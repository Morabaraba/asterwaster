(function(window,Object,undefined){"use strict";function WheelEventProxy(t,e){this._scaleFactor=t,this._deltaMode=e,this.originalEvent=null}if(!window.qc||!window.qc.Node){var deepCopy=function(t){var e=[],i=function(t,e){for(var i in t)if(t[i]==e)return!0;return!1},r=function(t){if("object"!=typeof t||null===t)return t;if(i(e,t))return t;e.push(t);var n={};t.constructor===Array&&(n=[]);for(var o in t)t.hasOwnProperty(o)&&(n[o]=r(t[o]));return n};return r(t)},mixin=function(t,e,i){for(var r in e)i&&t[r]!==undefined||(t[r]=e[r]);return t};window.qc||(window.qc={});var qc=window.qc,Phaser=window.Phaser,PIXI=window.PIXI;mixin(qc,{PHASER_VERSION:Phaser.VERSION,GAMES:Phaser.GAMES,AUTO:Phaser.AUTO,CANVAS:Phaser.CANVAS,WEBGL:Phaser.WEBGL,HEADLESS:Phaser.HEADLESS,NONE:Phaser.NONE,LEFT:Phaser.LEFT,RIGHT:Phaser.RIGHT,UP:Phaser.UP,DOWN:Phaser.DOWN,scaleModes:Phaser.scaleModes}),this.qc=this.qc||{},this.qc.lang="",this.qc.locales={},this.qc.lc_get=function(t){if(qc.locales[qc.lang]&&qc.locales[qc.lang][t]){var e=qc.locales[qc.lang][t],i=!1;if(-1!==e.indexOf("<br>")?i="<br>":-1!==e.indexOf("&#10;")&&(i="&#10;"),i){var r=e.split(i),n="";for(var o in r)n+=r[o].replace(/^\s+/,"")+"\n";return n}return e}},this.qc.lc_format=function(t,e){var i=qc.lc_get(t);if(i){for(var r in e){var n=RegExp("{"+r+"}","g");i=i.replace(n,e[r])}return i}return qc.lang+":"+t};var Log=qc.Log=function(t){var e=this;e.game=t,e.enableTrace=!1};Log.prototype.trace=function(){if(this.game.remoteLogUrl){var t=qc.Util.formatString.apply(null,arguments);console.log(t);var e=new Date,i=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",i+" "+t,function(){})}else if(this.enableTrace){var t=qc.Util.formatString.apply(null,arguments);console.log(t)}},Log.prototype.important=function(){var t=qc.Util.formatString.apply(null,arguments);if(console.log("%c"+t,"color:green"),this.game.remoteLogUrl){var e=new Date,i=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",i+" "+t,function(){})}},Log.prototype.error=function(){var t=qc.Util.formatString.apply(null,arguments);console.log("%c"+t,"color:red");for(var e,i=1;i<arguments.length;i++)if(arguments[i]&&arguments[i].stack){e=arguments[i].stack,console.error(e);break}this.game.remoteLogUrl&&qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+e?e:t,function(){}),e||console.trace()},Log.prototype.remoteReply=function(){var t=qc.Util.formatString.apply(null,arguments);console.log("%c"+t,"color:green"),qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",t,function(){})},qc.Circle=Phaser.Circle,Object.defineProperty(qc.Circle.prototype,"class",{get:function(){return"qc.Circle"}}),qc.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]},qc.Circle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.diameter=t[2]},qc.Ellipse=Phaser.Ellipse,Object.defineProperty(qc.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}}),qc.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Ellipse.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]},qc.Line=Phaser.Line,Object.defineProperty(qc.Line.prototype,"class",{get:function(){return"qc.Line"}}),qc.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]},qc.Line.prototype.fromJson=function(t){this.start.setTo(t[0],t[1]),this.end.setTo(t[2],t[3])},qc.Matrix=Phaser.Matrix,Object.defineProperty(qc.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}}),qc.Matrix.prototype.toJson=function(){return this.toArray()},qc.Matrix.prototype.fromJson=function(t){this.fromArray(t)},qc.Point=Phaser.Point,Object.defineProperty(qc.Point.prototype,"class",{get:function(){return"qc.Point"}}),qc.Point.prototype.toJson=function(){return[this.x,this.y]},qc.Point.prototype.fromJson=function(t){this.x=t[0],this.y=t[1]},qc.Polygon=Phaser.Polygon,Object.defineProperty(qc.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}}),qc.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]},qc.Polygon.prototype.fromJson=function(t){this.setTo(t[0]),this.closed=t[1]},qc.Rectangle=Phaser.Rectangle,Object.defineProperty(qc.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}}),qc.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Rectangle.prototype.fromJson=function(t){this.setTo(t[0],t[1],t[2],t[3])},qc.RoundedRectangle=Phaser.RoundedRectangle,Object.defineProperty(qc.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}}),qc.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]},qc.RoundedRectangle.prototype.fromJson=function(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3],this.radius=t[4]};var Keyframe=qc.Keyframe=function(t,e,i,r){this.time=t,this.value=e,this.type=Keyframe.FREE_SMOOTH,this.inTangent=isNaN(i)?0:i,this.outTangent=isNaN(r)?0:r};Keyframe.prototype={},Keyframe.prototype.constructor=Keyframe,Keyframe.prototype.clone=function(){var t=new Keyframe(this.time,this.value,this.inTangent,this.outTangent);return t.type=this.type,t},Keyframe.AUTO=0,Keyframe.FREE_SMOOTH=1,Keyframe.FLAT=2,Keyframe.BROKEN=3,Keyframe.LINEAR=4,Keyframe.InfinityValue=Math.tan(Math.PI/2),Object.defineProperties(Keyframe.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(t){this.inTangent=Math.tan(t*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(t){this.outTangent=Math.tan(t*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(t){this._inTangent=Math.abs(t)===Keyframe.InfinityValue?1/0*(0>t?-1:1):t}},outTangent:{get:function(){return this._outTangent||0},set:function(t){this._outTangent=Math.abs(t)===Keyframe.InfinityValue?1/0*(0>t?-1:1):t}},isFlat:{get:function(){return this.inTangent===this.outTangent&&0===this.outTangent}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var BezierCurve=qc.BezierCurve=function(t){if(this._keys=[],Array.isArray(t))for(var e in t)this.addKey(t[e]);else for(var e=0;e<arguments.length;++e)this.addKey(arguments[e])};BezierCurve.prototype={},BezierCurve.prototype.constructor=BezierCurve,Object.defineProperties(BezierCurve.prototype,{"class":{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(t){this._keys=[];for(var e in t)this.addKey(t[e])}},length:{get:function(){return this._keys.length}},startTime:{get:function(){return this.keys&&this.keys.length?this.keys[0].time:0}},endTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time:0}},totalTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time-this.keys[0].time:0}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?BezierCurve.WRAP_CLAMP:this._postWrapMode},set:function(t){this._postWrapMode=t}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?BezierCurve.WRAP_CLAMP:this._preWrapMode},set:function(t){this._preWrapMode=t}}}),BezierCurve.prototype.toJson=function(){for(var t=[],e=0;e<this._keys.length;++e)t.push([this._keys[e].time,this._keys[e].value,1/0===this._keys[e].inTangent?"Infinity":this._keys[e].inTangent,1/0===this._keys[e].outTangent?"Infinity":this._keys[e].outTangent]);return t.push([this.preWrapMode,this.postWrapMode]),t},BezierCurve.prototype.fromJson=function(t){for(var e=0;e<t.length;++e)4===t[e].length&&this.addKey(t[e][0],t[e][1],"Infinity"===t[e][2]?1/0:t[e][2],"Infinity"===t[e][3]?1/0:t[e][3]);2===t[t.length-1].length&&(this.preWrapMode=t[t.length-1][0],this.postWrapMode=t[t.length-1][1])},BezierCurve.prototype.sort=function(){this._keys.sort(function(t,e){return t.time-e.time})},BezierCurve.prototype.addKey=function(t,e,i,r){var n=!(t instanceof Keyframe)&&(isNaN(i)||isNaN(r)),o=t instanceof Keyframe?t:new Keyframe(t,e,i,r),s=qc.Util.insertSortedList(this._keys,o,this._keyframeLess);return n&&this.makeKeyframeAuto(s),s},BezierCurve.prototype.removeKey=function(t){return this._keys?this._keys.splice(t,1):null},BezierCurve.prototype._keyframeLess=function(t,e){return t.time<e.time},BezierCurve.prototype._calc=function(t,e,i,r,n){var o=Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*i+3*(1-t)*Math.pow(t,2)*n+r*Math.pow(t,3);return 1/0===o||isNaN(o)||Math.abs(o)>=2147483647?1===t?r:e:o},BezierCurve.prototype._calcDerivative=function(t,e,i,r,n){var o=1-t,s=-3*e*o*o+3*i*o*(1-3*t)+3*n*t*(2-3*t)+3*r*Math.pow(t,2);return 1/0===s||isNaN(s)?0:s},BezierCurve.prototype.evaluate=function(t,e){var i=0,r=this._keys?this._keys.length:0;if(0===r)return 0/0;if(1===r)return this._keys[0].value;var n=this._keys[0].time,o=this._keys[r-1].time,s=o-n;if(n>t){if(0===s||this.preWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[0].value;if(this.preWrapMode===BezierCurve.WRAP_LOOP){var a=n-t;return a-=Math.floor(a/s)*s,this.evaluate(o-a,e)}if(this.preWrapMode===BezierCurve.WRAP_PINGPONG){var a=n-t;return a-=2*Math.floor(a/(2*s))*s,a>s?this.evaluate(o-a+s,e):this.evaluate(n+a,e)}}if(t>o){if(0===s||this.postWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[r-1].value;if(this.postWrapMode===BezierCurve.WRAP_LOOP){var a=t-o;return a-=Math.floor(a/s)*s,this.evaluate(n+a,e)}if(this.postWrapMode===BezierCurve.WRAP_PINGPONG){var a=t-o;return a-=2*Math.floor(a/(2*s))*s,a>s?this.evaluate(n+a-s,e):this.evaluate(o-a,e)}}t===n&&e&&this.preWrapMode!==BezierCurve.WRAP_CLAMP&&(t=o);for(var h;++i<r;)if(h=this._keys[i].time,h!==n){if(h>=t){var l=h-n,c=(this._keys[i].value-this._keys[i-1].value,(t-n)/l),u=this._calc(c,this._keys[i-1].value,this._keys[i-1].value+l*this._keys[i-1].outTangent/3,this._keys[i].value,this._keys[i].value-l*this._keys[i].inTangent/3);return u}n=this._keys[i].time}return 0/0},BezierCurve.prototype.evaluateDerivative=function(t){var e=0,i=this._keys?this._keys.length:0;if(0===i)return 0/0;var r=this._keys[0].time;if(r>t||t>this._keys[i-1].time)return 0/0;for(var n;++e<i;)if(n=this._keys[e].time,n!==r){if(n>t){var o=n-r,s=(t-r)/o,a=this._calcDerivative(s,this._keys[e-1].value,this._keys[e-1].value+o*this._keys[e-1].outTangent/3,this._keys[e].value,this._keys[e].value-o*this._keys[e].inTangent/3);return a/o}r=this._keys[e].time}return 0/0},BezierCurve.prototype.makeKeyframeAuto=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t>this._keys.length-1||0>t?null:this._keys[t+1],n=0,o=0;e&&(i&&(n++,o+=Math.atan2(e.value-i.value,e.time-i.time)),r&&(n++,o+=Math.atan2(r.value-e.value,r.time-e.time)),n>0&&(e.inTangent=e.outTangent=Math.tan(o/n)))},BezierCurve.prototype.makeKeyframeSmooth=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;if(e){var i=Math.atan(e.inTangent)+Math.atan(e.outTangent);e.inTangent=e.outTangent=Math.tan(i/2)}},BezierCurve.prototype.makeKeyframeFlat=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null;e&&(e.inTangent=e.outTangent=0)},BezierCurve.prototype.makeKeyframeLinear=function(t){var e=t>=0&&t<this._keys.length?this.keys[t]:null,i=t>0&&t<this._keys.length?this._keys[t-1]:null,r=t>this._keys.length-1||0>t?null:this._keys[t+1];e&&(i&&(e.inTangent=(e.value-i.value)/(e.time-i.time)),r&&(e.outTangent=(r.value-e.value)/(r.time-e.time)))},BezierCurve.prototype.clone=function(){var t=new BezierCurve([]);for(var e in this._keys)t.addKey(this._keys[e].clone());return t},BezierCurve.WRAP_CLAMP=0,BezierCurve.WRAP_LOOP=1,BezierCurve.WRAP_PINGPONG=2;var GeometricTool=qc.GeometricTool={};GeometricTool.flattenPolygon=function(t){for(var e=Array(2*t.length),i=t.length;i--;)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},GeometricTool.polygonContains=function(t,e,i){if(isNaN(t[0])){for(var r=t.length,n=!1,o=-1,s=r-1;++o<r;s=o){var a=t[o].x,h=t[o].y,l=t[s].x,c=t[s].y;(i>=h&&c>i||i>=c&&h>i)&&(l-a)*(i-h)/(c-h)+a>e&&(n=!n)}return n}for(var r=t.length/2,n=!1,o=-1,s=r-1;++o<r;s=o){var a=t[2*o],h=t[2*o+1],l=t[2*s],c=t[2*s+1];(i>=h&&c>i||i>=c&&h>i)&&(l-a)*(i-h)/(c-h)+a>e&&(n=!n)}return n},GeometricTool.pointOnLine=function(t,e,i,r){return(i-t.x)*(e.y-t.y)===(e.x-t.x)*(r-t.y)},GeometricTool.pointOnSegment=function(t,e,i,r){var n=Math.min(t.x,e.x),o=Math.max(t.x,e.x),s=Math.min(t.y,e.y),a=Math.max(t.y,e.y);return qc.GeometricTool.pointOnLine(t,e,i,r)&&i>=n&&o>=i&&r>=s&&a>=r},GeometricTool.lineIntersectsPoints=function(t,e,i,r,n,o){undefined===n&&(n=!0),o||(o=new qc.Point);var s=e.y-t.y,a=r.y-i.y,h=t.x-e.x,l=i.x-r.x,c=e.x*t.y-t.x*e.y,u=r.x*i.y-i.x*r.y,p=s*l-a*h;if(0===p)return null;if(t.equals(i)||t.equals(r))return o.x=t.x,o.y=t.y,o;if(e.equals(i)||e.equals(r))return o.x=e.x,o.y=e.y,o;if(o.x=(h*u-l*c)/p,o.y=(a*c-s*u)/p,n){var d=(r.y-i.y)*(e.x-t.x)-(r.x-i.x)*(e.y-t.y),f=((r.x-i.x)*(t.y-i.y)-(r.y-i.y)*(t.x-i.x))/d,g=((e.x-t.x)*(t.y-i.y)-(e.y-t.y)*(t.x-i.x))/d;return 0>f||f>1||0>g||g>1?null:o}return o};var inside=GeometricTool._sutherlandHodgmanInside=function(t,e,i,r){return(e.x-t.x)*(i.y-t.y)+r>=(e.y-t.y)*(i.x-t.x)},intersection=GeometricTool._sutherlandHodgmanIntersection=function(t,e,i,r){var n=[t.x-e.x,t.y-e.y],o=[i.x-r.x,i.y-r.y],s=t.x*e.y-t.y*e.x,a=i.x*r.y-i.y*r.x,h=1/(n[0]*o[1]-n[1]*o[0]);return{x:(s*o[0]-a*n[0])*h,y:(s*o[1]-a*n[1])*h}};GeometricTool.sutherlandHodgman=function(t,e){var i,r,n,o,s,a,h=1e-6,l=t;i=e[e.length-1];for(s in e){var r=e[s],c=l;l=[],n=c[c.length-1];for(a in c){var o=c[a];inside(i,r,o,h)?(inside(i,r,n,h)||l.push(intersection(i,r,n,o)),l.push(o)):inside(i,r,n,h)&&l.push(intersection(i,r,n,o)),n=o}i=r}return l},GeometricTool.Triangulate=function(t){var e=!0,i=t.length;if(3>i)return[];for(var r=[],n=[],o=0;i>o;o++)n.push(o);o=0;for(var s=i;s>3;){var a=n[(o+0)%s],h=n[(o+1)%s],l=n[(o+2)%s],c=t[a].x,u=t[a].y,p=t[h].x,d=t[h].y,f=t[l].x,g=t[l].y,m=!1;if(PIXI.PolyK._convex(c,u,p,d,f,g,e)){m=!0;for(var _=0;s>_;_++){var y=n[_];if(y!==a&&y!==h&&y!==l&&PIXI.PolyK._PointInTriangle(t[y].x,t[y].y,c,u,p,d,f,g)){m=!1;break}}}if(m)r.push(a,h,l),n.splice((o+1)%s,1),s--,o=0;else if(o++>3*s){if(!e)return null;for(r=[],n=[],o=0;i>o;o++)n.push(o);o=0,s=i,e=!1}}return r.push(n[0],n[1],n[2]),r},GeometricTool.area=function(t,e,i){return t&&e&&i?(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y):0},GeometricTool.left=function(t,e,i){return GeometricTool.area(t,e,i)>0},GeometricTool.leftOn=function(t,e,i){return GeometricTool.area(t,e,i)>=0},GeometricTool.right=function(t,e,i){return GeometricTool.area(t,e,i)<0},GeometricTool.rightOn=function(t,e,i){return GeometricTool.area(t,e,i)<=0},GeometricTool.distance=function(t,e){var i=e.x-t.x,r=e.y-t.y;return i*i+r*r},GeometricTool.atPolygon=function(t,e){var i=t.length;return t[0>e?e%i+i:e%i]},GeometricTool.lineInt=function(t,e,i){i=i||0;var r,n,o,s,a,h,l,c=new qc.Point;return r=t[1].y-t[0].y,n=t[0].x-t[1].x,o=r*t[0].x+n*t[0].y,s=e[1].y-e[0].y,a=e[0].x-e[1].x,h=s*e[0].x+a*e[0].y,l=1/(r*a-s*n),GeometricTool._equals(l,0,i)||(c.x=(a*o-n*h)*l,c.y=(r*h-s*o)*l),c},GeometricTool.isPolygonReflex=function(t,e){return GeometricTool.right(GeometricTool.atPolygon(t,e-1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,e+1))},GeometricTool.polygonCanSee=function(t,e,i){var r,n,o=[],s=[];if(GeometricTool.leftOn(GeometricTool.atPolygon(t,e+1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,e-1),GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i)))return!1;n=GeometricTool.distance(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i));for(var a=0;a!=t.length;++a)if((a+1)%t.length!==e&&a!==e&&GeometricTool.leftOn(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i),GeometricTool.atPolygon(t,a+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,e),GeometricTool.atPolygon(t,i),GeometricTool.atPolygon(t,a))&&(o[0]=GeometricTool.atPolygon(t,e),o[1]=GeometricTool.atPolygon(t,i),s[0]=GeometricTool.atPolygon(t,a),s[1]=GeometricTool.atPolygon(t,a+1),r=GeometricTool.lineInt(o,s),GeometricTool.distance(GeometricTool.atPolygon(t,e),r)<n))return!1;return!0},GeometricTool._equals=function(t,e,i){return i=i||0,Math.abs(t-e)<i},GeometricTool.getIntersectionPoint=function(t,e,i,r,n){n=n||0;var o=e.y-t.y,s=t.x-e.x,a=o*t.x+s*t.y,h=r.y-i.y,l=i.x-r.x,c=h*i.x+l*i.y,u=o*l-h*s;return GeometricTool._equals(u,0,n)?{x:0,y:0}:{x:(l*a-s*c)/u,y:(o*c-h*a)/u}},GeometricTool.quickDecomp=function(t,e,i,r,n,o,s){o=o||100,s=s||0,n=n||25,e=undefined!==e?e:[],i=i||[],r=r||[];var a=[0,0],h=[0,0],l=[0,0],c=0,u=0,p=0,d=0,f=0,g=0,m=0,_=[],y=[],v=t;if(v.length<3)return e;if(s++,s>o)return e;for(var T=0;T<v.length;++T)if(GeometricTool.isPolygonReflex(v,T)){i.push(v[T]),c=u=Number.MAX_VALUE;for(var x=0;x<v.length;++x)GeometricTool.left(GeometricTool.atPolygon(v,T-1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,T-1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x-1))&&(l=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(v,T-1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,x-1)),GeometricTool.right(GeometricTool.atPolygon(v,T+1),GeometricTool.atPolygon(v,T),l)&&(p=GeometricTool.distance(v[T],l),u>p&&(u=p,h=l,g=x))),GeometricTool.left(GeometricTool.atPolygon(v,T+1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,T+1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x))&&(l=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(v,T+1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x),GeometricTool.atPolygon(v,x+1)),GeometricTool.left(GeometricTool.atPolygon(v,T-1),GeometricTool.atPolygon(v,T),l)&&(p=GeometricTool.distance(v[T],l),c>p&&(c=p,a=l,f=x)));if(g==(f+1)%v.length)l.x=(h.x+a.x)/2,l.y=(h.y+a.y)/2,r.push(l),f>T?(Array.prototype.push.apply(_,v.slice(T,f+1)),_.push(l),y.push(l),0!=g&&Array.prototype.push.apply(y,v.slice(g,v.length)),Array.prototype.push.apply(y,v.slice(0,T+1))):(0!=T&&Array.prototype.push.apply(_,v.slice(T,v.length)),Array.prototype.push.apply(_,v.slice(0,f+1)),_.push(l),y.push(l),Array.prototype.push.apply(y,v.slice(g,T+1)));else{if(g>f&&(f+=v.length),d=Number.MAX_VALUE,g>f)return e;for(var x=g;f>=x;++x)GeometricTool.leftOn(GeometricTool.atPolygon(v,T-1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x))&&GeometricTool.rightOn(GeometricTool.atPolygon(v,T+1),GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x))&&(p=GeometricTool.distance(GeometricTool.atPolygon(v,T),GeometricTool.atPolygon(v,x)),d>p&&(d=p,m=x%v.length));m>T?(Array.prototype.push.apply(_,v.slice(T,m+1)),0!=m&&Array.prototype.push.apply(y,v.slice(m,v.length)),Array.prototype.push.apply(y,v.slice(0,T+1))):(0!=T&&Array.prototype.push.apply(_,v.slice(T,v.length)),Array.prototype.push.apply(_,v.slice(0,m+1)),Array.prototype.push.apply(y,v.slice(m,T+1)))}return _.length<y.length?(GeometricTool.quickDecomp(_,e,i,r,n,o,s),GeometricTool.quickDecomp(y,e,i,r,n,o,s)):(GeometricTool.quickDecomp(y,e,i,r,n,o,s),GeometricTool.quickDecomp(_,e,i,r,n,o,s)),e}return e.push(v),e},GeometricTool.decomp=function(t){var e=GeometricTool.getCutEdges(t);return e.length>0?GeometricTool.polygonSlice(t,e):[t]},GeometricTool.polygonSlice=function(t,e){if(0===e.length)return[this];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2==e[0].length&&e[0][0]instanceof Array){for(var i=[t],r=0;r<e.length;r++)for(var n=e[r],o=0;o<i.length;o++){var s=i[o],a=GeometricTool.polygonSlice(s,n);if(a){i.splice(o,1),i.push(a[0],a[1]);break}}return i}var n=e,r=t.indexOf(n[0]),o=t.indexOf(n[1]);return-1!=r&&-1!=o?[GeometricTool.copyPolygon(t,r,o),GeometricTool.copyPolygon(t,o,1)]:!1},GeometricTool.copyPolygon=function(t,e,i,r){var n=r||[];if(i>e)for(var o=e;i>=o;o++)n.push(t[o]);else{for(var o=0;i>=o;o++)n.push(t[o]);for(var o=e;o<t.length;o++)n.push(t[o])}return n},GeometricTool.getCutEdges=function(t){for(var e=[],i=[],r=[],n=Number.MAX_VALUE,o=0;o<t.length;++o)if(GeometricTool.isPolygonReflex(t,o))for(var s=0;s<t.length;++s)if(GeometricTool.polygonCanSee(t,o,s)){i=GeometricTool.getCutEdges(GeometricTool.copyPolygon(t,o,s)),r=GeometricTool.getCutEdges(GeometricTool.copyPolygon(t,s,o));for(var a=0;a<r.length;a++)i.push(r[a]);i.length<n&&(e=i,n=i.length,e.push([GeometricTool.atPolygon(t,o),GeometricTool.atPolygon(t,s)]))}return e};var AssetUtil=qc.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_ACTION:9,ASSET_ACTIONMANAGER:10,ASSET_TS:99,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(t,e,i){var r,n=e.key,o=e.url;if(!/\.bin$/.test(o)){if(e.isRaw)this._addAtlasToCache(t,n,o);else{var s=t.assets._cache.getSound(o);if(s){var a=new qc.SoundAsset(n,o,s.data,{uuid:n,type:AssetUtil.ASSET_SOUND});t.assets.cache(n,o,a)}}return i&&i(),undefined}if(e.isSound){var h=t.assets._cache.getBinary(o);delete t.assets._cache._binary[o];var l,c,u=new Uint8Array(h);if(81!==u[0]||67!==u[1])return t.log.error("Asset({0}) parse fail",o),t.assets._parsing--,undefined;l=u,c=2;var p=function(){var t=l[c]<<24|l[c+1]<<16|l[c+2]<<8|l[c+3],e=c+4;return c+=t+4,[e,t]};r=[];var d;d=p(),r.push(t.serializer.unpackUTF8(l.subarray(d[0],d[0]+d[1]))),d=p(),r.push(h.slice(d[0],d[1]))}else{var h=t.assets._cache.getText(o);delete t.assets._cache._text[o];try{r=JSON.parse(h)}catch(f){return t.log.error("Asset{0}/{1} Parse fail",n,o),qc.Util.popupError(f.message),i&&i(),undefined}}var g=JSON.parse(r[0]);switch(g.type){case AssetUtil.ASSET_ATLAS:return AssetUtil._parseAtlas(t,g,JSON.parse(r[1]),r[2],r[3]?JSON.parse(r[3]):undefined,n,o,i);case AssetUtil.ASSET_PREFAB:return AssetUtil._parsePrefab(t,JSON.parse(r[1]),n,o,g,i);case AssetUtil.ASSET_SCENE:return AssetUtil._parseScene(t,JSON.parse(r[1]),n,o,g,i);case AssetUtil.ASSET_TEXT:return AssetUtil._parseText(t,r[1],n,o,g,i);case AssetUtil.ASSET_FONT:return AssetUtil._parseFont(t,g,r[1],r[2],n,o,i);case AssetUtil.ASSET_SOUND:return AssetUtil._parseSound(t,g,r[1],n,o,i);case AssetUtil.ASSET_EXCEL:return AssetUtil._parseExcel(t,g,JSON.parse(r[1]),n,o,i);case AssetUtil.ASSET_WEBFONT:return AssetUtil._parseWebFont(t,g,JSON.parse(r[1]),n,o,i);case AssetUtil.ASSET_ACTION:return AssetUtil._parseAction(t,JSON.parse(r[1]),n,o,g,i);case AssetUtil.ASSET_ACTIONMANAGER:return AssetUtil._parseActionManager(t,JSON.parse(r[1]),n,o,g,i);default:throw Error("unsupported asset type："+g.type)}},isSound:function(t){if(qc.Util.isArray(t)){for(var e=0;e<t.length;e++)if(t[e]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t[e].toLowerCase()))return!0;return!1}return t&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(t.toLowerCase())},_parseAtlas:function(t,e,i,r,n,o,s,a){var h=new Image;h.src="data:image/png;base64,"+r,h.onerror=function(){h.onerror=undefined,a()},h.onload=function(){h.onload=undefined;var r=t.assets._cache;if(r._images[s]={url:s,data:h},PIXI.BaseTextureCache[s]=new PIXI.BaseTexture(h),PIXI.TextureCache[s]=new PIXI.Texture(PIXI.BaseTextureCache[s]),Object.keys(i).length>0)if(!n||e.animationType!==Sprite.DRAGON_BONES&&e.animationType!==Sprite.FRAME_SAMPLES)r._images[s].frameData=i&&qc.Util.isArray(i.frames)?Phaser.AnimationParser.JSONData(t.phaser,i,s):Phaser.AnimationParser.JSONDataHash(t.phaser,i,s);else{var l=qc.dragonBones.CoverAtlas(i);r._images[s].frameData=Phaser.AnimationParser.JSONDataHash(t.phaser,l,s)}else if(e.spriteSheet){var c=h.width/(e.spriteSheet.columns||1),u=h.height/(e.spriteSheet.rows||1),p=e.spriteSheet.margin||0,d=e.spriteSheet.spacing||0;r._images[s].frameData=Phaser.AnimationParser.spriteSheet(t.phaser,s,c,u,-1,p,d)}else r._images[s].frameData=new Phaser.FrameData,r._images[s].frame=new Phaser.Frame(0,0,0,h.width,h.height,"",""),r._images[s].frameData.addFrame(new Phaser.Frame(0,0,0,h.width,h.height,null,t.math.uuid()));r._resolveURL(s,r._images[s]);var f=new qc.Atlas(o,s,r._images[s],e,n);f.json=i,f.img=h,t.assets.cache(o,s,f),a()}},addAtlasFromImage:function(t,e,i,r){return t.assets._cache.addImage(i,i,r),this._addAtlasToCache(t,e,i)},_addAtlasToCache:function(t,e,i){var r=t.assets._cache._images[i],n=new qc.Atlas(e,i,r,{uuid:t.math.uuid(),type:AssetUtil.ASSET_ATLAS});return n.img=r.data,t.assets.cache(e,i,n),n},_parseFont:function(t,e,i,r,n,o,s){r=t.assets._loader.parseXml(r);var a=new Image;a.src="data:image/png;base64,"+i,a.onerror=function(){a.onerror=undefined,s()},a.onload=function(){a.onload=undefined;var i=new qc.Font(n,o,a,r,e);i._fontFamily=qc.UIText.BITMAPFONT,t.assets._cache.addBitmapFont(o,o,a,r,i.xSpacing,i.ySpacing),t.assets.cache(n,o,i),s()}},_parseText:function(t,e,i,r,n,o){t.assets._cache.addText(r,r,e),t.assets.cache(i,r,new qc.TextAsset(i,r,e,n)),o()},_parseScene:function(t,e,i,r,n,o){return AssetUtil._parsePrefab(t,e,i,r,n,o)},_parsePrefab:function(t,e,i,r,n,o){t.assets.cache(i,r,new Prefab(i,r,e,n)),o()},_parseAction:function(t,e,i,r,n,o){t.assets.cache(i,r,new ActionAsset(i,r,e,n)),o()},_parseActionManager:function(t,e,i,r,n,o){t.assets.cache(i,r,new ActionManagerAsset(i,r,e,n)),o()},_parseSound:function(t,e,i,r,n,o){if(t.assets._cache.addSound(n,n,i),t.assets._cache.isSoundDecoded(n)){var s=new qc.SoundAsset(r,n,t.phaser.cache.getSound(n),e);t.assets.cache(r,n,s),o()}else t.sound.phaser.decode(n,{url:n,key:r,meta:e,nextStep:o})},_parseExcel:function(t,e,i,r,n,o){t.assets.cache(r,n,new qc.ExcelAsset(r,n,i,e)),o()},_parseWebFont:function(t,e,i,r,n,o){AssetUtil._deleteWebFont(e.uuid),AssetUtil._loadWebFont(t,e.uuid,i.url);var s=new qc.Font(e.uuid,n,s,null,e);s._fontUrl="string"==typeof i.url?[i.url]:i.url,s._fontFamily=qc.UIText.WEBFONT,t.assets.cache(r,""+n,s),o(),window.WebFont&&WebFont.load({timeout:6e4,custom:{families:[e.uuid]},fontactive:function(i){t.world&&(Object.keys(PIXI.Text.fontPropertiesCache).forEach(function(t){t.indexOf(e.uuid)<0||delete PIXI.Text.fontPropertiesCache[t]}),AssetUtil._refreshWebFont(i,t.world)),t.assets.webFontLoaded.dispatch()},fontinactive:function(e){t.log.error("Load "+e+" fail")}})},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(t,e,i){var r=AssetUtil._webFontType,n=document.createElement("style");n.type="text/css",n.id="qc.webfont."+e,document.getElementsByTagName("head")[0].appendChild(n);var o="@font-face { font-family:"+e+"; src:";if(qc.Util.isArray(i))for(var s=0,a=i.length;a>s;s++){var h=(i[s],AssetUtil._getSuffix(i[s]));o+=i[s].indexOf("http")<0?"url('"+(t.assets.baseURL+i[s])+"') format('"+r[h]+"')":"url('"+i[s]+"') format('"+r[h]+"')",o+=s===a-1?";":","}else{var h=AssetUtil._getSuffix(i);o+="url('"+i+"') format('"+r[h]+"');"}n.textContent+=o+"};"},_deleteWebFont:function(t){for(;;){var e=document.getElementById("qc.webfont."+t);if(!e)break;qc.Util.removeHTML(e)}},_refreshWebFont:function(t,e){e instanceof qc.UIText&&e._refreshWebFont(t);for(var i=e.children,r=i.length;r--;){var n=i[r];AssetUtil._refreshWebFont(t,n)}},_getSuffix:function(t){var e=t.substr((Math.max(0,t.lastIndexOf("."))||1/0)+1);return e.toLowerCase()},_createStandardXHR:function(){try{return new window.XMLHttpRequest}catch(t){}},_createActiveXHR:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}},getXHR:function(){var t;try{t=location.href}catch(e){t=document.createElement("a"),t.href="",t=t.href}var i=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,r=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,n=i.exec(t.toLowerCase())||[],o=r.test(n[1]),s=window.ActiveXObject?function(){return!o&&AssetUtil._createStandardXHR()||AssetUtil._createActiveXHR()}:AssetUtil._createStandardXHR;return s()},get:function(t,e,i){var r=AssetUtil.getXHR();r.open("GET",t,!0),r.responseType="text",r.onreadystatechange=function(){4===r.readyState&&(200===r.status?e(r.responseText):i&&i(r))},r.send()},post:function(t,e,i,r){var n=AssetUtil.getXHR();n.open("POST",t,!0),n.responseType="text",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?i(n.responseText):r&&r(n))},n.send(e)}},Assets=qc.Assets=function(t,e,i){this._loader=e,this._cache=i,this.game=t,e._qc=this,i._qc=this,this._uuid2UrlConf=window.urlMapConfig||{},this._uuid2UrlConf.__builtin_resource__="__builtin_resource__",this.assetCountMap=window.assetCountMap||{},this.batchTotalCount=0,this.batchCurCount=0,this.batchLoadFlag=!1,this.maxRetryTimes=1,this.webFontLoaded=new qc.Signal,this._parsing=0,this._loaderTimerMutex=-1024,this._assets={},this._keyUrl={},this._complete={};var r=this;e.onFileComplete.add(function(t,e,i){if(!i){var n=r._complete[e];if(!n||0===n.length)return;return n[0].retry<r.maxRetryTimes?(r.game.timer.add(1e3,function(){r.game.log.trace("Retry download:{0}",e),n[0].retry++,r._internalLoad(n[0])}),undefined):(r.game.log.important("Asset({0}) load fail",e),r._callCb(e,null,n[0]),undefined)}r._parseAsset(e)}),t.sound.phaser.onSoundDecode.add(function(e,i){var n=r.game.phaser.cache.getSound(e);if(n&&n.decoded){var o=new qc.SoundAsset(i.key,i.url,n,i.meta);t.assets.cache(i.key,i.url,o)}i.nextStep()}),this._loadBuiltin()};Assets.prototype={},Assets.prototype.constructor=Assets,Assets.IMAGE=1,Assets.AUDIO=2,Assets.TEXT=3,Assets.BITMAPFONT=4,Assets.BINARY=5,Assets.ATLAS=6,Assets.JSON=7,Object.defineProperties(Assets.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(t){this._loader.baseURL=t}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this.batchCurCount?this.batchCurCount:this._loader._loadedFileCount}},total:{get:function(){return this.batchTotalCount?this.batchTotalCount:this._loader._totalFileCount}}}),Assets.prototype.loadBatch=function(){var t=function(t,e,i,r){e.loaded=!1,t.load(e.key,e.url,function(t){e.loaded=!0,e.asset=t,e.callback&&e.callback(e);for(var n=0;n<i.length;n++)if(!i[n].loaded)return;r(i)},e.override,e.isRaw)};return function(e,i){this.beginBatchLoad();for(var r=0;r<e.length;r++)t(this,e[r],e,i);this.endBatchLoad()}}(),Assets.prototype._internalLoad=function(t){var e=this;t.retry||(t.retry=0),t.isSound=AssetUtil.isSound(t.url),t.isSound&&(t.url=e.game.sound.tryGetUrl(t.url));var i=t.url;if(!t.override){var r=e.find(i);if(r&&(!r.hasUnloadedDependence||!r.hasUnloadedDependence(this.game)))return e._keyUrl[t.key]=i,"__builtin_resource__"!==t.key&&e.batchTotalCount&&e.batchCurCount<e.batchTotalCount&&(t.inPrefab||(e.batchCurCount+=1,e.game.log.trace("Asset {0} load from cache: {1} / {2}",i,e.batchCurCount,e.batchTotalCount))),t.callback&&t.callback(r),undefined}if("__builtin_resource__"!==t.key){var n=e._loader;0===t.retry&&(e._complete[i]?e._complete[i].push(t):e._complete[i]=[t]),t.isSound?i.indexOf(".bin")<0?n.audio(i,i):AssetUtil.isSound(i)&&n.binary(i,i):t.isRaw?n.image(i,i):n.text(i,i),e.start()}},Assets.prototype.load=function(){var t,e,i,r=this,n=!1,o=!1,s=!1;if(1===arguments.length?e=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1]):(e=arguments[0],i=arguments[1]):(t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],o=arguments[4],s=arguments[5]),t=t||e,!e)throw Error("url is empty.");var a={key:t,url:e,callback:i,override:n,isRaw:o,inPrefab:s};if(r.batchLoadFlag&&"__builtin_resource__"!==t){var h=r.assetCountMap[e]||1;r.batchTotalCount+=h}else r.batchLoadFlag||"__builtin_resource__"===t||r.batchTotalCount&&r.batchCurCount>=r.batchTotalCount&&(r.batchTotalCount=r.batchCurCount=0);r.game.phaser.state._created?r.game.timer.add(1,function(){r._internalLoad(a)}):r._internalLoad(a)},Assets.prototype.beginBatchLoad=function(){this.batchLoadFlag=!0,this.batchTotalCount=0,this.batchCurCount=0},Assets.prototype.endBatchLoad=function(){this.batchLoadFlag=!1},Assets.prototype.loadByUUID=function(t,e,i,r){var n=this,o=this._uuid2UrlConf[t];return o?(this.load(t,o,e,i,!1,r),undefined):(this.game.log.important("UUID({0}) not found.",t),n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(r||(n.batchCurCount+=1,n.game.log.trace("Asset {0} load failed: {1} / {2}",t,n.batchCurCount,n.batchTotalCount))),e&&e(),undefined)
},Assets.prototype.loadTexture=function(){var t,e,i,r,n=this;if(1===arguments.length?"string"==typeof arguments[0]?e=arguments[0]:i=arguments[0]:2===arguments.length?"string"==typeof arguments[0]&&"function"==typeof arguments[1]?(e=arguments[0],r=arguments[1]):"function"==typeof arguments[1]?(i=arguments[0],r=arguments[1]):(t=arguments[0],e=arguments[1]):"string"==typeof arguments[1]?(t=arguments[0],e=arguments[1],r=arguments[2]):(t=arguments[0],i=arguments[1],r=arguments[2]),t=t||e,i){if(!t)throw Error("key cannot be null.");n._keyUrl[t]=t;var o=AssetUtil.addAtlasFromImage(n.game,t,t,i);n.batchTotalCount&&n.batchCurCount<n.batchTotalCount&&(n.batchCurCount+=1,n.game.log.trace("Asset {0} loaded: {1} / {2}",t,n.batchCurCount,n.batchTotalCount)),r(o)}else n.load(t,e,r,!1,!0)},Assets.prototype.find=function(t){if(AssetUtil.isSound(t)&&(t=this.game.sound.tryGetUrl(t)),!qc.Util.isArray(t)){var e=this._keyUrl[t];return e?this._assets[e]:null}for(var i=0;i<t.length;i++){var r=this.find(t[i]);if(r)return r}},Assets.prototype.unload=function(t){if("string"==typeof t&&!this._keyUrl[t]){var e=AssetUtil.isSound(t);e&&(t=this.game.sound.tryGetUrl(t))}if(qc.Util.isArray(t))for(var i=0;i<t.length;i++)this.unload(t[i]);else if("string"==typeof t){var r=this._keyUrl[t];r&&(this._assets[r]&&this._assets[r].unload&&this._assets[r].unload(this.game),delete this._assets[r],delete this._keyUrl[t])}else this.unload(t.url)},Assets.prototype.findByUUID=function(t){for(var e in this._assets){var i=this._assets[e];if(i.uuid===t)return i}},Assets.prototype.cache=function(t,e,i){t=t||e,this._assets[e]=i,this._keyUrl[t]=e,this._keyUrl[e]=e},Assets.prototype.clear=function(){var t=this,e=Object.keys(PIXI.TextureCache);e.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&(PIXI.TextureCache[t].destroy(),delete PIXI.TextureCache[t])}),e=Object.keys(PIXI.BaseTextureCache),e.forEach(function(t){"__default"!==t&&"__missing"!==t&&"__builtin_resource__"!==t&&delete PIXI.BaseTextureCache[t]});var i=t._cache._images.__builtin_resource__;t._cache.destroy(),t._cache._images.__builtin_resource__=i,e=Object.keys(t._keyUrl),e.forEach(function(e){"__builtin_resource__"!==e&&delete t._keyUrl[e]}),e=Object.keys(t._assets),e.forEach(function(e){"__builtin_resource__"!==e&&delete t._assets[e]})},Assets.prototype.start=function(){var t=this;t.game.time.fixedTime-t._loaderTimerMutex<1||(t._loaderTimerMutex=t.game.time.fixedTime,t.game.timer.add(1,function(){t._loaderTimerMutex=-1024,t._loader.start()}))},Assets.prototype.addUrlConf=function(t,e){this._uuid2UrlConf[t]=e},Assets.prototype._parseAsset=function(t){var e=this,i=e._complete[t];if(i&&0!=i.length){var r=function(){e._parsing--;var r=e.find(t);if(r&&r.meta.type!==AssetUtil.ASSET_SCENE&&r.hasUnloadedDependence&&r.hasUnloadedDependence(e.game))for(var n in r.dependences){var o=r.dependences[n],s=function(n){var n=n;return function(o){if(!o){e.game.log.important("预制的依赖资源({0})加载失败.",n.uuid);var s=r.dependences[n.uuid];s&&(s.ok=!0)}r.hasUnloadedDependence(e.game)||e._callCb(t,r,i[0])}};e.loadByUUID(o.uuid,s(o),!1,!0)}else e._callCb(t,r,i[0])};e.nextStep=r,e._parsing++;try{AssetUtil.parse(this.game,i[0],r)}catch(n){e._parsing--,e.game.log.error("Asset({0}) Parse fail",t,n),qc.Util.popupError(n.message),e._callCb(t,null,i[0])}}},Assets.prototype._callCb=function(t,e){var i=this,r=i._complete[t];r&&(delete i._complete[t],r.forEach(function(r){e&&(i._keyUrl[r.key]=r.url),i.game.loadingProcessCallback&&(r.inPrefab||i.game.loadingProcessCallback(t,e,r)),i.batchTotalCount&&i.batchCurCount<i.batchTotalCount&&(r.inPrefab||(i.batchCurCount+=1,e?i.game.log.trace("Asset {0} loaded: {1} / {2}",t,i.batchCurCount,i.batchTotalCount):i.game.log.trace("Asset {0} load failed: {1} / {2}",t,i.batchCurCount,i.batchTotalCount))),r.callback&&r.callback(e)}))},Assets.prototype._loadBuiltin=function(){var t=this,e="__builtin_resource__",i="iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAURElEQVR4Xu1cCVRUR9au1w2NrL8LAoIoEFBJ0w8QIioJRBRB1BE1qCCLBCUaEyMBo6AnYlSYqIjGOaNxieKekBicIKIoZnFQiUjTiKgoIAoBo8ggi2z95tyXLv62pbtfb7Q61DkegXer6ta9X92qunVvEUiFQpLkSDabPUFfX5+HELJqbGy0pijqoYmJyROhUHitra2ttKOjI6ekpKRdhW5eqEpRFIEQGokQMlSx3WaE0C2CICim7URERERdu3ZtfF1dnUlTUxPTajSdkZERMjc3bxw9enReWlraPqaVeTzeBQ6H83ZHR4cOi8VCHA6HaVWUn58PspJaZH6U10sfAF5+AIAOZYFAYQC4uLi4GBgYLGltbQ1yc3Mb4Ofnh7hcLiIIAo0aNYrGzM2bNxFFUejKlSvo7NmzHaWlpVcJgthlb29/JD09vUsesOR937x5c3Z2drZfeXk5evLkiTzyHr8PGDAA2dnZIX9//zMrVqzwl9dIXFycz9GjRzdyOBz9hIQEWzs7O30Oh0PAOJkUkE97eztVXl7empSUVNHe3t4aEhKyesuWLbnS6ru6unoJhcKzlpaWeqGhoSgkJIRJVy/QENC5lMIYACRJ2hobG39tb2/vu2TJEuTh4aEQM7m5uSg1NfXhgwcPPuLz+ekKVRYRx8bGzjpy5MjxpqYm3bCwMDR9+nRka2uLwCyCIuQpA+QA/4RCIaqoqEA//fQTOnToEJjmjpCQEK+tW7de7omvNWvWOKSkpBxZt26dmZ+f3xCEEAf6VKZA3wih9jNnzvyxdu3ah7GxsfM3bNhQJtnWmDFjRrS3t99cu3YtERgYqExX3XVUBsDEiRO36+rqfrR48WLWjBkzVGLmwIED6JtvvrldX1/vW1JSUsW0sYSEBDI1NZUfFRVFzJ07F5mZmdGKh3+SAJcEQk/fQRHw7+HDh+jbb79F+/bto2JiYqySkpL+kOTJxsbmzOzZs4eHh4fbcTgcXfxdHuAk2xHno729vePgwYPlP/zww73Kyko/SVoej/d4xowZAxMTE1FHRwc9TswzU5lhOkNDQ+UsAJfLNTI1NT3v7e09BhgRHwAMvqur6zmmROimmYWCFcRms1+oGxkZ2czn86cXFRVdYDIge3v7/4wbN85kw4YNNLmuri6CdiXbFm8L+O1JSZh34B+EC2XNmjXo0qVLjXfu3Pk/sTa+gp8DAgJ8N2/eDBtcQ2VnvuQYQVYEQTSvWLHiflZW1gHR9y/d3d3pGfbGG29k7N+/n/6zokCT7EspAHC5XIv+/ftfmzlz5pDY2NjuNkFonZ2dtPIVKaAoHR0dWmG4xMbGCnNzcz/g8/l7ZbSVBt8sLS3DL1++TLcBu2A9PT26LawQGcvcc01jYYICYAxtbW2wNtNjGjt2LKqpqfm7qEI8Qugq/Hzjxg03aWBSRAY9WQTg58033ywQfXN3dnb+N/ycl5f3iCCIaTCPeh0AXC6XM2TIkBsBAQFvxMTEdKMQhIVnubIDB4WB8rDC4uLiqPPnz8/i8/kZUtqkd1lbt25F8+fPR/369XtO+XhdV4QfvF8QB8GzZ8/QkSNH0KeffoqbArNJA6C0tNSFoqj/R64incmhJQiiy9HRkY8BwOPxauDny5cv1xEE4aIVC+Dn55c1fvz4KZ9//jnNF54hahx390yGNhcsWNBRWFjIEwgEt3rogwbA1atX0ciRI1+Y+aryJA6CW7duIXd39xcAcPPmTRehUKgRALBYrK5Ro0aJA+ChCAA1BEE4Y2ZUsQIKLQF+fn7LjY2NU7/77jt6lsKsV9TcM1UKmHCwBjC4CRMmlJuZmY3o4ZhIA+Dx48fI2Nj4ObPPtB95dBgET58+RYMGDdIqAEiSvCECwFqE0He9CgAulzvQ2tq6ZtmyZXpTpkxBYBZVNfnyhA9LAph12Ilv3rw5rqCgIEWiDg0AUI6+vn6Pu355fcj7DgCEcba2ttIgE5XuJaA3LYCbm9sqUf/JFy9e7N4A9ooFIElyu7e397KvvvpKI2ZfmiLwxm7mzJlPy8rKTCVcxzQAWlpaaGuhrl24JC8AALB2BgYGWgUA7pwkybbY2FjOnDlzVJ6EjJaAcePG6ffv379h3bp1nNGjR9PC6M0Cyv3tt99QTExMNJ/P3yPWNw0AsEZw9NMkAOBICNZImxYAd/7WW29FdnR0fLNr1y7k7OzMyNElTV+MAODt7R2MEDr6888/06ZQFZOjDHBgvwEm3sPDoyQ/P99JEgAASAAA0+OeojzAeAEAAMSXAQDAg4uLy0aKolZ5enqyVq1ahQYPHqyUXgwMDOQ7gsLCwi7Y29u/Gx8f3+0cUVSIqtCDYmEpWLp0KZWXl2cKbZWUlNSDHwR+hpMIAECTBQAgdtOmlT2A5Pi8vLysnzx5UkAQxGCQD3hAxUDKSBwnT56UD4DZs2c3RkZGGk+cOFHlNYcRVz0QgXnPzMxEGzduBAcI4vP5pzAAwFEj7kRStg9Z9eC0A0J+WSwA8KEqAGQpH9onYOcPP1haWj5OTU0FF6RWAXD37l0UHh6+CXi6du3aSgwAmJ1iytGE/mlvoJiV0YojSCMDk9Eo4ezsPAa+6+joXMnOzkaGhoZKrTPqYByWgebmZuTr63taZAECMABgdmpqA4h5h5OAmJXpBsDt27dHd3V1Mb76ZSoLGC+bzaZGjBhxTVSH9kJRKm7AZN3+SfJGODk5+Yr+eBZ87fhqlekg1EmH/e1jx469BO0WFxePfxkAkJGRYWdjY2PSr18/trr8IiDnZ8+edVVWVjYGBgaWYwCoqvzu9YvhbplwcXGZCpU6OzszXyIAFIoAMBoDAK6R582bp/AGiClA4ZRx/PhxcEt3y/CDDz7wgl+ysrL+8eOPP9oaGhoaqTg5u9kRWbummTNnVgQEBHwEH77++utfex0APB7PGzrncDg/v0RLwK+iJcDbx8fnB/j54sWLsxobGzUKABMTE/T222+fgP5yc3NnY21ZWVldWLhw4fDAwMBhYAVEZpoptp6jwxMTZn9GRkbV3r1771VXV0/ARL0OAFdX1zehc3Nz85JNmzYhBwcHrW4Cy8rKUFRU1HHg6ffffwffBF2GDRv2dNKkSUY7d+6k+RNz2CilCFwJHExgjiHK6dy5c01VVVXdvmBMs3LlyvG7du3aFh8fb+7r62uhq6vLYWhhX+BN5G9oz8nJqU1OTq5bvHjx8i+//DJPawCAq1/onCTJZ/PmzSMmT56sNQDABgys0Pr16+OAJ/F7AYjb271796ng4GAWxCfY29urpHhc+c6dOyglJQUdO3ZMGB0dPRXiDXtqGMcEGhgYGMbHx9vY2trqw6mE6Z4AQAanjIqKitbk5OTKlpaW5p5iAnvdAuDBfvjhh9WDBg2yXL16NT0oda11TLUEMwqEBB6vCxcu0AGHRUVF+eL1RTGBx5qbmzkQjArX1TweRKQrXoqLi9EXX3yBzpw5Ayef9vnz5wenpKTQ5l9aiY6O1m1ra4u8evWq559//mmgTFj44MGDW9zd3f+tp6e3f/fu3X+FI4kVrQHg/fff33v37t2onJwcGqnaAADMKG9v72dDhw41Apn0FEGcmJjIqa6uTrx3715kS0uLBVwSKVPg0sfAwKB2+PDh+62srBITExPl5i681gDg8Xhu9vb2V5cvX05H/GoqBkCassD85+fngwX4V15entTIU20CQBmgKVpHaxYAGOVyuVXvvvuuNYRfAQB6ywqIHCIoOjoavH/uxcXFOEZOUfm9MvQ8Hi+SIIi5XV1dfxO//tYqAHx8fIIHDRp0FBIQICCkt6wAzP7Tp0+jbdu2CX755ZfuMChp2oyIiFhTWFjoX1dXN1CZddjc3Lze1dU1Oy0t7a8QYy0UcQBA9xgEWgUAMBITE3OzpqZmJDheoDDd5SorQ+zenTt3LlVVVTWaz+fj+DipTb7qAODxeIcIgggVDXAp/C8QCP4J/2sdAOAX8PT0FJiamrLhaljZZAQmgMB5A+vXr4c0sn05OTkLZdWDU8Dhw4ePNjc368EpYOPGjXSgqCIFAj/hpCPa/beFhoaGyNv9K9K+PFqSJJchhLaL0dHZSAKBYNxLAQBgIiQkJBwhlObi4oI++eQTjYAAK3/79u1w9r9dV1fHk5VFLMoMKoyKimIBMC0tLeXJWub3mpoalJycDBlBwpiYGNekpCSBSg0yqMzj8bwIgoBEGPG8MvqoKxAI6KOv1i0AHseCBQtSqqurP4WZ9vHHH6sVBFj5O3bsQCdOnHjc2trqWFhY+KcsGdrY2PzxzjvvWBw8eJCBqJmThIeHQyhabWVlJeT8aaw4OTmZs1isSoRQd8wZQqitq6uLRrIo+OXlAQAwFRwcvImiqBWQ9bty5cruxEplTwfY2QP1k5KSIPulvLa21rOkpKRWhuTpiCCY8dXV1TQZDt9SZnnC4BMPL7OysoKMIMwC44RZRdBCkiTkHFqI1yEIYnZRUdFzzqeXxgJgRidPnjzfwcHhwKNHj3TgNi4gIOA5T6E8MGCfOVZ+VlYWOnz4MGpqajrd2Ng4+9KlS61yBEkDAOpAZhBO51JE+NJocXoZZARB+rWoqB0AJEleRAh5ivNBUdSPxcXFsyR5e+kAAAzCxtDLy+tIRUWFi7W1NX0tO2bMmBdi1jEYxJUO9eF3cPIcPXoU3b59u5kgiBXnzp3byVCJNADu378PF1Zqj1cES1BXV4dgXJoAAEmS2xBCn0iM9ZFAIBgsbfyqgkChgBCGSqDJxo4dO8nDw2P/vXv3htbX1yMfHx96Fw5LBJhWR0dHmq60tJS2EvBQBOy6z58/D27XdhaLldrQ0LCOwax/brLALzhDSZ7FUWQ8GJw4Q0kaAMBLShCEp0Ag+AecjJn24ezsHEpR1CEJeqFQKHS9fv26xjedTPhUytzB0zCenp5LdXV1ZzQ0NAyDtC1QOMTzwWyHlzfgd1NT02YdHZ3fqqqqdpqamp5S8nWQ7qhgTdxR4GhkiWhgWnb4ppTNZuMkCbgpfE8gEMDbQjKLk5MTyWKxINRLMqdwnUAgSJRVOSgiZAmiqOUIdfqmH0zv8Q2FoPDgZITQVETpzEg/dKhCHj/SvisFAMnGnJ2drYRCoQVFUQMJgoBQ7vZiuG5TT9EaAHg8HgSlAqhxyjj8ms9ms6fJOrXAuwpsNhs2tpKPWAkEAoFMTyetfCgKAADIlQVBHwBE+Qg9WQAej0c/ekQQBNxNdOeMIYRgxk0UCAQ9zjySJO8ihOwk8E8f+fBxT9rcCAoPpsPhIC8EIaIKoY53JK1AUETwBkSh1YhAN3TakQ8QHzt2rE6Z+aYWACjTsQJ1tGYBMI9OTk7WLBarBCEkHi1Uz2Kx/Pl8/u/iY+HxeJkEQdBxluKlpyNfTzIICgqir8KRvk4mQshbEgRBEcHrEIUgb78AsTunpO9Pl+k/kSfnHgFQW1trePDgwdgrV65MKykpcYSNl6IhULgOl8st9fDwyAwPD0+xsLCQu3b2wLDWAQA8iRw5pQihAWI8thIEMaeoqAiUBVFVsLZDWvdzRdqRT5ZygoKCOEhf5wjsOTAIEKETJVL+JdSvc0r67vT/yFOwvO99AJCxBEgKD5Jo2Gw2PGJBp66JShdFUR+yWKwGiqIgllFSpjKPfPIUFBQ+bwdCBEQNg7Lh/aJc1No5Iz09XbFHCqV09AIA0tLSQrds2bIjLCysv5OTE72jlzb75b2bA1YA3vK7fv06PMfWEBcX93FERMRheYOWnEDwO36rQBPHQPxGgahfmcuiaIMHIJC8jIBHkyR3/Go58gWFBcN6D+t+NnrWOSs9PV2e84yxiJ8b7KJFizKNjIyeBAYGhlpYWKiUkow5wG/41NbWooyMjMNNTU0D9uzZQ+f+MSz0EgD3/ppIWgH+4MgKz7gyAQDQwPFQZAls5IxB7pGPoQzQnPCQSVRrx6/p6elyQ9eYtgl03QDYtGnT5w8fPrRbtGhRBH5ESV2zDYMA/t+zZ0+amZlZ+WefffYFQ0ZpAED0Lvjs1R2fAKCCOwaxKGNGG2MRCCB24S/v14tF7pGP4fhpMo0BoKyszAQ6mDZtWvX3339vBK5RdQsZDxSEDUme7733XlNmZqYV/N3BwaFRjiBoAODMIHVGLOP7CcmMIEUUQ5JkEez/JOowOvIp0o+maAmY+aLG18EroOoUsCTTWOAnT56ET/RuWZ4liIqKmg50hw4d+hdkBuH3fNQhEPzKKGQEhYWF/Q3a3Ldv30+Ktk2SJOQyjsX1mB75FO1HE/TE1KlTaY9dTEyM09ChQzU2+8WtwIMHD+Dd4Ovwt1OnTjEK7Le0tHzi7+/fH2cG4WVKGaHgJQlnBGVnZzfU1NSIH+8UbpYkyRyE0CRljnwKd6bGCoSbmxvtQdq7d68ZpFupa92XxiMIH3b0CxcupN/DKygoMGcyHsnMILi9UwYEWPlwu8gkI4gJb5jG2dn570VFRfiVL0Wqao2WcHV1pT1JBw4cMAV3aG8AAJ57WbBgwSPot7CwUOq1qKRUcExgS0sLHRMImUH4iXqmEoQbSpwRZGBgoNaYwFcSAK/KEoAVDIkh5eXlCQUFBVMePXpkrExYuKmp6VM3N7fTdnZ2SUwygpiC61WkI5KSkjYC43p6egnTpk3TeC4A3L3DO0BtbW1J0G9CQsJqRQTXBwBFpCWflqioqOgPZP7+/vdPnDgB15ga2wjCpgtCumbNmtWUnZ1Nh+DY2to2yGezj0JTEuh2eoAlqK+vt+oNR9DAgQOrFZ35mhLA/3q7r4Ir+H9dRxodv8zLIJIk6csgVQpcBgkEAlUug1Tpvq+uHAnIvA7Oy8sLLC0tdVBFio6OjmXjx4/PUCEeQJXu++r2AaAPA7IkwOjmq0+Er68E+gDw+uqW0cj6AMBITK8vUR8AXl/dMhpZHwAYien1JeoDwOurW0Yj+y97o2/XSZsB1wAAAABJRU5ErkJggg==",r={ver:1,uuid:e,padding:{"button.png":[10,9,10,9],"button2.png":[10,9,10,9],"slider.png":[12,10,12,10],"sliderbg.png":[13,7,13,7],"sliderbg2.png":[14,0,0,0]}},n=JSON.parse('{"frames":{"circle.png":{"frame":{"x":1,"y":1,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"sliderbg.png":{"frame":{"x":1,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"slider.png":{"frame":{"x":41,"y":1,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"button.png":{"frame":{"x":41,"y":28,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":72,"y":1,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"ok.png":{"frame":{"x":72,"y":27,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"sliderbg2.png":{"frame":{"x":101,"y":1,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}},"empty.png":{"frame":{"x":101,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"arrow.png":{"frame":{"x":101,"y":37,"w":12,"h":7},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":12,"h":7},"sourceSize":{"w":12,"h":7}}},"meta":{"app":"QCEngine","version":"1.0","image":"__builtin_resource__","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1"}}');t._parsing++,AssetUtil._parseAtlas(this.game,r,n,i,undefined,r.uuid,e,function(){t._parsing--,t._callCb(e,t.find(e))})};var Atlas=qc.Atlas=function(t,e,i,r,n){this.key=e,this.url=e,this.meta=r,this.animation=undefined,this.json=undefined,this.img=undefined,this._data=i,n&&(this.animation={type:r.animationType,data:n})};Atlas.prototype.constructor=Atlas,Object.defineProperties(Atlas.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var t=this.frames;if(!t||t.length<1)return[0];var e=[];for(var i in t)e.push(t[i].name);return e}},uuid:{get:function(){return this.meta.uuid}},"class":{get:function(){return"qc.Atlas"}}}),Atlas.prototype.getFrame=function(t){return"number"==typeof t?this._data.frameData.getFrame(t):this._data.frameData.getFrameByName(t)},Atlas.prototype.getTexture=function(t){return new qc.Texture(this,t)},Atlas.prototype.getPadding=function(t){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(1==this.count){var e=Object.keys(this.meta.padding);t=e.length>0?e[0]:0}t===undefined&&(t=0);var i=this.meta.padding[t];return i&&(i[0]*=1,i[1]*=1,i[2]*=1,i[3]*=1),i||[0,0,0,0]},Atlas.prototype.unload=function(t){t.assets._cache.removeImage(this.key,!1),delete PIXI.TextureCache[this.key],delete PIXI.BaseTextureCache[this.key]};var Texture=qc.Texture=function(t,e){var i=this;i.atlas=t,i.frame=e||0};Texture.prototype.constructor=Texture,Object.defineProperties(Texture.prototype,{padding:{get:function(){return this.atlas.getPadding(this.frame)}},"class":{get:function(){return"qc.Texture"}}});var Prefab=qc.Prefab=function(t,e,i,r){this.key=t,this.url=e,this.meta=r,this.json=i};Prefab.prototype.constructor=Prefab,Object.defineProperties(Prefab.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),Prefab.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var Font=qc.Font=function(t,e,i,r,n){this.key=t,this.url=e,this.meta=n,this.xml=r,this.image=i,this._fontUrl,this._fontFamily=qc.UIText.SYSTEMFONT};Font.prototype.constructor=Font,Object.defineProperties(Font.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}}),Font.prototype.unload=function(t){t.assets._cache.removeBitmapData(this.key),t.assets._cache.removeBitmapFont(this.key)};var SoundAsset=qc.SoundAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.sound=i};SoundAsset.prototype.constructor=SoundAsset,Object.defineProperties(SoundAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),SoundAsset.prototype.unload=function(t){t.assets._cache.removeSound(this.key)};var TextAsset=qc.TextAsset=function(t,e,i,r){this.key=t,this.url=e,this.meta=r,this.text=i};TextAsset.prototype.constructor=TextAsset,Object.defineProperties(TextAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),SoundAsset.prototype.unload=function(t){t.assets._cache.removeText(this.key)};var ExcelAsset=qc.ExcelAsset=function(t,e,i,r){this.key=t,this.url=e,this._meta=r,this._data="string"==typeof i?JSON.parse(i):i,this._sheets={},this._makeSheetData()};ExcelAsset.prototype.constructor=ExcelAsset,Object.defineProperties(ExcelAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?Object.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}}),ExcelAsset.prototype._makeSheetData=function(){for(var t=this._data?Object.keys(this._data):[],e=0;e<t.length;e++){var i=t[e],r=this._data[i].rows,n=this._data[i].cols,o=this._meta[i]?this._meta[i].primaryKey||[]:[],s=new qc.ExcelSheet(n,r,o);this._sheets[i]=s}},ExcelAsset.prototype.findSheet=function(t){return this.sheets[t]},ExcelAsset.prototype.unload=function(){},ExcelAsset._EXCEL_DATE_OFF=-22089888e5,ExcelAsset._TIMEZONE_OFF=60*(new Date).getTimezoneOffset()*1e3,ExcelAsset.parseToDate=function(t){return new Date(ExcelAsset._EXCEL_DATE_OFF+864e5*t+ExcelAsset._TIMEZONE_OFF)};var ExcelSheet=qc.ExcelSheet=function(t,e,i){this._cols=t||[],this._rows=e||[],this._indexes={},this._primaryKey=i,this._buildPrimaryIndex()};ExcelSheet.prototype.constructor=ExcelSheet,Object.defineProperties(ExcelSheet.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}}),ExcelSheet.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)},ExcelSheet.prototype.addSortIndex=function(t){var e,i=Array.prototype.slice.call(arguments,1);return e=Array.isArray(i[0])?new qc.ExcelSortSheetIndex(this,i[0]):new qc.ExcelSortSheetIndex(this,i),this._indexes[t]=e,e},ExcelSheet.prototype.addHashIndex=function(t,e,i){var r=new qc.ExcelHashSheetIndex(this,e,i===undefined||i);return this._indexes[t]=r,r},ExcelSheet.prototype.getIndex=function(t){return this._indexes[t]},ExcelSheet.prototype.getPrimary=function(){return this.getIndex("primary")},ExcelSheet.prototype.find=function(t){for(var e=this._rows,i=e.length,r=-1;++r<i;)if(t(e[r]))return r;return-1},ExcelSheet.prototype.findLast=function(t){for(var e=this._rows,i=e.length;i-->0;)if(t(e[i]))return i;return-1},ExcelSheet.prototype.matches=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t(e[r])&&n.push(r);return n},ExcelSheet.prototype.parseColumnToData=function(t){for(var e=this._rows,i=e.length,r=-1,n=[];++r<i;)t in e[r]&&(e[r][t]=ExcelAsset.parseToDate(e[r][t]));return n};var ExcelSortSheetIndex=qc.ExcelSortSheetIndex=function(t,e){this.sheet=t,this._keys=e,this._buildIndex()};ExcelSortSheetIndex.prototype={},ExcelSortSheetIndex.prototype.constructor=ExcelSortSheetIndex,Object.defineProperties(ExcelSortSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}}),ExcelSortSheetIndex.prototype._buildIndex=function(){var t=this,e=this.sheet.columns.slice(0);if(this._keys){for(var i=0;i<this._keys.length;i++){var r=e.indexOf(this._keys[i]);e.splice(r,1)}Array.prototype.unshift.apply(e,this._keys)}t._cols=e,t._rows=this.sheet.rows.slice(0),t._rows.sort(function(i,r){t._rowCompare(e,i,r)})},ExcelSortSheetIndex.prototype.first=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},ExcelSortSheetIndex.prototype.last=function(){var t=arguments.length;if(0===t)return 0;var e=this;return this._dichotomySearchLast(this._rows,arguments,function(t,i){return e._searchCompare(t,i)})},ExcelSortSheetIndex.prototype.matches=function(){var t=arguments.length;if(0===t)return[0,this._rows.length];var e=this,i=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)});if(0>i)return null;var r=this._dichotomySearchFirst(this._rows,arguments,function(t,i){return e._searchCompare(t,i)},i);return[i,r]},ExcelSortSheetIndex.prototype._cellCompare=function(t,e){return t?e?t===e?0:e>t?-1:1:-1:e?1:0},ExcelSortSheetIndex.prototype._searchCompare=function(t,e){if(!e)return 1;for(var i,r=this._cols,n=t.length,o=-1;++o<n;){if(i=this._cellCompare(t[o],e[r[o]]),i>0)return 1;if(0>i)return-1}return 0},ExcelSortSheetIndex.prototype._rowCompare=function(t,e,i,r,n){if(!t)return e?1:0;if(!e)return-1;r=r||0;for(var o,s,a=r+(n||i.length-r),h=r;a>h;h++)if(o=i[h],s=this._cellCompare(t[o],e[o]),0!==s)return s;return 0},ExcelSortSheetIndex.prototype._dichotomySearch=function(t,e,i){for(var r=0,n=t.length-1,o=0,s=0;n>=r;)if(o=Math.floor((r+n)/2),s=i(e,t[o]),0>s)n=o-1;else{if(0>=s)return o;r=o+1}return-1},ExcelSortSheetIndex.prototype._dichotomySearchFirst=function(t,e,i,r,n){for(var r=r||0,n=n||t.length-1,o=0,s=0;n>r;)o=Math.floor((r+n)/2),s=i(e,t[o]),s>0?r=o+1:n=o;return 0===i(e,t[r])?r:-1},ExcelSortSheetIndex.prototype._dichotomySearchLast=function(t,e,i,r,n){for(var r=r||0,n=n||t.length-1,o=0,s=0;n>r;)o=Math.ceil((r+n)/2),s=i(e,t[o]),0>s?n=o-1:r=o;return 0===i(e,t[n])?r:-1};var ExcelHashSheetIndex=qc.ExcelHashSheetIndex=function(t,e,i){this._buildIndex(t,e,i)};ExcelHashSheetIndex.prototype={},ExcelHashSheetIndex.prototype.constructor=ExcelHashSheetIndex,Object.defineProperties(ExcelHashSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}}),ExcelHashSheetIndex.prototype._buildIndex=function(t,e,i){var r=t.rows;this._rows=r,this._cols=t.columns.slice(0),this._keys=[];for(var n=r.length,o=-1;++o<n;){var s=r[o],a=s[e];i?(this[a]=s,this._keys.push(a)):a in this?this[a].push(s):(this[a]=[s],this._keys.push(a))}};var phaserFileComplete=Phaser.Loader.prototype.fileComplete;Phaser.Loader.prototype.fileComplete=function(t,e){this.game.cache&&phaserFileComplete.call(this,t,e)};var ActionAsset=qc.ActionAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};ActionAsset.prototype.constructor=ActionAsset,Object.defineProperties(ActionAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionAsset.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var ActionManagerAsset=qc.ActionManagerAsset=function(t,e,i,r){this.key=e,this.url=e,this.meta=r,this.json=i};ActionManagerAsset.prototype.constructor=ActionManagerAsset,Object.defineProperties(ActionManagerAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionManagerAsset.prototype.hasUnloadedDependence=function(t){for(var e in this.dependences){var i=this.dependences[e];if(!i.ok&&i.uuid!==this.uuid){var r=t.assets.find(i.uuid);if(!r)return!0;if(r.hasUnloadedDependence&&r.hasUnloadedDependence(t))return!0;i.ok=!0}}return!1};var Math2=qc.Math=function(t){this.phaserMath=Phaser.Math,this.arrayUtils=Phaser.ArrayUtils,this.phaserRnd=t};Math2.prototype={},Math2.prototype.constructor=Math2,Math2.prototype.fuzzyEqual=function(t,e,i){return this.phaserMath.fuzzyEqual(t,e,i)},Math2.prototype.shuffle=function(t){return this.arrayUtils.shuffle(t)},Math2.prototype.fuzzyLessThan=function(t,e,i){return this.phaserMath.fuzzyLessThan(t,e,i)},Math2.prototype.fuzzyGreaterThan=function(t,e,i){return this.phaserMath.fuzzyGreaterThan(t,e,i)},Math2.prototype.fuzzyCeil=function(t,e){return this.phaserMath.fuzzyCeil(t,e)},Math2.prototype.fuzzyFloor=function(t,e){return this.phaserMath.fuzzyFloor(t,e)},Math2.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)},Math2.prototype.shear=function(t){return this.phaserMath.shear(t)},Math2.prototype.snapTo=function(t,e,i){return this.phaserMath.snapTo(t,e,i)},Math2.prototype.snapToFloor=function(t,e,i){return this.phaserMath.snapToFloor(t,e,i)},Math2.prototype.snapToCeil=function(t,e,i){return this.phaserMath.snapToCeil(t,e,i)},Math2.prototype.roundTo=function(t,e,i){return this.phaserMath.roundTo(t,e,i)},Math2.prototype.floorTo=function(t,e,i){return this.phaserMath.floorTo(t,e,i)},Math2.prototype.ceilTo=function(t,e,i){return this.phaserMath.ceilTo(t,e,i)},Math2.prototype.angleBetween=function(t,e,i,r){return this.phaserMath.angleBetween(t,e,i,r)},Math2.prototype.angleBetweenY=function(t,e,i,r){return this.phaserMath.angleBetweenY(t,e,i,r)},Math2.prototype.reverseAngle=function(t){return this.phaserMath.reverseAngle(t)},Math2.prototype.normalizeAngle=function(t){return this.phaserMath.normalizeAngle(t)},Math2.prototype.maxAdd=function(t,e,i){return this.phaserMath.maxAdd(t,e,i)},Math2.prototype.minSub=function(t,e,i){return this.phaserMath.minSub(t,e,i)},Math2.prototype.wrap=function(t,e,i){return i>e?this.phaserMath.wrap(t,e,i):this.phaserMath.wrap(t,i,e)},Math2.prototype.wrapValue=function(t,e,i){return this.phaserMath.wrapValue(t,e,i)},Math2.prototype.isOdd=function(t){return!!this.phaserMath.isOdd(t)},Math2.prototype.isEven=function(t){return!!this.phaserMath.isEven(t)},Math2.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)},Math2.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)},Math2.prototype.wrapAngle=function(t,e){return this.phaserMath.wrapAngle(t,e)},Math2.prototype.linear=function(t,e,i){return this.phaserMath.linear(t,e,i)},Math2.prototype.factorial=function(t){return this.phaserMath.factorial(t)},Math2.prototype.getRandom=function(t,e,i){return Phaser.ArrayUtils.getRandomItem(t,e,i)},Math2.prototype.distance=function(t,e,i,r){return this.phaserMath.distance(t,e,i,r)},Math2.prototype.clamp=function(t,e,i){return this.phaserMath.clamp(t,e,i)},Math2.prototype.within=function(t,e,i){return this.phaserMath.within(t,e,i)},Math2.prototype.sign=function(t){return this.phaserMath.sign(t)},Math2.prototype.degToRad=function(t){return this.phaserMath.degToRad(t)},Math2.prototype.radToDeg=function(t){return this.phaserMath.radToDeg(t)},Math2.prototype.random=function(t,e){return undefined===t||undefined===e?this.phaserRnd.frac():t>e?this.phaserRnd.integerInRange(e,t):this.phaserRnd.integerInRange(t,e)},Math2.prototype.uuid=function(){return this.phaserRnd.uuid()},Math2.prototype.id=function(){var t=1;return function(){return++t}}(),Math2.prototype.invert=function(t,e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],c=e[8],u=c*s-a*l,p=-c*o+a*h,d=l*o-s*h,f=i*u+r*p+n*d;return f?(f=1/f,t[0]=u*f,t[1]=(-c*r+n*l)*f,t[2]=(a*r-n*s)*f,t[3]=p*f,t[4]=(c*i-n*h)*f,t[5]=(-a*i+n*o)*f,t[6]=d*f,t[7]=(-l*i+r*h)*f,t[8]=(s*i-r*o)*f,t):null},Math2.prototype.multiply=function(t,e,i){var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],p=i[0],d=i[1],f=i[2],g=i[3],m=i[4],_=i[5],y=i[6],v=i[7],T=i[8];return t[0]=p*r+d*s+f*l,t[1]=p*n+d*a+f*c,t[2]=p*o+d*h+f*u,t[3]=g*r+m*s+_*l,t[4]=g*n+m*a+_*c,t[5]=g*o+m*h+_*u,t[6]=y*r+v*s+T*l,t[7]=y*n+v*a+T*c,t[8]=y*o+v*h+T*u,t},Math2.prototype.smoothDamp=function(t,e,i,r,n,o){r=Math.max(1e-4,r);var s=2/r,a=s*o,h=1/(1+a+.48*a*a+.235*a*a*a),l=t-e,c=e,u=n*r;l=this.clamp(l,-u,u),e=t-l;var p=(i+s*l)*o;i=(i-s*p)*h;var d=e+(l+p)*h;return c-t>0&&d>c&&(d=c,i=(d-c)/o),[d,i]},qc.CleanPIXISpriteRetainer=function(t){this._frameCount=0,this.game=t},qc.CleanPIXISpriteRetainer.prototype={postRender:function(){if(this._frameCount++,this._frameCount>=100){this._frameCount=0;var t=this.game.phaser.renderer;if(t instanceof PIXI.WebGLRenderer)for(var e=t.spriteBatch.sprites,i=t.spriteBatch.currentBatchSize,r=e.length,n=i;r>n;n++)e[n]=null}}},qc.CleanPIXISpriteRetainer.prototype.constructor=qc.CleanPIXISpriteRetainer;var NodePool=qc.NodePool=function(t){this._game=t,this._nodes={},this._nameUuidMap={}};NodePool.prototype={},NodePool.prototype.constructor=NodePool,Object.defineProperties(NodePool.prototype,{game:{get:function(){return this._game}}}),NodePool.prototype.add=function(t,e){this._nodes[t]&&this.game.log.error("uuid {0} already exists",t),this._nodes[t]=e,e.uniqueName&&!this._nameUuidMap[e.uniqueName]&&(this._nameUuidMap[e.uniqueName]=t)},NodePool.prototype.remove=function(t){this._nodes[t]&&(this._nodes[t].uniqueName&&delete this._nameUuidMap[this._nodes[t].uniqueName],delete this._nodes[t])},NodePool.prototype.find=function(t){return this._nodes[t]?this._nodes[t]:undefined},NodePool.prototype.findByName=function(t){var e=this._nameUuidMap[t];return e?this._nodes[e]:undefined},NodePool.prototype.removeName=function(t){delete this._nameUuidMap[t]},NodePool.prototype.addName=function(t,e){this._nameUuidMap[t]=e};var Behaviour=qc.Behaviour=function(t){this._gameObject=t,this.cookie=0,this._events={},this.__hadUpdateOrRender=this.preUpdate||this.update||this.postUpdate?!0:!1};Behaviour.prototype.constructor=Behaviour,qc._userScripts={};var defineBehaviour=qc.defineBehaviour=function(t,e,i,r){for(var n=t.split("."),o=window,s=0;s<n.length-1;s++)o[n[s]]||(o[n[s]]={}),o=o[n[s]];var a=n[n.length-1];return e=e||qc.Behaviour,"function"==typeof r&&(r=r.call(this)),r=r||{},o[a]=function(r){e.call(this,r),this.class=t,this.super=e.prototype,"function"==typeof i&&i.call(this)},o[a].prototype=Object.create(e.prototype),o[a].prototype.constructor=o[a],o[a].prototype.getMeta=function(){var t=e.prototype.getMeta.call(this);return mixin(t,r)},o[a].prototype.clazz=t,qc._userScripts[t]=o[a],o[a]};qc.registerBehaviour=function(t,e){for(var i=t.split("."),r=window,n=0;n<i.length-1;n++)r[i[n]]||(r[i[n]]={}),r=r[i[n]];var o=i[i.length-1];r[o]=e;var s=e.prototype.getMeta;e.prototype.getMeta=function(){var t=s.call(this);return mixin(t,this.serializableFields||{})},e.prototype.clazz=t,qc._userScripts[t]=e},Object.defineProperties(Behaviour.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid=t}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(t){this.gameObject.name=t}},key:{get:function(){if(this._key)return this._key;if(this.class){var t=this.class.match(/([^\..]*)$/);t&&(this._key=t[1])}return this._key},set:function(t){this._key&&this.gameObject&&this.gameObject[this._key]&&this.gameObject[this._key].uuid===this.uuid&&delete this.gameObject[this._key],this._key=t,this.gameObject&&!this.gameObject[t]&&(this.gameObject[t]=this)}},enable:{get:function(){return this._enable},set:function(t){this._enable!==t&&(this._enable=t,this._enable&&this.onEnable?this.onEnable():!this._enable&&this.onDisable&&this.onDisable())}},runInEditor:{get:function(){return this._runInEditor===!0},set:function(t){this._runInEditor=t}},game:{get:function(){return this.gameObject.game}}}),Behaviour.prototype.getScript=function(t){return this.gameObject.getScript(t)},Behaviour.prototype.getScripts=function(t){return this.gameObject.getScripts(t)},Behaviour.prototype.destroy=function(){this.gameObject.removeScript(this),this.onDestroy&&this.onDestroy();for(var t in this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[]},Behaviour.prototype.isEnable=function(){return this._enable},Behaviour.prototype.getMeta=function(){return{uuid:qc.Serializer.STRING,enable:{get:function(t){return t.enable},set:function(t,e){t._enable=e}}}},Behaviour.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)},Behaviour.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},Behaviour.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},Behaviour.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])};var Storage=qc.Storage=function(t){this.game=t,this.restore()};Storage.prototype={},Storage.prototype.constructor=Storage,Object.defineProperties(Storage.prototype,{key:{get:function(){return this.game.localStorageID}}}),Storage.prototype.restore=function(){var t=window.localStorage.getItem(this.key);this._data=t?JSON.parse(t):{}},Storage.prototype.save=function(){var t=this.key;if(!t||"com.DefaultCompany.Default"===t)throw Error("game.localStorageID should be set for local storage");
var e=JSON.stringify(this._data);window.localStorage.setItem(this.key,e)},Storage.prototype.set=function(t,e){this._data[t]=e},Storage.prototype.del=function(t){this._data[t]&&delete this._data[t]},Storage.prototype.get=function(t){return this._data[t]?this._data[t]:undefined};var Node=qc.Node=function(t,e,i){var r=this;r.game=t.game._qc,r.phaser=t,t._qc=this,r.uuid=i||r.game.math.uuid(),r._uniqueName="",r._interactive=!1,r._draggable=!1,r._children=null,r._prefab="",r.scripts=[],r.scriptMap={},r.static=!1,r.hitArea=undefined,this.cookie=0,r._events=[];var n=t.destroy;t.destroy=function(){if(!r._destroy)if(this.maybeOutWorld&&this.maybeOutWorld(),r===r.game.world)n.call(t,!0,!0),r._dispatchModelChangeEvent("destroy",r);else{r.onDestroy(),n.call(t);for(var e=r.scripts.length;e--;)r.scripts[e].destroy();r.scripts=[],r.scriptMap={},r._dispatchModelChangeEvent("destroy",r),r._destroy=!0}},e!==this&&(e||this.game.world).addChild(this),this._defaultTransform()};Node.prototype.constructor=Node,Object.defineProperties(Node.prototype,{uuid:{get:function(){return this._uuid},set:function(t){this._uuid&&this.game.nodePool.remove(this.uuid),this._uuid=t,this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(t){t=t||"",t=t.replace(/\//g,""),this.phaser.name=t,this._dispatchModelChangeEvent("name",this)}},uniqueName:{get:function(){return this._uniqueName},set:function(t){this._uniqueName&&this.game.nodePool.removeName(this._uniqueName),this._uniqueName=t,this._uniqueName&&!this.game.nodePool.findByName(this._uniqueName)&&this.game.nodePool.addName(this._uniqueName,this.uuid)}},ignoreDestroy:{get:function(){return this.parent===this.game.world&&this.phaser.ignoreDestroy},set:function(t){this.parent===this.game.world?this.phaser.ignoreDestroy=t:(this.phaser.ignoreDestroy=!1,t&&this.game.log.error("Only Root Node can set: ignoreDestroy=true"))}},alpha:{get:function(){return this.phaser.alpha},set:function(t){this.phaser.alpha=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ALPHA)}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible!==t&&(t&&this._toDestroy||(this.phaser.visible=t,this._isTransformDirty=!0,this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(t?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this._notifyVisibleChanged(t)))}},parent:{get:function(){var t=this.phaser.parent;return t?t._qc:null},set:function(t){t?t.addChild(this):this.parent instanceof Node&&this.parent.removeChild(this)}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(t){this.phaser.mask=t}},children:{get:function(){if(!this._children){this._children=[];for(var t=this.phaser.children,e=0;e<t.length;e++){var i=t[e]._qc;i&&this._children.push(i)}}return this._children}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(t){return t=t||new Color(16777215),t instanceof Color?(this.phaser.tint=t.toNumber(),this.phaser.displayChanged(qc.DisplayChangeStatus.TINT),undefined):(console.error(t),this.game.log.error("Expected qc.Color"),undefined)}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new Phaser.Signal)}}}),Node.prototype.isVisible=function(){return this.phaser.visible},Node.prototype.isWorldVisible=function(){var t=this;do{if(!t.phaser.visible)return!1;t=t.parent}while(t);return!0},Node.prototype.addScript=function(t,e){var i=qc.Util.findClass(t);if("function"!=typeof i)return this.game.log.error("Class:{0} not exists",t),undefined;var r=new i(this);return r instanceof qc.Behaviour?(r.uuid=this.game.math.uuid(),r._clazz=t,r.class=t,this[r.key]=r,this.scripts.push(r),this.scriptMap[t]=r,(e||e===undefined)&&(!r.awake||this.game.device.editor===!0&&r.runInEditor!==!0||r.awake()),r._enable===undefined&&e!==!1&&(this.game.device.editor===!0&&r.runInEditor!==!0?r._enable=!0:r.enable=!0),r):(this.game.log.error("Must inherit from qc.Behaviour"),undefined)},Node.prototype.removeScript=function(t){var e=this.scripts.indexOf(t);e>-1&&this.scripts.splice(e,1),delete this.scriptMap[t.class],this[t._key]&&this[t._key].uuid===t.uuid&&delete this[t._key],this.__json&&this.__json[t.uuid]&&delete this.__json[t.uuid]},Node.prototype.getScript=function(t,e){var i=t;if("string"!=typeof t&&(t=i.prototype.clazz),this.scriptMap[t])return this.scriptMap[t];if("string"==typeof t&&(i=qc.Util.findClass(t)),!i)return this.game.log.error("Class:{0} not exists",t),null;if(1===arguments.length||e){for(var r in this.scripts)if(this.scripts[r]instanceof i)return this.scripts[r]}else for(var r in this.scripts)if(this.scripts[r].class===i.prototype.clazz)return this.scripts[r]},Node.prototype.getScripts=function(t,e){var i=t;"string"==typeof t&&(i=qc.Util.findClass(t));var r=[];if(!i)return this.game.log.error("Class:{0} not exists",t),r;if(1===arguments.length||e)for(var n in this.scripts)this.scripts[n]instanceof i&&r.push(this.scripts[n]);else for(var n in this.scripts)this.scripts[n].class===i.prototype.clazz&&r.push(this.scripts[n]);return r},Node.prototype.isDescendantOf=function(t){for(var e=this.parent;e;){if(t===e)return!0;e=e.parent}return!1},Node.prototype.getChildren=function(){var t=this._children;return t||(t=this.children),t},Node.prototype.addChild=function(t){return this.addChildAt(t,this.children.length)},Node.prototype.addChildAt=function(t,e){if(t.parent!==this){if(!(t instanceof Node))throw Error("Expected qc.Node");if(t===this)throw Error("The child is myself");if(this.isDescendantOf(t))throw Error("child is my parent");var i=t.parent;return i instanceof Node&&(i._children=null),this.phaser.addAt?this.phaser.addAt(t.phaser,e):this.phaser.addChildAt(t.phaser,e),this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onAddToWorld"),t}},Node.prototype.swapChildren=function(t,e){this.phaser.swapChildren(t.phaser,e.phaser),this._dispatchModelChangeEvent("parent",t),this._dispatchModelChangeEvent("parent",e)},Node.prototype.getChildIndex=function(t){return this.children.indexOf(t)},Node.prototype.setChildIndex=function(t,e){if(t.parent===this){var i=this.phaser.children,r=i.indexOf(t.phaser);r!==e&&(i.splice(r,1),i.splice(e,0,t.phaser),t.phaser.displayChanged(qc.DisplayChangeStatus.ORDER),this._dispatchModelChangeEvent("parent",t),this._dispatchChildrenChanged("order",[t]))}},Node.prototype.getChildAt=function(t){return this.children[t]},Node.prototype.removeChild=function(t){return this.phaser.remove?this.phaser.remove(t.phaser):this.phaser.removeChild(t.phaser),this._children=null,this._dispatchModelChangeEvent("parent",t),t._callChildrenFunc("onRemoveFromWorld"),t},Node.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return this.removeChild(e)},Node.prototype.removeChildren=function(){var t=this.children;this.phaser.removeAll?this.phaser.removeAll():this.phaser.removeChildren(),this._dispatchModelChangeEvent("removeChildren",this),t.forEach(function(t){t&&t._callChildrenFunc("onRemoveFromWorld")})},Node.prototype.onDestroy=function(){this.parent=null,this.game.nodePool.remove(this.uuid)},Node.prototype.destroy=function(){this._toDestroy||(this._toDestroy=!0,this.visible=!1,this.game.world.addToDestroy(this))},Node.prototype.destroyImmediately=function(){if(!this._destroy&&!this._destroying){for(var t in this._events){var e=this._events[t];e&&e[0].remove(e[1],e[2])}this._events=[],this.visible=!1,this._destroying=!0,this.phaser&&this.phaser.destroy(),this._destroying=!1}},Node.prototype.find=function(t){if(""===t||"."===t||"./"===t)return this;for(var e=t.split("/"),i=this,r=0;r<e.length-1;r++){var n=e[r];if(""!==n)if(".."!==n){if(i=i._findByName(e[r]),!i)return i}else if(i=this.parent,i===this.game.stage)return null}var n=e[e.length-1];return""===n||"."===n?i:".."===n?i.parent===this.game.stage?null:i.parent:i._findByName(n)},Node.prototype._findByName=function(t){var e=this.children;for(var i in e)if(e[i].name===t)return e[i]},Node.prototype._dispatchModelChangeEvent=function(t,e){"name"!==t&&(this._children=null);var i=this.game.world;i.onModelChange.dispatch({type:t,target:e})},Node.prototype._sendMessage=function(t,e){if(this.scripts)for(var i=this.scripts.length,r=Array.prototype.slice.call(arguments,2),n=0;i>n;n++){var o=this.scripts[n];if(o&&o.enable){var s=o[t];if(!s)continue;var a=s.apply(o,r);if(e===!0&&a===!0)return!0}}},Node.prototype._broadcast=function(t){if(this.scripts){for(var e=this.scripts.length,i=Array.prototype.slice.call(arguments,1);e--;){var r=this.scripts[e];if(r&&r.enable&&(this.game.device.editor!==!0||r.runInEditor===!0)){if(this._toDestroy||this._destroy)return;var n=r[t];n&&n.apply(r,i)}}var o=this._children;o||(o=this.getChildren());var s=o.length;for(e=0;s>e;e++)o[e][t](i)}},Node.prototype._dispatchChildrenChanged=function(t,e){for(var i=this,r={source:this,type:t,children:e};i;)i._onChildrenChanged&&i._onChildrenChanged.dispatch(r),i=i.parent},Node.prototype._notifyVisibleChanged=function(t){this.onVisibleChange&&this.onVisibleChange();var e=this._children;e||(e=this.children);for(var i=e.length;i--;)e[i].visible&&e[i]._notifyVisibleChanged(t)},Node.prototype._callChildrenFunc=function(t){var e=this[t];e&&e.apply(this,arguments);var i=this._children;i||(i=this.children);for(var r=i.length;r--;){var n=i[r];n&&(e=n[t],e&&e.apply(n,arguments))}},Node.prototype.addListener=function(t,e,i,r){return t.add(e,i,r),this.cookie++,this._events[this.cookie]=[t,e,i],this.cookie},Node.prototype.addListenerOnce=function(t,e,i,r){t.addOnce(e,i,r)},Node.prototype.removeListener=function(t){var e=this._events[t];e&&(e[0].remove(e[1],e[2]),delete this._events[t])},Object.defineProperties(Node.prototype,{x:{get:function(){return this.phaser.x},set:function(t){this.x!==t&&(this.minAnchor.x<this.maxAnchor.x&&(this._left=this.left+(t-this.x),this._right=this.right-(t-this.x)),this.phaser.x=t,this._calcAnchoredX(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},y:{get:function(){return this.phaser.y},set:function(t){this.y!==t&&(this.minAnchor.y<this.maxAnchor.y&&(this._top=this.top+(t-this.y),this._bottom=this.bottom-(t-this.y)),this.phaser.y=t,this._calcAnchoredY(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},anchoredX:{get:function(){return this._anchoredX===undefined&&this._calcAnchoredX(),this._anchoredX},set:function(t){t!==this.anchoredX&&(this._anchoredX=t,this._calcX(),this._isTransformDirty=!0)}},anchoredY:{get:function(){return this._anchoredY===undefined&&this._calcAnchoredY(),this._anchoredY},set:function(t){t!==this.anchoredY&&(this._anchoredY=t,this._calcY(),this._isTransformDirty=!0)}},scaleX:{get:function(){return this.phaser.scale.x},set:function(t){t!==this.scaleX&&(this.phaser.scale.x=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},scaleY:{get:function(){return this.phaser.scale.y},set:function(t){t!==this.scaleY&&(this.phaser.scale.y=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},pivotX:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.x},set:function(t){this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.x!==t&&(this.phaser.anchor.x=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},pivotY:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.y},set:function(t){this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.y!==t&&(this.phaser.anchor.y=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},rotation:{get:function(){return this.phaser.rotation},set:function(t){this.phaser.rotation!==t&&(this.phaser.rotation=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX!==t&&(this._skewX=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY!==t&&(this._skewY=t,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},width:{get:function(){return this._width=this._width||0},set:function(t){if(!this.game.math.fuzzyEqual(this._width,t,.001)){if(this.minAnchor.x<this.maxAnchor.x){var e=t-this.width,i=e*this.pivotX,r=e-i;this._left-=i,this._right-=r}else this.setWidth(t);this.relayout()}}},height:{get:function(){return this._height=this._height?this._height:0},set:function(t){if(!this.game.math.fuzzyEqual(this._height,t,.001)){if(this.minAnchor.y<this.maxAnchor.y){var e=t-this.height,i=e*this.pivotY,r=e-i;this._top-=i,this._bottom-=r}else this.setHeight(t);this.relayout()}}},minAnchor:{get:function(){return this._minAnchor||(this._minAnchor=new qc.Point(0,0)),this._minAnchor},set:function(){throw Error("user function:setAnchor")}},maxAnchor:{get:function(){return this._maxAnchor||(this._maxAnchor=new qc.Point(0,0)),this._maxAnchor},set:function(){throw Error("use function:setAnchor")}},left:{get:function(){return this._left===undefined&&(this._left=0),this._left},set:function(t){this._left!==t&&(this._left=t,this.relayout())}},right:{get:function(){return this._right===undefined&&(this._right=0),this._right},set:function(t){this._right!==t&&(this._right=t,this.relayout())}},top:{get:function(){return this._top===undefined&&(this._top=0),this._top},set:function(t){this._top!==t&&(this._top=t,this.relayout())}},bottom:{get:function(){return this._bottom===undefined&&(this._bottom=0),this._bottom},set:function(t){this._bottom!==t&&(this._bottom=t,this.relayout())}},rect:{get:function(){var t=this.width,e=this.height;return new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,t,e)}},worldTransform:{get:function(){return this.nodeUpdateTransform(),this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(t){this.phaser._isNotNeedCalcTransform!==!t&&(this.phaser._isNotNeedCalcTransform=!t)}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new Phaser.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new Phaser.Signal)}},onTransformChanged:{get:function(){return this.phaser._onTransformChanged||(this.phaser._onTransformChanged=new Phaser.Signal)}}}),Node.prototype.setStretch=function(t,e,i,r){var n=!1;this.minAnchor.x<this.maxAnchor.x?(t!==undefined&&this._left!==t&&(this._left=t,n=!0),e!==undefined&&this._right!==e&&(this._right=e,n=!0)):this._anchoredX!==t&&(this._anchoredX=t,n=!0),this.minAnchor.y<this.maxAnchor.y?(i!==undefined&&this._top!==i&&(this._top=i,n=!0),r!==undefined&&this._bottom!==r&&(this._bottom=r,n=!0)):this._anchoredY!==i&&(this._anchoredY=i,n=!0),n&&this.relayout()},Node.prototype.setAnchor=function(t,e,i){if(i=i===undefined?!0:i,t=t||this.minAnchor,e=e||this.maxAnchor,t.x<0&&(t.x=0),t.y<0&&(t.y=0),t.x>1&&(t.x=1),t.y>1&&(t.y=1),e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x>1&&(e.x=1),e.y>1&&(e.y=1),t.x>e.x||t.y>e.y)throw Error("Expected:min < max");(t.x!==this.minAnchor.x||t.y!==this.minAnchor.y||e.x!==this.maxAnchor.x||e.y!==this.maxAnchor.y)&&(this._minAnchor=t,this._maxAnchor=e,i?(this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()):this.relayout())},Node.prototype.relayout=function(){var t=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var e=t.x+t.width*this.minAnchor.x+this.left,i=t.x+t.width*this.maxAnchor.x-this.right,r=i-e;this.setWidth(r),this.phaser.x=e+r*this.pivotX,this._calcAnchoredX()}else this.phaser.x=t.x+t.width*this.minAnchor.x+this.anchoredX;if(this.minAnchor.y<this.maxAnchor.y){var n=t.y+t.height*this.minAnchor.y+this.top,o=t.y+t.height*this.maxAnchor.y-this.bottom,s=o-n;this.setHeight(s),this.phaser.y=n+s*this.pivotY,this._calcAnchoredY()}else this.phaser.y=t.y+t.height*this.minAnchor.y+this.anchoredY;this._isTransformDirty=!0;for(var a=this.children,h=0;h<a.length;h++)a[h].relayout();this._calcWorldCorners(!0),this._dispatchLayoutArgumentChanged("size"),this._lastRectInfo=new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this._onRelayout&&this._onRelayout.dispatch()},Node.prototype.setWidth=function(t){this._width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype.setHeight=function(t){this._height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype._defaultTransform=function(){this.parent&&this.parent!==this.game.stage&&(this.x=0,this.y=0,this.width=100,this.height=100)},Node.prototype._calcMargin=function(){var t=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var e=this.x-this.pivotX*this.width,i=t.x+t.width*this.minAnchor.x;this._left=e-i;var r=t.x+t.width*this.maxAnchor.x;this._right=r-(e+this.width)}else this._left=this._right=0;if(this.minAnchor.y<this.maxAnchor.y){var n=this.y-this.pivotY*this.height,o=t.y+t.height*this.minAnchor.y;this._top=n-o;var s=t.y+t.height*this.maxAnchor.y;this._bottom=s-(n+this.height)}else this._top=this._bottom=0},Node.prototype._calcAnchoredX=function(){var t=this.parent.rect;this._anchoredX=this.x-(t.width*this.minAnchor.x+t.x)},Node.prototype._calcAnchoredY=function(){var t=this.parent.rect;this._anchoredY=this.y-(t.height*this.minAnchor.y+t.y)},Node.prototype._calcX=function(){var t=this.parent.rect;this.x=this._anchoredX+(t.width*this.minAnchor.x+t.x)},Node.prototype._calcY=function(){var t=this.parent.rect;this.y=this._anchoredY+(t.height*this.minAnchor.y+t.y)},Node.prototype.toLocal=function(t){return this.worldTransform.applyInverse(t)},Node.prototype.toGlobal=function(t){return this.worldTransform.apply(t)},Node.prototype.nodeUpdateTransform=function(){var t=!1;return this.parent&&this.parent.nodeUpdateTransform&&(t=this.parent.nodeUpdateTransform()),this._isTransformDirty?(t||this.phaser.updateTransform(),!0):t},Node.prototype.getWorldPosition=function(){var t=this.worldTransform;return new qc.Point(t.tx,t.ty)},Node.prototype.getWorldScale=function(){var t=this.worldTransform,e=Math.atan2(t.b,t.a),i=Math.atan2(-t.c,t.d);t.b/t.a===-t.c/t.d&&i!==e&&(e=Math.atan(t.b/t.a),i=Math.atan(-t.c/t.d));var r=e===Math.PI||0===e||0===t.b&&0!==t.a?t.a/Math.cos(e):t.b/Math.sin(e),n=i===Math.PI||0===i||0===t.c&&0!==t.d?t.d/Math.cos(i):-t.c/Math.sin(i);return new qc.Point(r,n)},Node.prototype.getWorldSkew=function(){var t=this.worldTransform;return t.b/t.a===-t.c/t.d?new qc.Point(0,0):new qc.Point(Math.atan2(-t.c,t.d),Math.atan2(t.b,t.a))},Node.prototype.getWorldRotation=function(){var t=this.worldTransform;return t.b/t.a!==-t.c/t.d?0:Math.atan2(t.b,t.a)},Node.prototype.setTransformToWorld=function(t,e,i,r,n){this.setTransformTo(this.game.world,t,e,i,r,n)},Node.prototype.setTransformTo=function(t,e,i,r,n,o){e=e||0,i=i||0,r=r||1,n=n||1,o=o||0;var s=0,a=0;arguments.length>6&&"number"==typeof arguments[6]&&(s=arguments[6]),arguments.length>7&&"number"==typeof arguments[7]&&(a=arguments[7]);var h=Math.cos(s),l=Math.sin(s),c=Math.cos(a),u=Math.sin(a),p=Math.cos(o),d=Math.sin(o),f=(p*c-d*l)*r,g=(p*u+d*h)*r,m=(-d*c-p*l)*n,_=(-d*u+p*h)*n,y=e,v=i;this.setTransformToWithMatrix(t,f,g,m,_,y,v)},Node.prototype.setTransformToWithMatrix=function(t,e,i,r,n,o,s){var a=[e,i,0,r,n,0,o,s,1];if(t){var h=t?t.worldTransform||new qc.Matrix:new qc.Matrix,l=h.toArray(!0);this.game.math.multiply(a,l,a)}var c=this.parent?this.parent.worldTransform||new qc.Matrix:new qc.Matrix,u=c.toArray(!0),p=[];this.game.math.invert(p,u),this.game.math.multiply(p,p,a);var e=p[0],i=p[1],r=p[3],n=p[4];if(this.x=p[6],this.y=p[7],i/e!==-r/n){var d=Math.atan2(i,e),f=Math.atan2(-r,n);this.rotation=d,this.scaleX=0===d||0===i&&0!==e?e/Math.cos(d):i/Math.sin(d),this.scaleY=0===f||0===r&&0!==n?n/Math.cos(f):-r/Math.sin(f)}else{var g=Math.atan2(i,e);this.rotation=g,this.scaleX=0===g||0===i&&0!==e?e/Math.cos(g):i/Math.sin(g),this.scaleY=0===g||0===r&&0!==n?n/Math.cos(g):-r/Math.sin(g)}this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()};var oldAddChildAt=Node.prototype.addChildAt;Node.prototype.addChildAt=function(t,e){oldAddChildAt.call(this,t,e),t._isSwitchParent||t.relayout(),t._isTransformDirty=!0},Node.prototype.switchParent=function(t,e){if(t!==this&&!t.isDescendantOf(this)){var i=this.worldTransform,r=i.a,n=i.b,o=i.c,s=i.d,a=i.tx,h=i.ty;this._isSwitchParent=!0,this.parent=t,delete this._isSwitchParent,e&&this.parent.setChildIndex(this,e),this.setTransformToWithMatrix(null,r,n,o,s,a,h)}},Node.prototype._calcWorldCorners=function(t){if(t||this.nodeUpdateTransform()){var e=this.rect,i=new qc.Point(e.x,e.y),r=new qc.Point(e.x+e.width,e.y),n=new qc.Point(e.x+e.width,e.y+e.height),o=new qc.Point(e.x,e.y+e.height),s=this.phaser.worldTransform;this._worldLeftTop=s.apply(i),this._worldRightTop=s.apply(r),this._worldRightBottom=s.apply(n),this._worldLeftBottom=s.apply(o);var a=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),h=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),l=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y),c=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new qc.Rectangle(a,l,h-a,c-l)}},Node.prototype.getWorldCorners=function(){return this._calcWorldCorners(),[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getCornersIn=function(t){var e=t&&t.phaser.worldTransform;return this._calcWorldCorners(),e?[e.applyInverse(this._worldLeftTop),e.applyInverse(this._worldRightTop),e.applyInverse(this._worldRightBottom),e.applyInverse(this._worldLeftBottom)]:[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getWorldBox=function(){return this._calcWorldCorners(),this._worldBox},Node.prototype.getBoxIn=function(t){for(var e=this.getCornersIn(t),i=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),r=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),n=0;4>n;n++){var o=e[n];i.x=Math.max(i.x,o.x),i.y=Math.max(i.y,o.y),r.x=Math.min(r.x,o.x),r.y=Math.min(r.y,o.y)}return new qc.Rectangle(r.x,r.y,i.x-r.x,i.y-r.y)},Node.prototype.rectContains=function(t){var e=this.toLocal(t);return this.rect.contains(e.x,e.y)},Node.prototype._dispatchLayoutArgumentChanged=function(t){this._onLayoutArgumentChanged&&this._onLayoutArgumentChanged.dispatch(t)},Object.defineProperties(Node.prototype,{hitArea:{get:function(){return this.phaser.hitArea===undefined?this.rect:this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(t){this.phaser.hitArea=t}},onDown:{get:function(){return this._onDown||(this._onDown=new Phaser.Signal),this._onDown}},onUp:{get:function(){return this._onUp||(this._onUp=new Phaser.Signal),this._onUp}},onClick:{get:function(){return this._onClick||(this._onClick=new Phaser.Signal),this._onClick}},onDragStart:{get:function(){return this._onDragStart||(this._onDragStart=new Phaser.Signal),this._onDragStart}},onDrag:{get:function(){return this._onDrag||(this._onDrag=new Phaser.Signal),this._onDrag}},onDragEnd:{get:function(){return this._onDragEnd||(this._onDragEnd=new Phaser.Signal),this._onDragEnd}},onDragDrop:{get:function(){return this._onDragDrop||(this._onDragDrop=new Phaser.Signal),this._onDragDrop}},onWheel:{get:function(){return this._onWheel||(this._onWheel=new Phaser.Signal),this._onWheel}},onEnter:{get:function(){return this._onEnter||(this._onEnter=new Phaser.Signal),this._onEnter}},onExit:{get:function(){return this._onExit||(this._onExit=new Phaser.Signal),this._onExit}},onInteractive:{get:function(){return this._onInteractive||(this._onInteractive=new Phaser.Signal),this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch()}}}),Node.prototype.checkAllowDrop=function(t){for(var e=!1,i=this.scripts.length,r=0;i>r;r++){var n=this.scripts[r];if(n){var o=n.isAllowDrop;if(!o)continue;if(o.call(n,t))return!0;e=!0}}return this.isAllowDrop?this.isAllowDrop(t):!e},Node.prototype.canHandleInputEvent=function(t){if(!this.interactive)return!1;var e=this["_"+t];if(e&&e.getNumListeners()>0)return!0;for(var i=this.scripts.length,r=0;i>r;r++){var n=this.scripts[r];if(n){var o=n[t];if(!o)continue;return!0}}return!1},Node.prototype.getInputEventHandle=function(t){for(var e,i=Array.isArray(t)?t:[t],r=this,n=this.game.stage;r&&r!==n;){for(e=i.length;e--;)if(r.canHandleInputEvent(i[e]))return r;r=r.parent}return null},Node.prototype.getInputEventHandleAndEventType=function(t){for(var e,i=Array.isArray(t)?t:[t],r=this,n=this.game.stage;r&&r!==n;){for(e=i.length;e--;)if(r.canHandleInputEvent(i[e]))return[r,i[e]];r=r.parent}return null},Node.prototype.fireInputEvent=function(t,e){if(!this.interactive||this.state===qc.UIState.DISABLED)return!1;var i=this._sendMessage(t,!0,e);if(i===!0)return!0;var r=this["_"+t];r&&r.getNumListeners()>0&&r.dispatch(this,e)},Node.prototype.checkHit=function(t,e){var i=this;if(i._interactive){var r=i.phaser.hitArea===undefined?this._lastRectInfo:this.phaser.hitArea;return r&&r.contains&&r.contains(t,e)}},Object.defineProperty(Node.prototype,"class",{get:function(){return"qc.Node"}}),Node.prototype.getMeta=function(){var t=qc.Serializer,e=this;return{uuid:{type:t.STRING,get:function(t){return t.uuid},set:function(t,i){e.game.serializer.restoreContext[i]=e.uuid}},_prefab:t.STRING,__lock:t.BOOLEAN,name:t.STRING,uniqueName:t.STRING,ignoreDestroy:t.BOOLEAN,alpha:t.NUMBER,visible:t.BOOLEAN,colorTint:t.COLOR,"static":t.BOOLEAN,scripts:{get:function(t,i){return e._packScripts.call(t,i)},set:function(t,i){e._unpackScripts.call(t,i)}},position:{get:function(t){return[t.pivotX,t.pivotY,t.anchoredX,t.anchoredY,t.x,t.y,t.width,t.height,t.left,t.right,t.top,t.bottom,t.minAnchor.x,t.minAnchor.y,t.maxAnchor.x,t.maxAnchor.y]},set:function(t,e){var i=t;i._minAnchor=new qc.Point(e[12],e[13]),i._maxAnchor=new qc.Point(e[14],e[15]),i.phaser.anchor=new qc.Point(e[0],e[1]),i._anchoredX=e[2],i._anchoredY=e[3],i._minAnchor.x<i._maxAnchor.x?(i._left=e[8],i._right=e[9]):i.setWidth(e[6]),i._minAnchor.y<i._maxAnchor.y?(i._top=e[10],i._bottom=e[11]):i.setHeight(e[7]),i.relayout()}},scaleX:t.NUMBER,scaleY:t.NUMBER,rotation:t.NUMBER,serializeHitArea:t.AUTO,interactive:t.BOOLEAN,isFiltersThrough:t.BOOLEAN,children:{get:function(t,i){return e._packChildren.call(t,i)},set:function(t,i){e._unpackChildren.call(t,i)}}}},Node.prototype._packChildren=function(t){var e=this.children;if(0===e.length)return[];if(this instanceof qc.UIText||this instanceof qc.Sprite)return[];var i=[];for(var r in e){var n=e[r],o=this.game.serializer.buildBundle(n,t);i.push(o)}return i},Node.prototype._unpackChildren=function(t){for(var e in t)var i=this.game.serializer.restoreBundle(t[e],this,!0)},Node.prototype._packScripts=function(t){var e=this.scripts;if(!e||0===e.length)return[];var i=[];for(var r in e){var n=e[r],o=null;"qc.NonexistScript"!==n._clazz?(this.__json&&this.__json[n.uuid]&&(o=this.__json[n.uuid].data),o=this.game.serializer.buildBundle(n,t,o),i.push({clazz:n._clazz,data:n.uuid}),this.__json||(this.__json={}),this.__json[n.uuid]=o):i.push({clazz:n.script,data:n.data.uuid[1]})}return i},Node.prototype._unpackScripts=function(t){for(var e in t){var i=t[e],r=i.data;r="string"==typeof r?this.__json[r].data:r.data;var n=qc.Util.findClass(i.clazz);if("function"==typeof n)try{var o=this.addScript(i.clazz,!1),s={};o.getMeta&&(s=o.getMeta());for(var a in s)try{this.game.serializer.fromJson(o,r,a,s[a])}catch(h){console.error("Deserialize fail!",h),qc.Util.popupError(h.message)}}catch(h){console.error("Deserialize error!",h),qc.Util.popupError(h.message)}else{if(r&&r.uuid){var o=this.addScript("qc.NonexistScript");o.script=i.clazz,o.data=r}console.error("Class: "+i.clazz+" is not exist!")}}this.game.device.editor||delete this.__json},Node.prototype._findPath=function(t,e){var i="";if(t===this)return i;e===undefined&&(e=!0);var r=this.children;for(var n in r){var o=r[n],s=o._findPath(t,!1);if(""===s)return i+=o.name;if(s)return i+=o.name+"/"+s}if(!e)return null;var a=this.parent;for(i+="/..";a!==this.game.stage;){var s=a._findPath(t,!1);if(""===s)return i;if(s)return i+="/"+s;a=a.parent,i+="/.."}return null},Node.prototype._restoreNodeRef=function(){var t={};this.getMeta&&(t=this.getMeta());for(var e in t){var i="__BUILTIN_NODE__"+e;this[i]&&"string"==typeof this[i]&&(this[e]=this.game.serializer.findNodeRef(this[i]),delete this[i]);var r="__BUILTIN_NODE_ARRAY__"+e;if(this[r]&&"object"==typeof this[r]){var n=[];for(var o in this[r])n.push(this[r][o]&&this[r][o][1]?this.game.serializer.findNodeRef(this[r][o][1]):null);this[e]=n,delete this[r]}}for(var o in this.scripts){var s=this.scripts[o],t={};s.getMeta&&(t=s.getMeta());for(var e in t){var i="__BUILTIN_NODE__"+e;s[i]&&"string"==typeof s[i]&&(s[e]=this.game.serializer.findNodeRef(s[i]),delete s[i]);var r="__BUILTIN_NODE_ARRAY__"+e;if(s[r]&&"object"==typeof s[r]){var n=[];for(var o in s[r])n.push(s[r][o]&&s[r][o][1]?this.game.serializer.findNodeRef(s[r][o][1]):null);s[e]=n,delete s[r]}}}var a=this.children;for(var e in a)a[e]._restoreNodeRef()},Node.prototype._restoreInit=function(){this._initGetSetField();for(var t in this.scripts){var e=this.scripts[t];e._restoreInit&&e._restoreInit()}var i=this.children;for(var r in i)i[r]._restoreInit()},Node.prototype._dispatchAwake=function(){var t=this.children;for(var e in t)t[e]._dispatchAwake();for(var i in this.scripts){var r=this.scripts[i];(this.game.device.editor!==!0||r.runInEditor)&&r.awake&&r.awake.call(r)}},Node.prototype._dispatchEnable=function(){var t=this.children;for(var e in t)t[e]._dispatchEnable();for(var i in this.scripts){var r=this.scripts[i];(this.game.device.editor!==!0||r.runInEditor)&&r.enable&&r.onEnable&&r.onEnable()}},Node.prototype._dispatchLocale=function(){var t=this.children;for(var e in t)t[e]._dispatchLocale();"qc.UIText"===this.class&&qc.locales[qc.lang]&&this._locale&&(this.text=qc.locales[qc.lang][this._locale]?qc.lc_get(this._locale):this._locale)},Node.prototype._initGetSetField=function(){var t=this.__GET_SET__;if(t){for(var e in t){var i=t[e];this[i]=this["__BUILTIN_SET__"+i],delete this["__BUILTIN_SET__"+i]}delete this.__GET_SET__}};var _CUSTOM_FIELD=function(t,e){return{type:e,get:function(e){return e[t]},set:function(e,i){e["__BUILTIN_SET__"+t]=i,e.__GET_SET__?e.__GET_SET__.push(t):e.__GET_SET__=[t]}}};Node.prototype.generateTexture=function(t,e,i,r,n,o){if(!this.phaser)return new qc.RenderTexture(0,0,renderer,e,t);var s=this.localBounds;s.x+=i||0,s.y+=r||0,isNaN(n)||(s.width=n),isNaN(o)||(s.height=o);var a=new qc.RenderTexture(0|s.width,0|s.height,null,e,t);return PIXI.DisplayObject._tempMatrix.tx=-s.x,PIXI.DisplayObject._tempMatrix.ty=-s.y,a.render(this.phaser,PIXI.DisplayObject._tempMatrix),a},Node._snapTempMatrix=new PIXI.Matrix,Node.prototype._snapshotAsRenderTexture=function(t,e,i,r){if(!this.phaser)return new qc.RenderTexture(0,0);var n=t,o=this.getWorldScale();n||(n=qc.Bounds.getBounds(this)),e=e||n.width*o.x,i=i||n.height*o.y;var s=e/n.width,a=i/n.height;r=r||this.game.resolution,Node._snapTempMatrix.a=s,Node._snapTempMatrix.d=a,Node._snapTempMatrix.tx=-n.x*s,Node._snapTempMatrix.ty=-n.y*a;var h=this.game.phaser,l=new qc.RenderTexture(1,1,h.renderer,h.scale.scaleMode,r);return l.resize(e,i,!0),l.render(this.phaser,Node._snapTempMatrix),l},Node.prototype.snapshotAsImage=function(t,e,i,r,n){var o=this._snapshotAsRenderTexture(t,e,i,r),s=o.getBase64();o.destroy(!0);var a=new Image;return a.src=s,n&&(a.onload=function(){n(a)}),a},Node.prototype.snapshotAsAtlas=function(t,e,i,r,n){var o=this._snapshotAsRenderTexture(e,i,r,n),s=this.game.assets._cache;
s.checkImageKey(t)&&s.removeImage(t,!1);var a=qc.AssetUtil.addAtlasFromImage(this.game,t,t,o.getCanvas());return a};var Serializer=qc.Serializer=function(t){this.game=t};Serializer.prototype={},Serializer.prototype.constructor=Serializer,Serializer.customDeserializers={},Serializer.AUTO=0,Serializer.INT=1,Serializer.INTS=2,Serializer.NUMBER=3,Serializer.NUMBERS=4,Serializer.BOOLEAN=5,Serializer.BOOLEANS=6,Serializer.STRING=7,Serializer.STRINGS=8,Serializer.MAPPING=9,Serializer.TEXTURE=10,Serializer.TEXTURES=11,Serializer.AUDIO=12,Serializer.AUDIOS=13,Serializer.COLOR=14,Serializer.COLORS=15,Serializer.PREFAB=16,Serializer.PREFABS=17,Serializer.NODE=18,Serializer.NODES=19,Serializer.SCRIPT=20,Serializer.SCRIPTS=21,Serializer.GEOM=22,Serializer.GEOMS=23,Serializer.POINT=24,Serializer.POINTS=25,Serializer.RECTANGLE=26,Serializer.RECTANGLES=27,Serializer.CIRCLE=28,Serializer.CIRCLES=29,Serializer.ELLIPSE=30,Serializer.ELLIPSES=31,Serializer.FONT=32,Serializer.FONTS=33,Serializer.FILTER=34,Serializer.FILTERS=35,Serializer.TEXTASSET=36,Serializer.TEXTASSETS=37,Serializer.EXCELASSET=38,Serializer.EXCELASSETS=39,Serializer.ACTION=40,Serializer.ACTIONMANAGER=41,Serializer.ANIMATOR=42,Serializer.ANIMATORS=43,Serializer.prototype.buildBundle=function(t,e,i){e.dependences||(e.dependences=[]);var r={};t.getMeta&&(r=t.getMeta()),i=i||{};for(var n in r)this.toJson(t,i,e,n,t[n],r[n]);return{"class":t.class,data:i,__json:t.__json}},Serializer.prototype.combineDependence=function(t){var e={};for(var i in t.dependences){var r=t.dependences[i];e[r.uuid]||(e[r.uuid]=r)}return e},Serializer.prototype.restoreBundle=function(t,e,i){i||(this.restoreContext={}),this.isRestoring=!0;var r=t.data.uuid;this.game.nodePool.find(r)&&(r=this.game.math.uuid());var n=this.newNode(t.class,e,r);t.__json&&(n.__json=deepCopy(t.__json));var o={};n.getMeta&&(o=n.getMeta());var s=t.data;for(var a in o)"scripts"!==a&&this.fromJson(n,s,a,o[a]);return o.scripts&&this.fromJson(n,s,"scripts",o.scripts),n.onDeserialized&&n.onDeserialized(),i?n:(n._restoreNodeRef(),n._restoreInit(),n._dispatchAwake(),n._dispatchEnable(),this.restoreContext={},this.isRestoring=!1,n)},Serializer.prototype.restoreState=function(t){var e=[];this.restoreContext={},this.isRestoring=!0;for(var i in t.children){var r=this.restoreBundle(t.children[i],this.game.world,!0);e.push(r)}for(var i in e)e[i]._restoreNodeRef();for(var i in e)e[i]._restoreInit();for(var i in e)"locales"===e[i].name?e[i]._dispatchAwake():e[i]._dispatchLocale();for(var i in e)"locales"!==e[i].name&&e[i]._dispatchAwake();for(var i in e)e[i]._dispatchEnable();this.restoreContext={},this.isRestoring=!1},Serializer.prototype.toJson=function(t,e,i,r,n,o){if(o=o||Serializer.AUTO,"object"==typeof o&&"function"==typeof o.get&&"function"==typeof o.set)return e[r]=o.get.call(t,t,i),undefined;switch(o){case Serializer.AUTO:o=this.getAutoType(n),o===undefined?e[r]=n:this.toJson(t,e,i,r,n,o);break;case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._saveCommonType(t,e,i,r,n,o);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._saveCommonArray(t,e,i,r,n,o);break;case Serializer.MAPPING:this._saveMapping(t,e,i,r,n,o);break;case Serializer.COLOR:this.saveColor(t,e,i,r,n);break;case Serializer.COLORS:this._saveArray(t,e,i,r,n,o,this._saveColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.saveGeom(t,e,i,r,n);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._saveArray(t,e,i,r,n,o,this._saveGeomItem);break;case Serializer.PREFAB:this.savePrefab(t,e,i,r,n);break;case Serializer.PREFABS:this._saveArray(t,e,i,r,n,o,this._savePrefabItem);break;case Serializer.TEXTURE:this.saveTexture(t,e,i,r,n);break;case Serializer.TEXTURES:this._saveArray(t,e,i,r,n,o,this._saveTextureItem);break;case Serializer.AUDIO:this.saveAudio(t,e,i,r,n);break;case Serializer.AUDIOS:this._saveArray(t,e,i,r,n,o,this._saveAudioItem);break;case Serializer.TEXTASSET:this.saveTextAsset(t,e,i,r,n);break;case Serializer.TEXTASSETS:this._saveArray(t,e,i,r,n,o,this._saveTextAssetItem);break;case Serializer.EXCELASSET:this.saveExcelAsset(t,e,i,r,n);break;case Serializer.EXCELASSETS:this._saveArray(t,e,i,r,n,o,this._saveExcelAssetItem);break;case Serializer.FONT:this.saveFont(t,e,i,r,n);break;case Serializer.FONTS:this._saveArray(t,e,i,r,n,o,this._saveFontItem);break;case Serializer.NODE:this.saveNode(t,e,i,r,n);break;case Serializer.NODES:this._saveArray(t,e,i,r,n,o,this._saveNodeItem);break;case Serializer.FILTER:this._saveFilter(t,e,i,r,n);break;case Serializer.FILTERS:this._saveArray(t,e,i,r,n,o,this._saveFilterItem);break;case Serializer.ACTION:this.saveAction(t,e,i,r,n);break;case Serializer.ACTIONMANAGER:this.saveActionManager(t,e,i,r,n);break;case Serializer.ANIMATOR:n instanceof qc.ActionAsset?this.saveAction(t,e,i,r,n):n instanceof qc.ActionManagerAsset&&this.saveActionManager(t,e,i,r,n);break;case Serializer.ANIMATORS:if(n){e[r]=[o,[]];for(var s in n){var a=n[s];a instanceof qc.ActionAsset?e[r][1].push(this._saveActionItem(a,i)):a instanceof qc.ActionManagerAsset&&e[r][1].push(this._saveActionManagerItem(a,i))}}break;default:throw Error("unsupported asset type:"+o)}},Serializer.prototype.fromJson=function(t,e,i,r){if(r=r||Serializer.AUTO,"object"==typeof r&&"function"==typeof r.get&&"function"==typeof r.set)return r.set.call(t,t,e[i]),undefined;var n=e[i];if(n!==undefined){if(null===n||0/0===n)return t[i]=n,undefined;switch(n[0]){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._restoreCommonType(t,e,i,n[0]);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._restoreCommonArray(t,e,i,n);break;case Serializer.MAPPING:this._restoreMapping(t,e,i,n);break;case Serializer.COLOR:this.restoreColor(t,e,i,n);break;case Serializer.COLORS:this._restoreArray(t,e,i,n,this._restoreColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.restoreGeom(t,e,i,n);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._restoreArray(t,e,i,n,this._restoreGeomItem);break;case Serializer.PREFAB:this.restorePrefab(t,e,i,n);break;case Serializer.PREFABS:this._restoreArray(t,e,i,n,this._restorePrefabItem);break;case Serializer.TEXTURE:this.restoreTexture(t,e,i,n);break;case Serializer.TEXTURES:this._restoreArray(t,e,i,n,this._restoreTextureItem);break;case Serializer.EXCELASSET:this.restoreExcelAsset(t,e,i,n);break;case Serializer.EXCELASSETS:this._restoreArray(t,e,i,n,this._restoreExcelAssetItem);break;case Serializer.AUDIO:this.restoreAudio(t,e,i,n);break;case Serializer.AUDIOS:this._restoreArray(t,e,i,n,this._restoreAudioItem);break;case Serializer.TEXTASSET:this.restoreTextAsset(t,e,i,n);break;case Serializer.TEXTASSETS:this._restoreArray(t,e,i,n,this._restoreTextAssetItem);break;case Serializer.FONT:this.restoreFont(t,e,i,n);break;case Serializer.FONTS:this._restoreArray(t,e,i,n,this._restoreFontItem);break;case Serializer.NODE:this.restoreNode(t,e,i,n);break;case Serializer.NODES:this.restoreNodes(t,e,i,n);break;case Serializer.FILTER:this._restoreFilter(t,e,i,n);break;case Serializer.FILTERS:this._restoreArray(t,e,i,n,this._restoreFilterItem);break;case Serializer.ACTION:this.restoreAction(t,e,i,n);break;case Serializer.ACTIONMANAGER:this.restoreActionManager(t,e,i,n);break;case Serializer.ANIMATORS:var o=[];if(n)for(var s in n[1])n[1][s][0]===Serializer.ACTION?o.push(this._restoreActionItem(n[1][s])):n[1][s][0]===Serializer.ACTIONMANAGER&&o.push(this._restoreActionManagerItem(n[1][s]));t[i]=o;break;default:throw Error("unsupported asset type:"+r)}}},Serializer.prototype.atob=function(t){return decodeURIComponent(atob(t))},Serializer.prototype.btoa=function(t){return btoa(encodeURIComponent(t))},Serializer.prototype.unpackUTF8=function(t){var e,i,r,n,o,s,i=0,r=t.length;for(e="";r>i;)switch(n=t[i++],n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(n);break;case 12:case 13:o=t[i++],e+=String.fromCharCode((31&n)<<6|63&o);break;case 14:o=t[i++],s=t[i++],e+=String.fromCharCode((15&n)<<12|(63&o)<<6|(63&s)<<0)}return e},Serializer.prototype.findNodeRef=function(t){var e=this.restoreContext[t]?this.restoreContext[t]:t;return this.game.nodePool.find(e)},Serializer.prototype.saveAudio=function(t,e,i,r,n){e[r]=this._saveAudioItem(n,i)},Serializer.prototype.restoreAudio=function(t,e,i,r){t[i]=this._restoreAudioItem(r)},Serializer.prototype._saveAudioItem=function(t,e){return t instanceof qc.SoundAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.AUDIO,t.key,t.uuid]):null},Serializer.prototype._restoreAudioItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.SoundAsset?e:null:(console.error("音频资源尚未载入, 无法反序列化.",t[1]),null)},Serializer.prototype.saveAction=function(t,e,i,r,n){e[r]=this._saveActionItem(n,i)},Serializer.prototype.restoreAction=function(t,e,i,r){t[i]=this._restoreActionItem(r)},Serializer.prototype._saveActionItem=function(t,e){return t instanceof qc.ActionAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.ACTION,t.uuid]):null},Serializer.prototype._restoreActionItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof qc.ActionAsset?e:null},Serializer.prototype.saveActionManager=function(t,e,i,r,n){e[r]=this._saveActionManagerItem(n,i)},Serializer.prototype.restoreActionManager=function(t,e,i,r){t[i]=this._restoreActionManagerItem(r)},Serializer.prototype._saveActionManagerItem=function(t,e){return t instanceof qc.ActionManagerAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.ACTIONMANAGER,t.uuid]):null},Serializer.prototype._restoreActionManagerItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof qc.ActionManagerAsset?e:null},Serializer.prototype.saveColor=function(t,e,i,r,n){e[r]=this._saveColorItem(n)},Serializer.prototype.restoreColor=function(t,e,i,r){t[i]=this._restoreColorItem(r)},Serializer.prototype._saveColorItem=function(t){return t instanceof Color?[Serializer.COLOR,t.toNumber(!0)]:null},Serializer.prototype._restoreColorItem=function(t){return t?new Color(t[1]):null},Serializer.prototype.saveExcelAsset=function(t,e,i,r,n){e[r]=this._saveExcelAssetItem(n,i)},Serializer.prototype.restoreExcelAsset=function(t,e,i,r){t[i]=this._restoreExcelAssetItem(r)},Serializer.prototype._saveExcelAssetItem=function(t,e){return t instanceof qc.ExcelAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.EXCELASSET,t.key,t.uuid]):null},Serializer.prototype._restoreExcelAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e&&e instanceof qc.ExcelAsset?e:null},Serializer.prototype.saveFont=function(t,e,i,r,n){e[r]=this._saveFontItem(n,i)},Serializer.prototype.restoreFont=function(t,e,i,r){t[i]=this._restoreFontItem(r)},Serializer.prototype._saveFontItem=function(t,e){if(t instanceof qc.Font)var i=t;if(i&&i instanceof qc.Font){e.dependences.push({key:i.key,uuid:i.uuid});var r=i.uuid;t=i.key}return[Serializer.FONT,t,r]},Serializer.prototype._restoreFontItem=function(t,e){if(!t)return null;e=e||this;var i=e.game.assets.find(t[1]);return i||(i=e.game.assets.findByUUID(t[2])),i||(i=t[1]),i},Serializer.prototype.isGeom=function(t){return t instanceof qc.Circle||t instanceof qc.Ellipse||t instanceof qc.Line||t instanceof qc.Matrix||t instanceof qc.Polygon||t instanceof qc.Rectangle||t instanceof qc.RoundedRectangle||t instanceof qc.Point},Serializer.prototype.saveGeom=function(t,e,i,r,n){e[r]=this._saveGeomItem(n,i)},Serializer.prototype.restoreGeom=function(t,e,i,r){t[i]=this._restoreGeomItem(r)},Serializer.prototype._saveGeomItem=function(t){var e=Serializer.GEOM;return t instanceof qc.Point?e=Serializer.POINT:t instanceof qc.Rectangle?e=Serializer.RECTANGLE:t instanceof qc.Circle?e=Serializer.CIRCLE:t instanceof qc.Ellipse&&(e=Serializer.ELLIPSE),t?[e,t.class,t.toJson()]:null},Serializer.prototype._restoreGeomItem=function(t){if(!t)return null;var e=qc.Util.findClass(t[1]),i=new e;return i.fromJson(t[2]),i},Serializer.prototype.saveNode=function(t,e,i,r,n){e[r]=this._saveNodeItem(n,i)},Serializer.prototype.restoreNode=function(t,e,i,r){t["__BUILTIN_NODE__"+i]=r[1]},Serializer.prototype.restoreNodes=function(t,e,i,r){t["__BUILTIN_NODE_ARRAY__"+i]=r[1]},Serializer.prototype._saveNodeItem=function(t){return t instanceof qc.Node?[Serializer.NODE,t.uuid]:null},Serializer.prototype.savePrefab=function(t,e,i,r,n){e[r]=this._savePrefabItem(n,i)},Serializer.prototype.restorePrefab=function(t,e,i,r){t[i]=this._restorePrefabItem(r)},Serializer.prototype._savePrefabItem=function(t,e){return t instanceof Prefab?(e.dependences.push({key:t.uuid,uuid:t.uuid}),[Serializer.PREFAB,t.uuid]):null},Serializer.prototype._restorePrefabItem=function(t){if(!t)return null;var e=this.game.assets.findByUUID(t[1]);return e instanceof Prefab?e:null},Serializer.prototype.saveTexture=function(t,e,i,r,n){e[r]=this._saveTextureItem(n,i)},Serializer.prototype.restoreTexture=function(t,e,i,r){t[i]=this._restoreTextureItem(r)},Serializer.prototype._saveTextureItem=function(t,e){if(!(t instanceof qc.Texture))return null;var i=t.atlas;return e.dependences.push({key:i.key,uuid:i.uuid}),[Serializer.TEXTURE,i.key,i.uuid,t.frame]},Serializer.prototype._restoreTextureItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.Atlas?new qc.Texture(e,t[3]):null:(console.error("贴图资源尚未载入，无法反序列化。",t[1]),null)},Serializer.prototype.saveTextAsset=function(t,e,i,r,n){e[r]=this._saveTextAssetItem(n,i)},Serializer.prototype.restoreTextAsset=function(t,e,i,r){t[i]=this._restoreTextAssetItem(r)},Serializer.prototype._saveTextAssetItem=function(t,e){return t instanceof qc.TextAsset?(e.dependences.push({key:t.key,uuid:t.uuid}),[Serializer.TEXTASSET,t.key,t.uuid]):null},Serializer.prototype._restoreTextAssetItem=function(t){if(!t)return null;var e=this.game.assets.find(t[1]);return e||(e=this.game.assets.findByUUID(t[2])),e?e instanceof qc.TextAsset?e:null:(console.error("文本资源尚未载入, 无法反序列化.",t[1]),null)},Serializer.registerCustomDeserializer=function(t,e){var i=Serializer.customDeserializers;return i[t]?(console.error("Duplicate custom deserializer"),undefined):(i[t]=e,undefined)},Serializer.prototype.getAutoType=function(t){if(t===undefined||null===t||0/0===t)return undefined;if("number"==typeof t)return Serializer.NUMBER;if("string"==typeof t)return Serializer.STRING;if("boolean"==typeof t)return Serializer.BOOLEAN;if(t instanceof qc.Node)return Serializer.NODE;if(t instanceof qc.Texture)return Serializer.TEXTURE;if(t instanceof qc.SoundAsset)return Serializer.AUDIO;if(t instanceof qc.TextAsset)return Serializer.TEXTASSET;if(t instanceof qc.ActionAsset)return Serializer.ACTION;if(t instanceof qc.ActionManagerAsset)return Serializer.ACTIONMANAGER;if(this.isGeom(t))return Serializer.GEOM;throw console.error(t),Error("")},Serializer.prototype.newNode=function(t,e,i){switch(t){case"qc.UIImage":return this.game.add.image(e,i);case"qc.Sprite":return this.game.add.sprite(e,i);case"qc.UIRoot":return new qc.UIRoot(this.game,i);case"qc.Button":return this.game.add.button(e,i);case"qc.Toggle":return new qc.Toggle(this.game,e,i);case"qc.UIText":return this.game.add.text(e,i);case"qc.Sound":return this.game.add.sound(e,i);case"qc.Node":return this.game.add.node(e,i);case"qc.ScrollView":return this.game.add.scrollView(e,i);case"qc.ScrollBar":return this.game.add.scrollBar(e,!1,i);case"qc.InputField":return this.game.add.inputField(e,i);case"qc.ProgressBar":return this.game.add.progressBar(e,!1,i);case"qc.Slider":return this.game.add.slider(e,!1,i);case"qc.Tilemap":return this.game.add.tilemap(e,i);case"qc.TileLayer":return this.game.add.tileLayer(e,i);case"qc.ObjectLayer":return this.game.add.objectLayer(e,i);case"qc.Dom":return this.game.add.dom(e,i);case"qc.Graphics":return this.game.add.graphics(e,i);case"qc.Dropdown":return this.game.add.dropdown(e,i);default:var r=Serializer.customDeserializers[t];if(r)return r(this.game,e,i);throw Error("unsupported class:"+t)}},Serializer.prototype._saveCommonType=function(t,e,i,r,n,o){e[r]=[o,n]},Serializer.prototype._restoreCommonType=function(t,e,i){t[i]=e[i][1]},Serializer.prototype._saveCommonArray=function(t,e,i,r,n,o){if(e[r]=[o,[]],n)for(var s in n)e[r][1].push(n[s])},Serializer.prototype._restoreCommonArray=function(t,e,i,r){var n=[];if(r)for(var o in r[1])n.push(r[1][o]);t[i]=n},Serializer.prototype._saveMapping=function(t,e,i,r,n,o){if(e[r]=[o,{}],n)for(var s in n)e[r][1][s]=n[s]},Serializer.prototype._restoreMapping=function(t,e,i,r){var n={};if(r)for(var o in r[1])n[o]=r[1][o];t[i]=n},Serializer.prototype._saveArray=function(t,e,i,r,n,o,s){if(e[r]=[o,[]],n)for(var a in n){var h=n[a],l=s.call(this,h,i);e[r][1].push(l)}},Serializer.prototype._restoreArray=function(t,e,i,r,n){var o=this,s=[];if(r)for(var a in r[1])s.push(n.call(this,r[1][a],o));t[i]=s};var Camera=qc.Camera=function(t){this.phaser=t,t._qc=this,t.roundPx=!1};Camera.prototype={},Camera.prototype.constructor=Camera,Object.defineProperties(Camera.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(t){this.phaser.position=t}},size:{get:function(){return new qc.Point(this.view.width,this.view.height)},set:function(t){this.setSize(t.x,t.y)}},x:{get:function(){return this.phaser.x},set:function(t){this.phaser.x=t}},y:{get:function(){return this.phaser.y},set:function(t){this.phaser.y=t}},width:{get:function(){return this.phaser.width},set:function(t){this.phaser.width=t}},height:{get:function(){return this.phaser.height},set:function(t){this.phaser.height=t}},bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.bounds=t}},visible:{get:function(){return this.phaser.visible},set:function(t){this.phaser.visible=t}},target:{get:function(){return this.phaser.target}}}),Camera.FOLLOW_LOCKON=Phaser.Camera.FOLLOW_LOCKON,Camera.FOLLOW_PLATFORMER=Phaser.Camera.FOLLOW_PLATFORMER,Camera.FOLLOW_TOPDOWN=Phaser.Camera.FOLLOW_TOPDOWN,Camera.FOLLOW_TOPDOWN_TIGHT=Phaser.Camera.FOLLOW_TOPDOWN_TIGHT,Camera.prototype.follow=function(t,e){null===t?this.phaser.unfollow():this.phaser.follow(t,e)},Camera.prototype.focusOn=function(t,e){this.phaser.focusOnXY(t,e)},Camera.prototype.reset=function(){this.phaser.reset()};var Game=qc.Game=function(t,e,i,r,n,o,s,a){var h=this;h.onStart=new qc.Signal,h.log=new qc.Log(h),h._debug=new qc.Debug(h),h._device=new qc.Device(h,Phaser.Device);var l;l="object"==typeof arguments[0]&&1===arguments.length?arguments[0]:{width:t,height:e,parent:i,state:r,transparent:n,physicsConfig:a},h.debug.on=l.debug,h.device.editor=l.editor,h.fixedGameSize=l.width>0&&l.height>0?{width:l.width,height:l.height}:null,h.remoteLogUrl=l.remoteLogUrl,r=l.state,r=r||{preload:function(){},create:function(){}};var c=r.init;if(r.init=function(){var t=h.phaser;h._nodePool=new qc.NodePool(h),new qc.SceneManager(t.state),new qc.PluginManager(t.plugins),t.math._qc=new qc.Math(t.rnd),h.timer=new qc.Timer(h),h.time=new qc.Time(h),h.sound=new qc.SoundManager(h),h._assets=new qc.Assets(h,t.load,t.cache),new qc.Stage(t.stage),new qc.Camera(t.camera),new qc.World(t.world),new qc.Input(t.input),h.dirtyRectangle=new qc.DirtyRectangle(t),t.renderer.dirtyRectangle=h.dirtyRectangle,h.dirtyRectangle.enable=l.dirtyRectangles,h.dirtyRectangle.showDirtyRegion=l.dirtyRectanglesShow,h.canvas.style.outline=0,h.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),h.plugins.add(qc.dragonBonesDriver),h.plugins.add(qc.CleanPIXISpriteRetainer),h._serializer=new qc.Serializer(h),h._storage=new qc.Storage(h),h.phaser.scale.pageAlignHorizontally=!0,h.phaser.scale.pageAlignVertically=!0,h.phaser.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,h.phaser.scale.onSizeChange.add(function(){h.device.resetOrientation()}),h.device.resetOrientation(),h._debug.remoteLogUrl=l.remoteLogUrl,c&&c.call(r),window.qc.initGame&&window.qc.initGame(h),h.onStart.dispatch()},l.state=r,l.renderer=null==l.renderer?Phaser.AUTO:l.renderer,!("antialias"in l)){var u;switch(l.renderer){case Phaser.HEADLESS:case Phaser.CANVAS:u=!1;break;case Phaser.AUTO:var p=function(){try{var t=document.createElement("canvas");return t.screencanvas=!1,!!window.WebGLRenderingContext&&(t.getContext("webgl")||t.getContext("experimental-webgl"))}catch(e){return!1}}();u=p?!0:!1;default:u=!0}l.antialias=u}if(l.disableVisibilityChange=l.runInBackground,l.disableVisibilityChange=null==l.disableVisibilityChange?!0:l.disableVisibilityChange,!l.resolution){var d=window.devicePixelRatio;l.resolution="number"==typeof l.resolutionRatio?1+Math.max(0,(d-1)*l.resolutionRatio):h.device.desktop?d:1+Math.max(0,(d-1)/4)}var f=l.backgroundColor;null==f&&(f=Color.background),f instanceof Color&&(f=f.toNumber()),l.backgroundColor=f,h.phaser=new Phaser.Game(l),h.phaser._qc=this,this.phaser._calcTransformCount=0,h.phaser.forceSingleUpdate=!0,h.add=new GameObjectFactory(h)};Object.defineProperties(Game.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(t){this.phaser.config=t}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(t){this.phaser.physicsConfig=t}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(t){this.phaser.renderer.transparent=t}},antialias:{get:function(){return this.phaser.antialias},set:function(t){var e=this.phaser;if(e.antialias!==t){e.antialias=t,e.stage.smoothed=t;for(var i in PIXI.BaseTextureCache)PIXI.BaseTextureCache[i].scaleMode=t?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST,this.phaser.renderType===Phaser.WEBGL&&PIXI.BaseTextureCache[i].dirty();this.dirtyRectangle.forceDirty=!0}}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},scene:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(t){this.phaser.paused=t}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}}),Game.prototype.shutdown=function(){this.input.enable=!1,this.state.clearWorld(!0),this.assets.clear(),this.phaser.destroy()},Game.prototype.enableStep=function(){this.phaser.enableStep()},Game.prototype.disableStep=function(){this.phaser.disableStep()},Game.prototype.step=function(){this.phaser.step()},Game.prototype.updateScale=function(t){var e=this.phaser.scale;e&&(e._lastUpdate=0,t&&e.preUpdate())},Game.prototype.fullScreen=function(){var t=this;if(!t._adjustToFullScreen){var e,i;t._adjustToFullScreen=function(r){if(!t.isBooted||!t.input.inputting){var n=document.documentElement.clientWidth;window.innerWidth&&window.innerWidth<n&&(n=window.innerWidth);var o=document.documentElement.clientHeight;window.innerHeight&&window.innerHeight<o&&(o=window.innerHeight),(e!==n||i!==o||r)&&(e=n,i=o,t.device.iOS?(t.setGameSize(n-5,o+5),t.phaser.time.events.add(1,function(){t.setGameSize(n,o)})):t.setGameSize(n,o),t.container.style.width=n+"px",t.container.style.height=o+"px",t.updateScale(),t.device.phaser.UCBrowser&&(window.scrollTo(0,1),setTimeout(function(){var t=document.createElement("div");t.style.position="absolute",t.style.top=o+"px",t.style.width="100px",t.style.height="100px",document.body.appendChild(t),window.scrollTo(0,o),setTimeout(function(){window.scrollTo(0,1),document.body.removeChild(t)},10)},10)))}},window.addEventListener("orientationchange",t.updateGameLayout.bind(t,!1),!1),window.addEventListener("resize",t.updateGameLayout.bind(t,!1),!1),window.scrollTo(0,1),t._adjustToFullScreen()}},Game.prototype.setGameSize=function(t,e){this.fixedGameSize||this.phaser.scale.setGameSize(t,e),this.updateScale()},Game.prototype.updateGameLayout=function(t){this._adjustToFullScreen&&this._adjustToFullScreen(t),this.world.updateDomRoot()},Game.prototype.update=function(t){var e=this.phaser;if(this.time){var t=this.time.now;(!this._lastUpdateGameSizeTime||t-this._lastUpdateGameSizeTime>1e3)&&(this._lastUpdateGameSizeTime=t,this.updateGameLayout())}e._calcTransformCount=0,e.time.update(t);var i=1/e.time.desiredFps;if(e._kickstart)return this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform(),this.updateRender(e.time.slowMotion*e.time.desiredFps),e._kickstart=!1,undefined;if(e._spiraling<=1||e.forceSingleUpdate){var r=1e3*e.time.slowMotion/e.time.desiredFps;e._deltaTime+=Math.max(Math.min(3*r,e.time.elapsed),0);var n=0;e.updatesThisFrame=Math.floor(e._deltaTime/r),e.forceSingleUpdate&&(e.updatesThisFrame=Math.min(1,e.updatesThisFrame));for(var o=!1;e._deltaTime>=r&&(e._deltaTime-=r,e.currentUpdateID=n,o||this._paused||this.pendingStep||(o=!0),o&&(e.updateFrameDelta(),this.updateLogic(i),e._calcTransformCount=0,e.stage.updateTransform()),n++,!e.forceSingleUpdate||1!==n););return n>e._lastCount?e._spiraling++:n<e._lastCount&&(e._spiraling=0),e._lastCount=n,o&&this.updateRender(e._deltaTime/r),o}e.time.time>e._nextFpsNotification&&(e._nextFpsNotification=e.time.time+1e4,e.fpsProblemNotifier.dispatch()),e._deltaTime=0,e._spiraling=0,e.updateRender(e.time.slowMotion*e.time.desiredFps)},Game.prototype.updateLogic=function(t){var e=Date.now(),i=this.phaser;if(i._paused||i.pendingStep)i.scale.pauseUpdate(),i.state.pauseUpdate(),i.debug.preUpdate();else{this.timer&&this.timer.update(this.time.now),i.stepping&&(i.pendingStep=!0);var r=Date.now();i.scale.preUpdate(),i.debug.preUpdate(),i.world.camera.preUpdate(),i.state.preUpdate(t),i.plugins.preUpdate(t),i.stage.preUpdate(),i.physics.preUpdate(),this.debug.preUpdate+=Date.now()-r,r=Date.now(),i.input.update(),i.state.update(),i.stage.update(),i.tweens.update(t),i.sound.update(),i.physics.update(),i.plugins.update(),this.debug.update+=this.time.now-r,r=Date.now(),i.stage.postUpdate(),i.plugins.postUpdate(),this.debug.postUpdate+=Date.now()-r,r=Date.now()}this.debug.logic+=Date.now()-e},Game.prototype.updateRender=function(t){var e=Date.now(),i=this.phaser;i.lockRender||(i.state.preRender(t),i.renderer.render(i.stage),i.plugins.render(t),i.state.render(t),i.plugins.postRender(t),qc.CanvasPool.postRender(),this.debug.render+=Date.now()-e)},Phaser.Game.prototype.gamePaused=function(t){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},Phaser.Game.prototype.gameResumed=function(t){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(t),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))};var phaserGameParseConfig=Phaser.Game.prototype.parseConfig;Phaser.Game.prototype.parseConfig=function(t){phaserGameParseConfig.call(this,t),"antialias"in t&&(this.antialias=!!t.antialias)};var phaser_updateSetTimeout=Phaser.RequestAnimationFrame.prototype.updateSetTimeout;Phaser.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{phaser_updateSetTimeout.call(this)}catch(t){this.game._qc.log.error("Error：{0}",t)}};var phaser_updateRAF=Phaser.RequestAnimationFrame.prototype.updateRAF;Phaser.RequestAnimationFrame.prototype.updateRAF=function(t){try{phaser_updateRAF.call(this,t)}catch(e){this.game._qc.log.error("Error：{0}",e)}},Phaser.Game.prototype.updateFrameDelta=function(t){var e=this,i=e.time,r=i.time,n=e.__lastFrameTime?r-e.__lastFrameTime:t;e.__lastFrameTime=r,i.frameDeltaTime=n/i.slowMotion,i._totalEscapeTime=i.frameDeltaTime+(i._totalEscapeTime||0)};var Plugin=qc.Plugin=Phaser.Plugin,PluginManager=qc.PluginManager=function(t){t._qc=this,this.phaser=t};PluginManager.prototype={},PluginManager.prototype.constructor=PluginManager,Object.defineProperties(PluginManager.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}}),PluginManager.prototype.add=function(t){var t=this.phaser.add.apply(this.phaser,arguments);return t.game=this.game,t},PluginManager.prototype.remove=function(t){this.phaser.remove(t)},PluginManager.prototype.removeAll=function(){this.phaser.removeAll()},PluginManager.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser},qc.Signal=Phaser.Signal,qc.SignalBinding=Phaser.SignalBinding;var Stage=qc.Stage=function(t){this.phaser=t,t._qc=this};Stage.prototype={},Stage.prototype.constructor=Stage,Object.defineProperties(Stage.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(t){this.phaser.name=t}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(t){this.phaser.disableVisibilityChange=t}},backgroundColor:{get:function(){return new Color(this.phaser.backgroundColor)},set:function(t){if(t=t||Color.background,!(t instanceof Color))throw Error("Expected qc.Color");this.phaser.backgroundColor=t.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new qc.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(){throw Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}}),Stage.prototype.updateTransform=function(){this.phaser.updateTransform()},Stage.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser};var State=qc.State=function(){var t=new Phaser.State;this.phaser=t,t._qc=this};State.prototype={},State.prototype.constructor=State,Object.defineProperties(State.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(t){this.phaser.key=t}},add:{get:function(){return this.phaser.add._qc},set:function(t){this.phaser.add=t.phaser,t.phaser._qc=t}},make:{get:function(){return this.phaser.make._qc},set:function(t){this.phaser.make=t.phaser,t.phaser._qc=t}},camera:{get:function(){return this.phaser.camera._qc},set:function(t){this.phaser.camera=t.phaser,t.phaser._qc=t}},assets:{get:function(){return this._assets},set:function(t){this._assets=t}},input:{get:function(){return this.phaser.input._qc},set:function(t){this.phaser.input=t.phaser,t.phaser._qc=t
}},math:{get:function(){return this.phaser.math._qc},set:function(t){this.phaser.math=t.phaser,t.phaser._qc=t}},time:{get:function(){return this.phaser.time._qc},set:function(t){this.phaser.time=t.phaser,t.phaser._qc=t}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(t){this.phaser.tweens=t.phaser,t.phaser._qc=t}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null},set:function(t){this.phaser.world=t.phaser,t.phaser._qc=t}},physics:{get:function(){return this.phaser.physics._qc},set:function(t){this.phaser.physics=t.phaser,t.phaser._qc=t}}});var SceneManager=qc.SceneManager=function(t){t._qc=this,this.phaser=t,this._onPreload=new qc.Signal,this._onCreate=new qc.Signal,this.onStartLoad=new qc.Signal,this.onEndLoad=new qc.Signal};SceneManager.prototype={},SceneManager.prototype.constructor=SceneManager,Object.defineProperties(SceneManager.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(t){this._entry=t}},list:{get:function(){return this._list},set:function(t){this._list=t;var e=this;for(var i in t){var r=t[i],n={preload:function(){e._onPreload.dispatch();var t=e.game.assets.find(e.current+".bin");if(t)for(var i in t.dependences){var r=t.dependences[i];e.game.assets.loadByUUID(r.uuid,function(t){t||(e.game.log.important("场景的依赖资源({0})加载失败.",r.uuid),"function"==typeof e.game.loadingProcessCallback&&e.game.loadingProcessCallback(r.key))})}},create:function(){try{e._parse()}catch(t){e.game.log.error("Parse scene fail：{0}",t),qc.Util.popupError(t.message)}e.loading=!1,e._onCreate.dispatch(),e.onEndLoad.dispatch(n)}};this.phaser.add(r,n,!1)}}},loading:{get:function(){return this._loading||!1},set:function(t){this._loading=t}},current:{get:function(){return this.phaser.current}}}),SceneManager.prototype.download=function(t,e){t=t||this.entry;var i=t+".bin";this.game.log.trace("Start downloading scene:{0}",t),this.game.assets.beginBatchLoad(),this.game.assets.load(i,i,e),this.game.assets.endBatchLoad()},SceneManager.prototype.load=function(t,e,i,r){var n=this;return n.loading?(console.warn("Cannot call when switching scene."),undefined):(t=t||n.entry,/\//.test(t)||(t="Assets/scene/"+t),n.list.indexOf(t)<0?(n.game.log.error("Scene:{0} not exists",t),undefined):(n.loading=!0,n.onStartLoad.dispatch(t),n.clearWorld(),e!==!0&&(e=!1),e&&n.game.assets.clear(),n.download(t,function(){"function"==typeof i&&n._onPreload.addOnce(i),"function"==typeof r&&n._onCreate.addOnce(r),n.phaser.start(t,!1,e)}),undefined))},SceneManager.prototype.clearWorld=function(t){var e=this.game.world.children.slice(0);e.forEach(function(e){(t||!e.ignoreDestroy)&&e.destroy()})},SceneManager.prototype.destroy=function(){this.entry=undefined,this.list=[],this.phaser.destroy()},SceneManager.prototype._parse=function(){var t=this.current+".bin",e=this.game.assets.find(t);if(e){var i=e.json.data;this.game.serializer.restoreState(i),this.game.world._prefab=t}else self.game.log.error("Can not find scene {0} from assets",state)};var World=qc.World=function(t){var e=this;e.onModelChange=new qc.Signal,qc.Node.call(e,t,e),e.name="world",e.onSizeChange.add(function(){e.relayout()}),e._toDestroyQ=[],e.game.container.style.overflow="hidden",e.backDomRoot=document.createElement("div"),e.backDomRoot.style.position="absolute",e.backDomRoot.style.left="0px",e.backDomRoot.style.top="0px",e.backDomRoot.style.overflow="hidden",e.game.container.insertBefore(e.backDomRoot,e.game.canvas),e.frontDomRoot=document.createElement("div"),e.frontDomRoot.style.position="absolute",e.frontDomRoot.style.left="0px",e.frontDomRoot.style.top="0px",e.frontDomRoot.style.overflow="hidden",e.game.container.appendChild(e.frontDomRoot)};World.prototype=Object.create(qc.Node.prototype),World.prototype.constructor=World,World.prototype.getMeta=function(){var t=(qc.Serializer,qc.Node.prototype.getMeta.call(this));return delete t.uuid,t},World.prototype.relayout=function(){for(var t=this.children,e=0;e<t.length;e++)t[e].relayout()},Object.defineProperties(World.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(t){this.phaser.setBounds(t.x,t.y,t.width,t.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){return this._editorWidth!==undefined?this._editorWidth:this.phaser.width},set:function(t){this.width!==t&&(this.phaser.width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,t))}},height:{get:function(){return this._editorHeight!==undefined?this._editorHeight:this.phaser.height},set:function(t){this.height!==t&&(this.phaser.height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,t))}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(){throw Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}}),World.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(t){t.destroyImmediately()}),this._toDestroyQ.length=0},World.prototype.addToDestroy=function(t){this._toDestroyQ.push(t)},World.prototype.updateDomRoot=function(){if(!this.game.isBooted||!this.game.input.inputting){var t=this.frontDomRoot.style,e=this.backDomRoot.style,i=this.game.canvas.style;t.width=e.width=i.width,t.height=e.height=i.height,t.marginLeft=e.marginLeft=i.marginLeft,t.marginTop=e.marginTop=i.marginTop,t.marginRight=e.marginRight=i.marginRight,t.marginBottom=e.marginBottom=i.marginBottom}};var Input=qc.Input=function(t){var e=this;t._qc=e;var i=t.destroy;t.destroy=function(){e.destroy(),i.call(t)};var r=t.update;t.update=function(){e.update(),r.call(t)},e.phaser=t,e.game=t.game._qc,e._inputting=0,e.cursorPosition=new qc.Point(0/0,0/0),e.onKeyDown=new Phaser.Signal,e.onKeyUp=new Phaser.Signal,e.onKeyRepeat=new Phaser.Signal,e.onCursorMove=new Phaser.Signal,e.onWheel=new Phaser.Signal,e.onPointerUp=new Phaser.Signal,e.onPointerDown=new Phaser.Signal,e.onPointerMove=new Phaser.Signal,e.nativeMode=!1,e.keyboard=new qc.Keyboard(this),e.mouse=new qc.Mouse(this),e.touch=new qc.Touch(this),e.module=new qc.BaseInputModule(e.game,e),e._init()};Input.prototype={},Input.prototype.constructor=Input,Object.defineProperties(Input.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},inputting:{get:function(){return this._inputting>0}}}),Input.prototype._init=function(){var t=this;t.phaser.game.onBlur.add(this._onBlur,this),t.keyboard.onKeyUp.add(this.processKeyUp,this),t.keyboard.onKeyDown.add(this.processKeyDown,this),t.keyboard.onKeyRepeat.add(this.processKeyRepeat,this),t.mouse.onMouseDown.add(this.processPointerDown,this),t.mouse.onMouseUp.add(this.processPointerUp,this),t.mouse.onMousePressMove.add(this.processPointerMove,this),t.mouse.onMouseMove.add(this.processMouseMove,this),t.mouse.onMouseWheel.add(this.processMouseWheel,this),t.touch.onTouchStart.add(this.processPointerDown,this),t.touch.onTouchEnd.add(this.processPointerUp,this),t.touch.onTouchMove.add(this.processPointerMove,this),t.enable=!0},Input.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this),this.keyboard.onKeyUp.remove(this.processKeyUp,this),this.keyboard.onKeyDown.remove(this.processKeyDown,this),this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this),this.mouse.onMouseDown.remove(this.processPointerDown,this),this.mouse.onMouseUp.remove(this.processPointerUp,this),this.mouse.onMousePressMove.remove(this.processPointerDown,this),this.mouse.onMouseMove.remove(this.processMouseMove,this),this.mouse.onMouseWheel.remove(this.processMouseWheel,this),this.touch.onTouchStart.remove(this.processPointerDown,this),this.touch.onTouchEnd.remove(this.processPointerUp,this),this.touch.onTouchMove.remove(this.processPointerMove,this),this.module&&this.module.destroy(),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy(),this.onKeyDown.removeAll(),this.onKeyUp.removeAll(),this.onKeyRepeat.removeAll(),this.onCursorMove.removeAll(),this.onWheel.removeAll(),this.onPointerDown.removeAll(),this.onPointerMove.removeAll(),this.onPointerUp.removeAll(),this.phaser=null,this.module=null,this.keyboard=null,this.mouse=null,this.touch=null},Input.prototype._setEnable=function(t){this._enable!==t&&(this._enable=t,this.touch&&(this.touch.enable=t),this.mouse&&(this.mouse.enable=t),this.keyboard&&(this.keyboard.enable=t))},Input.prototype.update=function(){this._wheelDeltaX=0,this._wheelDeltaY=0,this.keyboard.update(),this.touch.update(),this.mouse.update(),this.module.update()},Input.prototype._onBlur=function(){this.module.lossFocus(),this.keyboard.lossFocus(),this.mouse.lossFocus(),this.touch.lossFocus()},Input.prototype.processKeyDown=function(t,e){this.onKeyDown.dispatch(t,e)},Input.prototype.processKeyUp=function(t,e){this.onKeyUp.dispatch(t,e)},Input.prototype.processKeyRepeat=function(t,e){this.onKeyRepeat.dispatch(t,e)},Input.prototype.isKeyDown=function(t){return this.keyboard.isKeyDown(t)},Input.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()},Input.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()},Input.prototype.isAltDown=function(){return this.isKeyDown(qc.Keyboard.ALT)},Input.prototype.isControlDown=function(){return this.isKeyDown(qc.Keyboard.CONTROL)},Input.prototype.isShiftDown=function(){return this.isKeyDown(qc.Keyboard.SHIFT)},Input.prototype.isMetaDown=function(){return this.isKeyDown(qc.Keyboard.META)||this.isKeyDown(qc.Keyboard.META_RWIN)||this.isKeyDown(qc.Keyboard.META_RMAC)},Input.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)},Input.prototype.isMouse=function(t){return 0>t&&t>=qc.Mouse.BUTTON_FORWORD},Input.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()},Input.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()},Input.prototype.isMouseDown=function(t){return this.mouse.isMouseDown(t)},Input.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()},Input.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()},Input.prototype.isTouchStart=function(t){return this.touch.isTouchStart(t)},Input.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()},Input.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()},Input.prototype.isPointerStart=function(t){return this.isMouse(t)?this.isMouseDown(t):this.isTouchStart(t)},Input.prototype.getPointer=function(t){return 0>t&&t>=qc.Mouse.BUTTON_FORWORD?this.mouse.getMouseById(t):this.touch.getTouchById(t)},Input.prototype.processMouseMove=function(t,e){this.cursorPosition.x=t,this.cursorPosition.y=e,this.onCursorMove.dispatch(t,e)},Input.prototype.processMouseWheel=function(t,e){this._wheelDeltaX=t,this._wheelDeltaY=e,this.onWheel.dispatch(t,e)},Input.prototype.processPointerDown=function(t,e,i){this.onPointerDown.dispatch(t,e,i)},Input.prototype.processPointerUp=function(t,e,i){this.onPointerUp.dispatch(t,e,i)},Input.prototype.processPointerMove=function(t,e,i){this.onPointerMove.dispatch(t,e,i)},Input.prototype.ignoreDomEvent=function(t){var e=this,i=e.findDomNodeWithEvent(t);return i&&i.interactive&&i.hitArea},Input.prototype.findDomNodeWithEvent=function(t){var e=this,i=t.target;if(!i||i===e.game.world.frontDomRoot||i===e.game.world.backDomRoot||i===e.game.canvas.parentNode)return null;for(;i&&!i._qc;)i=i.parentNode;return i?i._qc:null};var Debug=qc.Debug=function(t){var e=this;e._game=t,e.on=!1,e.animation=0,e.total=0,e.logic=0,e.render=0,e.preUpdate=0,e.update=0,e.postUpdate=0,e.clientId=0};Debug.prototype={},Debug.prototype.constructor=Debug,Object.defineProperties(Debug.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||!1},set:function(t){this._on=t,t&&(this.game.log.enableTrace=!0)}},remoteLogUrl:{set:function(v){if(this.pollTimer&&(this.game.timer.remove(this.pollTimer),this.pollTimer=null),"string"==typeof v){var self=this;this.pollTimer=this.game.timer.loop(1e3,function(game){if(!self.isPolling){var str=":queryCmd:"+self.clientId;try{self.isPolling=!0,qc.AssetUtil.post(game.remoteLogUrl+"/remoteLog",str,function(res){if(self.isPolling=!1,"200 OK"!==res){var match=res.match(/^id:(.*)/);if(match)return self.clientId=match[1],document.title="("+match[1]+")"+document.title,undefined;var cmdList;try{cmdList=JSON.parse(res)}catch(e){cmdList=[]}for(var i=0;i<cmdList.length;i++)try{var ret=eval(cmdList[i]);game.log.remoteReply(ret)}catch(e){game.log.remoteReply(e.stack)}}},function(){console.log("queryCmd post error."),self.isPolling=!1})}catch(e){self.isPolling=!1}}},null,this.game)}}}});var Device=qc.Device=function(t,e){var i=this;i.phaser=e,i._game=t,i._orientation=Device.PORTRAIT,i.onOrientationChange=new qc.Signal};Device.prototype={},Device.prototype.constructor=Debug,Object.defineProperties(Device.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){return this.phaser.initialized?this.phaser.desktop:(this._isDesktop===undefined&&this.checkOS(),this._isDesktop)}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){return this.phaser.chrome?Device.CHROME:this.phaser.arora?Device.ARORA:this.phaser.epiphany?Device.EPIPHANY:this.phaser.firefox?Device.FIREFOX:this.phaser.trident?Device.TRIDENT:this.phaser.ie?Device.IE:this.phaser.mobileSafari?Device.MOBILE_SAFARI:this.phaser.midori?Device.MIDORI:this.phaser.opera?Device.OPERA:this.phaser.safari?Device.SAFARI:this.phaser.silk?Device.SILK:this.phaser.UCBrowser?Device.UCBROWSER:Device.UNKNOW}},resolution:{get:function(){return window.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||!1},set:function(t){this._editor=t,t&&(this.game.debug.on=!0)}},orientation:{get:function(){return this._orientation},set:function(t){this.orientation!==t&&(this._orientation=t,this.onOrientationChange.dispatch(t))}}}),Device.UNKNOW=-1,Device.CHROME=0,Device.ARORA=1,Device.EPIPHANY=2,Device.FIREFOX=3,Device.IE=4,Device.TRIDENT=5,Device.MOBILE_SAFARI=6,Device.MIDORI=7,Device.OPERA=8,Device.SAFARI=9,Device.WEBAPP=10,Device.SILK=11,Device.UCBROWSER=12,Device.AUTO=0,Device.PORTRAIT=1,Device.LANDSCAPE=2,Device.prototype.resetOrientation=function(){this.orientation=this.game.world.width>this.game.world.height?Device.LANDSCAPE:Device.PORTRAIT},Device.prototype.isCanvasRenderer=function(){return this.game.phaser.renderType===Phaser.CANVAS},Device.prototype.isWebGLRenderer=function(){return this.game.phaser.renderType===Phaser.WEBGL},Device.prototype.checkOS=function(){var t=navigator.userAgent,e={};/Playstation Vita/.test(t)?e.vita=!0:/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?e.kindle=!0:/Android/.test(t)?e.android=!0:/CrOS/.test(t)?e.chromeOS=!0:/iP[ao]d|iPhone/i.test(t)?e.iOS=!0:/Linux/.test(t)?e.linux=!0:/Mac OS/.test(t)?e.macOS=!0:/Windows/.test(t)&&(e.windows=!0,/Windows Phone/i.test(t)&&(e.windowsPhone=!0));var i=/Silk/.test(t);this._isDesktop=!1,(e.windows||e.macOS||e.linux&&!i||e.chromeOS)&&(this._isDesktop=!0),(e.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(this._isDesktop=!1)},qc.RenderTexture=PIXI.RenderTexture,qc.RenderTexture.prototype.resize=function(t,e,i){(t!==this.width||e!==this.height)&&(this.valid=t>0&&e>0,this.width=t,this.height=e,this.frame.width=this.crop.width=t*this.resolution,this.frame.height=this.crop.height=e*this.resolution,i&&(this.baseTexture.width=Math.round(this.width*this.resolution),this.baseTexture.height=Math.round(this.height*this.resolution)),this.renderer.type===PIXI.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(Math.round(this.width*this.resolution),Math.round(this.height*this.resolution)))},qc.RenderTexture.prototype.directRenderWebGL=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0;var n=this.renderer.gl;if(n.isContextLost())return!1;if(!n.replace){var o=n.viewport;n.viewport=function(t,e,i,r){(0===i||0===r||0>i*r)&&console.log("viewPort:",t,e,i,r,i*r),o.call(n,t,e,i,r)},n.replace=!0}n.viewport(0,0,this.width*this.resolution,this.height*this.resolution),n.bindFramebuffer(n.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear();var s=n.getError();s&&console.log("webgl gl.getError(",s,")"),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},PIXI.RenderTexture.prototype.directRenderCanvas=function(t,e,i){if(this.valid){var r={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=e?e.x:0,this.renderer.offset.y=e?e.y:0,i&&this.textureBuffer.clear();var n=this.textureBuffer.context,o=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,n),this.renderer.resolution=o,this.renderer.offset.x=r.x,this.renderer.offset.y=r.y}},qc.RenderTexture.prototype.renderWebGL=function(t,e,i){if(this.valid){var r=t.getWorldTransform();r.identity(),r.translate(0,2*this.projection.y),e&&r.append(e),r.scale(1,-1),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,o=0,s=n.length;s>o;o++)n[o].updateTransform();var a=this.renderer.gl;a.viewport(0,0,this.width*this.resolution,this.height*this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.textureBuffer.frameBuffer),i&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,t._isNotNeedCalcTransform=!1}},PIXI.RenderTexture.prototype.renderCanvas=function(t,e,i){if(this.valid){var r=t.worldTransform;r.identity(),e&&r.append(e),t.worldAlpha=1,t._isSubNeedCalcTransform=!0;for(var n=t.children,o=0,s=n.length;s>o;o++)n[o].updateTransform();i&&this.textureBuffer.clear();var a=this.textureBuffer.context,h=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(t,a),this.renderer.resolution=h,t._isNotNeedCalcTransform=!1}};var SoftClipManager=qc.SoftClipManager=function(t){this.renderSession=t,this._polygons=[]};SoftClipManager.prototype={},SoftClipManager.prototype.constructor=SoftClipManager,Object.defineProperties(SoftClipManager.prototype,{needClip:{get:function(){return!!this._polygons.length}}}),SoftClipManager.getManager=function(t){var e=t.softClipManager;return e||(e=t.softClipManager=new SoftClipManager(t)),e},SoftClipManager.prototype.pushPolygon=function(t){var e=this,i=[];if(e.renderSession.spriteBatch.batchType=qc.BATCH_TRIANGLES,!e._polygons.length){for(var r=arguments.length;r--;){var n=arguments[r],o=qc.GeometricTool.quickDecomp(n);if(o.length)Array.prototype.push.apply(i,o);else for(var s=GeometricTool.Triangulate(n),a=0;a<s.length;a+=3){var h=s[a],l=s[a+1],c=s[a+2];i.push([n[h],n[l],n[c]])}}return e._polygons.push(i),undefined}for(var u=e._polygons[e._polygons.length-1],p=u.length;p--;)for(var d=u[p],r=arguments.length;r--;){t=arguments[r];var o=qc.GeometricTool.sutherlandHodgman(t,d);i.push(o)}e._polygons.push(i)},SoftClipManager.prototype.popPolygon=function(){var t=this;t._polygons.length&&t._polygons.splice(t._polygons.length-1,1),t._polygons.length||(t.renderSession.spriteBatch.batchType=qc.BATCH_QUAD)},SoftClipManager.prototype.getClipPolygon=function(t,e,i,r,n,o){var s=this,a=[],h=s._polygons[s._polygons.length-1],l=h.length,c=1/(t*r+i*-e);t*=c,e*=c,i*=c,r*=c;for(var u=o*i-n*r,p=-o*t+n*e,d=-1;++d<l;){for(var f=h[d],g=[],m=f.length,_=-1;++_<m;){var y=f[_];g.push(new qc.Point(r*y.x-i*y.y+u,t*y.y-e*y.x+p))}a.push(g)}return a},SoftClipManager.prototype.renderSprite=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,m){var _=this.getClipPolygon(c,u,p,d,f,g);if(0!==_.length){var y=[new qc.Point(i,r),new qc.Point(n,r),new qc.Point(n,o),new qc.Point(i,o)],v={x:i,y:r,width:n-i,height:o-r};if(v.width&&v.height)for(var T=function(t,e,i,r,n,o){return{x:e+(t.x-o.x)/o.width*(i-e),y:r+(t.y-o.y)/o.height*(n-r)}},x=_.length;x--;){var S=_[x],b=qc.GeometricTool.sutherlandHodgman(S,y),w=b.length;if(w>=3){for(var A=[],E=[],C=-1;++C<w;)A[C]=T(b[C],s,h,a,l,v),E.push({x:c*b[C].x+p*b[C].y+f,y:d*b[C].y+u*b[C].x+g});var P=qc.GeometricTool.Triangulate(E);if(P)for(var C=0;C<P.length;C+=3){var I=P[C],O=P[C+1],M=P[C+2];this._addWebGLTriangle(t.spriteBatch,e,m,E[I],E[O],E[M],A[I],A[O],A[M])}}}}},SoftClipManager.prototype._addWebGLTriangle=function(t,e,i,r,n,o,s,a,h){t.currentBatchSize<t.triangleSize||(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var l=t.colors,c=t.positions,u=3*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(c[u]=0|r.x,c[u+1]=0|r.y,c[u+5]=0|n.x,c[u+6]=0|n.y,c[u+10]=0|o.x,c[u+11]=0|o.y):(c[u]=r.x,c[u+1]=r.y,c[u+5]=n.x,c[u+6]=n.y,c[u+10]=o.x,c[u+11]=o.y),c[u+2]=s.x,c[u+3]=s.y,c[u+7]=a.x,c[u+8]=a.y,c[u+12]=h.x,c[u+13]=h.y,l[u+4]=l[u+9]=l[u+14]=i,t.sprites[t.currentBatchSize++]=e};var SoundManager=qc.SoundManager=function(t){this.game=t,this.phaser=t.phaser.sound,this.phaser._qc=this;var e=this;t.onStart.add(function(){e._boot()}),this._soundDurationMap=window.soundDurationMap||{}};SoundManager.prototype.constructor=SoundManager,SoundManager.prototype._boot=function(){var t=this.phaser,e=this.game.input;!t.game.device.cocoonJS&&t.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(e.touch.callbackContext=t,t.game.device.iOSVersion>8?e.touch.touchEndCallback=t.unlock:e.touch.touchStartCallback=t.unlock,e.mouse.callbackContext=t,e.mouse.mouseDownCallback=t.unlock,t.touchLocked=!0):t.touchLocked=!1},Object.defineProperties(SoundManager.prototype,{mute:{get:function(){return this.phaser.mute},set:function(t){this.phaser.mute=t}},volume:{get:function(){return this.phaser.volume},set:function(t){this.phaser.volume=t}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}}),SoundManager.prototype._getAudioTagDurationInConfig=function(t){var e=t.key;return/\.bin$/i.test(e)||(e+=".bin"),this._soundDurationMap[e]||t._sound.duration},SoundManager.prototype.tryGetUrl=function(t){var e=t;return e.indexOf(".mp3.bin")>0?this.mp3Support||(e=e.replace(".mp3.bin",".ogg.bin")):e.indexOf(".ogg.bin")>0&&(this.oggSupport||(e=e.replace(".ogg.bin",".mp3.bin"))),this.webAudioSupport||(e=e.replace(".bin","")),e};var Key=qc.Key=function(t,e){this.game=t,this._keycode=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.repeats=0,this._lastRepeatTime=0,this._eventList=[]};Key.prototype={},Key.prototype.constructor=Key,Object.defineProperties(Key.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(t){this._charCode=t}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Key.prototype.destroy=function(){this.game=null},Key.prototype.hasEvent=function(){return!!this._eventList.length},Key.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Key.DOWN:this._onDown(t.time);break;case Pointer.UP:this._onUp()}return!0}while(!1);return!1},Key.prototype.onDown=function(){return this._eventList.push({type:Key.DOWN,time:this.game.time.fixedTime}),!0},Key.prototype.onUp=function(){return this._eventList.push({type:Key.UP}),!0},Key.prototype._onDown=function(t){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=t,this._lastRepeatTime=this.downTime,!0)},Key.prototype._onUp=function(){return!this._isDown&&!this._justDown||this._justUp?!1:(this._justUp=!0,!0)},Key.prototype.setState=function(t){var e=(this._isDown||this._justDown)&&!this._justUp;return this._isDown=t,this._justDown=!1,this._justUp=!1,e^t},Key.prototype.checkRepeat=function(t){if(!this.isDown)return!1;var e=this.game.time.fixedTime;return e-this._lastRepeatTime-t>0?(this.repeats++,this._lastRepeatTime=e,!0):!1},Key.UP=-1,Key.DOWN=0;var Pointer=qc.Pointer=function(t,e){this.game=t,this._id=e,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.withinGame=!1,this.previousStatus=[],this._eventList=[]};Pointer.prototype={},Pointer.prototype.constructor=Pointer,Object.defineProperties(Pointer.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<qc.Mouse.NONE&&this._id>=qc.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var t=this._justDown;return t&&(this._justDown=!1,this._isDown=!0),t}},isJustUp:{get:function(){var t=this._justUp;return t&&(this._justUp=!1,this._isDown=!1),t}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(t){this._deviceId=t}},eventId:{get:function(){return this._eventId||this.id},set:function(t){this._eventId=t}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Pointer.prototype.destroy=function(){this.game=null},Pointer.prototype.update=function(){this._deltaX=this._tempX-this._x,this._deltaY=this._tempY-this._y,this._x=this._tempX,this._y=this._tempY},Pointer.prototype.hasEvent=function(){return!!this._eventList.length},Pointer.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var t=this._eventList.shift();do{if(!t)break;switch(t.type){case Pointer.DOWN:this.withinGame=!0,this._onDown(t.x,t.y,t.time);break;case Pointer.UP:this._onUp(t.time);break;case Pointer.LEAVE:this.withinGame=!1,this._onMove(t.x,t.y);break;case Pointer.ENTER:this.withinGame=!0,this._onMove(t.x,t.y);break;case Pointer.MOVE:this._onMove(t.x,t.y);break;case Pointer.CANCEL:this._onCancel(t.time)}return!0}while(!1);return!1},Pointer.prototype.onDown=function(t,e){return this._eventList.push({type:Pointer.DOWN,x:t,y:e,time:this.game.time.fixedTime}),!0},Pointer.prototype.onMove=function(t,e){var i=this._eventList.length;return i>0&&this._eventList[i-1].type===Pointer.MOVE?(this._eventList[i-1].x=t,this._eventList[i-1].y=e):this._eventList.push({type:Pointer.MOVE,x:t,y:e}),!0},Pointer.prototype.onLeave=function(t,e){return this._eventList.push({type:Pointer.LEAVE,x:t,y:e}),!0},Pointer.prototype.onEnter=function(t,e){return this._eventList.push({type:Pointer.ENTER,x:t,y:e}),!0},Pointer.prototype.onUp=function(){return this._eventList.push({type:Pointer.UP,time:this.game.time.fixedTime}),!0},Pointer.prototype.onCancel=function(){return this._eventList.push({type:Pointer.CANCEL,time:this.game.time.fixedTime}),!0},Pointer.prototype._onDown=function(t,e,i){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=i,this._x=t,this._y=e,this._startX=t,this._startY=e,this._tempX=t,this._tempY=e,this._deltaX=0,this._deltaY=0,!0)},Pointer.prototype._onUp=function(t){if(!this._isDown&&!this._justDown||this._justUp)return!1;for(this._justUp=!0,this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:t});this.previousStatus.length>10;)this.previousStatus.pop();return!0},Pointer.prototype._onCancel=function(t){return this._justUp?!1:(this._onUp(t),!0)},Pointer.prototype._onMove=function(t,e){this._tempX=t,this._tempY=e},Pointer.prototype.isDouble=function(){},Pointer.UP=-1,Pointer.DOWN=0,Pointer.MOVE=1,Pointer.ENTER=2,Pointer.LEAVE=3,Pointer.CANCEL=4;var Keyboard=qc.Keyboard=function(t,e){this.input=t,this.game=t.game,this.repeatInterval=100,this.onKeyDown=new Phaser.Signal,this.onKeyUp=new Phaser.Signal,this.onKeyRepeat=new Phaser.Signal,this._keys=[],this._keyCodes={},this._capture={},this._keyDownNum=0,this._anyKeyDown=!1,this._init(e)};Keyboard.prototype={},Keyboard.prototype.constructor=Keyboard,Object.defineProperties(Keyboard.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||window},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(t){this._gainFocusType=t}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return Object.keys(this._keyCodes)}}}),Keyboard.prototype._init=function(t){this._onKeyDown=this._processKeyDown.bind(this),this._onKeyUp=this._processKeyUp.bind(this),this._onBlur=this.lossFocus.bind(this),this._onMouseOver=this._onOver.bind(this),this._onMouseClick=this._onClick.bind(this),this.generator=t,this.gainFocusType=Keyboard.GAINFOCUS_CLICK,this.enable=!0,this.game.device.phaser.windows&&this.game.device.phaser.desktop&&this.addKeyCapture(Keyboard.ALT)},Keyboard.prototype.destroy=function(){this.enable=!1,this.input=null,this.generator=null,this._onKeyDown=null,this._onKeyUp=null,this._onBlur=null,this._onMouseOver=null,this._onMouseClick=null},Keyboard.prototype.update=function(){if(this.enable){this._anyKeyDown=!1;for(var t,e=this._keys.length;e--;)if(t=this._keys[e])for(;t.nextEvent();)t.isJustDown&&(this._anyKeyDown=!0,this._recordKey(t.keyCode,!0),this.onKeyDown.dispatch(t.keyCode)),t.isJustUp&&(this._recordKey(t.keyCode,!1),this.onKeyUp.dispatch(t.keyCode)),t.checkRepeat(this.repeatInterval)&&this.onKeyRepeat.dispatch(t._keycode)}},Keyboard.prototype.isKeyDown=function(t){return this._keys[t]&&this._keys[t].isDown},Keyboard.prototype.isAnyKey=function(){return this._keyDownNum>0},Keyboard.prototype.isAnyKeyDown=function(){return this._anyKeyDown},Keyboard.prototype._recordKey=function(t,e){e?(this._keyDownNum++,this._keyCodes[t]=!0):(this._keyDownNum--,delete this._keyCodes[t])},Keyboard.prototype._setEnable=function(t){if(this._enable!==t){this._enable=t;var e=this.generator;t?(e.addEventListener("keydown",this._onKeyDown,!1),e.addEventListener("keyup",this._onKeyUp,!1),e.addEventListener("blur",this._onBlur,!1),this._addFocusAbility(e,!0)):(e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",this._onKeyUp),e.removeEventListener("blur",this._onBlur),this._removeFocusAbility(e),this._clearKeys())
}},Keyboard.prototype._addFocusAbility=function(t,e){if(t!==window||window.parent&&window.parent!==window){t.tabIndex=t.tabIndex||-1;var i=this;t.addEventListener("mouseover",i._onMouseOver,!1),t.addEventListener("click",i._onMouseClick,!1),this.input.onPointerDown.add(i._onMouseClick,i),e&&setTimeout(function(){i.gainFocus()},1)}},Keyboard.prototype._removeFocusAbility=function(t){(t!==window||window.parent&&window.parent!==window)&&(t.removeEventListener("mouseover",this._onMouseOver),t.removeEventListener("click",this._onMouseClick),this.input.onPointerDown.remove(this._onMouseClick,this))},Keyboard.prototype._prepareKey=function(t){this._keys[t]||(this._keys[t]=new qc.Key(this.game,t))},Keyboard.prototype.setModifierKeysState=function(t,e){t.altKey!==undefined&&(this._setKeyCodeState(Keyboard.ALT,t.altKey,e),this._setKeyCodeState(Keyboard.SHIFT,t.shiftKey,e),this._setKeyCodeState(Keyboard.CONTROL,t.ctrlKey,e),e!=Keyboard.META&&e!=Keyboard.META_RWIN&&e!=Keyboard.META_RMAC&&this._setKeyCodeState(Keyboard.META,t.metaKey,e))},Keyboard.prototype._setKeyCodeState=function(t,e,i){t!==i&&(this._prepareKey(t),this._keys[t].setState(e)&&this._recordKey(t,e))},Keyboard.prototype._processKeyDown=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onDown(),this._keys[t.keyCode].currCharCode=t.charCode,this.setModifierKeysState(t,t.keyCode),this.input.nativeMode&&this.update()},Keyboard.prototype._processKeyUp=function(t){this._prepareKey(t.keyCode),this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode].onUp(),this.setModifierKeysState(t,t.keyCode),this.input.nativeMode&&this.update()},Keyboard.prototype._onOver=function(){this.gainFocusType===Keyboard.GAINFOCUS_OVER&&this.gainFocus()},Keyboard.prototype._onClick=function(){this.gainFocusType===Keyboard.GAINFOCUS_CLICK&&this.gainFocus()},Keyboard.prototype.gainFocus=function(){(this.generator!==window||window.parent&&window.parent!==window)&&this.generator.focus()},Keyboard.prototype._clearKeys=function(){for(;this._keys.length>0;){var t=this._keys.pop();t&&t.destroy()}this._keyDownNum=0,this._keyCodes={}},Keyboard.prototype.lossFocus=function(){this._clearKeys()},Keyboard.prototype.addKeyCapture=function(t){if("object"==typeof t)for(var e in t)this._capture[t[e]]=!0;else this._capture[t]=!0},Keyboard.prototype.removeKeyCapture=function(t){delete this._capture[t]},Keyboard.prototype.clearCapture=function(){this._capture={}},Keyboard.GAINFOCUS_OVER=0,Keyboard.GAINFOCUS_CLICK=1,Keyboard.A="A".charCodeAt(0),Keyboard.B="B".charCodeAt(0),Keyboard.C="C".charCodeAt(0),Keyboard.D="D".charCodeAt(0),Keyboard.E="E".charCodeAt(0),Keyboard.F="F".charCodeAt(0),Keyboard.G="G".charCodeAt(0),Keyboard.H="H".charCodeAt(0),Keyboard.I="I".charCodeAt(0),Keyboard.J="J".charCodeAt(0),Keyboard.K="K".charCodeAt(0),Keyboard.L="L".charCodeAt(0),Keyboard.M="M".charCodeAt(0),Keyboard.N="N".charCodeAt(0),Keyboard.O="O".charCodeAt(0),Keyboard.P="P".charCodeAt(0),Keyboard.Q="Q".charCodeAt(0),Keyboard.R="R".charCodeAt(0),Keyboard.S="S".charCodeAt(0),Keyboard.T="T".charCodeAt(0),Keyboard.U="U".charCodeAt(0),Keyboard.V="V".charCodeAt(0),Keyboard.W="W".charCodeAt(0),Keyboard.X="X".charCodeAt(0),Keyboard.Y="Y".charCodeAt(0),Keyboard.Z="Z".charCodeAt(0),Keyboard.ZERO="0".charCodeAt(0),Keyboard.ONE="1".charCodeAt(0),Keyboard.TWO="2".charCodeAt(0),Keyboard.THREE="3".charCodeAt(0),Keyboard.FOUR="4".charCodeAt(0),Keyboard.FIVE="5".charCodeAt(0),Keyboard.SIX="6".charCodeAt(0),Keyboard.SEVEN="7".charCodeAt(0),Keyboard.EIGHT="8".charCodeAt(0),Keyboard.NINE="9".charCodeAt(0),Keyboard.NUMPAD_0=96,Keyboard.NUMPAD_1=97,Keyboard.NUMPAD_2=98,Keyboard.NUMPAD_3=99,Keyboard.NUMPAD_4=100,Keyboard.NUMPAD_5=101,Keyboard.NUMPAD_6=102,Keyboard.NUMPAD_7=103,Keyboard.NUMPAD_8=104,Keyboard.NUMPAD_9=105,Keyboard.NUMPAD_MULTIPLY=106,Keyboard.NUMPAD_ADD=107,Keyboard.NUMPAD_ENTER=108,Keyboard.NUMPAD_SUBTRACT=109,Keyboard.NUMPAD_DECIMAL=110,Keyboard.NUMPAD_DIVIDE=111,Keyboard.F1=112,Keyboard.F2=113,Keyboard.F3=114,Keyboard.F4=115,Keyboard.F5=116,Keyboard.F6=117,Keyboard.F7=118,Keyboard.F8=119,Keyboard.F9=120,Keyboard.F10=121,Keyboard.F11=122,Keyboard.F12=123,Keyboard.F13=124,Keyboard.F14=125,Keyboard.F15=126,Keyboard.COLON=186,Keyboard.EQUALS=187,Keyboard.UNDERSCORE=189,Keyboard.QUESTION_MARK=191,Keyboard.TILDE=192,Keyboard.OPEN_BRACKET=219,Keyboard.BACKWARD_SLASH=220,Keyboard.CLOSED_BRACKET=221,Keyboard.QUOTES=222,Keyboard.BACKSPACE=8,Keyboard.TAB=9,Keyboard.CLEAR=12,Keyboard.ENTER=13,Keyboard.SHIFT=16,Keyboard.CONTROL=17,Keyboard.ALT=18,Keyboard.META=91,Keyboard.META_RWIN=92,Keyboard.META_RMAC=93,Keyboard.CAPS_LOCK=20,Keyboard.ESC=27,Keyboard.SPACEBAR=32,Keyboard.PAGE_UP=33,Keyboard.PAGE_DOWN=34,Keyboard.END=35,Keyboard.HOME=36,Keyboard.LEFT=37,Keyboard.UP=38,Keyboard.RIGHT=39,Keyboard.DOWN=40,Keyboard.INSERT=45,Keyboard.DELETE=46,Keyboard.HELP=47,Keyboard.NUM_LOCK=144,Keyboard.PLUS=43,Keyboard.MINUS=45;var Mouse=qc.Mouse=function(t,e){this.input=t,this.game=t.game,this._wheelEvent=null,this.capture=!0,this.callbackContext=this.game,this.mouseDownCallback=null,this.onMouseDown=new Phaser.Signal,this.onMouseUp=new Phaser.Signal,this.onMouseMove=new Phaser.Signal,this.onMousePressMove=new Phaser.Signal,this.onMouseWheel=new Phaser.Signal,this._mouses=[],this._mouseIds={},this._mouseDownNum=0,this._anyMouseDown=!1,this._checkEventHandledByTouch=this.game.phaser.device.android&&this.game.phaser.device.chrome===!1,this._wheelInfo={deltaX:0,deltaY:0},this._init(e)};Mouse.prototype={},Mouse.prototype.constructor=Mouse,Object.defineProperties(Mouse.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return Object.keys(this._mouseIds)}}}),Mouse.prototype._init=function(t){this._mouseKeyMap={0:Mouse.BUTTON_LEFT,1:Mouse.BUTTON_MIDDLE,2:Mouse.BUTTON_RIGHT,3:Mouse.BUTTON_BACK,4:Mouse.BUTTON_FORWORD},this._mouseKeyMap[-1]=Mouse.NONE,this._onMouseDown=this.processMouseDown.bind(this),this._onMouseUp=this.processMouseUp.bind(this),this._onMouseOver=this.processMouseOver.bind(this),this._onMouseOut=this.processMouseOut.bind(this),this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this),this._onMouseMove=this.processMouseMove.bind(this),this._onMouseWheel=this.processMouseWheel.bind(this),this.generator=t,this.enable=!0},Mouse.prototype.update=function(){if(this.enable){this._anyMouseDown=!1;for(var t,e=this._mouses.length;e-->1;)if(t=this._mouses[e])for(;t.nextEvent();)t.isJustDown&&(this._anyMouseDown=!0,this._recordMouse(t.id,!0),this.onMouseDown.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onMousePressMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordMouse(t.id,!1),this.onMouseUp.dispatch(t.id,t.x,t.y));if(t=this.getMouseById(Mouse.NONE))for(;t.nextEvent();)t.update(),(t.deltaX||t.deltaY)&&this.onMouseMove.dispatch(t.x,t.y);var i=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});i&&(i.deltaX||i.deltaY)?(this._wheelInfo.deltaX=i.deltaX||0,this._wheelInfo.deltaY=i.deltaY||0,this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)):(this._wheelInfo.deltaX=0,this._wheelInfo.deltaY=0),i.deltaX=0,i.deltaY=0}},Mouse.prototype.destroy=function(){this.enable=!1,this._onMouseDown=null,this._onMouseUp=null,this._onMouseOver=null,this._onMouseOut=null,this._onMouseUpGlobal=null,this._onMouseMove=null,this._onMouseWheel=null,this.input=null,this.game=null,this.generator=null},Mouse.prototype._setEnable=function(t){if(!(this._enable===t||this.game.phaser.device.android&&this.game.phaser.device.chrome===!1&&this.game.phaser.device.touch)){this._enable=t;var e=this.generator,i=this.game.phaser.device;if(t){e.addEventListener("mousedown",this._onMouseDown,!1),e.addEventListener("mouseup",this._onMouseUp,!1),e.addEventListener("mousemove",this._onMouseMove,!1),i.cocoonJS||(e===window||window.addEventListener("mouseup",this._onMouseUpGlobal,!1),e.addEventListener("mouseout",this._onMouseOut,!1),e.addEventListener("mouseover",this._onMouseOver,!1));var r=i.wheelEvent;r&&(e.addEventListener(r,this._onMouseWheel,!1),"mousewheel"===r?this._wheelEvent=new WheelEventProxy(-1/40,1):"DOMMouseScroll"===r&&(this._wheelEvent=new WheelEventProxy(1,1))),this.getMouseById(Mouse.NONE)}else{e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mousemove",this._onMouseMove),e.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("mouseout",this._onMouseOut),e.removeEventListener("mouseover",this._onMouseOver);var r=i.wheelEvent;r&&e.removeEventListener(r,this._onMouseWheel),e===window||window.removeEventListener("mouseup",this._onMouseUpGlobal),this._clearMouses()}}},Mouse.prototype._clearMouses=function(){for(;this._mouses.length>0;){var t=this._mouses.pop();t&&t.destroy()}this._mouseDownNum=0,this._mouseIds={}},Mouse.prototype.lossFocus=function(){this._clearMouses(),this.getMouseById(Mouse.NONE)},Mouse.prototype.isAnyMouse=function(){return this._mouseDownNum>0},Mouse.prototype.isAnyMouseDown=function(){return this._anyMouseDown},Mouse.prototype.isMouseDown=function(t){return!!this._mouseIds[t]},Mouse.prototype._recordMouse=function(t,e){e?(this._mouseDownNum++,this._mouseIds[t]=!0):(this._mouseDownNum--,delete this._mouseIds[t])},Mouse.prototype.getMouseById=function(t){var e=Math.abs(t);return this._mouses[e]||(this._mouses[e]=new qc.Pointer(this.game,t)),this._mouses[e]},Mouse.prototype._updateMousesPosition=function(t,e,i){for(var r,n=this._mouses.length;n--;)r=this._mouses[n],r&&(i===qc.Pointer.ENTER?r.onEnter(t,e):i===qc.Pointer.LEAVE?r.onLeave(t,e):r.onMove(t,e))},Mouse.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,o=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-o.left)*n.x,y:(i-o.top)*n.y}},Mouse.prototype.processMouseDown=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,t);var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);if(!this._checkEventHandledByTouch||!this.input.touch.checkEventHandled(!0,i.x,i.y)){var r=this.getMouseById(e);r.deviceId=t.button,r.onDown(i.x,i.y),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()}}},Mouse.prototype.processMouseUp=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this.getMouseById(e);i.deviceId=t.button,i.onUp(),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseUpGlobal=function(t){var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this.getMouseById(e);i.onUp(),this.input&&this.input.keyboard&&this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseOut=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.LEAVE),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseOver=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.ENTER),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseMove=function(t){!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=this._mouseKeyMap[t.button];if(e!=undefined){var i=this._toWorld(this.generator,t.clientX,t.clientY);this._updateMousesPosition(i.x,i.y,qc.Pointer.MOVE),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseWheel=function(t){this._wheelEvent&&(t=this._wheelEvent.bindEvent(t)),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();var e=(Phaser.Math.clamp(-t.deltaY,-1,1),this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0}));e.deltaX+=t.deltaX,e.deltaY+=t.deltaY,this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()},Mouse.NONE=0,Mouse.BUTTON_LEFT=-1,Mouse.BUTTON_MIDDLE=-2,Mouse.BUTTON_RIGHT=-3,Mouse.BUTTON_BACK=-4,Mouse.BUTTON_FORWORD=-5,WheelEventProxy.prototype={},WheelEventProxy.prototype.constructor=WheelEventProxy,WheelEventProxy.prototype.bindEvent=function(t){if(!WheelEventProxy._stubsGenerated&&t){var e=function(t){return function(){var e=this.originalEvent[t];return"function"!=typeof e?e:e.bind(this.originalEvent)}};for(var i in t)i in WheelEventProxy.prototype||Object.defineProperty(WheelEventProxy.prototype,i,{get:e(i)});WheelEventProxy._stubsGenerated=!0}return this.originalEvent=t,this},Object.defineProperties(WheelEventProxy.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var Touch=qc.Touch=function(t,e){this.input=t,this.game=t.game,this.capture=!0,this.onTouchStart=new Phaser.Signal,this.onTouchEnd=new Phaser.Signal,this.onTouchMove=new Phaser.Signal,this._touches=[],this._touchIds={},this._deviceIdMap={},this._touchesStartPosition=[],this._touchStartNum=0,this._anyTouchStart=!1,this._init(e),this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null};Touch.prototype={},Touch.prototype.constructor=Touch,Object.defineProperties(Touch.prototype,{enable:{get:function(){return this._enable},set:function(t){this._setEnable(t)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(t){if(t!==this._generator){var e=this.enable;this.enable=!1,this._generator=t,e&&(this.enable=!0)}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return Object.keys(this._touchIds)}}}),Touch.prototype._init=function(t){this._onTouchStart=this.processTouchStart.bind(this),this._onTouchCancel=this.processTouchCancel.bind(this),this._onTouchEnd=this.processTouchEnd.bind(this),this._onTouchEnter=this.processTouchEnter.bind(this),this._onTouchLeave=this.processTouchLeave.bind(this),this._onTouchMove=this.processTouchMove.bind(this),this.generator=t,this.enable=!0},Touch.prototype.update=function(){if(this.enable){this._touchesStartPosition.splice(0,this._touchesStartPosition.length),this._anyTouchStart=!1;for(var t,e=this._touches.length;e--;)if(t=this._touches[e])for(;t.nextEvent();)t.isJustDown&&(this._anyTouchStart=!0,this._recordTouch(t.id,!0),this.onTouchStart.dispatch(t.id,t.x,t.y)),t.update(),t.isDown&&(t.deltaX||t.deltaY)&&this.onTouchMove.dispatch(t.id,t.x,t.y),t.isJustUp&&(this._recordTouch(t.id,!1),this.onTouchEnd.dispatch(t.id,t.x,t.y)),t.isDown||this._removeTouch(t.id)}},Touch.prototype.destroy=function(){this.enable=!1,this._onTouchStart=null,this._onTouchCancel=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchMove=null,this.input=null,this.game=null,this.generator=null},Touch.prototype.checkEventHandled=function(t,e,i){for(var r=this._touchesStartPosition.length;r--;){var n=this._touchesStartPosition[r];if(n.isDown===t&&n.x===e&&n.y===i)return!0}return!1},Touch.prototype._setEnable=function(t){if(this._enable!==t){var e=this.generator,i=this.game.phaser.device;if(!i.touch)return this._enable=!1,undefined;this._enable=t,t?(e.addEventListener("touchstart",this._onTouchStart,!1),e.addEventListener("touchmove",this._onTouchMove,!1),e.addEventListener("touchend",this._onTouchEnd,!1),e.addEventListener("touchcancel",this._onTouchCancel,!1),i.cocoonJS||(e.addEventListener("touchenter",this._onTouchEnter,!1),e.addEventListener("touchleave",this._onTouchLeave,!1))):(e.removeEventListener("touchstart",this._onTouchStart),e.removeEventListener("touchmove",this._onTouchMove),e.removeEventListener("touchend",this._onTouchEnd),e.removeEventListener("touchcancel",this._onTouchCancel),e.removeEventListener("touchenter",this._onTouchEnter),e.removeEventListener("touchleave",this._onTouchLeave),this._clearTouches())}},Touch.prototype._clearTouches=function(){for(var t;this._touches.length>0;)t=this._touches.pop(),t&&t.destroy();this._deviceIdMap={},this._touchStartNum=0,this._touchIds={}},Touch.prototype.lossFocus=function(){this._clearTouches()},Touch.prototype.isAnyTouch=function(){return this._touchStartNum>0},Touch.prototype.isAnyTouchStart=function(){return this._anyTouchStart},Touch.prototype.isTouchStart=function(t){return!!this._touchIds[t]},Touch.prototype._recordTouch=function(t,e){e?(this._touchStartNum++,this._touchIds[t]=!0):(this._touchStartNum--,delete this._touchIds[t])},Touch.prototype.getTouchById=function(t){return this._touches[t]},Touch.prototype._getFirstInvalidTouch=function(){for(var t=-1,e=this._touches.length+1;++t<e;){var i=this._touches[t];if(!i)break;if(!i.isDown&&!i.hasEvent())return i}var r=new qc.Pointer(this.game,t);return this._touches[t]=r,r},Touch.prototype._removeTouch=function(t){var e=this._touches[t];e&&delete this._deviceIdMap[e.deviceId]},Touch.prototype.getTouchByDeviceId=function(t,e){if(this._deviceIdMap[t]===undefined){if(e){var i=this._getFirstInvalidTouch();return i.deviceId=t,this._deviceIdMap[t]=i.id,i}return null}return this.getTouchById(this._deviceIdMap[t])},Touch.prototype._toWorld=function(t,e,i){var r=this.game.canvas,n=this.game.phaser.scale.scaleFactor,o=r.ownerDocument===(this.generator.ownerDocument||this.generator.document)?r.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(e-o.left)*n.x,y:(i-o.top)*n.y}},Touch.prototype._updateTouchWithTouches=function(t){for(var e=t.length,i={};e--;){var r=t[e];i[r.identifier]=!0;var n=this._toWorld(this.generator,r.clientX,r.clientY),o=this.getTouchByDeviceId(r.identifier);o&&(o.deviceId=r.identifier,o.onMove(n.x,n.y))}for(var e=this._touches.length;e--;){var r=this._touches[e];r&&!i[r.deviceId]&&r.onCancel(!1)}},Touch.prototype.processTouchStart=function(t){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier,!0),n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!0,x:n.x,y:n.y}),r.onDown(n.x,n.y)}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()},Touch.prototype.processTouchEnd=function(t){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var e=t.changedTouches.length;e--;){var i=t.changedTouches[e];if(i){var r=this.getTouchByDeviceId(i.identifier);if(r){var n=this._toWorld(this.generator,i.clientX,i.clientY);this._touchesStartPosition.push({isDown:!1,x:n.x,y:n.y}),r.onUp(n.x,n.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()},Touch.prototype.processTouchCancel=function(t){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,t),this.processTouchEnd(t,!0)},Touch.prototype.processTouchLeave=function(t){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},Touch.prototype.processTouchEnter=function(t){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,t),this.processTouchMove(t,!0)},Touch.prototype.processTouchMove=function(t,e){!e&&this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,t),!this.input.ignoreDomEvent(t)&&this.capture&&t.preventDefault();for(var i=t.changedTouches.length;i--;){var r=t.changedTouches[i];if(r){var n=this.getTouchByDeviceId(r.identifier);if(n){var o=this._toWorld(this.generator,r.clientX,r.clientY);n.onMove(o.x,o.y)}}}this._updateTouchWithTouches(t.touches),this.input.keyboard.setModifierKeysState(t),this.input.nativeMode&&this.update()},Touch.MAIN=0;var BaseInputEvent=qc.BaseInputEvent=function(t){this.source=t,this.effect=!0};BaseInputEvent.prototype={},BaseInputEvent.prototype.constructor=BaseInputEvent;var WheelEvent=qc.WheelEvent=function(t,e){BaseInputEvent.call(this,{deltaX:t,deltaY:e})};WheelEvent.prototype=Object.create(BaseInputEvent.prototype),WheelEvent.prototype.constructor=WheelEvent,Object.defineProperties(WheelEvent.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var CursorMoveEvent=qc.CursorMoveEvent=function(t,e){BaseInputEvent.call(this,{x:t,y:e})};CursorMoveEvent.prototype=Object.create(BaseInputEvent.prototype),CursorMoveEvent.prototype.constructor=CursorMoveEvent,Object.defineProperties(CursorMoveEvent.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var PointerEvent=qc.PointerEvent=function(t){BaseInputEvent.call(this,t)};PointerEvent.prototype=Object.create(BaseInputEvent.prototype),PointerEvent.prototype.constructor=PointerEvent;var ClickEvent=qc.ClickEvent=function(t){PointerEvent.call(this,t),this.isTap=!1,this.isDoubleTap=!1,this.isDoubleClick=!1};ClickEvent.prototype=Object.create(PointerEvent.prototype),ClickEvent.prototype.constructor=ClickEvent;var DragStartEvent=qc.DragStartEvent=function(t){PointerEvent.call(this,t),this.started=!0};DragStartEvent.prototype=Object.create(PointerEvent.prototype),DragStartEvent.prototype.constructor=DragStartEvent;var DragEvent=qc.DragEvent=function(t){PointerEvent.call(this,t)};DragEvent.prototype=Object.create(PointerEvent.prototype),DragEvent.prototype.constructor=DragEvent;var DragEndEvent=qc.DragEndEvent=function(t,e){PointerEvent.call(this,t),this.result=e};DragEndEvent.prototype=Object.create(PointerEvent.prototype),DragEndEvent.prototype.constructor=DragEndEvent;var DropEvent=qc.DropEvent=function(t,e){PointerEvent.call(this,t),this.dragging=e,this.result=null};DropEvent.prototype=Object.create(PointerEvent.prototype),DropEvent.prototype.constructor=DropEvent;var BaseInputModule=qc.BaseInputModule=function(t,e){this.game=t,this.input=e,this.handleTouchAsMouse=!0,this._currMainPointerId=0/0,this._needHandleEventTypes=["onDown","onUp","onClick"],this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"],this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"],this._startDragMoveDistance=10,this.tapDuringTime=200,this.doubleClickDuringTime=600,this._pointersEvent={},this._init()};BaseInputModule.prototype={},BaseInputModule.prototype.constructor=BaseInputModule,BaseInputModule.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this),this.input.onPointerUp.add(this.onPointerUp,this),this.input.onPointerMove.add(this.onPointerMove,this),this.input.onWheel.add(this.onWheel,this),this.input.onCursorMove.add(this.onCursorMove,this)},BaseInputModule.prototype._buildPointerRecord=function(t,e){return{eventId:t,deviceId:t,isMouse:e,downNode:null,draggingNode:null,overNode:null}},BaseInputModule.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this),this.input.onPointerUp.remove(this.onPointerUp,this),this.input.onPointerMove.remove(this.onPointerMove,this),this.input.onWheel.remove(this.onWheel,this),this.input.onCursorMove.remove(this.onCursorMove,this),this.reset()},BaseInputModule.prototype.lossFocus=function(){this.reset()},BaseInputModule.prototype.update=function(){},BaseInputModule.prototype.reset=function(){for(var t in this._pointersEvent){var e,i=this._pointersEvent[t];if(isNaN(i.deviceId)||(e=this.input.getPointer(i.deviceId),i.deviceId=0/0),null!==i.downNode){var r=new qc.PointerEvent(e);i.downNode.fireInputEvent("onUp",r),i.downNode=null}if(i.draggingNode){var n=new qc.DragEndEvent(e,null);i.draggingNode.fireInputEvent("onDragEnd",n),i.draggingNode=null}if(i.overNode){var o=new qc.CursorMoveEvent(0/0,0/0);this.doPointerExitAndEnter(i,o,null),i.overNode=null}}this._pointersEvent={},this._currMainPointerId=0/0},BaseInputModule.prototype.checkEventRecordNode=function(t){t.draggingNode&&t.draggingNode._destroy&&(t.draggingNode=null),t.downNode&&t.downNode._destroy&&(t.downNode=null),t.overNode&&t.overNode._destroy&&(t.overNode=null)},BaseInputModule.prototype.onPointerDown=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===qc.Mouse.BUTTON_LEFT||t===qc.Touch.MAIN)){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==t)return;this._currMainPointerId=t,r.eventId=qc.Mouse.BUTTON_LEFT,n.eventId=qc.Mouse.BUTTON_LEFT}this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var s=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,s,o)}var a=o?o.getInputEventHandle(this._needHandleEventTypes):null;if(a){n.downNode=a;var h=new qc.PointerEvent(r);a&&a.fireInputEvent("onDown",h)}},BaseInputModule.prototype.onPointerUp=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));if(this.handleTouchAsMouse&&(t===qc.Mouse.BUTTON_LEFT||t===qc.Touch.MAIN)){if(this._currMainPointerId!==t)return;this._currMainPointerId=0/0,r.eventId=qc.Mouse.BUTTON_LEFT,n.eventId=r.eventId}this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i,n.draggingNode),s=o?o.getInputEventHandle(this._needHandleEventTypes):null,a=new qc.PointerEvent(r);if(null!==n.draggingNode){var h=o?o.getInputEventHandle("onDragDrop"):null,l=new qc.DropEvent(r,n.draggingNode);h&&h.checkAllowDrop(n.draggingNode)&&h.fireInputEvent("onDragDrop",l);var c=new qc.DragEndEvent(r,l.result);n.draggingNode.fireInputEvent("onDragEnd",c),n.draggingNode=null}else if(s&&s===n.downNode){var u=new qc.ClickEvent(r);if(r.previousStatus.length){var p=r.previousStatus[0],d=r.previousStatus[1];u.isTap=p.upTime-p.downTime<this.tapDuringTime,u.isDoubleTap=d&&p.upTime-d.downTime<2*this.tapDuringTime,u.isDoubleClick=d&&p.upTime-d.downTime<this.doubleClickDuringTime}s.fireInputEvent("onClick",u)}if(n.downNode&&(a.downInside=!0,a.upInside=n.downNode===s,n.downNode.fireInputEvent("onUp",a)),s&&s!==n.downNode&&(a.downInside=!1,a.upInside=!0,s.fireInputEvent("onUp",a)),n.downNode=null,!n.isMouse){var f=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,f,null)}delete this._buildPointerRecord[n.deviceId]},BaseInputModule.prototype.onPointerMove=function(t,e,i){var r=this.input.getPointer(t),n=this._pointersEvent[t]||(this._pointersEvent[t]=this._buildPointerRecord(t,this.input.isMouse(t)));this.checkEventRecordNode(n);var o=this._fetchNodeInParent(this.game.world,e,i);if(!n.isMouse){var s=new qc.CursorMoveEvent(e,i);this.doPointerExitAndEnter(n,s,o)}if(!n.draggingNode){var a=this._fetchNodeInParent(this.game.world,r.startX,r.startY),h={x:r.x,y:r.y},l=null;do{if(!a)break;var c=a.getInputEventHandleAndEventType(this._needHandleClickAndDragType);if(!c)break;if("onClick"===c[1]&&(Math.abs(r.distanceX)<this._startDragMoveDistance||Math.abs(r.distanceY)<this._startDragMoveDistance))break;l=c[0]}while(!1);var u=new qc.DragStartEvent(r);r._x=r.startX,r._y=r.startY,l&&l.fireInputEvent("onDragStart",u),r._x=h.x,r._y=h.y,n.draggingNode=l}if(!(n.draggingNode||Math.abs(r.distanceX)<this._startDragMoveDistance&&Math.abs(r.distanceY)<this._startDragMoveDistance)){var a=this._fetchNodeInParent(this.game.world,r.startX,r.startY),h={x:r.x,y:r.y},l=a?a.getInputEventHandle(this._needHandleDragTypes):null,u=new qc.DragStartEvent(r);r._x=r.startX,r._y=r.startY,l&&l.fireInputEvent("onDragStart",u),r._x=h.x,r._y=h.y,n.draggingNode=l}if(n.draggingNode){var l=o?o.getInputEventHandle("onDragDrop"):null,p=new qc.DropEvent(r,n.draggingNode);!l||l.isAllowDrop&&!l.isAllowDrop(n.draggingNode)||l.fireInputEvent("onDragOver",p);var d=new qc.DragEvent(r);n.draggingNode.fireInputEvent("onDrag",d)}},BaseInputModule.prototype.onWheel=function(t,e){if(this.input.hasCursor){var i=this.input.cursorPosition,r=this._fetchNodeInParent(this.game.world,i.x,i.y),n=r?r.getInputEventHandle("onWheel"):null;if(n){var o=new qc.WheelEvent(-t,-e);n.fireInputEvent("onWheel",o),this.onCursorMove(i.x,i.y)}}},BaseInputModule.prototype.onCursorMove=function(t,e){var i=this._fetchNodeInParent(this.game.world,t,e),r=new qc.CursorMoveEvent(t,e);this.checkEventRecordNode(this),this.doPointerExitAndEnter(this,r,i)},BaseInputModule.prototype.doPointerExitAndEnter=function(t,e,i){if(t.overNode!==i){var r=this.findCommonRoot(t.overNode,i);if(t.overNode)for(var n=t.overNode;n&&n!==this.game.world&&(!r||r!==n);)n.fireInputEvent("onExit",e),n=n.parent;if(i)for(var n=i;n&&n!==r&&n!==this.game.world;)n.fireInputEvent("onEnter",e),n=n.parent;t.overNode=i}},BaseInputModule.prototype._flattenPolygonContains=function(t,e,i){for(var r=t.length/2,n=!1,o=-1,s=r-1;++o<r;s=o){var a=t[2*o],h=t[2*o+1],l=t[2*s],c=t[2*s+1];(i>=h&&c>i||i>=c&&h>i)&&(l-a)*(i-h)/(c-h)+a>e&&(n=!n)}return n},BaseInputModule.prototype.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},BaseInputModule.prototype._fetchNodeInParent=function(t,e,i,r){if(!t||!t.phaser.visible)return null;var n=t.phaser.worldTransform.applyInverse({x:e,y:i});if(t===this.game.world&&!t.rect.contains(n.x,n.y))return null;if(t===r)return null;if(t.phaser.mask){for(var o=t.phaser.mask.graphicsData.length,s=!1,a=0;a<t.phaser.mask.graphicsData.length;a++){var h=t.phaser.mask.graphicsData[a];if(h.fill&&h.shape){h.shape.points&&h.shape.points.length>0&&!(h.shape.points[0]instanceof qc.Point)&&this._flattenPolygonContains(h.shape.points,e,i)?s=!0:h.shape.contains(e,i)&&(s=!0);break}}if(0!=o&&!s)return null}if(t.phaser.softClip&&t.phaser.softClip.length&&!qc.GeometricTool.polygonContains(t.phaser.softClip,e,i))return null;for(var l=null,c=t.children,a=c.length;a--;)if(l=this._fetchNodeInParent(c[a],e,i,r))return l;return t.checkHit(n.x,n.y)?t:null};var DirtyRectangle=qc.DirtyRectangle=function(t){var e=this;e._destroyRegion=[],e.game=t,e.game.world.getSelfWidth=function(){return this.width},e.game.world.getSelfHeight=function(){return this.height},e.game.scale.onSizeChange.add(e.onSizeChange,e),e.enable=!1,e.showDirtyRegion=!1,e.forceDirty=!1};DirtyRectangle.prototype={},DirtyRectangle.prototype.constructor=DirtyRectangle,Object.defineProperties(DirtyRectangle.prototype,{enable:{get:function(){return this._enable},set:function(t){t!==this._enable&&(this._enable=t,this._recalcAll=t,t||this.releaseDirtyCanvas())}},showDirtyRegion:{get:function(){return this._showDirtyRegion},set:function(t){t!==this._showDirtyRegion&&(this._showDirtyRegion=t,t||this.releaseDirtyCanvas())}}}),DirtyRectangle.prototype.redirectDirty=function(t){var e=this;e._enable&&t&&e._destroyRegion.push(t)},DirtyRectangle.prototype.onSizeChange=function(){var t=this;t.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)},DirtyRectangle.prototype._unionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,o=e.y+e.height,s=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,h=n>i?n:i,l=o>r?o:r,c=h-s,u=l-a;
return{x:s,y:a,width:c,height:u,area:c*u}},DirtyRectangle.prototype._insersectionRect=function(t,e){var i=t.x+t.width,r=t.y+t.height,n=e.x+e.width,o=e.y+e.height,s=t.x>e.x?t.x:e.x,a=t.y>e.y?t.y:e.y,h=i>n?n:i,l=r>o?o:r,c=h-s,u=l-a;if(0>c||0>u)return null;var p={x:s,y:a,width:c,height:u,area:c*u};return p},DirtyRectangle.prototype._mergeRect=function(t){var e=this,i=t.length;if(2>i)return!0;for(var r=-1,n=!1,o=null,s=0;!n&&++r<i;){var a=t[r];for(a.clip&&(a=a.clip),s=r;!n&&++s<i;){var h=t[s];h.clip&&(h=h.clip),o=e._unionRect(a,h),n=.8*o.area-a.area-h.area<0}}return n&&o?(t[r]=o,t.splice(s,1),!1):!0},DirtyRectangle.prototype.collectDirtyRegion=function(t,e,i){var r=this;if(i=i||[],!e)return i;var n=t;e instanceof Phaser.Text&&e.dirty&&(e.updateText(),e.getWorldTransform(),e.dirty=!1);var o=e.isSkipChildrenRender&&e.isSkipChildrenRender(),s=e.getDisplayProxy&&e.getDisplayProxy()||e;if(s!==e&&s.displayChanged(e._displayChangeStatus),s._updateBounds&&(o|=s._updateBounds(r._recalcAll)),s._mask){var a=s._currWorldBounds;a&&(n=n?r._insersectionRect(n,a):a)}if(s._dirtyBounds){var h=s._currWorldBounds;if(h&&n){var l=r._insersectionRect(h,n);l?s._currWorldBounds.clip=l:h=null}if(s._lastWorldBounds)for(var c=s._lastWorldBounds.length;c--;){var u=s._lastWorldBounds[c];u&&i.push(u)}s._lastWorldBounds=[],h&&i.push(h),s._dirtyBounds=!1}if(0===s._displayChangeStatus&&(o|=!e._subDisplayChanged),e._subDisplayChanged=!1,r._recalcAll||!o)for(var p=e.children.length;p--;)r.collectDirtyRegion(n,e.children[p],i);return e._resetDisplayChangeStatus&&e._resetDisplayChangeStatus(),s!==e&&s._resetDisplayChangeStatus&&s._resetDisplayChangeStatus(),i},DirtyRectangle.prototype.updateDirtyRegion=function(t,e,i){{var r=this;Date.now()}null==i._displayChangeStatus&&(i._displayChangeStatus=-1);var n=r._currDirtyRegion=r.collectDirtyRegion(null,i);if(r._destroyRegion&&(Array.prototype.push.apply(n,r._destroyRegion),r._destroyRegion=[]),r._recalcAll||r.forceDirty||n.length>500)r._recalcAll=!1,r._currDirtyRegion=n=[{x:0,y:0,width:r.game.width,height:r.game.height}],r.forceDirty=!1;else for(;!r._mergeRect(n););var o=n.length;if(!o)return!1;for(t.save(),r._saveContext=!0,t.beginPath();o--;){var s=n[o];s&&0!==s.clip&&(s.clip&&(s=s.clip),t.rect(s.x*e-1|0,s.y*e-1|0,s.width*e+3|0,s.height*e+3|0))}return t.clip(),i._displayChangeStatus=0,!0},DirtyRectangle.prototype.restore=function(t){var e=this;e._saveContext&&(t.restore(),e._saveContext=!1)},DirtyRectangle.prototype.checkShowDirtyCanvas=function(){var t=this,e=t.game.canvas,i=t._dirtyCanvas;return e?(i||(i=t._dirtyCanvas=document.createElement("canvas"),t._dirtyContext=t._dirtyCanvas.getContext("2d"),e.parentNode.insertBefore(t._dirtyCanvas,e),i.style.left=i.style.top="0px",i.style.position="absolute"),(i.style.width!==e.style.width||i.style.height!==e.style.height||i.width!==e.width||i.height!==e.height)&&(i.width=e.width,i.height=e.height,i.style.width=e.style.width,i.style.height=e.style.height),!0):!1},DirtyRectangle.prototype.releaseDirtyCanvas=function(){var t=this,e=t._dirtyCanvas;e&&(this.dirtyContext=null,this._dirtyCanvas=null,e.parentElement&&e.parentElement.removeChild(e))},DirtyRectangle.prototype.showDirtyRectangle=function(t,e){if(this._showDirtyRegion){var i=this;if(i.checkShowDirtyCanvas()){var r=i._dirtyCanvas,n=i._dirtyContext;n.clearRect(0,0,r.width,r.height),n.beginPath();var o=this._currDirtyRegion,s=o.length,a=.9;for(0===s&&this._lastShowAlpha>0?(o=this._lastShowRegion,a=this._lastShowAlpha-.05,s=o.length):this._lastShowRegion=o,this._lastShowAlpha=a;s--;){var h=o[s];h&&(h.clip?n.rect(h.clip.x*e,h.clip.y*e,h.clip.width*e,h.clip.height*e):n.rect(h.x*e,h.y*e,h.width*e,h.height*e))}n.lineWidth=3,n.strokeStyle="rgba(255,255,0, "+this._lastShowAlpha+")",n.stroke()}}};var __extends=function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},dragonBones;!function(t){!function(t){var e=function(){function t(t,e){undefined===t&&(t=0),undefined===e&&(e=0),this.x=t,this.y=e}return t.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},t}();t.Point=e;var i=function(){function t(t,e,i,r){undefined===t&&(t=0),undefined===e&&(e=0),undefined===i&&(i=0),undefined===r&&(r=0),this.x=t,this.y=e,this.width=i,this.height=r}return t}();t.Rectangle=i;var r=function(){function t(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,r=this.d,n=this.tx,o=t*r-e*i;this.a=r/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.tx=(i*this.ty-r*n)/o,this.ty=-(t*this.ty-e*n)/o},t}();t.Matrix=r;var n=function(){function t(){this.alphaMultiplier=0,this.alphaOffset=0,this.blueMultiplier=0,this.blueOffset=0,this.greenMultiplier=0,this.greenOffset=0,this.redMultiplier=0,this.redOffset=0}return t}();t.ColorTransform=n}(t.geom||(t.geom={}));var e=t.geom;!function(t){var e=function(){function t(t){this.type=t}return t}();t.Event=e;var i=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.FADE_IN="fadeIn",e.FADE_OUT="fadeOut",e.START="start",e.COMPLETE="complete",e.LOOP_COMPLETE="loopComplete",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT_COMPLETE="fadeOutComplete",e}(e);t.AnimationEvent=i;var r=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.Z_ORDER_UPDATED="zOrderUpdated",e}(e);t.ArmatureEvent=r;var n=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.ANIMATION_FRAME_EVENT="animationFrameEvent",e.BONE_FRAME_EVENT="boneFrameEvent",e}(e);t.FrameEvent=n;var o=function(t){function e(e){t.call(this,e)}return __extends(e,t),e.SOUND="sound",e.BONE_FRAME_EVENT="boneFrameEvent",e}(e);t.SoundEvent=o;var s=function(){function t(){}return t.prototype.hasEventListener=function(t){return this._listenersMap&&this._listenersMap[t]?!0:!1},t.prototype.addEventListener=function(t,e){if(t&&e){this._listenersMap||(this._listenersMap={});var i=this._listenersMap[t];i&&this.removeEventListener(t,e),i?i.push(e):this._listenersMap[t]=[e]}},t.prototype.removeEventListener=function(t,e){if(this._listenersMap&&t&&e){var i=this._listenersMap[t];if(i)for(var r=i.length,n=0;r>n;n++)i[n]==e&&(1==r?(i.length=0,delete this._listenersMap[t]):i.splice(n,1))}},t.prototype.removeAllEventListeners=function(t){t?delete this._listenersMap[t]:this._listenersMap=null},t.prototype.dispatchEvent=function(t){if(t){var e=this._listenersMap[t.type];if(e){t.target=this;for(var i=e.concat(),r=e.length,n=0;r>n;n++)i[n](t)}}},t}();t.EventDispatcher=s;var a=function(t){function e(){if(t.call(this),e._instance)throw Error("Singleton already constructed!")}return __extends(e,t),e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e}(s);t.SoundEventManager=a}(t.events||(t.events={}));var i=t.events;!function(t){var r=function(){function t(){this.transform=new n.DBTransform,this.pivot=new e.Point,this._durationTransform=new n.DBTransform,this._durationPivot=new e.Point,this._durationColor=new e.ColorTransform}return t._borrowObject=function(){return 0==t._pool.length?new t:t._pool.pop()},t._returnObject=function(e){t._pool.indexOf(e)<0&&(t._pool[t._pool.length]=e),e.clear()},t._clear=function(){for(var e=t._pool.length;e--;)t._pool[e].clear();t._pool.length=0},t.getEaseValue=function(e,i){if(i>1){var r=.5*(1-Math.cos(e*Math.PI))-e;i-=1}else i>0?r=Math.sin(e*t.HALF_PI)-e:0>i&&(r=1-Math.cos(e*t.HALF_PI)-e,i*=-1);return r*i+e},t.prototype.fadeIn=function(t,e,i){switch(this._bone=t,this._animationState=e,this._timeline=i,this._originTransform=this._timeline.originTransform,this._originPivot=this._timeline.originPivot,this._tweenTransform=!1,this._tweenColor=!1,this._totalTime=this._animationState.totalTime,this.transform.x=0,this.transform.y=0,this.transform.scaleX=0,this.transform.scaleY=0,this.transform.skewX=0,this.transform.skewY=0,this.pivot.x=0,this.pivot.y=0,this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationPivot.x=0,this._durationPivot.y=0,this._currentFrame=null,this._timeline.getFrameList().length){case 0:this._bone._arriveAtFrame(null,this,this._animationState,!1),this._updateState=0;break;case 1:this._updateState=-1;break;default:this._updateState=1}},t.prototype.fadeOut=function(){this.transform.skewX=o.TransformUtil.formatRadian(this.transform.skewX),this.transform.skewY=o.TransformUtil.formatRadian(this.transform.skewY)},t.prototype.update=function(e){if(this._updateState)if(this._updateState>0){0==this._timeline.scale?e=1:e/=this._timeline.scale,1==e&&(e=.99999999),e+=this._timeline.offset;var i=Math.floor(e);e-=i;for(var r,n=this._totalTime*e,s=!1;!this._currentFrame||n>this._currentFramePosition+this._currentFrameDuration||n<this._currentFramePosition;)s&&this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!0),s=!0,this._currentFrame?(r=this._timeline.getFrameList().indexOf(this._currentFrame)+1,r<this._timeline.getFrameList().length||(r=0),this._currentFrame=this._timeline.getFrameList()[r]):(r=0,this._currentFrame=this._timeline.getFrameList()[0]),this._currentFrameDuration=this._currentFrame.duration,this._currentFramePosition=this._currentFrame.position;if(s){this.tweenActive=this._currentFrame.displayIndex>=0,r++,r<this._timeline.getFrameList().length||(r=0);var a=this._timeline.getFrameList()[r];0==r&&this._animationState.loop&&this._animationState.loopCount>=Math.abs(this._animationState.loop)-1&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+i-this._timeline.offset)*this._timeline.scale>.99999999?(this._updateState=0,this._tweenEasing=0/0):this._tweenEasing=this._currentFrame.displayIndex<0||a.displayIndex<0||!this._animationState.tweenEnabled?0/0:isNaN(this._animationState.clip.tweenEasing)?this._currentFrame.tweenEasing:this._animationState.clip.tweenEasing,isNaN(this._tweenEasing)?(this._tweenTransform=!1,this._tweenColor=!1):(this._durationTransform.x=a.transform.x-this._currentFrame.transform.x,this._durationTransform.y=a.transform.y-this._currentFrame.transform.y,this._durationTransform.skewX=a.transform.skewX-this._currentFrame.transform.skewX,this._durationTransform.skewY=a.transform.skewY-this._currentFrame.transform.skewY,this._durationTransform.scaleX=a.transform.scaleX-this._currentFrame.transform.scaleX,this._durationTransform.scaleY=a.transform.scaleY-this._currentFrame.transform.scaleY,0==r&&(this._durationTransform.skewX=o.TransformUtil.formatRadian(this._durationTransform.skewX),this._durationTransform.skewY=o.TransformUtil.formatRadian(this._durationTransform.skewY)),this._durationPivot.x=a.pivot.x-this._currentFrame.pivot.x,this._durationPivot.y=a.pivot.y-this._currentFrame.pivot.y,this._tweenTransform=0!=this._durationTransform.x||0!=this._durationTransform.y||0!=this._durationTransform.skewX||0!=this._durationTransform.skewY||0!=this._durationTransform.scaleX||0!=this._durationTransform.scaleY||0!=this._durationPivot.x||0!=this._durationPivot.y?!0:!1,this._currentFrame.color&&a.color?(this._durationColor.alphaOffset=a.color.alphaOffset-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=a.color.redOffset-this._currentFrame.color.redOffset,this._durationColor.greenOffset=a.color.greenOffset-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=a.color.blueOffset-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=a.color.alphaMultiplier-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=a.color.redMultiplier-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=a.color.greenMultiplier-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=a.color.blueMultiplier-this._currentFrame.color.blueMultiplier,this._tweenColor=0!=this._durationColor.alphaOffset||0!=this._durationColor.redOffset||0!=this._durationColor.greenOffset||0!=this._durationColor.blueOffset||0!=this._durationColor.alphaMultiplier||0!=this._durationColor.redMultiplier||0!=this._durationColor.greenMultiplier||0!=this._durationColor.blueMultiplier?!0:!1):this._currentFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=-this._currentFrame.color.redOffset,this._durationColor.greenOffset=-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=1-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=1-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=1-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=1-this._currentFrame.color.blueMultiplier):a.color?(this._tweenColor=!0,this._durationColor.alphaOffset=a.color.alphaOffset,this._durationColor.redOffset=a.color.redOffset,this._durationColor.greenOffset=a.color.greenOffset,this._durationColor.blueOffset=a.color.blueOffset,this._durationColor.alphaMultiplier=a.color.alphaMultiplier-1,this._durationColor.redMultiplier=a.color.redMultiplier-1,this._durationColor.greenMultiplier=a.color.greenMultiplier-1,this._durationColor.blueMultiplier=a.color.blueMultiplier-1):this._tweenColor=!1),this._tweenTransform||(this._animationState.blend?(this.transform.x=this._originTransform.x+this._currentFrame.transform.x,this.transform.y=this._originTransform.y+this._currentFrame.transform.y,this.transform.skewX=this._originTransform.skewX+this._currentFrame.transform.skewX,this.transform.skewY=this._originTransform.skewY+this._currentFrame.transform.skewY,this.transform.scaleX=this._originTransform.scaleX+this._currentFrame.transform.scaleX,this.transform.scaleY=this._originTransform.scaleY+this._currentFrame.transform.scaleY,this.pivot.x=this._originPivot.x+this._currentFrame.pivot.x,this.pivot.y=this._originPivot.y+this._currentFrame.pivot.y):(this.transform.x=this._currentFrame.transform.x,this.transform.y=this._currentFrame.transform.y,this.transform.skewX=this._currentFrame.transform.skewX,this.transform.skewY=this._currentFrame.transform.skewY,this.transform.scaleX=this._currentFrame.transform.scaleX,this.transform.scaleY=this._currentFrame.transform.scaleY,this.pivot.x=this._currentFrame.pivot.x,this.pivot.y=this._currentFrame.pivot.y)),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._tweenColor||(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1))}if((this._tweenTransform||this._tweenColor)&&(e=(n-this._currentFramePosition)/this._currentFrameDuration,this._tweenEasing&&(e=t.getEaseValue(e,this._tweenEasing))),this._tweenTransform){var h=this._currentFrame.transform,l=this._currentFrame.pivot;this._animationState.blend?(this.transform.x=this._originTransform.x+h.x+this._durationTransform.x*e,this.transform.y=this._originTransform.y+h.y+this._durationTransform.y*e,this.transform.skewX=this._originTransform.skewX+h.skewX+this._durationTransform.skewX*e,this.transform.skewY=this._originTransform.skewY+h.skewY+this._durationTransform.skewY*e,this.transform.scaleX=this._originTransform.scaleX+h.scaleX+this._durationTransform.scaleX*e,this.transform.scaleY=this._originTransform.scaleY+h.scaleY+this._durationTransform.scaleY*e,this.pivot.x=this._originPivot.x+l.x+this._durationPivot.x*e,this.pivot.y=this._originPivot.y+l.y+this._durationPivot.y*e):(this.transform.x=h.x+this._durationTransform.x*e,this.transform.y=h.y+this._durationTransform.y*e,this.transform.skewX=h.skewX+this._durationTransform.skewX*e,this.transform.skewY=h.skewY+this._durationTransform.skewY*e,this.transform.scaleX=h.scaleX+this._durationTransform.scaleX*e,this.transform.scaleY=h.scaleY+this._durationTransform.scaleY*e,this.pivot.x=l.x+this._durationPivot.x*e,this.pivot.y=l.y+this._durationPivot.y*e)}this._tweenColor&&(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset+this._durationColor.alphaOffset*e,this._currentFrame.color.redOffset+this._durationColor.redOffset*e,this._currentFrame.color.greenOffset+this._durationColor.greenOffset*e,this._currentFrame.color.blueOffset+this._durationColor.blueOffset*e,this._currentFrame.color.alphaMultiplier+this._durationColor.alphaMultiplier*e,this._currentFrame.color.redMultiplier+this._durationColor.redMultiplier*e,this._currentFrame.color.greenMultiplier+this._durationColor.greenMultiplier*e,this._currentFrame.color.blueMultiplier+this._durationColor.blueMultiplier*e,!0):this._bone._updateColor(this._durationColor.alphaOffset*e,this._durationColor.redOffset*e,this._durationColor.greenOffset*e,this._durationColor.blueOffset*e,1+this._durationColor.alphaMultiplier*e,1+this._durationColor.redMultiplier*e,1+this._durationColor.greenMultiplier*e,1+this._durationColor.blueMultiplier*e,!0))}else this._updateState=0,this._animationState.blend?(this.transform.copy(this._originTransform),this.pivot.x=this._originPivot.x,this.pivot.y=this._originPivot.y):(this.transform.x=this.transform.y=this.transform.skewX=this.transform.skewY=this.transform.scaleX=this.transform.scaleY=0,this.pivot.x=0,this.pivot.y=0),this._currentFrame=this._timeline.getFrameList()[0],this.tweenActive=this._currentFrame.displayIndex>=0,this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1)},t.prototype.clear=function(){this._updateState=0,this._bone=null,this._animationState=null,this._timeline=null,this._currentFrame=null,this._originTransform=null,this._originPivot=null},t.HALF_PI=.5*Math.PI,t._pool=[],t}();t.TimelineState=r;var s=function(){function t(){this.loop=0,this.layer=0,this._timelineStates={}}return t._borrowObject=function(){return 0==t._pool.length?new t:t._pool.pop()},t._returnObject=function(e){t._pool.indexOf(e)<0&&(t._pool[t._pool.length]=e),e.clear()},t._clear=function(){for(var e=t._pool.length;e--;)t._pool[e].clear();t._pool.length=0},t.prototype.fadeIn=function(t,e,i,r,n,o,s,a){this.layer=o,this.clip=e,this.name=this.clip.name,this.totalTime=this.clip.duration,this._armature=t,Math.round(this.clip.duration*this.clip.frameRate)<2||1/0==r?(this.timeScale=1,this.currentTime=this.totalTime,this.loop=this.loop<0?-1:1):(this.timeScale=r,this.currentTime=0,this.loop=n),this._pauseBeforeFadeInComplete=a,this._fadeInTime=i*this.timeScale,this._fadeState=1,this._fadeOutBeginTime=0,this._fadeOutWeight=-1,this._fadeWeight=0,this._fadeIn=!0,this._fadeOut=!1,this.loopCount=-1,this.displayControl=s,this.isPlaying=!0,this.isComplete=!1,this.weight=1,this.blend=!0,this.enabled=!0,this.tweenEnabled=!0,this.updateTimelineStates()},t.prototype.fadeOut=function(t,e){if(undefined===e&&(e=!1),this._armature&&this._fadeOutWeight<0){this._fadeState=-1,this._fadeOutWeight=this._fadeWeight,this._fadeOutTime=t*this.timeScale,this._fadeOutBeginTime=this.currentTime,this._fadeOut=!0,this.isPlaying=!e,this.displayControl=!1;for(var i in this._timelineStates)this._timelineStates[i].fadeOut();this.enabled=!0}},t.prototype.play=function(){this.isPlaying=!0},t.prototype.stop=function(){this.isPlaying=!1},t.prototype.getMixingTransform=function(t){return this._mixingTransforms?+this._mixingTransforms[t]:-1},t.prototype.addMixingTransform=function(t,e,i){if(undefined===e&&(e=2),undefined===i&&(i=!0),!this.clip||!this.clip.getTimeline(t))throw Error();if(this._mixingTransforms||(this._mixingTransforms={}),i)for(var r,n,o=this._armature._boneList.length;o--;)r=this._armature._boneList[o],r.name==t&&(n=r),n&&(n==r||n.contains(r))&&(this._mixingTransforms[r.name]=e);else this._mixingTransforms[t]=e;this.updateTimelineStates()},t.prototype.removeMixingTransform=function(t,e){if(undefined===t&&(t=null),undefined===e&&(e=!0),t){if(e)for(var i,r,n=this._armature._boneList.length;n--;)i=this._armature._boneList[n],i.name==t&&(r=i),r&&(r==i||r.contains(i))&&delete this._mixingTransforms[i.name];else delete this._mixingTransforms[t];for(var o in this._mixingTransforms){var s=!0;break}s||(this._mixingTransforms=null)}else this._mixingTransforms=null;this.updateTimelineStates()},t.prototype.advanceTime=function(t){if(!this.enabled)return!1;var e,r;if(this._fadeIn&&(this._fadeIn=!1,this._armature.hasEventListener(i.AnimationEvent.FADE_IN)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_IN),e.animationState=this,this._armature._eventList.push(e))),this._fadeOut&&(this._fadeOut=!1,this._armature.hasEventListener(i.AnimationEvent.FADE_OUT)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_OUT),e.animationState=this,this._armature._eventList.push(e))),this.currentTime+=t*this.timeScale,this.isPlaying&&!this.isComplete){var n,o;this._pauseBeforeFadeInComplete?(this._pauseBeforeFadeInComplete=!1,this.isPlaying=!1,n=0,o=Math.floor(n)):(n=this.currentTime/this.totalTime,o=Math.floor(n),o!=this.loopCount&&(-1==this.loopCount&&this._armature.hasEventListener(i.AnimationEvent.START)&&(e=new i.AnimationEvent(i.AnimationEvent.START),e.animationState=this,this._armature._eventList.push(e)),this.loopCount=o,this.loopCount&&(this.loop&&this.loopCount*this.loopCount>=this.loop*this.loop-1?(r=!0,n=1,o=0,this._armature.hasEventListener(i.AnimationEvent.COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.COMPLETE),e.animationState=this,this._armature._eventList.push(e))):this._armature.hasEventListener(i.AnimationEvent.LOOP_COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.LOOP_COMPLETE),e.animationState=this,this._armature._eventList.push(e)))));for(var s in this._timelineStates)this._timelineStates[s].update(n);var a=this.clip.getFrameList();if(a.length>0){for(var h,l=this.totalTime*(n-o),c=!1;!this._currentFrame||l>this._currentFrame.position+this._currentFrame.duration||l<this._currentFrame.position;)c&&this._armature._arriveAtFrame(this._currentFrame,null,this,!0),c=!0,this._currentFrame?(h=a.indexOf(this._currentFrame),h++,h<a.length||(h=0),this._currentFrame=a[h]):this._currentFrame=a[0];c&&this._armature._arriveAtFrame(this._currentFrame,null,this,!1)}}if(this._fadeState>0)0==this._fadeInTime?(this._fadeWeight=1,this._fadeState=0,this.isPlaying=!0,this._armature.hasEventListener(i.AnimationEvent.FADE_IN_COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_IN_COMPLETE),e.animationState=this,this._armature._eventList.push(e))):(this._fadeWeight=this.currentTime/this._fadeInTime,this._fadeWeight<1||(this._fadeWeight=1,this._fadeState=0,this.isPlaying||(this.currentTime-=this._fadeInTime),this.isPlaying=!0,this._armature.hasEventListener(i.AnimationEvent.FADE_IN_COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_IN_COMPLETE),e.animationState=this,this._armature._eventList.push(e))));else if(this._fadeState<0){if(0==this._fadeOutTime)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(i.AnimationEvent.FADE_OUT_COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_OUT_COMPLETE),e.animationState=this,this._armature._eventList.push(e)),!0;if(this._fadeWeight=(1-(this.currentTime-this._fadeOutBeginTime)/this._fadeOutTime)*this._fadeOutWeight,this._fadeWeight<=0)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(i.AnimationEvent.FADE_OUT_COMPLETE)&&(e=new i.AnimationEvent(i.AnimationEvent.FADE_OUT_COMPLETE),e.animationState=this,this._armature._eventList.push(e)),!0}return r&&(this.isComplete=!0,this.loop<0&&this.fadeOut((this._fadeOutWeight||this._fadeInTime)/this.timeScale,!0)),!1},t.prototype.updateTimelineStates=function(){if(this._mixingTransforms){for(var t in this._timelineStates)null==this._mixingTransforms[t]&&this.removeTimelineState(t);for(t in this._mixingTransforms)this._timelineStates[t]||this.addTimelineState(t)}else for(t in this.clip.getTimelines())this._timelineStates[t]||this.addTimelineState(t)},t.prototype.addTimelineState=function(t){var e=this._armature.getBone(t);if(e){var i=r._borrowObject(),n=this.clip.getTimeline(t);i.fadeIn(e,this,n),this._timelineStates[t]=i}},t.prototype.removeTimelineState=function(t){r._returnObject(this._timelineStates[t]),delete this._timelineStates[t]},t.prototype.clear=function(){this.clip=null,this.enabled=!1,this._armature=null,this._currentFrame=null,this._mixingTransforms=null;for(var t in this._timelineStates)this.removeTimelineState(t)},t._pool=[],t}();t.AnimationState=s;var a=function(){function t(t){this._armature=t,this._animationLayer=[],this._isPlaying=!1,this.animationNameList=[],this.tweenEnabled=!0,this.timeScale=1}return t.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},t.prototype.getLastAnimationState=function(){return this._lastAnimationState},t.prototype.getAnimationDataList=function(){return this._animationDataList},t.prototype.setAnimationDataList=function(t){this._animationDataList=t,this.animationNameList.length=0;for(var e in this._animationDataList)this.animationNameList[this.animationNameList.length]=this._animationDataList[e].name},t.prototype.getIsPlaying=function(){return this._isPlaying&&!this.getIsComplete()},t.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var t=this._animationLayer.length;t--;)for(var e=this._animationLayer[t],i=e.length;i--;)if(!e[i].isComplete)return!1;return!0}return!1},t.prototype.dispose=function(){if(this._armature){this.stop();for(var t=this._animationLayer.length;t--;){for(var e=this._animationLayer[t],i=e.length;i--;)s._returnObject(e[i]);e.length=0}this._animationLayer.length=0,this.animationNameList.length=0,this._armature=null,this._animationLayer=null,this._animationDataList=null,this.animationNameList=null}},t.prototype.gotoAndPlay=function(e,i,r,n,o,a,h,l,c,u){if(undefined===i&&(i=-1),undefined===r&&(r=-1),undefined===n&&(n=0/0),undefined===o&&(o=0),undefined===a&&(a=null),undefined===h&&(h=t.SAME_LAYER_AND_GROUP),undefined===l&&(l=!0),undefined===c&&(c=!0),undefined===u&&(u=!0),!this._animationDataList)return null;for(var p,d=this._animationDataList.length;d--;)if(this._animationDataList[d].name==e){p=this._animationDataList[d];break}if(!p)return null;this._isPlaying=!0,i=0>i?p.fadeInTime<0?.3:p.fadeInTime:i;var f;f=0>r?p.scale<0?1:p.scale:r/p.duration,n=isNaN(n)?p.loop:n,o=this.addLayer(o);var g,m;switch(h){case t.NONE:break;case t.SAME_LAYER:for(m=this._animationLayer[o],d=m.length;d--;)g=m[d],g.fadeOut(i,c);break;case t.SAME_GROUP:for(_=this._animationLayer.length;_--;)for(m=this._animationLayer[_],d=m.length;d--;)g=m[d],g.group==a&&g.fadeOut(i,c);break;case t.ALL:for(var _=this._animationLayer.length;_--;)for(m=this._animationLayer[_],d=m.length;d--;)g=m[d],g.fadeOut(i,c);break;case t.SAME_LAYER_AND_GROUP:default:for(m=this._animationLayer[o],d=m.length;d--;)g=m[d],g.group==a&&g.fadeOut(i,c)}this._lastAnimationState=s._borrowObject(),this._lastAnimationState.group=a,this._lastAnimationState.tweenEnabled=this.tweenEnabled,this._lastAnimationState.fadeIn(this._armature,p,i,1/f,n,o,l,u),this.addState(this._lastAnimationState);var y,v,T=this._armature._slotList;for(d=T.length;d--;)y=T[d],v=y.getChildArmature(),v&&v.animation.gotoAndPlay(e,i);return this._lastAnimationState},t.prototype.play=function(){this._animationDataList&&0!=this._animationDataList.length&&(this._lastAnimationState?this._isPlaying?this.gotoAndPlay(this._lastAnimationState.name):this._isPlaying=!0:this.gotoAndPlay(this._animationDataList[0].name))},t.prototype.stop=function(){this._isPlaying=!1},t.prototype.getState=function(t,e){undefined===e&&(e=0);var i=this._animationLayer.length;if(0==i)return null;i>e||(e=i-1);var r=this._animationLayer[e];if(!r)return null;for(var n=r.length;n--;)if(r[n].name==t)return r[n];return null},t.prototype.hasAnimation=function(t){for(var e=this._animationDataList.length;e--;)if(this._animationDataList[e].name==t)return!0;return!1},t.prototype.advanceTime=function(t){if(this._isPlaying){t*=this.timeScale;var e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,m,_,y,v,T,x,S=this._armature._boneList.length,b=S;for(S--;b--;){for(n=this._armature._boneList[b],o=n.name,s=1,a=0,h=0,l=0,c=0,u=0,p=0,d=0,f=0,e=this._animationLayer.length;e--;){for(g=0,m=this._animationLayer[e],r=m.length,i=0;r>i;i++)_=m[i],b==S&&_.advanceTime(t)?(this.removeState(_),i--,r--):(y=_._timelineStates[o],y&&y.tweenActive&&(v=_._fadeWeight*_.weight*s,T=y.transform,x=y.pivot,a+=T.x*v,h+=T.y*v,l+=T.skewX*v,c+=T.skewY*v,u+=T.scaleX*v,p+=T.scaleY*v,d+=x.x*v,f+=x.y*v,g+=v));if(g>=s)break;s-=g}T=n.tween,x=n._tweenPivot,T.x=a,T.y=h,T.skewX=l,T.skewY=c,T.scaleX=u,T.scaleY=p,x.x=d,x.y=f}}},t.prototype.addLayer=function(t){return t<this._animationLayer.length||(t=this._animationLayer.length,this._animationLayer[t]=[]),t},t.prototype.addState=function(t){var e=this._animationLayer[t.layer];e.push(t)},t.prototype.removeState=function(t){var e=t.layer,i=this._animationLayer[e];i.splice(i.indexOf(t),1),s._returnObject(t),0==i.length&&e==this._animationLayer.length-1&&this._animationLayer.length--},t.NONE="none",t.SAME_LAYER="sameLayer",t.SAME_GROUP="sameGroup",t.SAME_LAYER_AND_GROUP="sameLayerAndGroup",t.ALL="all",t}();t.Animation=a}(t.animation||(t.animation={}));var r=t.animation;!function(t){var i=function(){function t(){this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1}return t.prototype.getRotation=function(){return this.skewX},t.prototype.setRotation=function(t){this.skewX=this.skewY=t},t.prototype.copy=function(t){this.x=t.x,this.y=t.y,this.skewX=t.skewX,this.skewY=t.skewY,this.scaleX=t.scaleX,this.scaleY=t.scaleY},t.prototype.toString=function(){return"[DBTransform (x="+this.x+" y="+this.y+" skewX="+this.skewX+" skewY="+this.skewY+" scaleX="+this.scaleX+" scaleY="+this.scaleY+")]"},t}();t.DBTransform=i;var r=function(){function t(){this.position=0,this.duration=0}return t.prototype.dispose=function(){},t}();t.Frame=r;var n=function(t){function r(){t.call(this),this.tweenEasing=0,this.tweenRotate=0,this.displayIndex=0,this.zOrder=0/0,this.visible=!0,this.global=new i,this.transform=new i,this.pivot=new e.Point}return __extends(r,t),r.prototype.dispose=function(){t.prototype.dispose.call(this),this.global=null,this.transform=null,this.pivot=null,this.color=null},r}(r);t.TransformFrame=n;var s=function(){function t(){this._frameList=[],this.duration=0,this.scale=1}return t.prototype.getFrameList=function(){return this._frameList},t.prototype.dispose=function(){for(var t=this._frameList.length;t--;)this._frameList[t].dispose();this._frameList.length=0,this._frameList=null},t.prototype.addFrame=function(t){if(!t)throw Error();if(this._frameList.indexOf(t)>=0)throw Error();this._frameList[this._frameList.length]=t},t}();t.Timeline=s;var a=function(t){function r(){t.call(this),this.originTransform=new i,this.originPivot=new e.Point,this.offset=0,this.transformed=!1}return __extends(r,t),r.prototype.dispose=function(){this!=r.HIDE_TIMELINE&&(t.prototype.dispose.call(this),this.originTransform=null,this.originPivot=null)},r.HIDE_TIMELINE=new r,r}(s);t.TransformTimeline=a;var h=function(t){function e(){t.call(this),this.frameRate=0,this.loop=0,this.tweenEasing=0/0,this.fadeInTime=0,this._timelines={}}return __extends(e,t),e.prototype.getTimelines=function(){return this._timelines},e.prototype.dispose=function(){t.prototype.dispose.call(this);for(var e in this._timelines)this._timelines[e].dispose();
this._timelines=null},e.prototype.getTimeline=function(t){return this._timelines[t]},e.prototype.addTimeline=function(t,e){if(!t)throw Error();this._timelines[e]=t},e}(s);t.AnimationData=h;var l=function(){function t(){this.transform=new i}return t.prototype.dispose=function(){this.transform=null,this.pivot=null},t.ARMATURE="armature",t.IMAGE="image",t}();t.DisplayData=l;var c=function(){function t(){this._displayDataList=[],this.zOrder=0}return t.prototype.getDisplayDataList=function(){return this._displayDataList},t.prototype.dispose=function(){for(var t=this._displayDataList.length;t--;)this._displayDataList[t].dispose();this._displayDataList.length=0,this._displayDataList=null},t.prototype.addDisplayData=function(t){if(!t)throw Error();if(this._displayDataList.indexOf(t)>=0)throw Error();this._displayDataList[this._displayDataList.length]=t},t.prototype.getDisplayData=function(t){for(var e=this._displayDataList.length;e--;)if(this._displayDataList[e].name==t)return this._displayDataList[e];return null},t}();t.SlotData=c;var u=function(){function t(){this.length=0,this.global=new i,this.transform=new i}return t.prototype.dispose=function(){this.global=null,this.transform=null},t}();t.BoneData=u;var p=function(){function t(){this._slotDataList=[]}return t.prototype.getSlotDataList=function(){return this._slotDataList},t.prototype.dispose=function(){for(var t=this._slotDataList.length;t--;)this._slotDataList[t].dispose();this._slotDataList.length=0,this._slotDataList=null},t.prototype.getSlotData=function(t){for(var e=this._slotDataList.length;e--;)if(this._slotDataList[e].name==t)return this._slotDataList[e];return null},t.prototype.addSlotData=function(t){if(!t)throw Error();if(this._slotDataList.indexOf(t)>=0)throw Error();this._slotDataList[this._slotDataList.length]=t},t}();t.SkinData=p;var d=function(){function t(){this._boneDataList=[],this._skinDataList=[],this._animationDataList=[]}return t.prototype.getBoneDataList=function(){return this._boneDataList},t.prototype.getSkinDataList=function(){return this._skinDataList},t.prototype.getAnimationDataList=function(){return this._animationDataList},t.prototype.dispose=function(){for(var t=this._boneDataList.length;t--;)this._boneDataList[t].dispose();for(t=this._skinDataList.length;t--;)this._skinDataList[t].dispose();for(t=this._animationDataList.length;t--;)this._animationDataList[t].dispose();this._boneDataList.length=0,this._skinDataList.length=0,this._animationDataList.length=0,this._boneDataList=null,this._skinDataList=null,this._animationDataList=null},t.prototype.getBoneData=function(t){for(var e=this._boneDataList.length;e--;)if(this._boneDataList[e].name==t)return this._boneDataList[e];return null},t.prototype.getSkinData=function(t){if(!t)return this._skinDataList[0];for(var e=this._skinDataList.length;e--;)if(this._skinDataList[e].name==t)return this._skinDataList[e];return null},t.prototype.getAnimationData=function(t){for(var e=this._animationDataList.length;e--;)if(this._animationDataList[e].name==t)return this._animationDataList[e];return null},t.prototype.addBoneData=function(t){if(!t)throw Error();if(this._boneDataList.indexOf(t)>=0)throw Error();this._boneDataList[this._boneDataList.length]=t},t.prototype.addSkinData=function(t){if(!t)throw Error();if(this._skinDataList.indexOf(t)>=0)throw Error();this._skinDataList[this._skinDataList.length]=t},t.prototype.addAnimationData=function(t){if(!t)throw Error();this._animationDataList.indexOf(t)<0&&(this._animationDataList[this._animationDataList.length]=t)},t.prototype.sortBoneDataList=function(){var t=this._boneDataList.length;if(0!=t){for(var e=[];t--;){for(var i=this._boneDataList[t],r=0,n=i;n&&n.parent;)r++,n=this.getBoneData(n.parent);e[t]={level:r,boneData:i}}for(e.sort(this.sortBoneData),t=e.length;t--;)this._boneDataList[t]=e[t].boneData}},t.prototype.sortBoneData=function(t,e){return t.level>e.level?1:-1},t}();t.ArmatureData=d;var f=function(){function t(){this._armatureDataList=[],this._subTexturePivots={}}return t.prototype.getArmatureNames=function(){var t=[];for(var e in this._armatureDataList)t[t.length]=this._armatureDataList[e].name;return t},t.prototype.getArmatureDataList=function(){return this._armatureDataList},t.prototype.dispose=function(){for(var t in this._armatureDataList)this._armatureDataList[t].dispose();this._armatureDataList.length=0,this._armatureDataList=null,this._subTexturePivots=null},t.prototype.getArmatureData=function(t){for(var e=this._armatureDataList.length;e--;)if(this._armatureDataList[e].name==t)return this._armatureDataList[e];return null},t.prototype.addArmatureData=function(t){if(!t)throw Error();if(this._armatureDataList.indexOf(t)>=0)throw Error();this._armatureDataList[this._armatureDataList.length]=t},t.prototype.removeArmatureData=function(t){var e=this._armatureDataList.indexOf(t);0>e||this._armatureDataList.splice(e,1)},t.prototype.removeArmatureDataByName=function(t){for(var e=this._armatureDataList.length;e--;)this._armatureDataList[e].name==t&&this._armatureDataList.splice(e,1)},t.prototype.getSubTexturePivot=function(t){return this._subTexturePivots[t]},t.prototype.addSubTexturePivot=function(t,i,r){var n=this._subTexturePivots[r];return n?(n.x=t,n.y=i):this._subTexturePivots[r]=n=new e.Point(t,i),n},t.prototype.removeSubTexturePivot=function(t){if(t)delete this._subTexturePivots[t];else for(t in this._subTexturePivots)delete this._subTexturePivots[t]},t}();t.SkeletonData=f;var g=function(){function t(){}return t.parseTextureAtlasData=function(t,i){if(undefined===i&&(i=1),!t)throw Error();var r={};r.__name=t[o.ConstValues.A_NAME];var n=t[o.ConstValues.SUB_TEXTURE];for(var s in n){var a=n[s],h=a[o.ConstValues.A_NAME],l=new e.Rectangle(+a[o.ConstValues.A_X]/i,+a[o.ConstValues.A_Y]/i,+a[o.ConstValues.A_WIDTH]/i,+a[o.ConstValues.A_HEIGHT]/i);r[h]=l}return r},t.parseSkeletonData=function(e){if(!e)throw Error();var i=+e[o.ConstValues.A_FRAME_RATE],r=new f;r.name=e[o.ConstValues.A_NAME];var n=e[o.ConstValues.ARMATURE];for(var s in n){var a=n[s];r.addArmatureData(t.parseArmatureData(a,r,i))}return r},t.parseArmatureData=function(e,i,r){var n=new d;n.name=e[o.ConstValues.A_NAME];var s=e[o.ConstValues.BONE];for(var a in s){var h=s[a];n.addBoneData(t.parseBoneData(h))}var l=e[o.ConstValues.SKIN];for(var a in l){var c=l[a];n.addSkinData(t.parseSkinData(c,i))}o.DBDataUtil.transformArmatureData(n),n.sortBoneDataList();var u=e[o.ConstValues.ANIMATION];for(var a in u){var p=u[a];n.addAnimationData(t.parseAnimationData(p,n,r))}return n},t.parseBoneData=function(e){var i=new u;return i.name=e[o.ConstValues.A_NAME],i.parent=e[o.ConstValues.A_PARENT],i.length=+e[o.ConstValues.A_LENGTH]||0,t.parseTransform(e[o.ConstValues.TRANSFORM],i.global),i.transform.copy(i.global),i},t.parseSkinData=function(e,i){var r=new p;r.name=e[o.ConstValues.A_NAME];var n=e[o.ConstValues.SLOT];for(var s in n){var a=n[s];r.addSlotData(t.parseSlotData(a,i))}return r},t.parseSlotData=function(e,i){var r=new c;r.name=e[o.ConstValues.A_NAME],r.parent=e[o.ConstValues.A_PARENT],r.zOrder=+e[o.ConstValues.A_Z_ORDER];var n=e[o.ConstValues.DISPLAY];for(var s in n){var a=n[s];r.addDisplayData(t.parseDisplayData(a,i))}return r},t.parseDisplayData=function(e,i){var r=new l;return r.name=e[o.ConstValues.A_NAME],r.type=e[o.ConstValues.A_TYPE],r.pivot=i.addSubTexturePivot(0,0,r.name),t.parseTransform(e[o.ConstValues.TRANSFORM],r.transform,r.pivot),r},t.parseAnimationData=function(e,i,r){var n=new h;if(n.name=e[o.ConstValues.A_NAME],n.frameRate=r,n.loop=+e[o.ConstValues.A_LOOP]||0,n.fadeInTime=+e[o.ConstValues.A_FADE_IN_TIME],n.duration=+e[o.ConstValues.A_DURATION]/r,n.scale=+e[o.ConstValues.A_SCALE],e.hasOwnProperty(o.ConstValues.A_TWEEN_EASING)){var s=e[o.ConstValues.A_TWEEN_EASING];n.tweenEasing=s==undefined||null==s?0/0:+s}else n.tweenEasing=0/0;t.parseTimeline(e,n,t.parseMainFrame,r);var a,l,c=e[o.ConstValues.TIMELINE];for(var u in c){var p=c[u];a=t.parseTransformTimeline(p,n.duration,r),l=p[o.ConstValues.A_NAME],n.addTimeline(a,l)}return o.DBDataUtil.addHideTimeline(n,i),o.DBDataUtil.transformAnimationData(n,i),n},t.parseTimeline=function(t,e,i,r){var n,s=0,a=t[o.ConstValues.FRAME];for(var h in a){var l=a[h];n=i(l,r),n.position=s,e.addFrame(n),s+=n.duration}n&&(n.duration=e.duration-n.position)},t.parseTransformTimeline=function(e,i,r){var n=new a;return n.duration=i,t.parseTimeline(e,n,t.parseTransformFrame,r),n.scale=+e[o.ConstValues.A_SCALE],n.offset=+e[o.ConstValues.A_OFFSET],n},t.parseFrame=function(t,e,i){e.duration=+t[o.ConstValues.A_DURATION]/i,e.action=t[o.ConstValues.A_ACTION],e.event=t[o.ConstValues.A_EVENT],e.sound=t[o.ConstValues.A_SOUND]},t.parseMainFrame=function(e,i){var n=new r;return t.parseFrame(e,n,i),n},t.parseTransformFrame=function(i,r){var s=new n;if(t.parseFrame(i,s,r),s.visible=1!=+i[o.ConstValues.A_HIDE],i.hasOwnProperty(o.ConstValues.A_TWEEN_EASING)){var a=i[o.ConstValues.A_TWEEN_EASING];s.tweenEasing=a==undefined||null==a?0/0:+a}else s.tweenEasing=0;s.tweenRotate=+i[o.ConstValues.A_TWEEN_ROTATE]||0,s.displayIndex=+i[o.ConstValues.A_DISPLAY_INDEX]||0,s.zOrder=+i[o.ConstValues.A_Z_ORDER]||0,t.parseTransform(i[o.ConstValues.TRANSFORM],s.global,s.pivot),s.transform.copy(s.global);var h=i[o.ConstValues.COLOR_TRANSFORM];return h&&(s.color=new e.ColorTransform,s.color.alphaOffset=+h[o.ConstValues.A_ALPHA_OFFSET],s.color.redOffset=+h[o.ConstValues.A_RED_OFFSET],s.color.greenOffset=+h[o.ConstValues.A_GREEN_OFFSET],s.color.blueOffset=+h[o.ConstValues.A_BLUE_OFFSET],s.color.alphaMultiplier=.01*+h[o.ConstValues.A_ALPHA_MULTIPLIER],s.color.redMultiplier=.01*+h[o.ConstValues.A_RED_MULTIPLIER],s.color.greenMultiplier=.01*+h[o.ConstValues.A_GREEN_MULTIPLIER],s.color.blueMultiplier=.01*+h[o.ConstValues.A_BLUE_MULTIPLIER]),s},t.parseTransform=function(t,e,i){undefined===i&&(i=null),t&&(e&&(e.x=+t[o.ConstValues.A_X],e.y=+t[o.ConstValues.A_Y],e.skewX=+t[o.ConstValues.A_SKEW_X]*o.ConstValues.ANGLE_TO_RADIAN,e.skewY=+t[o.ConstValues.A_SKEW_Y]*o.ConstValues.ANGLE_TO_RADIAN,e.scaleX=+t[o.ConstValues.A_SCALE_X],e.scaleY=+t[o.ConstValues.A_SCALE_Y]),i&&(i.x=+t[o.ConstValues.A_PIVOT_X],i.y=+t[o.ConstValues.A_PIVOT_Y]))},t}();t.DataParser=g}(t.objects||(t.objects={}));var n=t.objects;!function(e){var r=function(e){function i(){e.call(this),this._dataDic={},this._textureAtlasDic={},this._textureAtlasLoadingDic={}}return __extends(i,e),i.prototype.getSkeletonData=function(t){return this._dataDic[t]},i.prototype.addSkeletonData=function(t,e){if(!t)throw Error();if(e=e||t.name,!e)throw Error("Unnamed data!");this._dataDic[e],this._dataDic[e]=t},i.prototype.removeSkeletonData=function(t){delete this._dataDic[t]},i.prototype.getTextureAtlas=function(t){return this._textureAtlasDic[t]},i.prototype.addTextureAtlas=function(t,e){if(!t)throw Error();if(e=e||t.name,!e)throw Error("Unnamed data!");this._textureAtlasDic[e],this._textureAtlasDic[e]=t},i.prototype.removeTextureAtlas=function(t){delete this._textureAtlasDic[t]},i.prototype.dispose=function(t){if(undefined===t&&(t=!0),t){for(var e in this._dataDic)this._dataDic[e].dispose();for(var e in this._textureAtlasDic)this._textureAtlasDic[e].dispose()}this._dataDic=null,this._textureAtlasDic=null,this._textureAtlasLoadingDic=null,this._currentDataName=null,this._currentTextureAtlasName=null},i.prototype.buildArmature=function(e,i,r,o,s){if(r){var a=this._dataDic[r];if(a)var h=a.getArmatureData(e)}else for(r in this._dataDic)if(a=this._dataDic[r],h=a.getArmatureData(e))break;if(!h)return null;this._currentDataName=r,this._currentTextureAtlasName=o||r;var l=this._generateArmature(e);l.name=e;var c,u,p=h.getBoneDataList();for(var d in p)u=p[d],c=new t.Bone,c.name=u.name,c.origin.copy(u.transform),h.getBoneData(u.parent)?l.addChild(c,u.parent):l.addChild(c,null);if(i&&i!=e){var f=a.getArmatureData(i);if(!f)for(r in this._dataDic)if(a=this._dataDic[r],f=a.getArmatureData(i))break}l.animation.setAnimationDataList(f?f.getAnimationDataList():h.getAnimationDataList());var g=h.getSkinData(s);if(!g)throw Error();var m,_,y,v,T,x,S=[],b=g.getSlotDataList();for(var d in b)if(T=b[d],c=l.getBone(T.parent)){for(x=T.getDisplayDataList(),m=this._generateSlot(),m.name=T.name,m._originZOrder=T.zOrder,m._dislayDataList=x,S.length=0,v=x.length;v--;)switch(_=x[v],_.name=""+_.name,_.type){case n.DisplayData.ARMATURE:y=this.buildArmature(_.name,null,this._currentDataName,this._currentTextureAtlasName,null),y&&(S[v]=y);break;case n.DisplayData.IMAGE:default:S[v]=this._generateDisplay(this._textureAtlasDic[this._currentTextureAtlasName],_.name,_.pivot.x,_.pivot.y)}m.setDisplayList(S),m._changeDisplay(0),c.addChild(m)}return l._slotsZOrderChanged=!0,l.advanceTime(0),l},i.prototype.getTextureDisplay=function(t,e,i,r){if(e)var n=this._textureAtlasDic[e];if(!n&&!e)for(e in this._textureAtlasDic){if(n=this._textureAtlasDic[e],n.getRegion(t))break;n=null}if(n){if(isNaN(i)||isNaN(r)){var o=this._dataDic[e];if(o){var s=o.getSubTexturePivot(t);s&&(i=s.x,r=s.y)}}return this._generateDisplay(n,t,i,r)}return null},i.prototype._generateArmature=function(){return null},i.prototype._generateSlot=function(){return null},i.prototype._generateDisplay=function(){return null},i}(i.EventDispatcher);e.BaseFactory=r}(t.factorys||(t.factorys={}));t.factorys;!function(t){var i=function(){function t(){}return t.ANGLE_TO_RADIAN=Math.PI/180,t.DRAGON_BONES="dragonBones",t.ARMATURE="armature",t.SKIN="skin",t.BONE="bone",t.SLOT="slot",t.DISPLAY="display",t.ANIMATION="animation",t.TIMELINE="timeline",t.FRAME="frame",t.TRANSFORM="transform",t.COLOR_TRANSFORM="colorTransform",t.TEXTURE_ATLAS="TextureAtlas",t.SUB_TEXTURE="SubTexture",t.A_VERSION="version",t.A_IMAGE_PATH="imagePath",t.A_FRAME_RATE="frameRate",t.A_NAME="name",t.A_PARENT="parent",t.A_LENGTH="length",t.A_TYPE="type",t.A_FADE_IN_TIME="fadeInTime",t.A_DURATION="duration",t.A_SCALE="scale",t.A_OFFSET="offset",t.A_LOOP="loop",t.A_EVENT="event",t.A_SOUND="sound",t.A_ACTION="action",t.A_HIDE="hide",t.A_TWEEN_EASING="tweenEasing",t.A_TWEEN_ROTATE="tweenRotate",t.A_DISPLAY_INDEX="displayIndex",t.A_Z_ORDER="z",t.A_WIDTH="width",t.A_HEIGHT="height",t.A_X="x",t.A_Y="y",t.A_SKEW_X="skX",t.A_SKEW_Y="skY",t.A_SCALE_X="scX",t.A_SCALE_Y="scY",t.A_PIVOT_X="pX",t.A_PIVOT_Y="pY",t.A_ALPHA_OFFSET="aO",t.A_RED_OFFSET="rO",t.A_GREEN_OFFSET="gO",t.A_BLUE_OFFSET="bO",t.A_ALPHA_MULTIPLIER="aM",t.A_RED_MULTIPLIER="rM",t.A_GREEN_MULTIPLIER="gM",t.A_BLUE_MULTIPLIER="bM",t}();t.ConstValues=i;var o=function(){function t(){}return t.transformPointWithParent=function(e,i){var r=t._helpMatrix;t.transformToMatrix(i,r),r.invert();var n=e.x,o=e.y;e.x=r.a*n+r.c*o+r.tx,e.y=r.d*o+r.b*n+r.ty,e.skewX=t.formatRadian(e.skewX-i.skewX),e.skewY=t.formatRadian(e.skewY-i.skewY)},t.transformToMatrix=function(t,e){e.a=t.scaleX*Math.cos(t.skewY),e.b=t.scaleX*Math.sin(t.skewY),e.c=-t.scaleY*Math.sin(t.skewX),e.d=t.scaleY*Math.cos(t.skewX),e.tx=t.x,e.ty=t.y},t.formatRadian=function(e){return e%=t.DOUBLE_PI,e>Math.PI&&(e-=t.DOUBLE_PI),e<-Math.PI&&(e+=t.DOUBLE_PI),e},t.DOUBLE_PI=2*Math.PI,t._helpMatrix=new e.Matrix,t}();t.TransformUtil=o;var s=function(){function t(){}return t.transformArmatureData=function(t){for(var e,i,r=t.getBoneDataList(),n=r.length;n--;)e=r[n],e.parent&&(i=t.getBoneData(e.parent),i&&(e.transform.copy(e.global),o.transformPointWithParent(e.transform,i.global)))},t.transformArmatureDataAnimations=function(e){for(var i=e.getAnimationDataList(),r=i.length;r--;)t.transformAnimationData(i[r],e)},t.transformAnimationData=function(e,i){for(var r,n,s,a,h,l,c,u,p,d,f=i.getSkinData(null),g=i.getBoneDataList(),m=f.getSlotDataList(),_=g.length;_--;)if(r=g[_],n=e.getTimeline(r.name)){s=null;for(var y in m)if(s=m[y],s.parent==r.name)break;a=r.parent?e.getTimeline(r.parent):null,h=n.getFrameList(),l=null,c=null,u=null,d=h.length;for(var v=0;d>v;v++){if(p=h[v],a?(t._helpTransform1.copy(p.global),t.getTimelineTransform(a,p.position,t._helpTransform2),o.transformPointWithParent(t._helpTransform1,t._helpTransform2),p.transform.copy(t._helpTransform1)):p.transform.copy(p.global),p.transform.x-=r.transform.x,p.transform.y-=r.transform.y,p.transform.skewX-=r.transform.skewX,p.transform.skewY-=r.transform.skewY,p.transform.scaleX-=r.transform.scaleX,p.transform.scaleY-=r.transform.scaleY,n.transformed||s&&(p.zOrder-=s.zOrder),l||(l=n.originTransform,l.copy(p.transform),l.skewX=o.formatRadian(l.skewX),l.skewY=o.formatRadian(l.skewY),c=n.originPivot,c.x=p.pivot.x,c.y=p.pivot.y),p.transform.x-=l.x,p.transform.y-=l.y,p.transform.skewX=o.formatRadian(p.transform.skewX-l.skewX),p.transform.skewY=o.formatRadian(p.transform.skewY-l.skewY),p.transform.scaleX-=l.scaleX,p.transform.scaleY-=l.scaleY,n.transformed||(p.pivot.x-=c.x,p.pivot.y-=c.y),u){var T=p.transform.skewX-u.transform.skewX;u.tweenRotate?u.tweenRotate>0?(0>T&&(p.transform.skewX+=2*Math.PI,p.transform.skewY+=2*Math.PI),u.tweenRotate>1&&(p.transform.skewX+=2*Math.PI*(u.tweenRotate-1),p.transform.skewY+=2*Math.PI*(u.tweenRotate-1))):(T>0&&(p.transform.skewX-=2*Math.PI,p.transform.skewY-=2*Math.PI),u.tweenRotate<1&&(p.transform.skewX+=2*Math.PI*(u.tweenRotate+1),p.transform.skewY+=2*Math.PI*(u.tweenRotate+1))):(p.transform.skewX=u.transform.skewX+o.formatRadian(p.transform.skewX-u.transform.skewX),p.transform.skewY=u.transform.skewY+o.formatRadian(p.transform.skewY-u.transform.skewY))}u=p}n.transformed=!0}},t.getTimelineTransform=function(t,e,i){for(var n,s,a,h,l=t.getFrameList(),c=l.length;c--;)if(n=l[c],n.position<=e&&n.position+n.duration>e){s=n.tweenEasing,c==l.length-1||isNaN(s)||e==n.position?i.copy(n.global):(a=(e-n.position)/n.duration,s&&(a=r.TimelineState.getEaseValue(a,s)),h=l[c+1],i.x=n.global.x+(h.global.x-n.global.x)*a,i.y=n.global.y+(h.global.y-n.global.y)*a,i.skewX=o.formatRadian(n.global.skewX+(h.global.skewX-n.global.skewX)*a),i.skewY=o.formatRadian(n.global.skewY+(h.global.skewY-n.global.skewY)*a),i.scaleX=n.global.scaleX+(h.global.scaleX-n.global.scaleX)*a,i.scaleY=n.global.scaleY+(h.global.scaleY-n.global.scaleY)*a);break}},t.addHideTimeline=function(t,e){for(var i,r,o=e.getBoneDataList(),s=o.length;s--;)i=o[s],r=i.name,t.getTimeline(r)||t.addTimeline(n.TransformTimeline.HIDE_TIMELINE,r)},t._helpTransform1=new n.DBTransform,t._helpTransform2=new n.DBTransform,t}();t.DBDataUtil=s}(t.utils||(t.utils={}));var o=t.utils,s=function(){function t(){this.global=new n.DBTransform,this.origin=new n.DBTransform,this.offset=new n.DBTransform,this.tween=new n.DBTransform,this.tween.scaleX=this.tween.scaleY=0,this._globalTransformMatrix=new e.Matrix,this._visible=!0,this._isColorChanged=!1,this._isDisplayOnStage=!1,this._scaleType=0,this.fixedRotation=!1}return t.prototype.getVisible=function(){return this._visible},t.prototype.setVisible=function(t){this._visible=t},t.prototype._setParent=function(t){this.parent=t},t.prototype._setArmature=function(t){this.armature&&this.armature._removeDBObject(this),this.armature=t,this.armature&&this.armature._addDBObject(this)},t.prototype.dispose=function(){this.parent=null,this.armature=null,this.global=null,this.origin=null,this.offset=null,this.tween=null,this._globalTransformMatrix=null},t.prototype._update=function(){if(this.global.scaleX=(this.origin.scaleX+this.tween.scaleX)*this.offset.scaleX,this.global.scaleY=(this.origin.scaleY+this.tween.scaleY)*this.offset.scaleY,this.parent){var t=this.origin.x+this.offset.x+this.tween.x,e=this.origin.y+this.offset.y+this.tween.y,i=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx=this.global.x=i.a*t+i.c*e+i.tx,this._globalTransformMatrix.ty=this.global.y=i.d*e+i.b*t+i.ty,this.fixedRotation?(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY):(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX+this.parent.global.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY+this.parent.global.skewY),this.parent.scaleMode<this._scaleType||(this.global.scaleX*=this.parent.global.scaleX,this.global.scaleY*=this.parent.global.scaleY)}else this._globalTransformMatrix.tx=this.global.x=this.origin.x+this.offset.x+this.tween.x,this._globalTransformMatrix.ty=this.global.y=this.origin.y+this.offset.y+this.tween.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY;this._globalTransformMatrix.a=this.global.scaleX*Math.cos(this.global.skewY),this._globalTransformMatrix.b=this.global.scaleX*Math.sin(this.global.skewY),this._globalTransformMatrix.c=-this.global.scaleY*Math.sin(this.global.skewX),this._globalTransformMatrix.d=this.global.scaleY*Math.cos(this.global.skewX)},t}();t.DBObject=s;var a=function(t){function e(e){t.call(this),this._displayBridge=e,this._displayList=[],this._displayIndex=-1,this._scaleType=1,this._originZOrder=0,this._tweenZorder=0,this._offsetZOrder=0,this._isDisplayOnStage=!1,this._isHideDisplay=!1}return __extends(e,t),e.prototype.getZOrder=function(){return this._originZOrder+this._tweenZorder+this._offsetZOrder},e.prototype.setZOrder=function(t){this.getZOrder()!=t&&(this._offsetZOrder=t-this._originZOrder-this._tweenZorder,this.armature&&(this.armature._slotsZOrderChanged=!0))},e.prototype.getDisplay=function(){var t=this._displayList[this._displayIndex];return t instanceof l?t.getDisplay():t},e.prototype.setDisplay=function(t){this._displayList[this._displayIndex]=t,this._setDisplay(t)},e.prototype.getChildArmature=function(){var t=this._displayList[this._displayIndex];return t instanceof l?t:null},e.prototype.setChildArmature=function(t){this._displayList[this._displayIndex]=t,t&&this._setDisplay(t.getDisplay())},e.prototype.getDisplayList=function(){return this._displayList},e.prototype.setDisplayList=function(t){if(!t)throw Error();for(var e=this._displayList.length=t.length;e--;)this._displayList[e]=t[e];if(this._displayIndex>=0){var i=this._displayIndex;this._displayIndex=-1,this._changeDisplay(i)}},e.prototype._setDisplay=function(t){this._displayBridge.getDisplay()?this._displayBridge.setDisplay(t):(this._displayBridge.setDisplay(t),this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)),this.updateChildArmatureAnimation(),this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},e.prototype._changeDisplay=function(t){if(0>t)this._isHideDisplay||(this._isHideDisplay=!0,this._displayBridge.removeDisplay(),this.updateChildArmatureAnimation());else{if(this._isHideDisplay){this._isHideDisplay=!1;var e=!0;this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)}var i=this._displayList.length;if(t>=i&&i>0&&(t=i-1),this._displayIndex!=t){this._displayIndex=t;var r=this._displayList[this._displayIndex];this._setDisplay(r instanceof l?r.getDisplay():r),this._dislayDataList&&this._displayIndex<this._dislayDataList.length&&this.origin.copy(this._dislayDataList[this._displayIndex].transform)}else e&&this.updateChildArmatureAnimation()}this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},e.prototype.setVisible=function(t){t!=this._visible&&(this._visible=t,this._updateVisible(this._visible))},e.prototype._setArmature=function(e){t.prototype._setArmature.call(this,e),this.armature?(this.armature._slotsZOrderChanged=!0,this._displayBridge.addDisplay(this.armature.getDisplay(),-1)):this._displayBridge.removeDisplay()},e.prototype.dispose=function(){this._displayBridge&&(t.prototype.dispose.call(this),this._displayBridge.dispose(),this._displayList.length=0,this._displayBridge=null,this._displayList=null,this._dislayDataList=null)},e.prototype._update=function(){if(t.prototype._update.call(this),this._isDisplayOnStage){var e=this.parent._tweenPivot.x,i=this.parent._tweenPivot.y;if(e||i){var r=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx+=r.a*e+r.c*i,this._globalTransformMatrix.ty+=r.b*e+r.d*i}this._displayBridge.updateTransform(this._globalTransformMatrix,this.global)}},e.prototype._updateVisible=function(t){this._displayBridge.setVisible(this.parent.getVisible()&&this._visible&&t)},e.prototype.updateChildArmatureAnimation=function(){var t=this.getChildArmature();if(t)if(this._isHideDisplay)t.animation.stop(),t.animation._lastAnimationState=null;else{var e=this.armature?this.armature.animation.getLastAnimationName():null;e&&t.animation.hasAnimation(e)?t.animation.gotoAndPlay(e):t.animation.play()}},e}(s);t.Slot=a;var h=function(t){function r(){t.call(this),this._children=[],this._scaleType=2,this._tweenPivot=new e.Point,this.scaleMode=1}return __extends(r,t),r.prototype.setVisible=function(t){if(this._visible!=t){this._visible=t;for(var e=this._children.length;e--;){var i=this._children[e];i instanceof a&&i._updateVisible(this._visible)}}},r.prototype._setArmature=function(e){t.prototype._setArmature.call(this,e);for(var i=this._children.length;i--;)this._children[i]._setArmature(this.armature)},r.prototype.dispose=function(){if(this._children){t.prototype.dispose.call(this);for(var e=this._children.length;e--;)this._children[e].dispose();this._children.length=0,this._children=null,this._tweenPivot=null,this.slot=null}},r.prototype.contains=function(t){if(!t)throw Error();if(t==this)return!1;for(var e=t;e!=this&&null!=e;)e=e.parent;return e==this},r.prototype.addChild=function(t){if(!t)throw Error();if(t==this||t instanceof r&&t.contains(this))throw Error("An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)");t.parent&&t.parent.removeChild(t),this._children[this._children.length]=t,t._setParent(this),t._setArmature(this.armature),!this.slot&&t instanceof a&&(this.slot=t)},r.prototype.removeChild=function(t){if(!t)throw Error();var e=this._children.indexOf(t);if(0>e)throw Error();this._children.splice(e,1),t._setParent(null),t._setArmature(null),t==this.slot&&(this.slot=null)},r.prototype.getSlots=function(){for(var t=[],e=this._children.length;e--;)this._children[e]instanceof a&&t.unshift(this._children[e]);return t},r.prototype._arriveAtFrame=function(t,e,n){if(t){var o=n.getMixingTransform(name);if(!(!n.displayControl||2!=o&&-1!=o||this.displayController&&this.displayController!=n.name)){var s=t;if(this.slot){var h=s.displayIndex;0>h||isNaN(s.zOrder)||s.zOrder==this.slot._tweenZorder||(this.slot._tweenZorder=s.zOrder,this.armature._slotsZOrderChanged=!0),this.slot._changeDisplay(h),this.slot._updateVisible(s.visible)}}if(t.event&&this.armature.hasEventListener(i.FrameEvent.BONE_FRAME_EVENT)){var l=new i.FrameEvent(i.FrameEvent.BONE_FRAME_EVENT);l.bone=this,l.animationState=n,l.frameLabel=t.event,this.armature._eventList.push(l)}if(t.sound&&r._soundManager.hasEventListener(i.SoundEvent.SOUND)){var c=new i.SoundEvent(i.SoundEvent.SOUND);c.armature=this.armature,c.animationState=n,c.sound=t.sound,r._soundManager.dispatchEvent(c)}if(t.action)for(var u in this._children)if(this._children[u]instanceof a){var p=this._children[u].getChildArmature();p&&p.animation.gotoAndPlay(t.action)}}else this.slot&&this.slot._changeDisplay(-1)},r.prototype._updateColor=function(t,e,i,r,n,o,s,h,l){for(var c=this._children.length;c--;){var u=this._children[c];u instanceof a&&u._displayBridge.updateColor(t,e,i,r,n,o,s,h)}this._isColorChanged=l},r._soundManager=i.SoundEventManager.getInstance(),r}(s);t.Bone=h;var l=function(t){function e(e){t.call(this),this.animation=new r.Animation(this),this._display=e,this._slotsZOrderChanged=!1,this._slotList=[],this._boneList=[],this._eventList=[]}return __extends(e,t),e.prototype.getDisplay=function(){return this._display},e.prototype.dispose=function(){if(this.animation){this.animation.dispose();for(var t=this._slotList.length;t--;)this._slotList[t].dispose();for(t=this._boneList.length;t--;)this._boneList[t].dispose();this._slotList.length=0,this._boneList.length=0,this._eventList.length=0,this._slotList=null,this._boneList=null,this._eventList=null,this._display=null,this.animation=null}},e.prototype.advanceTime=function(t){this.animation.advanceTime(t),t*=this.animation.timeScale;for(var e=this._boneList.length;e--;)this._boneList[e]._update();e=this._slotList.length;for(var r;e--;)if(r=this._slotList[e],r._update(),r._isDisplayOnStage){var n=r.getChildArmature();n&&n.advanceTime(t)}if(this._slotsZOrderChanged&&(this.updateSlotsZOrder(),this.hasEventListener(i.ArmatureEvent.Z_ORDER_UPDATED)&&this.dispatchEvent(new i.ArmatureEvent(i.ArmatureEvent.Z_ORDER_UPDATED))),this._eventList.length){var o=this._eventList.length;for(e=0;o>e;e++)this.dispatchEvent(this._eventList[e]);this._eventList.length=0}},e.prototype.getSlots=function(t){return undefined===t&&(t=!0),t?this._slotList.concat():this._slotList},e.prototype.getBones=function(t){return undefined===t&&(t=!0),t?this._boneList.concat():this._boneList},e.prototype.getSlot=function(t){for(var e=this._slotList.length;e--;)if(this._slotList[e].name==t)return this._slotList[e];return null},e.prototype.getSlotByDisplay=function(t){if(t)for(var e=this._slotList.length;e--;)if(this._slotList[e].getDisplay()==t)return this._slotList[e];return null},e.prototype.removeSlot=function(t){if(!t)throw Error();if(this._slotList.indexOf(t)<0)throw Error();t.parent.removeChild(t)},e.prototype.removeSlotByName=function(t){if(t){var e=this.getSlot(t);e&&this.removeSlot(e)}},e.prototype.getBone=function(t){for(var e=this._boneList.length;e--;)if(this._boneList[e].name==t)return this._boneList[e];return null},e.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null},e.prototype.removeBone=function(t){if(!t)throw Error();if(this._boneList.indexOf(t)<0)throw Error();t.parent?t.parent.removeChild(t):t._setArmature(null)},e.prototype.removeBoneByName=function(t){if(t){var e=this.getBone(t);e&&this.removeBone(e)}},e.prototype.addChild=function(t,e){if(!t)throw Error();if(e){var i=this.getBone(e);if(!i)throw Error();i.addChild(t)}else t.parent&&t.parent.removeChild(t),t._setArmature(this)},e.prototype.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);for(var t,e=this._slotList.length;e--;)t=this._slotList[e],t._isDisplayOnStage&&t._displayBridge.addDisplay(this._display,-1);this._slotsZOrderChanged=!1},e.prototype._addDBObject=function(t){if(t instanceof a){var e=t;this._slotList.indexOf(e)<0&&(this._slotList[this._slotList.length]=e)}else if(t instanceof h){var i=t;this._boneList.indexOf(i)<0&&(this._boneList[this._boneList.length]=i,this._sortBoneList())}},e.prototype._removeDBObject=function(t){if(t instanceof a){var e=t,i=this._slotList.indexOf(e);0>i||this._slotList.splice(i,1)}else if(t instanceof h){var r=t;i=this._boneList.indexOf(r),0>i||this._boneList.splice(i,1)}},e.prototype._sortBoneList=function(){var t=this._boneList.length;if(0!=t){for(var e,i,r,n=[];t--;){for(e=0,i=this._boneList[t],r=i;r;)e++,r=r.parent;n[t]={level:e,bone:i}}for(n.sort(this.sortBone),t=n.length;t--;)this._boneList[t]=n[t].bone}},e.prototype._arriveAtFrame=function(t,r,n){if(t.event&&this.hasEventListener(i.FrameEvent.ANIMATION_FRAME_EVENT)){var o=new i.FrameEvent(i.FrameEvent.ANIMATION_FRAME_EVENT);o.animationState=n,o.frameLabel=t.event,this._eventList.push(o)}if(t.sound&&e._soundManager.hasEventListener(i.SoundEvent.SOUND)){var s=new i.SoundEvent(i.SoundEvent.SOUND);s.armature=this,s.animationState=n,s.sound=t.sound,e._soundManager.dispatchEvent(s)}t.action&&n.isPlaying&&this.animation.gotoAndPlay(t.action)},e.prototype.sortSlot=function(t,e){return t.getZOrder()<e.getZOrder()?1:-1},e.prototype.sortBone=function(t,e){return t.level<e.level?1:-1},e._soundManager=i.SoundEventManager.getInstance(),e}(i.EventDispatcher);t.Armature=l}(dragonBones||(dragonBones={}));var dragonBones;!function(t){!function(t){var e=function(){function t(){}return t.prototype.getVisible=function(){return this._display?this._display.visible:!1},t.prototype.setVisible=function(t){this._display&&(this._display.visible=t)},t.prototype.getDisplay=function(){return this._display},t.prototype.setDisplay=function(t){if(this._display!=t){var e=-1;
if(this._display){var i=this._display.parent;i&&(e=this._display.parent.children.indexOf(this._display)),this.removeDisplay()}this._display=t,this.addDisplay(i,e)}},t.prototype.dispose=function(){this._display=null},t.prototype.updateTransform=function(t,e){this._display.x=t.tx,this._display.y=t.ty,this._display.skewX=e.skewX,this._display.skewY=e.skewY,this._display.scaleX=e.scaleX,this._display.scaleY=e.scaleY},t.prototype.updateColor=function(t,e,i,r,n){this._display&&(this._display.alpha=n)},t.prototype.addDisplay=function(t,e){var i=t;i&&this._display&&(0>e||undefined===e?(this._display.parent===i&&i.removeChild(this._display),i.addChild(this._display)):i.addChildAt(this._display,Math.min(e,i.children.length)))},t.prototype.removeDisplay=function(){this._display&&this._display.parent&&this._display.parent.removeChild(this._display)},t.RADIAN_TO_ANGLE=180/Math.PI,t}();t.QcDisplayBridge=e}(t.display||(t.display={}));var e=t.display;!function(e){var i=function(){function e(t,e,i){undefined===i&&(i=1),this._regions={},this.image=t,this.scale=i,this.atlasId=e.atlasId,this.parseData(e)}return e.prototype.dispose=function(){this.image=null,this._regions=null},e.prototype.getRegion=function(t){return this._regions[t]},e.prototype.parseData=function(e){var i=t.objects.DataParser.parseTextureAtlasData(e,this.scale);this.name=i.__name,delete i.__name;for(var r in i)this._regions[r]=i[r]},e}();e.QcBonesAtlas=i}(t.textures||(t.textures={}));t.textures;!function(i){var r=function(i){function r(){i.call(this)}return __extends(r,i),r.prototype._generateArmature=function(e){var i=new qc.UIImage(t.game._qc),r=new t.Armature(i);return i.name=e,i._bone=!0,i._armature=!0,r},r.prototype._generateSlot=function(){var i=new t.Slot(new e.QcDisplayBridge);return i},r.prototype._generateDisplay=function(e,i,r,n){var o=new qc.UIImage(t.game._qc),s=e.atlasId;return o.texture=o.game.assets.find(s),o.frame=i,o.name=i,o._bone=!0,o.resetNativeSize(),o.pivotX=r/o.width,o.pivotY=n/o.height,o.parent&&o.parent.removeChild(o),o},r}(i.BaseFactory);i.QcBonesFactory=r}(t.factorys||(t.factorys={}));t.factorys}(dragonBones||(dragonBones={})),dragonBones.CoverAtlas=function(t){for(var e,i,r={meta:{image:t.imagePath},frames:e={}},n=t.SubTexture,o=n.length,s=0;o>s;s++)i=n[s],e[i.name]={filename:i.name,frame:{x:i.x,y:i.y,w:i.width,h:i.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:i.width,h:i.height},sourceSize:{w:i.width,h:i.height}};return r},dragonBones.findArmature=function(t){return t.armature[0].name},dragonBones.makeQcArmature=function(t,e,i,r){e.name=r,t.name=r;var n=e;n.atlasId=n.name;var o=new dragonBones.factorys.QcBonesFactory;o.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(t));var s=new dragonBones.textures.QcBonesAtlas(i,n);o.addTextureAtlas(s);var a=o.buildArmature(dragonBones.findArmature(t));return a},qc.dragonBones=dragonBones,qc.dragonBonesDriver=function(t){qc.dragonBones.game=t},qc.dragonBonesDriver.prototype={update:function(){}},qc.dragonBonesDriver.prototype.constructor=qc.dragonBonesDriver,qc.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3},qc.UIState={NORMAL:0,PRESSED:1,DISABLED:2},qc.Util={findClass:function(t){for(var e=t.split("."),i=window,r=0;r<e.length-1;r++){if(!i[e[r]])return;i=i[e[r]]}return i[e[e.length-1]]},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=new t.constructor;for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},isArray:Array.isArray||function(t){return"[object Array]"===toString.call(t)},removeHTML:function(){var t;return function(e){if(e&&e.parentNode){if(t===e)return;t=e,e.parentNode.removeChild(e),t=null}}}(),updateTransform:function(t,e){var i=t.game,r=i.phaser.scale.scaleFactorInversed,n=e.style,o=t.rect,s=t.worldTransform,a=(-o.x).toFixed(5)+"px "+(-o.y).toFixed(5)+"px",h="matrix("+(s.a*r.x).toFixed(5)+","+(s.b*r.x).toFixed(5)+","+(s.c*r.y).toFixed(5)+","+(s.d*r.y).toFixed(5)+","+(s.tx*r.x).toFixed(0)+","+(s.ty*r.y).toFixed(0)+")";n.left=o.x.toFixed(5)+"px",n.top=o.y.toFixed(5)+"px",n.width=o.width.toFixed(5)+"px",n.height=o.height.toFixed(5)+"px",n.webkitTransform=h,n.mozTransform=h,n.msTransform=h,n.oTransform=h,n.transform=h,n.webkitTransformOrigin=a,n.mozTransformOrigin=a,n.msTransformOrigin=a,n.oTransformOrigin=a,n.transformOrigin=a},formatString:function(t){var e=arguments;return e.length>1?t.replace(/\{(\d+)\}/g,function(t,i){return qc.Util.formatValue(e[parseInt(i)+1]).replace(/^\'|\'$/g,"")}):qc.Util.formatValue(t).replace(/^\'|\'$/g,"")},popupError:function(t){if(window.parent&&window.parent.G&&window.parent.G.notification){var e=window.parent.G,i=qc.Util.formatString(e._("Exception notification"),t);e.notification.error(i)}else{var i="Error: "+t;if("undefined"!=typeof qici&&qici.config){var r=qici.config.gameInstance,n=window[r];n&&(n.log.error(i),n.debug.on&&alert(i))}else console.trace(i)}},formatValue:function(t,e,i){"number"!=typeof e&&(e=0),i=i||[];var r=function(t){if(t===undefined)return"undefined";if(null===t)return"null";var e=typeof t,i=Object.prototype.toString.call(t);if("string"===e){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return r}if("number"===e)return 0===t&&0>1/t?"-0":""+t;if("boolean"===e)return""+t;if("symbol"===e)return""+t;if("function"===e){var n=t.name?":"+t.name:"";return"[Function"+n+"]"}return"[object RegExp]"===i?"[RegExp: "+RegExp.prototype.toString.call(t)+"]":"[object Error]"===i?"[Error: "+t.stack+"]":"[object Date]"===i?"[Date: "+Date.prototype.toString.call(t)+"]":undefined},n=r(t);if(n)return n;var o=Object.keys(t);if(0===o.length){var s=t;try{s=t.valueOf()}catch(a){}if(n=r(s))return n}var h,l,c=function(t,e,i,r){for(var n=[],o=0,s=t.length;s>o;++o)n.push(Object.prototype.hasOwnProperty.call(t,o+"")?p(r,t,e,o+"",!0):"");return i.forEach(function(i){"symbol"!=typeof i&&i.match(/^\d+$/)||n.push(p(r,t,e,i,!0))}),n},u=function(t,e,i,r){return i.map(function(i){return p(r,t,e,i,!1)})};if(Array.isArray(t)?(h=["[","]"],l=c):(h=["{","}"],l=u),0===o.length)return h[0]+""+h[1];var p=function(t,e,i,r,n){var o,s,a;return a=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]},a.get?s=a.set?"[Getter/Setter]":"[Getter]":a.set&&(s="[Setter]"),s||(t.indexOf(a.value)<0?(s=null===i?qc.Util.formatValue(a.value,null,t):qc.Util.formatValue(a.value,i-1,t),s.indexOf("\n")>-1&&(s=n?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s="[Circular]"),n&&r.match(/^\d+$/)?s:(o=JSON.stringify(""+r),o=o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?o.substr(1,o.length-2):o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\"),o+": "+s)};if(0>e){var d="Object";return Array.isArray(t)?d="Array":(t.class&&"string"==typeof t.class&&(d=t.class),t.name&&"string"==typeof t.class&&(d=d+"("+t.name+")")),"["+d+"]"}i.push(t);var f=l(t,e,o,i);i.pop();var g=function(t,e){var i=t.reduce(function(t,e){return t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return i>60?e[0]+(1===e[0].length?"":"\n ")+" "+t.join(",\n  ")+" "+e[1]:e[0]+" "+t.join(", ")+" "+e[1]};return g(f,h)},insertSortedList:function(t,e,i,r){var n,o=function(t,e,i){var r=0,n=t.length-1;if(0>n)return-1;for(var o=0;n>r;)o=Math.floor((r+n)/2),i(t[o],e)?r=o+1:n=o;return i(t[r],e)?-1:r},s=o(t,e,i);return n=r?0>s?t.push(e)-1:t.splice(s,0,e)&&s:0>s?t.push(e)-1:t.splice(s,i(e,t[s])?0:1,e)&&s}},window.onerror=function(t){qc.Util.popupError(t)};var Color=qc.Color=function(t){if(this.alpha=1,this._rgb=[255,255,255],null!=t)if("number"==typeof t)this._rgb[0]=t>>16&255,this._rgb[1]=t>>8&255,this._rgb[2]=255&t,this.alpha=(t>>>24)/255;else if(qc.Util.isArray(t))this.rgb=t;else{if("string"!=typeof t)throw Error("Invalid color");if(t=t.toLowerCase(),0===t.indexOf("rgb"))var e=Phaser.Color.webToColor(t);else{var e=this._hexToColor(t);e.a=e.a/255}this._rgb[0]=e.r,this._rgb[1]=e.g,this._rgb[2]=e.b,this.alpha=e.a}};Color.prototype={},Color.prototype.constructor=Color,Object.defineProperties(Color.prototype,{alpha:{get:function(){return this._alpha},set:function(t){(0>t||t>1)&&(t=1),this._alpha=t}},rgb:{get:function(){return this._rgb},set:function(t){if(!qc.Util.isArray(t))throw Error("Expected:Array");if(t.length<3)throw Error("Invalid rgb");this._rgb[0]=t[0],this._rgb[1]=t[1],this._rgb[2]=t[2],this.alpha=4===t.length?t[3]:1}},r:{get:function(){return this._rgb[0]},set:function(t){this._rgb[0]=t}},g:{get:function(){return this._rgb[1]},set:function(t){this._rgb[1]=t}},b:{get:function(){return this._rgb[2]},set:function(t){this._rgb[2]=t}},"class":{get:function(){return"qc.Color"}}}),Color.prototype.toString=function(t){switch(t){case"#rgb":return"#"+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+Phaser.Color.componentToHex(Math.round(255*this.alpha))+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0]+","+this._rgb[1]+","+this._rgb[2]+")";default:return"rgba("+this._rgb[0]+","+this._rgb[1]+","+this._rgb[2]+","+this.alpha+")"}},Color.prototype.toNumber=function(t){return t?(255*this.alpha<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0:(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0},Color.prototype._hexToColor=function(t){if(t.length<=0||"#"!==t[0])return{r:255,g:255,b:255,a:255};t=t.substr(1,t.length-1);var e=!1;if(t.length>6&&t.length<=8)for(e=!0;t.length<8;)t="0"+t;for(;t.length<6;)t="0"+t;var i=255,r=0;e&&(i=parseInt(t.substr(r,2),16),r+=2);var n=parseInt(t.substr(r,2),16);r+=2;var o=parseInt(t.substr(r,2),16);r+=2;var s=parseInt(t.substr(r,2),16);return{r:n,g:o,b:s,a:i}},Color.black=new Color(4278190080),Color.white=new Color(4294967295),Color.red=new Color(4294901760),Color.yellow=new Color(4294967040),Color.blue=new Color(4278255615),Color.green=new Color(4278255360),Color.grey=new Color(4291611852),Color.shadow=new Color(2147483648),Color.background=new Color(4282861383),qc.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(t){var e=qc.CanvasPool.pool,i=e[t],r=!1;if(!i){r=!0;var n=qc.CanvasPool.unused;e[t]=i=n.length?n.pop():Phaser.Canvas.create(1,1)}return i._cookie=qc.CanvasPool.cookie,{canvas:i,dirty:r}},stat:function(){var t=0,e=0,i=qc.CanvasPool.pool;for(var r in i){var n=i[r];n&&(t++,e+=n.width*n.height)}console.info("当前Canvas使用中："+t+"，总像素为："+e+"，未使用的Canvas数量："+qc.CanvasPool.unused.length)},postRender:function(){var t=qc.CanvasPool,e=t.cookie;t.cookie=e+1;for(var i=t.pool,r=t.unused,n=Object.keys(i),o=0,s=n.length;s>o;o++){var a=n[o],h=i[a];h._cookie!==e&&(delete i[a],h.width=1,h.height=1,r.push(h))}}};var appCache=window.applicationCache;if(appCache){var logEvent=function(){},logError=function(){};appCache.addEventListener("cached",logEvent,!1),appCache.addEventListener("checking",logEvent,!1),appCache.addEventListener("downloading",logEvent,!1),appCache.addEventListener("error",logError,!1),appCache.addEventListener("noupdate",logEvent,!1),appCache.addEventListener("obsolete",logEvent,!1),appCache.addEventListener("progress",logEvent,!1),appCache.addEventListener("updateready",logEvent,!1)}var pc2bytes0=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],pc2bytes1=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],pc2bytes2=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],pc2bytes3=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],pc2bytes4=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],pc2bytes5=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],pc2bytes6=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],pc2bytes7=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],pc2bytes8=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],pc2bytes9=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],pc2bytes10=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],pc2bytes11=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],pc2bytes12=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],pc2bytes13=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],spfunction1=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],spfunction2=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],spfunction3=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],spfunction4=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],spfunction5=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],spfunction6=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],spfunction7=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],spfunction8=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];qc.Des={encrypt:function(t,e,i,r,n){return qc.Des._des(t,e,!0,i,r,n)},decrypt:function(t,e,i,r,n){return qc.Des._des(t,e,!1,i,r,n)},_des:function(t,e,i,r,n,o){var s,a,h,l,c,u,p,d,f,g,m,_,y,v,T=qc.Des.des_createKeys(t),x=0,S=e.length,b=0,w=32==T.length?3:9;d=3==w?i?[0,32,2]:[30,-2,-2]:i?[0,32,2,62,30,-2,64,96,2]:[94,62,-2,32,64,2,30,-2,-2],2==o?e+="        ":1==o?(h=8-S%8,e+=String.fromCharCode(h,h,h,h,h,h,h,h),8==h&&(S+=8)):o||(e+="\x00\x00\x00\x00\x00\x00\x00\x00");var A="",E="";for(1==r&&(f=n.charCodeAt(x++)<<24|n.charCodeAt(x++)<<16|n.charCodeAt(x++)<<8|n.charCodeAt(x++),m=n.charCodeAt(x++)<<24|n.charCodeAt(x++)<<16|n.charCodeAt(x++)<<8|n.charCodeAt(x++),x=0);S>x;){for(u=e.charCodeAt(x++)<<24|e.charCodeAt(x++)<<16|e.charCodeAt(x++)<<8|e.charCodeAt(x++),p=e.charCodeAt(x++)<<24|e.charCodeAt(x++)<<16|e.charCodeAt(x++)<<8|e.charCodeAt(x++),1==r&&(i?(u^=f,p^=m):(g=f,_=m,f=u,m=p)),h=252645135&(u>>>4^p),p^=h,u^=h<<4,h=65535&(u>>>16^p),p^=h,u^=h<<16,h=858993459&(p>>>2^u),u^=h,p^=h<<2,h=16711935&(p>>>8^u),u^=h,p^=h<<8,h=1431655765&(u>>>1^p),p^=h,u^=h<<1,u=u<<1|u>>>31,p=p<<1|p>>>31,a=0;w>a;a+=3){for(y=d[a+1],v=d[a+2],s=d[a];s!=y;s+=v)l=p^T[s],c=(p>>>4|p<<28)^T[s+1],h=u,u=p,p=h^(spfunction2[l>>>24&63]|spfunction4[l>>>16&63]|spfunction6[l>>>8&63]|spfunction8[63&l]|spfunction1[c>>>24&63]|spfunction3[c>>>16&63]|spfunction5[c>>>8&63]|spfunction7[63&c]);h=u,u=p,p=h}u=u>>>1|u<<31,p=p>>>1|p<<31,h=1431655765&(u>>>1^p),p^=h,u^=h<<1,h=16711935&(p>>>8^u),u^=h,p^=h<<8,h=858993459&(p>>>2^u),u^=h,p^=h<<2,h=65535&(u>>>16^p),p^=h,u^=h<<16,h=252645135&(u>>>4^p),p^=h,u^=h<<4,1==r&&(i?(f=u,m=p):(u^=g,p^=_)),E+=String.fromCharCode(u>>>24,u>>>16&255,u>>>8&255,255&u,p>>>24,p>>>16&255,p>>>8&255,255&p),b+=8,512==b&&(A+=E,E="",b=0)}return A+E},des_createKeys:function(t){for(var e,i,r,n=t.length>8?3:1,o=Array(32*n),s=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],a=0,h=0,l=0;n>l;l++){var c=t.charCodeAt(a++)<<24|t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++),u=t.charCodeAt(a++)<<24|t.charCodeAt(a++)<<16|t.charCodeAt(a++)<<8|t.charCodeAt(a++);r=252645135&(c>>>4^u),u^=r,c^=r<<4,r=65535&(u>>>-16^c),c^=r,u^=r<<-16,r=858993459&(c>>>2^u),u^=r,c^=r<<2,r=65535&(u>>>-16^c),c^=r,u^=r<<-16,r=1431655765&(c>>>1^u),u^=r,c^=r<<1,r=16711935&(u>>>8^c),c^=r,u^=r<<8,r=1431655765&(c>>>1^u),u^=r,c^=r<<1,r=c<<8|u>>>20&240,c=u<<24|u<<8&16711680|u>>>8&65280|u>>>24&240,u=r;for(var p=0;p<s.length;p++)s[p]?(c=c<<2|c>>>26,u=u<<2|u>>>26):(c=c<<1|c>>>27,u=u<<1|u>>>27),c&=-15,u&=-15,e=pc2bytes0[c>>>28]|pc2bytes1[c>>>24&15]|pc2bytes2[c>>>20&15]|pc2bytes3[c>>>16&15]|pc2bytes4[c>>>12&15]|pc2bytes5[c>>>8&15]|pc2bytes6[c>>>4&15],i=pc2bytes7[u>>>28]|pc2bytes8[u>>>24&15]|pc2bytes9[u>>>20&15]|pc2bytes10[u>>>16&15]|pc2bytes11[u>>>12&15]|pc2bytes12[u>>>8&15]|pc2bytes13[u>>>4&15],r=65535&(i>>>16^e),o[h++]=e^r,o[h++]=i^r<<16}return o}},Phaser.Game.prototype.update=function(t){var e=Date.now();this._qc.update(t),this._qc.debug.total+=Date.now()-e};var phaser_setUpRenderer=Phaser.Game.prototype.setUpRenderer;Phaser.Game.prototype.setUpRenderer=function(){!this.device.webGL||this.device.desktop||this.device.iOS||qc.isSupportWebGL&&!qc.isSupportWebGL(this._qc)&&(this.device.webGL=!1),phaser_setUpRenderer.call(this)},Phaser.Group.prototype.preUpdate=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.preUpdate(),!this.visible))return}}for(var n=this.children,i=n.length;i--;)n[i]&&(n[i].visible?n[i].preUpdate():n[i].renderOrderID=-1);return!0},Phaser.Group.prototype.update=function(){var t=this._qc;if(t&&t.static)return!0;if(t){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.update(),!this.visible))return}}for(var n=this.children,i=n.length;i--;)n[i]&&n[i].visible&&n[i].update()},Phaser.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(!t||!t.static){if(t){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.postUpdate(),!this.visible))return}}for(var n=this.children,i=n.length;i--;)n[i]&&n[i].visible&&n[i].postUpdate()}},Phaser.StateManager.prototype.loadComplete=function(){var t=this;if(t._created!==!0){var e=t.game._qc;return e.assets.parsing||e.state.pendLoadComplete?(e.timer.add(15,function(){t.loadComplete()}),undefined):(t._created===!1&&t.onCreateCallback?(t._created=!0,t.onCreateCallback.call(t.callbackContext,t.game)):t._created=!0,undefined)}};var oldClearCurrentState=Phaser.StateManager.prototype.clearCurrentState;Phaser.StateManager.prototype.clearCurrentState=function(){oldClearCurrentState.call(this),this.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)};var oldDeviceInitialize=Phaser.Device._initialize;Phaser.Device._initialize=function(){oldDeviceInitialize.call(this);var t=window.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(t),this.iOS&&(navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10));var e=/AppleWebKit\/([0-9\.]+)/,i=e.exec(navigator.userAgent);i&&i.length>0?(this.AppleWebKit=!0,this.AppleWebKitVersion=i[1].split(".")):this.AppleWebKit=!1,this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534,this.android&&this.UCBrowser&&(qc.__IS_ANDROID_UC=!0)},/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
Phaser.Animation=function(t,e,i,r,n,o,s){undefined===s&&(s=!1),this.game=t,this._parent=e,this._frameData=r,this.name=i,this._frames=[],this._frames=this._frames.concat(n),this.delay=1e3/o,this.loop=s,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.onStart=new Phaser.Signal,this.onUpdate=null,this.onComplete=new Phaser.Signal,this.onLoop=new Phaser.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},Phaser.Animation.prototype={play:function(t,e,i){return"number"==typeof t&&(this.delay=1e3/t),"boolean"==typeof e&&(this.loop=e),undefined!==i&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(t,e){var i;if(undefined===e&&(e=!1),"string"==typeof t)for(var r=0;r<this._frames.length;r++)this._frameData&&this._frameData.getFrame(this._frames[r]).name===t&&(i=r);else if("number"==typeof t)if(e)i=t;else for(var r=0;r<this._frames.length;r++)this._frames[r]===i&&(i=r);i&&(this._frameIndex=i-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(t,e){undefined===t&&(t=!1),undefined===e&&(e=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,t&&(this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0,this._parent.setFrame(this.currentFrame)),e&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay,this._frameSkip+=1),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex<this._frames.length?this.updateCurrentFrame(!0):this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1)):!1},updateCurrentFrame:function(t){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&t?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(t){undefined===t&&(t=1);var e=this._frameIndex+t;e<this._frames.length||(this.loop?e%=this._frames.length:e=this._frames.length-1),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},previous:function(t){undefined===t&&(t=1);var e=this._frameIndex-t;0>e&&(this.loop?e=this._frames.length+e:e++),e!==this._frameIndex&&(this._frameIndex=e,this.updateCurrentFrame(!0))},updateFrameData:function(t){this._frameData=t,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){this.game&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},Phaser.Animation.prototype.constructor=Phaser.Animation,Object.defineProperty(Phaser.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(t){this.isPaused=t,t?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(Phaser.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(Phaser.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(t){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[t]):t,null!==this.currentFrame&&(this._frameIndex=t,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(Phaser.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(t){1>t||(this.delay=1e3/t)}}),Object.defineProperty(Phaser.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(t){t&&null===this.onUpdate?this.onUpdate=new Phaser.Signal:t||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),Phaser.Animation.generateFrameNames=function(t,e,i,r,n){undefined===r&&(r="");var o=[],s="";if(i>e)for(var a=e;i>=a;a++)s="number"==typeof n?Phaser.Utils.pad(""+a,n,"0",1):""+a,s=t+s+r,o.push(s);else for(var a=e;a>=i;a--)s="number"==typeof n?Phaser.Utils.pad(""+a,n,"0",1):""+a,s=t+s+r,o.push(s);return o},/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2015 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
Phaser.AnimationManager=function(t){this.sprite=t,this.game=t.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},Phaser.AnimationManager.prototype={loadFrameData:function(t,e){if(undefined===t)return!1;if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(t);return this._frameData=t,undefined===e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},copyFrameData:function(t,e){if(this._frameData=t.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return undefined===e||null===e?this.frame=0:"string"==typeof e?this.frameName=e:this.frame=e,this.isLoaded=!0,!0},add:function(t,e,i,r,n){if(e=e||[],i=i||60,undefined===r&&(r=!1),undefined===n&&(n=e&&"number"==typeof e[0]?!0:!1),this._outputFrames.length=0,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION)this._frameData.getFrameIndexes(e,n,this._outputFrames),this._anims[t]=new Phaser.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,i,r);else{for(var o=this.sprite._qc._animation[t].last,s=Array(o),a=0,h=o;h>a;a++)s[a]=a;this._anims[t]=new Phaser.Animation(this.game,this.sprite,t,null,s,i,r)}return this.currentAnim=this._anims[t],this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(t,e){undefined===e&&(e=!0);for(var i=0;i<t.length;i++)if(e===!0){if(t[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(t[i])===!1)return!1;return!0},play:function(t,e,i,r){if(this._anims[t]){var n=this.currentAnim;return n===this._anims[t]?n.isPlaying===!1?(n.paused=!1,n.play(e,i,r)):("number"==typeof e&&n.delay!==1e3/e&&(n.delay=1e3/e,n._timeNextFrame=n._timeLastFrame+n.delay),"boolean"==typeof i&&(n.loop=i),undefined!==r&&(n.killOnComplete=r),n):(n&&n.isPlaying&&n.stop(),n=this._anims[t],n.paused=!1,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=n.currentFrame),n.play(e,i,r))}},stop:function(t,e){undefined===e&&(e=!1),"string"==typeof t?this._anims[t]&&(this.currentAnim=this._anims[t],this.currentAnim.stop(e)):this.currentAnim&&this.currentAnim.stop(e)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),!0):!1},next:function(t){this.currentAnim&&(this.currentAnim.next(t),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},previous:function(t){this.currentAnim&&(this.currentAnim.previous(t),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},getAnimation:function(t){return"string"==typeof t&&this._anims[t]?this._anims[t]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var t=null;for(var t in this._anims)this._anims.hasOwnProperty(t)&&this._anims[t].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},Phaser.AnimationManager.prototype.constructor=Phaser.AnimationManager,Object.defineProperty(Phaser.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(Phaser.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(t){this.currentAnim.paused=t}}),Object.defineProperty(Phaser.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:undefined}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:undefined},set:function(t){"number"==typeof t&&this._frameData&&null!==this._frameData.getFrame(t)&&(this.currentFrame=this._frameData.getFrame(t),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:undefined},set:function(t){"string"==typeof t&&null!==this._frameData.getFrameByName(t)?(this.currentFrame=this._frameData.getFrameByName(t),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+t)}}),qc.BATCH_QUAD=0,qc.BATCH_TRIANGLES=1;var oldWebGLSpriteBatchSetContext=PIXI.WebGLSpriteBatch.prototype.setContext;PIXI.WebGLSpriteBatch.prototype.setContext=function(t){oldWebGLSpriteBatchSetContext.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(e);for(var i=0;e>i;++i)this.triangleIndices[i]=i;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var oldWebGLSpriteBatchDestroy=PIXI.WebGLSpriteBatch.prototype.destroy;PIXI.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLSpriteBatch.prototype.renderBatch=function(t,e,i){if(0!==e){var r=this.gl;t._dirty[r.id]?this.renderSession.renderer.updateTexture(t):r.bindTexture(r.TEXTURE_2D,t._glTextures[r.id]),r.drawElements(r.TRIANGLES,e*this.batchIndexNumber,r.UNSIGNED_SHORT,i*this.batchIndexNumber*2),this.renderSession.drawCount++}},PIXI.CanvasMaskManager.prototype.popMask=function(t){if(t.context.restore(),qc.__IS_ANDROID_UC){var e=qc._tempCanvas;e||(e=qc._tempCanvas=document.createElement("canvas"),e.width=128,e.height=128),t.context.drawImage(e,0,0,2,2,-5,-5,1,1)}},PIXI.CanvasTinter.getTintedTexture=function(t,e){var i=t.tintedTexture||document.createElement("canvas");return PIXI.CanvasTinter.tintMethod(t.texture,e,i),i};var DisplayChangeStatus=qc.DisplayChangeStatus={OFFSET:1,SCALE:2,ROTATION:4,SIZE:8,TINT:16,ALPHA:32,SHOW:64,HIDE:128,TEXTURE:256,ORDER:512};DisplayChangeStatus.VISIBLE_MASK=DisplayChangeStatus.SHOW|DisplayChangeStatus.HIDE,DisplayChangeStatus.INHERIT_MASK=DisplayChangeStatus.SIZE|DisplayChangeStatus.ORDER|DisplayChangeStatus.OFFSET|DisplayChangeStatus.SCALE|DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK,DisplayChangeStatus.RECALC_MASK=DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK|DisplayChangeStatus.SIZE|DisplayChangeStatus.SCALE,DisplayChangeStatus.REOFFSET_MASK=DisplayChangeStatus.OFFSET;var oldDestroy=PIXI.DisplayObject.prototype.destroy;PIXI.DisplayObject.prototype.destroy=function(){this.maybeOutWorld(),oldDestroy.call(this)},PIXI.DisplayObject.prototype.setDisplayProxy=function(t,e){this._displayProxy=t,this._skipChildren=e},PIXI.DisplayObject.prototype.getDisplayProxy=function(){return this._displayProxy},PIXI.DisplayObject.prototype.isSkipChildrenRender=function(){return this._skipChildren},PIXI.DisplayObject.prototype.maybeOutWorld=function(){this.game?this.game._qc&&this.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds):this.stage&&this.stage.game._qc&&this.stage.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds)},PIXI.DisplayObject.prototype.displayChanged=function(t){if(0!==t&&null!=t){var e=this;if(null==e._displayChangeStatus&&(e._displayChangeStatus=DisplayChangeStatus.SHOW),e._displayChangeStatus|=t,t&DisplayChangeStatus.HIDE){this.displayObjectUpdateTransform();for(var i=0,r=this.children.length;r>i;++i)this.children[i].updateTransform()}else t&DisplayChangeStatus.SHOW&&(e._displayChangeStatus&=~DisplayChangeStatus.HIDE);for(var n=e;(n=n.parent)&&!n._subDisplayChanged;)n._subDisplayChanged=!0}},PIXI.DisplayObject.prototype._fastCalcBounds=function(t,e){var i=this,r=i.getSelfWidth&&i.getSelfWidth(),n=i.getSelfHeight&&i.getSelfHeight();if(e&DisplayChangeStatus.HIDE||!i.worldAlpha||!i.worldVisible||!r||!n)return null;var o=i.worldTransform,s=o.a,a=o.b,h=o.c,l=o.d,c=o.tx,u=o.ty;if(!t||e&DisplayChangeStatus.RECALC_MASK){var p,d=i.anchor?i.anchor.x:0,f=i.anchor?i.anchor.y:0,g=r*-d,m=n*-f,_=g+r,y=m+n;0>r&&(p=g,g=_,_=p),0>n&&(p=m,m=y,y=p);var v,T,x,S;if(0===a&&0===h)0>s?(v=s*_+c,T=s*g+c):(v=s*g+c,T=s*_+c),0>l?(x=l*y+u,S=l*m+u):(x=l*m+u,S=l*y+u);else{var b,w,A,E,C,P,I,O;0>s?(b=s*_,w=s*g):(b=s*g,w=s*_),0>a?(A=a*_,E=a*g):(A=a*g,E=a*_),0>h?(C=h*y,P=h*m):(C=h*m,P=h*y),0>l?(I=l*y,O=l*m):(I=l*m,O=l*y),v=b+C+c,T=w+P+c,x=A+I+u,S=E+O+u}return{x:v,y:x,width:T-v,height:S-x,tx:c,ty:u,area:(T-v)*(S-x)}}if(e&DisplayChangeStatus.REOFFSET_MASK){{c-t.tx,u-t.ty}return{x:t.x+c-t.tx,y:t.y+u-t.ty,width:t.width,height:t.height,tx:c,ty:u,area:t.area}}return{x:t.x,y:t.y,tx:t.tx,ty:t.ty,width:t.width,height:t.height,area:t.area}},PIXI.DisplayObject.prototype._updateBounds=function(t){var e=this,i=(e.worldTransform,e.parent),r=i?i._displayChangeStatus:0;(null==e._displayChangeStatus||t)&&(e._displayChangeStatus=DisplayChangeStatus.SHOW);var n=e._displayChangeStatus;if(n|=r&DisplayChangeStatus.INHERIT_MASK,!(e.worldVisible||n&DisplayChangeStatus.HIDE))return!0;if(0===n)return!1;e._lastWorldBounds||(e._lastWorldBounds=[]);var o=e._qc&&e._qc.animationType===qc.Sprite.FRAME_SAMPLES,s=e._currWorldBounds;if(e._currWorldBounds&&e._lastWorldBounds.push(e._currWorldBounds),e._displayChangeStatus=n,o){var a=e._qc.getSampledAnimationBounds(),h=e.worldTransform.apply(new qc.Point(a.x,a.y)),l=e.worldTransform.apply(new qc.Point(a.x+a.width,a.y)),c=e.worldTransform.apply(new qc.Point(a.x+a.width,a.y+a.height)),u=e.worldTransform.apply(new qc.Point(a.x,a.y+a.height)),p=Math.min(h.x,l.x,c.x,u.x),d=Math.max(h.x,l.x,c.x,u.x),f=Math.min(h.y,l.y,c.y,u.y),g=Math.max(h.y,l.y,c.y,u.y);e._currWorldBounds={x:p,y:f,width:d-p,height:g-f,area:(d-p)*(g-f)}}else e._currWorldBounds=e._fastCalcBounds(e._lastWorldBounds[e._lastWorldBounds.length-1],n);return e._dirtyBounds=s!==e._currWorldBounds,!1},PIXI.DisplayObject.prototype._resetDisplayChangeStatus=function(){var t=this;t._displayChangeStatus=0},PIXI.DisplayObject.prototype.updateTransform=function(){var t=this.parent;if(t)if(this.worldAlpha=this.alpha*this.parent.worldAlpha,this._lastWorldAlpha!==this.worldAlpha&&(this._lastWorldAlpha=this.worldAlpha,this.displayChanged(DisplayChangeStatus.ALPHA)),!this._isNotNeedCalcTransform||t._isSubNeedCalcTransform){this.game&&this.game._calcTransformCount++;var e,i,r,n,o,s,a=this.parent.worldTransform,h=this.worldTransform;h.inUpdate=!0,this.rotation%PIXI.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),e=this._cr*this.scale.x,i=this._sr*this.scale.x,r=-this._sr*this.scale.y,n=this._cr*this.scale.y,o=this.position.x,s=this.position.y,(this.pivot.x||this.pivot.y)&&(o-=this.pivot.x*e+this.pivot.y*r,s-=this.pivot.x*i+this.pivot.y*n),h.a=e*a.a+i*a.c,h.b=e*a.b+i*a.d,h.c=r*a.a+n*a.c,h.d=r*a.b+n*a.d,h.tx=o*a.a+s*a.c+a.tx,h.ty=o*a.b+s*a.d+a.ty):(e=this.scale.x,n=this.scale.y,o=this.position.x-this.pivot.x*e,s=this.position.y-this.pivot.y*n,h.a=e*a.a,h.b=e*a.b,h.c=n*a.c,h.d=n*a.d,h.tx=o*a.a+s*a.c+a.tx,h.ty=o*a.b+s*a.d+a.ty),this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,this.worldTransformChangedCallback&&this.worldTransformChangedCallback.call(this.worldTransformChangedContext),this.transformCallback&&(h.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,h,a)),this._onTransformChanged&&this._onTransformChanged.dispatch(h,a)}else{this._isSubNeedCalcTransform=!1;var h=this.worldTransform,a=t.worldTransform;this.transformCallback&&(h.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,h,a))}},PIXI.DisplayObject.prototype.displayObjectUpdateTransform=PIXI.DisplayObject.prototype.updateTransform,PIXI.DisplayObject.prototype.getWorldTransform=function(){for(var t=!1,e=this,i=null;e;)e._isNotNeedCalcTransform||(t=!0,i=e),e=e.parent;return t&&i.updateTransform(),this.worldTransform},PIXI.DisplayObjectContainer.prototype._renderWebGL=function(t){if(this.visible&&this.alpha>0){if(this._cacheAsBitmap)return this._renderCachedSprite(t),undefined;var e;this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip);var i=!1;if(this._graphicsFilter||this._mask||this._filters){if(this._graphicsFilter&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);t.spriteBatch.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),t.spriteBatch.start()}else if(this._renderSelfWebGL&&(i=this._renderSelfWebGL(t)),!i)for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},PIXI.DisplayObjectContainer.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(t),undefined;var e=!1;if(this._mask&&t.maskManager.pushMask(this._mask,t),this._renderSelfCanvas&&(e=this._renderSelfCanvas(t)),!e)for(var i=0;i<this.children.length;i++)this.children[i]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}},PIXI.DisplayObjectContainer.prototype.addChildAt=function(t,e){if(0>e||e>this.children.length)throw Error(t+"addChildAt: The index "+e+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("add",[t._qc]),this.stage&&t.setStageReference(this.stage),t},PIXI.DisplayObjectContainer.prototype.swapChildren=function(t,e){if(t!==e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(0>i||0>r)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=e,this.children[r]=t,this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc,e._qc]),t.displayChanged(qc.DisplayChangeStatus.ORDER),e.displayChanged(qc.DisplayChangeStatus.ORDER)}},PIXI.DisplayObjectContainer.prototype.setChildIndex=function(t,e){if(0>e||e>=this.children.length)throw Error("The supplied index is out of bounds");var i=this.getChildIndex(t);this.children.splice(i,1),this.children.splice(e,0,t),this._qc&&this._qc._dispatchChildrenChanged("order",[t._qc]),t.displayChanged(qc.DisplayChangeStatus.ORDER)},PIXI.DisplayObjectContainer.prototype.removeChildAt=function(t){var e=this.getChildAt(t);return e.maybeOutWorld(),this.stage&&e.removeStageReference(),e.parent=undefined,this.children.splice(t,1),this._qc&&this._qc._dispatchChildrenChanged("remove",[e._qc]),e},PIXI.DisplayObjectContainer.prototype.remove=function(t){return this.removeChild(t)},PIXI.DisplayObjectContainer.prototype.removeChildren=function(t,e){var i=t||0,r="number"==typeof e?e:this.children.length,n=r-i;if(n>0&&r>=n){for(var o=this.children.splice(i,n),s=[],a=0;a<o.length;a++){var h=o[a];h.maybeOutWorld(),this.stage&&h.removeStageReference(),h.parent=undefined,h._qc&&s.push(h._qc)}return this._qc&&this._qc._dispatchChildrenChanged("remove",s),o}if(0===n&&0===this.children.length)return this._qc&&this._qc._dispatchChildrenChanged("remove",[]),[];throw Error("removeChildren: Range Error, numeric values are outside the acceptable range")},PIXI.DisplayObjectContainer.prototype.getLocalBounds=function(){var t=this.worldTransform;this._isSubNeedCalcTransform=!0,this.worldTransform=PIXI.identityMatrix;for(var e=0,i=this.children.length;i>e;e++)this.children[e].updateTransform();var r=this.getBounds();return this.worldTransform=t,this._isSubNeedCalcTransform=!0,this._isNotNeedCalcTransform=!1,r},PIXI.DisplayObjectContainer.prototype.displayMaybeOutWorld=PIXI.DisplayObject.prototype.maybeOutWorld,PIXI.DisplayObjectContainer.prototype.maybeOutWorld=function(){this.displayMaybeOutWorld();for(var t=this.children,e=0,i=t.length;i>e;e++)t[e].maybeOutWorld()},PIXI.PixiShader.prototype.init=function(){var t=this.gl,e=PIXI.compileProgram(t,this.vertexSrc||PIXI.PixiShader.defaultVertexSrc,this.fragmentSrc);if(t.useProgram(e),this.uSampler=t.getUniformLocation(e,"uSampler"),this.uSourceSampler=t.getUniformLocation(e,"uSourceSampler"),this.projectionVector=t.getUniformLocation(e,"projectionVector"),this.offsetVector=t.getUniformLocation(e,"offsetVector"),this.dimensions=t.getUniformLocation(e,"dimensions"),this.pixelSize=t.getUniformLocation(e,"pixelSize"),this.aVertexPosition=t.getAttribLocation(e,"aVertexPosition"),this.aTextureCoord=t.getAttribLocation(e,"aTextureCoord"),this.colorAttribute=t.getAttribLocation(e,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.extraAttribute)for(var i in this.extraAttribute){var r=this.extraAttribute[i].name;this[r]=t.getAttribLocation(e,r),this.attributes.push(this[r])}for(var r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(e,r);this.initUniforms(),this.program=e};var oldSpriteSetTexture=PIXI.Sprite.prototype.setTexture;PIXI.Sprite.prototype.setTexture=function(t){oldSpriteSetTexture.call(this,t),this.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE)},PIXI.Sprite.prototype.getSelfWidth=function(){return this._qc?this._qc.width:this.texture&&this.texture.frame&&this.texture.frame.width},PIXI.Sprite.prototype.getSelfHeight=function(){return this._qc?this._qc.height:this.texture&&this.texture.frame&&this.texture.frame.height},PIXI.Sprite.prototype._renderWebGL=function(t){if(this.visible&&this.alpha>0&&this.renderable){var e;if(this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip),this.maskPixel){var i=t.spriteBatch;for(i.flush(),t.filterManager.pushFilter(this.maskPixel),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),t.filterManager.popFilter(),i.start()}else if(this._graphicsFilter||this._mask||this._filters){var i=t.spriteBatch;if(this._graphicsFilter&&(i.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(i.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),t.maskManager.pushMask(this.mask,t),i.start()),this._filters&&this.filterSelf){i.stop();var r=this.texture.baseTexture._glTextures[t.gl.id],n=t.filterManager.buildFilterTexture(t,this._filterBlock,this);i.start();var o=this.texture._uvs;n&&(this.texture.baseTexture._glTextures[t.gl.id]=n.texture),this._renderWebGLImpl(t),i.flush(),n&&(this.texture.baseTexture._glTextures[t.gl.id]=r,t.filterManager.texturePool.push(n),this.texture._uvs=o)}else this._renderWebGLImpl(t);for(e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);i.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),i.start()}else for(this._renderWebGLImpl(t),e=0;e<this.children.length;e++)this.children[e]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},PIXI.WebGLStencilManager.prototype.pushSpriteStencil=function(t,e){var i=this.gl;0===this.stencilStack.length&&(i.enable(i.STENCIL_TEST),i.clear(i.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var r=this.count;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.ALWAYS,0,255),i.stencilOp(i.KEEP,i.KEEP,i.INVERT),this.reverse?(i.stencilFunc(i.EQUAL,r,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)):(i.stencilFunc(i.EQUAL,255-r,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r+1,255):i.stencilFunc(i.EQUAL,255-(r+1),255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),this.count++},PIXI.WebGLStencilManager.prototype.popSpriteStencil=function(t,e){var i=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)i.disable(i.STENCIL_TEST);else{var r=this.count;i.colorMask(!1,!1,!1,!1),this.reverse?(i.stencilFunc(i.EQUAL,r+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR)):(i.stencilFunc(i.EQUAL,255-(r+1),255),i.stencilOp(i.KEEP,i.KEEP,i.INCR)),t._renderWebGLImpl(e),e.spriteBatch.flush(),this.reverse?i.stencilFunc(i.EQUAL,r,255):i.stencilFunc(i.EQUAL,255-r,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},PIXI.Sprite.prototype._renderWebGLImpl=function(t){var e=t.softClipManager,i=t.spriteBatch;if(e&&e.needClip){var r=this.texture,n=r.baseTexture.resolution,o=this.worldTransform,s=r._uvs;if(!s)return;var a,h,l,c,u=o.a/n,p=o.b/n,d=o.c/n,f=o.d/n,g=o.tx,m=o.ty,_=this.anchor.x,y=this.anchor.y;if(r.trim){var v=r.trim;h=v.x-_*v.width,a=h+r.crop.width,c=v.y-y*v.height,l=c+r.crop.height}else a=r.frame.width*(1-_),h=r.frame.width*-_,l=r.frame.height*(1-y),c=r.frame.height*-y;var T=this.tint;T=(T>>16)+(65280&T)+((255&T)<<16)+(255*this.worldAlpha<<24),e.renderSprite(t,this,h,c,a,l,s.x0,s.y0,s.x2,s.y2,u,p,d,f,g,m,T)}else i.render(this)},PIXI.Sprite.prototype._renderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha&&this.renderable!==!1&&this.texture.crop.width>0&&this.texture.crop.height>0){if(this.maskPixel){var e=t.bufferPool||(t.bufferPool=[]),i=t.context,r=i.globalOffX||0,n=i.globalOffY||0,o=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),s=Math.max(r,o.x),a=Math.max(n,o.y),h=Math.min(o.x+o.width,i.canvas.width+r),l=Math.min(o.y+o.height,i.canvas.height+n);o.x=s,o.y=a,o.width=h-s,o.height=l-a;var c=e.pop();c||(c=new PIXI.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),c.context._setTransform=c.context.setTransform,c.context.setTransform=function(t,e,i,r,n,o){this._setTransform(t,e,i,r,n-(this.globalOffX||0),o-(this.globalOffY||0))}),c.resize(o.width*t.resolution,o.height*t.resolution),c.context.clearRect(0,0,o.width*t.resolution,o.height*t.resolution),c.context.globalOffX=o.x*t.resolution+r,c.context.globalOffY=o.y*t.resolution+n,t.context=c.context}if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var u=this.texture.baseTexture.resolution/t.resolution;t.context.globalAlpha=this.worldAlpha,t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var p=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,d=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;t.roundPixels?(t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),p=0|p,d=0|d):t.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),this.maskPixel||(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),t.drawCount++,t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.frame.width/u,this.texture.frame.height/u)):(t.drawCount++,t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.frame.width/u,this.texture.frame.height/u)))}for(var f=0;f<this.children.length;f++)this.children[f]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&this.texture.valid){var g=t.context;g.globalCompositeOperation="destination-in",t.roundPixels?(g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),p=0|p,d=0|d):g.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),t.drawCount++,g.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,p/u,d/u,this.texture.crop.width/u,this.texture.crop.height/u),g.globalCompositeOperation="source-over",t.context=i,t.roundPixels?t.context.setTransform(1,0,0,1,o.x*t.resolution|0,o.y*t.resolution|0):t.context.setTransform(1,0,0,1,o.x*t.resolution,o.y*t.resolution),t.drawCount++,t.context.drawImage(c.canvas,0,0,c.canvas.width,c.canvas.height,0,0,c.canvas.width,c.canvas.height),e.push(c)}}};var oldWebGLFastSpriteBatchSetContext=PIXI.WebGLFastSpriteBatch.prototype.setContext;PIXI.WebGLFastSpriteBatch.prototype.setContext=function(t){oldWebGLFastSpriteBatchSetContext.call(this,t),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var e=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(e);for(var i=0;e>i;++i)this.triangleIndices[i]=i;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.triangleIndices,t.STATIC_DRAW)};var oldWebGLFastSpriteBatchDestroy=PIXI.WebGLFastSpriteBatch.prototype.destroy;PIXI.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLFastSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(t){t!==this._batchType&&(this.stop(),t===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=t,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=t,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var t=this.gl;if(this.currentBaseTexture._glTextures[t.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>.5*this.size)t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);t.bufferSubData(t.ARRAY_BUFFER,0,e)}t.drawElements(t.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},PIXI.WebGLFilterManager.prototype.initShaderBuffers=function(){var t=this.gl;this.vertexBuffer=t.createBuffer(),this.uvBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.indexBuffer=t.createBuffer(),this.vertexArray=new PIXI.Float32Array([0,0,1,0,0,1,1,1]),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertexArray,t.STATIC_DRAW),this.uvArray=new PIXI.Float32Array(8*Filter.MAX_SAMPLE_COUNT),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvArray,t.STATIC_DRAW),this.colorArray=new PIXI.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colorArray,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),t.STATIC_DRAW)},PIXI.WebGLFilterManager.prototype.pushFilter=function(t){var e=this.gl,i=this.renderSession.projection,r=this.renderSession.offset,n=t._filterArea=(t.target.filterArea||t.target.getBounds()).clone();t._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new PIXI.WebGLStencilManager,this.renderSession.stencilManager.setContext(e),e.disable(e.STENCIL_TEST),this.filterStack.push(t);for(var o=t.filterPasses.length,s=0;o--;){var a=t.filterPasses[o];a.padding>s&&(s=a.padding)}n.x-=s,n.y-=s,n.width+=2*s,n.height+=2*s;var h=Math.max(this.offsetX,n.x),l=Math.max(this.offsetY,n.y),c=Math.max(h,Math.min(n.x+n.width,this.width+this.offsetX)),u=Math.max(l,Math.min(n.y+n.height,this.height+this.offsetY));n.x=h,n.y=l,n.width=c-h,n.height=u-l,this.offsetX+=n.x,this.offsetY+=n.y;var p=this.texturePool.pop();p?p.resize(this.width,this.height):p=new PIXI.FilterTexture(this.gl,this.width,this.height),e.bindTexture(e.TEXTURE_2D,p.texture),e.bindFramebuffer(e.FRAMEBUFFER,p.frameBuffer),e.viewport(0,0,n.width,n.height),i.x=n.width/2,i.y=-n.height/2,r.x=-n.x,r.y=-n.y,e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t._glFilterTexture=p},PIXI.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,e=this.filterStack.pop(),i=e._filterArea,r=e._glFilterTexture,n=e._glFilterTexture,o=this.renderSession.projection,s=this.renderSession.offset;if(e.filterPasses.length>1){t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);var a=r,h=this.texturePool.pop();h||(h=new PIXI.FilterTexture(this.gl,this.width,this.height)),h.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND);for(var l=0;l<e.filterPasses.length-1;l++){var c=e.filterPasses[l],u=c.extraAttribute;if(u){t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);for(var p=0;p<u.length;++p){var d=c.uniforms[u[p].texture].value;if(d){var f=d._uvs;this.uvArray[8*(p+1)]=f.x3,this.uvArray[8*(p+1)+1]=f.y3,this.uvArray[8*(p+1)+2]=f.x2,this.uvArray[8*(p+1)+3]=f.y2,this.uvArray[8*(p+1)+4]=f.x0,this.uvArray[8*(p+1)+5]=f.y0,this.uvArray[8*(p+1)+6]=f.x1,this.uvArray[8*(p+1)+7]=f.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray)}t.bindFramebuffer(t.FRAMEBUFFER,h.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,a.texture),this.applyFilterPass(c,i,i.width,i.height,n);var g=a;a=h,g===n?(h=this.texturePool.pop(),h||(h=new PIXI.FilterTexture(this.gl,this.width,this.height))):h=g}t.enable(t.BLEND),r=a,this.texturePool.push(h)}var m=e.filterPasses[e.filterPasses.length-1];
this.offsetX-=i.x,this.offsetY-=i.y;var _=this.width,y=this.height,v=0,T=0,x=this.buffer;if(0===this.filterStack.length)t.colorMask(!0,!0,!0,!0);else{var S=this.filterStack[this.filterStack.length-1];i=S._filterArea,_=i.width,y=i.height,v=i.x,T=i.y,x=S._glFilterTexture.frameBuffer}o.x=_/2,o.y=-y/2,s.x=v,s.y=T,i=e._filterArea;var b=i.x-v,w=i.y-T;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=w+i.height,this.vertexArray[2]=b+i.width,this.vertexArray[3]=w+i.height,this.vertexArray[4]=b,this.vertexArray[5]=w,this.vertexArray[6]=b+i.width,this.vertexArray[7]=w,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=i.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height;var u=m.extraAttribute;if(u)for(var p=0;p<u.length;++p){var d=m.uniforms[u[p].texture].value;if(d){var f=d._uvs;this.uvArray[8*(p+1)]=f.x3,this.uvArray[8*(p+1)+1]=f.y3,this.uvArray[8*(p+1)+2]=f.x2,this.uvArray[8*(p+1)+3]=f.y2,this.uvArray[8*(p+1)+4]=f.x0,this.uvArray[8*(p+1)+5]=f.y0,this.uvArray[8*(p+1)+6]=f.x1,this.uvArray[8*(p+1)+7]=f.y1}}t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),t.viewport(0,0,_*this.renderSession.resolution,y*this.renderSession.resolution),t.bindFramebuffer(t.FRAMEBUFFER,x),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=e._previous_stencil_mgr,e._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.applyFilterPass(m,i,_,y,n),r!==n&&this.texturePool.push(n),this.texturePool.push(r),e._glFilterTexture=null},PIXI.WebGLFilterManager.prototype.buildFilterTexture=function(t,e,i){var r=t.gl,n=r.isEnabled(r.STENCIL_TEST);n&&r.disable(r.STENCIL_TEST);var o=i.texture.baseTexture;o._glTextures[r.id]||t.renderer.updateTexture(o,r);var s=o._glTextures[r.id],a={texture:s},h=new qc.Rectangle(0,0,o.width,o.height),l=i.texture.crop,c=i.texture._uvs,u=this.texturePool.pop();u||(u=new PIXI.FilterTexture(this.gl,h.width,h.height)),u.resize(h.width,h.height),r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.viewport(0,0,h.width,h.height),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.disable(r.BLEND),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=l.x,this.vertexArray[1]=h.height-l.y,this.vertexArray[2]=l.x+l.width,this.vertexArray[3]=h.height-l.y,this.vertexArray[4]=l.x,this.vertexArray[5]=h.height-l.y-l.height,this.vertexArray[6]=l.x+l.width,this.vertexArray[7]=h.height-l.y-l.height,r.bufferSubData(r.ARRAY_BUFFER,0,this.vertexArray);var p=e.filterPasses[0];r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=c.x0,this.uvArray[1]=c.y0,this.uvArray[2]=c.x1,this.uvArray[3]=c.y1,this.uvArray[4]=c.x3,this.uvArray[5]=c.y3,this.uvArray[6]=c.x2,this.uvArray[7]=c.y2;var d=p.extraAttribute;if(d)for(var f=0;f<d.length;++f){var g=p.uniforms[d[f].texture].value;if(g){var c=g._uvs;this.uvArray[8*(f+1)]=c.x0,this.uvArray[8*(f+1)+1]=c.y0,this.uvArray[8*(f+1)+2]=c.x1,this.uvArray[8*(f+1)+3]=c.y1,this.uvArray[8*(f+1)+4]=c.x3,this.uvArray[8*(f+1)+5]=c.y3,this.uvArray[8*(f+1)+6]=c.x2,this.uvArray[8*(f+1)+7]=c.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.texture),this.applyFilterPass(p,new qc.Rectangle(0,0,h.width,h.height),h.width,h.height,a,h.width,h.height);for(var m=null,_=1;_<e.filterPasses.length;_++){var y=m;m=u,u=y,u||(u=this.texturePool.pop(),u||(u=new PIXI.FilterTexture(this.gl,h.width,h.height)),u.resize(h.width,h.height)),r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer),r.bufferSubData(r.ARRAY_BUFFER,0,this._filterSelfUVArray);var p=e.filterPasses[_],d=p.extraAttribute;if(d){r.bindBuffer(r.ARRAY_BUFFER,this.uvBuffer);for(var f=0;f<d.length;++f){var g=p.uniforms[d[f].texture].value;if(g){var c=g._uvs;this.uvArray[8*(f+1)]=c.x0,this.uvArray[8*(f+1)+1]=c.y0,this.uvArray[8*(f+1)+2]=c.x1,this.uvArray[8*(f+1)+3]=c.y1,this.uvArray[8*(f+1)+4]=c.x3,this.uvArray[8*(f+1)+5]=c.y3,this.uvArray[8*(f+1)+6]=c.x2,this.uvArray[8*(f+1)+7]=c.y2}}r.bufferSubData(r.ARRAY_BUFFER,0,this.uvArray)}r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,m.texture),this.applyFilterPass(p,new qc.Rectangle(0,0,h.width,h.height),h.width,h.height,a,h.width,h.height)}return n&&r.enable(r.STENCIL_TEST),r.enable(r.BLEND),r.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),r.bindFramebuffer(r.FRAMEBUFFER,this.buffer),r.colorMask(!0,!0,!0,!0),u},PIXI.WebGLFilterManager.prototype.applyFilterPass=function(t,e,i,r,n,o,s){var a=this.gl,h=t.shaders[a.id];if(h||(h=new PIXI.PixiShader(a),h.fragmentSrc=t.fragmentSrc,t.vertexSrc&&(h.vertexSrc=t.vertexSrc),h.uniforms=t.uniforms,t.extraAttribute&&(h.extraAttribute=t.extraAttribute),h.init(),t.shaders[a.id]=h),this.renderSession.shaderManager.setShader(h),o=isNaN(o)?this.width:o,s=isNaN(s)?this.height:s,a.uniform2f(h.projectionVector,i/2,-r/2),a.uniform2f(h.offsetVector,0,0),h.pixelSize&&a.uniform2f(h.pixelSize,1/o,1/s),t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=o,t.uniforms.dimensions.value[1]=s,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]),h.syncUniforms(),h.uSourceSampler&&n){var l=h.textureCount++;a.activeTexture(a["TEXTURE"+l]),a.bindTexture(a.TEXTURE_2D,n.texture),a.uniform1i(h.uSourceSampler,l)}a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.vertexAttribPointer(h.aVertexPosition,2,a.FLOAT,!1,0,0);var c=t.extraAttribute;if(a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.vertexAttribPointer(h.aTextureCoord,2,a.FLOAT,!1,0,0),c)for(var u=0;u<c.length;++u)a.vertexAttribPointer(h[c[u].name],2,a.FLOAT,!1,0,32*(u+1));a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.vertexAttribPointer(h.colorAttribute,2,a.FLOAT,!1,0,0),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),this.renderSession.drawCount++},PIXI.WebGLMaskManager.prototype.popMask=function(t,e){var i=this.gl;t._webGL[i.id].data.length&&e.stencilManager.popStencil(t,t._webGL[i.id].data[0],e)};var oldTextUpdateTexture=PIXI.Text.prototype.updateTexture;PIXI.Text.prototype.updateTexture=function(){oldTextUpdateTexture.call(this),this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE)},PIXI.Text.prototype.getSelfWidth=function(){return this.texture&&this.texture.frame&&this.texture.frame.width*(this._canvasDownScale?this._canvasDownScale.x:1)},PIXI.Text.prototype.getSelfHeight=function(){return this.texture&&this.texture.frame&&this.texture.frame.height*(this._canvasDownScale?this._canvasDownScale.y:1)},PIXI.Text.prototype._uploadToRenderTexture=function(){var t=this._frameTexture,e=t.baseTexture,i=this.game.renderer;e.source=this.canvas,i.updateTexture(e),this.texture=t,e.resolution=this.resolution,e.scaleMode=PIXI.scaleModes.NEAREST,e.width=t.crop.width=t.frame.width=this.canvas.width,e.height=t.crop.height=t.frame.height=this.canvas.height},Object.defineProperty(Phaser.Text.prototype,"dirty",{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t,this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE))}}),Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width/this.resolution},set:function(t){this.scale.x=t/this.texture.frame.width,this._width=t}}),Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height/this.resolution},set:function(t){this.scale.y=t/this.texture.frame.height,this._height=t}});var textScaleDirtyInterval=200,oldRenderCanvas=PIXI.Sprite.prototype._renderCanvas,oldRenderWebGL=PIXI.Sprite.prototype._renderWebGL,createFunc=function(t){return function(e){var i,r=this._canvasDownScale,n=this._nqc.roundPixels!==!1;if(n&&(i=e.roundPixels,e.roundPixels=!0),r){var o=this.worldTransform,s=o.a,a=o.b,h=o.c,l=o.d,c=r.x,u=r.y;o.a*=c,o.b*=c,o.c*=u,o.d*=u,this.texture.baseTexture.scaleMode=!this.game.antialias||o.a===o.d&&0===o.b&&0===o.c?PIXI.scaleModes.NEAREST:PIXI.scaleModes.LINEAR,t.call(this,e),o.a=s,o.b=a,o.c=h,o.d=l}else t.call(this,e);n&&(e.roundPixels=i)}};PIXI.Text.prototype.getBounds=function(t){this.dirty&&(this.updateText(),this.dirty=!1);var e=this._canvasDownScale,i=this.worldTransform;i.tx=i.tx||0,i.ty=i.ty||0;var r=i.a,n=i.b,o=i.c,s=i.d,a=e.x,h=e.y;i.a*=a,i.b*=a,i.c*=h,i.d*=h;var l=PIXI.Sprite.prototype.getBounds.call(this,t);return i.a=r,i.b=n,i.c=o,i.d=s,l},PIXI.Text.prototype._renderCanvas=function(){return createFunc(oldRenderCanvas)}(),PIXI.Text.prototype._renderWebGL=function(){return createFunc(oldRenderWebGL)}(),Phaser.Text.prototype.updateLine=function(t,e,i,r,n,o,s,a,h,l){for(var c=0;c<t.length;c++){var u=t[c];this.colors[this._charCount]&&(r.fillStyle="defaultColor"===this.colors[this._charCount]?o:this.colors[this._charCount]);var p=r.measureText(u).width;if(this.style.stroke&&n&&(this._clearShadowStyle(r),r.strokeText(u,e,i),this._restoreShadowStyle(r)),this.style.fill)if(h===r.fillStyle&&l){if(r.save(),r.fillStyle="black",r.fillText(u,e,i),r.globalCompositeOperation="source-in",r.fillStyle=h,r.beginPath(),r.rect(e,i-a/2,p,a),r.clip(),r.fillRect(e,i-a/2,p,a),r.restore(),qc.__IS_ANDROID_UC){var d=qc._tempCanvas;d||(d=qc._tempCanvas=document.createElement("canvas"),d.width=128,d.height=128),r.drawImage(d,0,0,2,2,-5,-5,1,1)}}else r.fillText(u,e,i);e+=p,this._charCount++}},Phaser.Text.prototype._clearShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=null)},Phaser.Text.prototype._restoreShadowStyle=function(t){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(this._shadowOffset?(t.shadowOffsetX=this._shadowOffset[0],t.shadowOffsetY=this._shadowOffset[1]):(t.shadowOffsetX=this.style.shadowOffsetX,t.shadowOffsetY=this.style.shadowOffsetY),t.shadowColor=this.style.shadowColor,t.shadowBlur=this.style.shadowBlur)},Phaser.Text.prototype._getWorldWidth=function(t){if(t.length>0&&"\n"===t[t.length-1]){var e=t.substr(0,t.length-1);return this.context.measureText(e).width}return this.context.measureText(t).width},Phaser.Text.prototype._isLetter=function(t){return("a">t||t>"z")&&("A">t||t>"Z")?!1:!0},Phaser.Text.prototype.runWordWrap=function(t,e){for(var i=e,r=[],n=0,o=!1,s=0;s<t.length;)if("\n"===t[s]){var a=t.substr(n,s-n+1);1===a.length&&r.length>0&&!o?r[r.length-1]+="\n":r.push(a),s++,n=s,o=!0}else{o=!1;for(var h=-1;s<t.length;){var l=t.charAt(s);if(!this._isLetter(l)){0>h||s--;break}-1===h&&(h=s),s++}s===t.length&&s--;var c=this._getWorldWidth(t.substr(n,s-n+1));if(c>i)if(h<0||h!==n)if(h<0)if(s-n===0){var a=t.substr(n,s-n+1);r.push(a),s++,n=s}else{var a=t.substr(n,s-n);r.push(a),n=s}else{var u=h-n,a=t.substr(n,u);r.push(a),s=n+u,n=s}else{var a=t.substr(n,s-n+1);r.push(a),s++,n=s}else if(s++,s===t.length){var a=t.substr(n,s-n+1);r.push(a)}}return r},Phaser.Text.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.inUpdate=!0,this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._isNotNeedCalcTransform=!1,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;for(var i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Text.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)){if(!this.visible)return;r.preUpdate()}}}},Phaser.BitmapText.prototype._isLetter=Phaser.Text.prototype._isLetter,Phaser.BitmapText.prototype.runWordWrap=Phaser.Text.prototype.runWordWrap,Phaser.BitmapText.prototype._getWorldWidth=function(t){var e=0,i=PIXI.BitmapText.fonts[this.fontName];if(!i||!t)return e;for(var r=this.fontSize/i.size,n=null,o=0;o<t.length;o++){var s=t.charCodeAt(o),a=i.chars[s];a&&(n&&a.kerning[n]&&(e+=a.kerning[n]),e+=a.xAdvance,n=s)}return e*r},PIXI.BitmapText.prototype.updateText=function(){var t=this.text;if(this._nqc){var e=PIXI.BitmapText.fonts[this.fontName];if(e){var i=new PIXI.Point,r=null,n=[],o=0,s=[],a=this.fontSize/e.size,h=[];if(this._nqc.wrap){t=t.replace(/\r/gi,"").replace(/\n/gi,"\n");var h=this.runWordWrap(t,this._nqc.width)}else for(var h=t.split(/(?:\r\n|\r|\n)/),l=0;l<h.length-1;l++)h[l]+="\n";i.x=0,i.y=0;for(var l=0;l<h.length;l++){i.x=0,r=null;for(var c=h[l],u=0;u<c.length;u++){var p=c.charCodeAt(u),d=e.chars[p];d&&(r&&d.kerning[r]&&(i.x+=d.kerning[r]),n.push({texture:d.texture,line:l,charCode:p,position:new PIXI.Point(i.x+d.xOffset,i.y+d.yOffset)}),i.x+=d.xAdvance,r=p)}s.push(i.x),o=Math.max(o,i.x),i.y+=e.lineHeight}var f=[];for(l=0;l<=h.length;l++){var g=0;"right"===this.style.align?g=o-s[l]:"center"===this.style.align&&(g=(o-s[l])/2),f.push(g)}var m=this.children.length,_=n.length,y=this.tint||16777215;this.textWidth=o*a,this.textHeight=e.lineHeight*a;var v=this.textWidth*this.anchor.x,T=this.textHeight*this.anchor.y;for(l=0;_>l;l++){var x=m>l?this.children[l]:this._pool.pop();x?x.setTexture(n[l].texture):x=new PIXI.Sprite(n[l].texture),x.position.x=(n[l].position.x+f[n[l].line])*a-v,x.position.y=Math.floor(n[l].position.y*a-T),x.scale.x=x.scale.y=a,x.tint=y,x.parent||this.addChild(x)}for(;this.children.length>_;){var S=this.getChildAt(this.children.length-1);this._pool.push(S),this.removeChild(S)}this._nqc.textRealWidth=this.textWidth,this._nqc.textRealHeight=this.textHeight,this.realWidth=this.textWidth,this.realHeight=this.textHeight,this._nqc._adjustTextPos(this.textWidth,this.textHeight)}}},Phaser.BitmapText.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.BitmapText.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.postUpdate(),!this.visible))return}}},Phaser.Graphics.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Graphics.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.update(),!this.visible))return}}for(var i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},Phaser.Graphics.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render();var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.postUpdate(),!this.visible))return}}for(var i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},Object.defineProperty(PIXI.Graphics.prototype,"dirty",{get:function(){return this._dirty},set:function(t){t!==this._dirty&&(this._dirty=t,this.displayChanged(qc.DisplayChangeStatus.RECALC_MASK))}}),PIXI.Graphics.prototype._updateBounds=function(){var t=this,e=(t.worldTransform,t.parent),i=e?e._displayChangeStatus:0;null==t._displayChangeStatus&&(t._displayChangeStatus=DisplayChangeStatus.SHOW);var r=t._displayChangeStatus;if(r|=i&DisplayChangeStatus.INHERIT_MASK,!(t.worldVisible||r&DisplayChangeStatus.HIDE))return!0;if(0===r)return!1;t._lastWorldBounds||(t._lastWorldBounds=[]),t._currWorldBounds&&t._lastWorldBounds.push(t._currWorldBounds),t._displayChangeStatus=r,t._currentBounds=null;var n=this.getBounds();return t._currWorldBounds={x:n.x,y:n.y,tx:n.x,ty:n.y,width:n.width,height:n.height,area:n.width*n.height},t._dirtyBounds=!0,!1},Phaser.Sprite.prototype.preUpdate=function(){var t=this._qc;if(t&&!t.static){t.preUpdate&&t.preUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.preUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)){if(!this.visible)return;r.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,t&&(t._isTransformDirty=!0),this.fresh=!1,!1;if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))return this.kill(),!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++,this.animations&&this.animations.update();for(var i=this.children.length;i--;)this.children[i].visible?this.children[i].preUpdate():this.children[i].renderOrderID=-1;return!0},Phaser.Sprite.prototype.update=function(){var t=this._qc;if(t&&!t.static){t.update&&t.update();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.update&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.update(),!this.visible))return}}for(var i=this.children.length;i--;)this.children[i].visible&&this.children[i].update()},Phaser.Sprite.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render(),this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var t=this._qc;if(t&&!t.static){t.postUpdate&&t.postUpdate();for(var e=t.scripts,i=e.length;i--;){var r=e[i];if(r&&r._enable&&r.__hadUpdateOrRender&&r.postUpdate&&(t.game.device.editor!==!0||r.runInEditor===!0)&&(r.postUpdate(),!this.visible))return}}for(var i=this.children.length;i--;)this.children[i].visible&&this.children[i].postUpdate()},Phaser.Tileset.prototype.updateTileData=function(t,e){t-=this.tileMargin,e-=this.tileMargin;var i,r;i=e>this.tileHeight?(e-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1:e/this.tileHeight,r=t>this.tileWidth?(t-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1:t/this.tileWidth,i=Math.floor(i),r=Math.floor(r),(this.rows&&this.rows!==i||this.columns&&this.columns!==r)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=i,this.columns=r,this.total=i*r,this.drawCoords.length=0;for(var n=this.tileMargin,o=this.tileMargin,s=0;s<this.rows;s++){for(var a=0;a<this.columns;a++)this.drawCoords.push(n),this.drawCoords.push(o),n+=this.tileWidth+this.tileSpacing;n=this.tileMargin,o+=this.tileHeight+this.tileSpacing}},Phaser.Cache.prototype.getSound=function(t){return this._sounds[t]?this._sounds[t]:null},Phaser.Loader.prototype.loadAudioTag=function(t){var e=this;if(this.game.sound.touchLocked)t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),this.fileComplete(t);else{t.data=new Audio,t.data.name=t.key;var i=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,Phaser.GAMES[e.game.id].load.fileComplete(t)};t.data.onerror=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};var r=function(){t.data.removeEventListener("canplaythrough",i,!1),t.data.removeEventListener("stalled",r,!1),t.data.onerror=null,e.fileError(t)};t.data.preload="auto",t.data.src=this.transformUrl(t.url,t),t.data.addEventListener("canplaythrough",i,!1),t.data.addEventListener("stalled",r,!1)}},Phaser.Sound.prototype.soundHasUnlocked=function(t){t===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this))},Phaser.Sound.prototype.play=function(t,e,i,r,n){if((undefined===t||t===!1||null===t)&&(t=""),undefined===n&&(n=!0),this.isPlaying&&!this.allowMultiple&&!n&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||n))if(this.usingWebAudio)if(undefined===this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(o){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===t&&Object.keys(this.markers).length>0)return this;if(""!==t){if(this.currentMarker=t,!this.markers[t])return this;this.position=this.markers[t].start,this.volume=this.markers[t].volume,this.loop=this.markers[t].loop,this.duration=this.markers[t].duration,this.durationMS=this.markers[t].durationMS,undefined!==i&&(this.volume=i),undefined!==r&&(this.loop=r),this._tempMarker=t,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else e=e||0,undefined===i&&(i=this._volume),undefined===r&&(r=this.loop),this.position=e,this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=t,this._tempPosition=e,this._tempVolume=i,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&""===t&&(this._sound.loop=!0),this.loop||""!==t||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),undefined===this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===t?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this),0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},Phaser.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var t=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var e=this.duration-this.pausedPosition/1e3;undefined===this._sound.start?this._sound.noteGrainOn(0,t,e):this.loop?this._sound.start(0,t):this._sound.start(0,t,e)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},Phaser.SoundManager.prototype.decode=function(t,e){e=e||null;var i=this.game.cache.getSoundData(t);if(i&&this.game.cache.isSoundDecoded(t)===!1){this.game.cache.updateSound(t,"isDecoding",!0);var r=this;try{var n=this.context.decodeAudioData(i,function(i){r.game.cache&&(i&&r.game.cache.decodedSound(t,i),r.onSoundDecode.dispatch(t,e))},function(){r.game._qc.log.trace("Sound decode failed: {0}",t),r.onSoundDecode.dispatch(t,e)});n&&n.catch&&n.catch(function(){})}catch(o){this.game._qc.log.trace("{0}",o.stack),r.onSoundDecode.dispatch(t,e)}}},Phaser.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,this.noAudio=!0,undefined;if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1,undefined}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),qc.Util.popupError(t.message)}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(t){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",t),qc.Util.popupError(t.message)}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain=undefined===this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},Phaser.SoundManager.prototype.unlock=function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null,this.game.input._qc.mouse.callbackContext=null,this.game.input._qc.mouse.mouseDownCallback=null;else{var t=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=t,this._unlockSource.connect(this.context.destination),undefined===this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},Phaser.SoundManager.prototype.update=function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null);for(var t=0;t<this._sounds.length;t++)this._sounds[t].update();if(this._watching){for(var e=this._watchList.first;e;)this.game.cache.isSoundDecoded(e)&&this._watchList.remove(e),e=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},Phaser.Loader.prototype.transformUrl=function(t){return/^http(s|):\/\//i.test(t)?t:this.baseURL+t},Phaser.Loader.prototype.asyncComplete=function(t,e){undefined===e&&(e=""),t.loaded=!0,t.error=!!e,t.requestObject&&200!==t.requestObject.status&&304!==t.requestObject.status&&(t.error=!0),e&&(t.errorMessage=e,console.warn("Phaser.Loader - "+t.type+"["+t.key+"]: "+e)),this.processLoadQueue()},PIXI.CanvasRenderer.prototype.render=function(t){if(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.drawCount=0,this.renderSession.currentBlendMode=PIXI.blendModes.NORMAL,this.context.globalCompositeOperation=PIXI.blendModesCanvas[PIXI.blendModes.NORMAL],this.dirtyRectangle.enable){if(!this.dirtyRectangle.updateDirtyRegion(this.context,this.resolution,t))return this.context.fillStyle="rgba(0, 0, 0, 0)",this.context.fillRect(0,0,1,1),this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution),undefined}else navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(t),this.dirtyRectangle.enable&&(this.dirtyRectangle.restore(this.context),this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution))},PIXI.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(this.__stage=t);var e=this.gl;e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?e.clearColor(0,0,0,0):e.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1),e.clear(e.COLOR_BUFFER_BIT)),this.renderDisplayObject(t,this.projection)}};var GameObjectFactory=qc.GameObjectFactory=function(t){this.game=t};GameObjectFactory.prototype.constructor=GameObjectFactory,GameObjectFactory.prototype.clone=function(t,e){if(!t)return null;if(t instanceof Prefab){var i=this.game.serializer.restoreBundle(t.json,e);return i._prefab=t.uuid,i}var r={},n=this.game.serializer.buildBundle(t,r);n.dependences=this.game.serializer.combineDependence(r);var i=this.game.serializer.restoreBundle(n,e?e:t.parent);return i},GameObjectFactory.prototype.node=function(t,e){var i=new Node(new Phaser.Group(this.game.phaser,null),t,e);return i.name="node",i},GameObjectFactory.prototype.text=function(t,e){return new UIText(this.game,t,e)},GameObjectFactory.prototype.image=function(t,e){return new UIImage(this.game,t,e)
},GameObjectFactory.prototype.button=function(t,e){return new Button(this.game,t,e)},GameObjectFactory.prototype.toggle=function(t,e){return new Toggle(this.game,t,e)},GameObjectFactory.prototype.sprite=function(t,e){return new Sprite(this.game,t,e)},GameObjectFactory.prototype.sound=function(t,e){return new Sound(this.game,t,e)},GameObjectFactory.prototype.scrollView=function(t,e){return new ScrollView(this.game,t,e)},GameObjectFactory.prototype.scrollBar=function(t,e,i){var r=new ScrollBar(this.game,t,i),n=i!==undefined;if(n)return r;if(r.width=160,r.height=20,r.size=.2,r.direction=qc.ScrollBar.LEFT_TO_RIGHT,e){var o=this.node(r);o.name="slidingArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s,r.interactive=!0}return r},GameObjectFactory.prototype.progressBar=function(t,e,i){var r=new ProgressBar(this.game,t,i),n=i!==undefined;if(n)return r;if(r.width=160,r.height=20,e){var o=this.node(r);o.name="progressArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s}return r},GameObjectFactory.prototype.slider=function(t,e,i){var r=new Slider(this.game,t,i),n=i!==undefined;if(n)return r;if(r.interactive=!0,r.width=160,r.height=20,e){var o=this.node(r);o.name="slidingArea",o.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),o.setStretch(0,0,0,0),o.pivotX=o.pivotY=.5;var s=this.image(o);s.name="sliders",s.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),s.setStretch(0,0,0,0),s.pivotX=s.pivotY=.5,r.sliders=s}return r},GameObjectFactory.prototype.inputField=function(t,e){return new InputField(this.game,t,e)},GameObjectFactory.prototype.dropdown=function(t,e){return new qc.Dropdown(this.game,t,e)},GameObjectFactory.prototype.tilemap=function(t,e){return new Tilemap(this.game,t,e)},GameObjectFactory.prototype.tileLayer=function(t,e){return new TileLayer(this.game,t,e)},GameObjectFactory.prototype.objectLayer=function(t,e){return new ObjectLayer(this.game,t,e)},GameObjectFactory.prototype.dom=function(t,e){return new Dom(this.game,t,e)},GameObjectFactory.prototype.graphics=function(t,e){return new Graphics(this.game,t,e)};var UIImage=qc.UIImage=function(t,e,i){var r=this,n=new Phaser.Sprite(t.phaser);qc.Node.call(r,n,e,i),r._oldUpdateTransformFunc=n.updateTransform,n._renderWebGL=imageRenderWebGL,n._renderCanvas=imageRenderCanvas,r._borderLeft=0,r._borderRight=0,r._borderTop=0,r._borderBottom=0,r._imageType=qc.UIImage.IMAGE_TYPE_SIMPLE,r.name="UIImage"};UIImage.prototype=Object.create(qc.Node.prototype),UIImage.prototype.constructor=UIImage,UIImage.IMAGE_TYPE_SIMPLE=0,UIImage.IMAGE_TYPE_SLICED=1,UIImage.IMAGE_TYPE_TILED=2,Object.defineProperties(UIImage.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(!t)return e._atlas=null,e.phaser.loadTexture(null,e.frame),undefined;if(t instanceof qc.Atlas)t=t.getTexture(this.frame);else if("string"==typeof t){if(!e._atlas)return;if(t=e._atlas.getTexture(t),!t)return}(e._atlas!==t.atlas||e.frame!==t.frame)&&(e._atlas=t.atlas,t.atlas.getFrame(t.frame)||(t.frame=0),e.phaser.key=t.atlas.key,e.frame=t.frame)}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];("string"!=typeof t||-1!==e.indexOf(t))&&(this.phaser.loadTexture(this.texture.atlas.key,t),this.setWidth(this.width),this.setHeight(this.height),this._resetNinePadding(),this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(t){this._imageType!==t&&(this._imageType=t,this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE))}},borderTop:{get:function(){return this._borderTop},set:function(t){this._borderTop=t}},borderBottom:{get:function(){return this._borderBottom},set:function(t){this._borderBottom=t}},borderLeft:{get:function(){return this._borderLeft},set:function(t){this._borderLeft=t}},borderRight:{get:function(){return this._borderRight},set:function(t){this._borderRight=t}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},skewX:{get:function(){return this._skewX},set:function(t){var e=this;e._skewX!==t&&(e._skewX=t,e.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=imageUpdateTransform:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},skewY:{get:function(){return this._skewY},set:function(t){var e=this;e._skewY!==t&&(e._skewY=t,e.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),e._isTransformDirty=!0,e._skewX||e._skewY?this.phaser.updateTransform=imageUpdateTransform:e.phaser.updateTransform=e._oldUpdateTransformFunc)}},"class":{get:function(){return"qc.UIImage"}}}),UIImage.prototype.resetNativeSize=function(){this.parent?(this.width=this.nativeSize.width,this.height=this.nativeSize.height):(this.setWidth(this.nativeSize.width),this.setHeight(this.nativeSize.width))},UIImage.prototype.setWidth=function(t){Node.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype.setHeight=function(t){Node.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype._resetNinePadding=function(){if(this.texture){var t=this.texture.padding;this._borderLeft=t[0],this._borderTop=t[1],this._borderRight=t[2],this._borderBottom=t[3]}},UIImage.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.imageType=t.NUMBER,e.skewX=t.NUMBER,e.skewY=t.NUMBER,e};var imageRenderWebGL=function(t){var e=this._qc;if(e.imageType===qc.UIImage.IMAGE_TYPE_SIMPLE)return Phaser.Sprite.prototype._renderWebGL.call(this,t);if(this.visible&&this.alpha>0&&this.renderable){var i;if(this.softClip&&SoftClipManager.getManager(t).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){var r=t.spriteBatch;for(this._graphicsFilter&&(r.flush(),t.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),t.maskManager.pushMask(this.mask,t),r.start()),this._filters&&this.filterSelf&&(r.flush(),t.filterManager.pushFilter(this._filterBlock)),imageFillVBO(r,this),this._filters&&this.filterSelf&&(r.stop(),t.filterManager.popFilter(),r.start()),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);r.stop(),this._mask&&t.maskManager.popMask(this._mask,t),this._filters&&!this.filterSelf&&t.filterManager.popFilter(),this._graphicsFilter&&t.filterManager.popFilter(),r.start()}else for(imageFillVBO(t.spriteBatch,this),i=0;i<this.children.length;i++)this.children[i]._renderWebGL(t);this.softClip&&SoftClipManager.getManager(t).popPolygon()}},generateSlicedSprite=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,o,s,a,h=e._qc,l=h.borderLeft,c=h.borderRight,u=h.borderTop,p=h.borderBottom,d=e.anchor.x,f=e.anchor.y;if(i.trim){var g=i.trim;o=g.x-d*g.width,n=o+i.crop.width,a=g.y-f*g.height,s=a+i.crop.height}else n=i.frame.width*(1-d),o=i.frame.width*-d,s=i.frame.height*(1-f),a=i.frame.height*-f;var m=i.baseTexture.width,_=i.baseTexture.height,y=[new Phaser.Point(r.x0,r.y0),new Phaser.Point(r.x0+l/m,r.y0+u/_),new Phaser.Point(r.x2-c/m,r.y2-p/_),new Phaser.Point(r.x2,r.y2)],v=Math.abs(n-o),T=Math.abs(s-a);l+c>v&&(l=v*l/(l+c),c=v-l),o>n&&(l=-l,c=-c),u+p>T&&(u=T*u/(u+p),p=T-u),a>s&&(u=-u,p=-p);var x=[new Phaser.Point(o,a),new Phaser.Point(o+l,a+u),new Phaser.Point(n-c,s-p),new Phaser.Point(n,s)],S=e.tint;S=(S>>16)+(65280&S)+((255&S)<<16)+(255*e.worldAlpha<<24);for(var b=i.baseTexture.resolution,w=e.worldTransform,A=w.a/b,E=w.b/b,C=w.c/b,P=w.d/b,I=w.tx,O=w.ty,M=0;3>M;++M)for(var L=M+1,R=0;3>R;++R){var D=R+1;webGLAddQuad(t,e,x[M].x,x[R].y,x[L].x,x[D].y,y[M].x,y[R].y,y[L].x,y[D].y,A,E,C,P,I,O,S)}}},webGLAddQuad=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,m){var _=t.renderSession.softClipManager;if(_&&_.needClip)return _.renderSprite(t.renderSession,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,m),undefined;t.currentBatchSize<t.size||(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var y=t.colors,v=t.positions,T=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(v[T]=c*i+p*r+f|0,v[T+1]=d*r+u*i+g|0,v[T+5]=c*n+p*r+f|0,v[T+6]=d*r+u*n+g|0,v[T+10]=c*n+p*o+f|0,v[T+11]=d*o+u*n+g|0,v[T+15]=c*i+p*o+f|0,v[T+16]=d*o+u*i+g|0):(v[T]=c*i+p*r+f,v[T+1]=d*r+u*i+g,v[T+5]=c*n+p*r+f,v[T+6]=d*r+u*n+g,v[T+10]=c*n+p*o+f,v[T+11]=d*o+u*n+g,v[T+15]=c*i+p*o+f,v[T+16]=d*o+u*i+g),v[T+2]=s,v[T+3]=a,v[T+7]=h,v[T+8]=a,v[T+12]=h,v[T+13]=l,v[T+17]=s,v[T+18]=l,y[T+4]=y[T+9]=y[T+14]=y[T+19]=m,t.sprites[t.currentBatchSize++]=e},generateTiledSprite=function(t,e){var i=e.texture,r=i._uvs;if(r){var n,o,s,a,h=e._qc,l=h.borderLeft,c=h.borderRight,u=h.borderTop,p=h.borderBottom,d=e.anchor.x,f=e.anchor.y;if(i.trim){var g=i.trim;o=g.x-d*g.width,n=o+i.crop.width,a=g.y-f*g.height,s=a+i.crop.height}else n=i.frame.width*(1-d),o=i.frame.width*-d,s=i.frame.height*(1-f),a=i.frame.height*-f;var m=i.baseTexture.width,_=i.baseTexture.height,y=[new Phaser.Point(r.x0,r.y0),new Phaser.Point(r.x0+l/m,r.y0+u/_),new Phaser.Point(r.x2-c/m,r.y2-p/_),new Phaser.Point(r.x2,r.y2)],v=r.x0+l/m,T=r.y0+u/_,x=r.x2-c/m,S=r.y2-p/_,b=Math.abs(n-o),w=Math.abs(s-a);l+c>b&&(l=b*l/(l+c),c=b-l),o>n&&(l=-l,c=-c),u+p>w&&(u=w*u/(u+p),p=w-u),a>s&&(u=-u,p=-p);var A=n-c,E=s-p,C=o+l,P=a+u,I=[new Phaser.Point(o,a),new Phaser.Point(C,P),new Phaser.Point(A,E),new Phaser.Point(n,s)],O=e.tint;O=(O>>16)+(65280&O)+((255&O)<<16)+(255*e.worldAlpha<<24);var M=i.baseTexture.resolution,L=e.worldTransform,R=L.a/M,D=L.b/M,N=L.c/M,q=L.d/M,B=L.tx,k=L.ty,F=(r.x2-r.x0)*m-l-c,U=(r.y2-r.y0)*_-u-p;b-l-c>32*F&&(F=(b-l-c)/32),w-u-p>32*U&&(U=(w-u-p)/32);var z=x,G=S;if(F>0&&U>0)for(var W=P;E>W;W+=U){var j=W+U;j>E&&(G=T+(S-T)*(E-W)/(j-W),j=E),z=x;for(var X=C;A>X;X+=F){var V=X+F;V>A&&(z=v+(x-v)*(A-X)/(V-X),V=A),webGLAddQuad(t,e,X,W,V,j,v,T,z,G,R,D,N,q,B,k,O)}}if(z=x,G=S,U)for(var W=P;E>W;W+=U){var j=W+U;j>E&&(G=T+(S-T)*(E-W)/(j-W),j=E),webGLAddQuad(t,e,o,W,C,j,r.x0,T,v,G,R,D,N,q,B,k,O),webGLAddQuad(t,e,A,W,n,j,x,T,r.x2,G,R,D,N,q,B,k,O)}if(z=x,G=S,F)for(var X=C;A>X;X+=F){var V=X+F;V>A&&(z=v+(x-v)*(A-X)/(V-X),V=A),webGLAddQuad(t,e,X,a,V,P,v,r.y0,z,T,R,D,N,q,B,k,O),webGLAddQuad(t,e,X,E,V,s,v,S,z,r.y2,R,D,N,q,B,k,O)}webGLAddQuad(t,e,I[0].x,I[0].y,I[1].x,I[1].y,y[0].x,y[0].y,y[1].x,y[1].y,R,D,N,q,B,k,O),webGLAddQuad(t,e,I[2].x,I[0].y,I[3].x,I[1].y,y[2].x,y[0].y,y[3].x,y[1].y,R,D,N,q,B,k,O),webGLAddQuad(t,e,I[2].x,I[2].y,I[3].x,I[3].y,y[2].x,y[2].y,y[3].x,y[3].y,R,D,N,q,B,k,O),webGLAddQuad(t,e,I[0].x,I[2].y,I[1].x,I[3].y,y[0].x,y[2].y,y[1].x,y[3].y,R,D,N,q,B,k,O)}},imageRenderCanvas=function(t){if(this.visible!==!1&&0!==this.alpha&&this.renderable!==!1&&this.texture.crop.width>0&&this.texture.crop.height>0){var e=this.texture.valid,i=this._qc,r=i.imageType;if(this.maskPixel&&e&&r===qc.UIImage.IMAGE_TYPE_SIMPLE){var n=t.bufferPool||(t.bufferPool=[]),o=t.context,s=o.globalOffX||0,a=o.globalOffY||0,h=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),l=Math.max(s,h.x),c=Math.max(a,h.y),u=Math.min(h.x+h.width,o.canvas.width+s),p=Math.min(h.y+h.height,o.canvas.height+a);h.x=l,h.y=c,h.width=u-l,h.height=p-c;var d=n.pop();d||(d=new PIXI.CanvasBuffer(t.context.canvas.width*t.resolution,t.context.canvas.height*t.resolution),d.context._setTransform=d.context.setTransform,d.context.setTransform=function(t,e,i,r,n,o){this._setTransform(t,e,i,r,n-(this.globalOffX||0),o-(this.globalOffY||0))}),d.resize(h.width*t.resolution,h.height*t.resolution),d.context.clearRect(0,0,h.width*t.resolution,h.height*t.resolution),d.context.globalOffX=h.x*t.resolution+s,d.context.globalOffY=h.y*t.resolution+a,t.context=d.context}var f=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,f.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),e){var g=this.texture.baseTexture.resolution/t.resolution;f.globalAlpha=this.worldAlpha,!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&f[t.smoothProperty]===(t.scaleMode===PIXI.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,f[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);var m=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,_=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,y=this.texture.trim?this.texture.crop.width:this.texture.frame.width,v=this.texture.trim?this.texture.crop.height:this.texture.frame.height;t.roundPixels?(f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),m=0|m,_=0|_):f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution);var T,x,S,b,w,A=function(e,i,r,n,o,s,a,h,l,c){l&&c&&(t.drawCount++,e.drawImage(i,r,n,o||1,s||1,a,h,l,c))};if(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),T=this.tintedTexture,x=0,S=0,b=this.texture.crop.width,w=this.texture.crop.height):(T=this.texture.baseTexture.source,x=this.texture.crop.x,S=this.texture.crop.y,b=this.texture.crop.width,w=this.texture.crop.height),m=Math.round(m/g),_=Math.round(_/g),y=Math.round(y/g),v=Math.round(v/g),r===qc.UIImage.IMAGE_TYPE_SIMPLE)this.maskPixel||A(f,T,x,S,b,w,m,_,y,v);else if(i.texture&&y&&v){var E=""+i.texture.atlas.uuid+r+i.frame+this.tint+y+v,C=qc.CanvasPool.get(E),P=C.canvas;if(C.dirty){var I=P.getContext("2d");t.smoothProperty&&I[t.smoothProperty]!==(t.scaleMode===PIXI.scaleModes.LINEAR)&&(I[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR),P.width=y,P.height=v,I.clearRect(0,0,y,v);var O=i.borderLeft,M=i.borderRight,L=i.borderTop,R=i.borderBottom,D=[new Phaser.Point(x,S),new Phaser.Point(x+O,S+L),new Phaser.Point(x+b-M,S+w-R),new Phaser.Point(x+b,S+w)];O/=g,L/=g,M/=g,R/=g,O+M>y&&(O=y*O/(O+M),M=y-O),L+R>v&&(L=v*L/(L+R),R=v-L);var N=[new Phaser.Point(0,0),new Phaser.Point(O,L),new Phaser.Point(y-M,v-R),new Phaser.Point(y,v)];if(r==qc.UIImage.IMAGE_TYPE_SLICED)for(var q=0;3>q;++q)for(var B=q+1,k=0;3>k;++k){var F=k+1,U=D[q].x,z=D[k].y,G=D[B].x,W=D[F].y,j=N[q].x,X=N[k].y,V=N[B].x,Y=N[F].y;G-U>0&&W-z>0&&V-j>0&&Y-X>0&&A(I,T,U,z,G-U,W-z,j,X,V-j,Y-X)}else{var K=D[1].x,H=D[1].y,J=D[2].x,Z=D[2].y,Q=y-M,$=v-R,te=O,ee=L,ie=b/g-O-M,re=w/g-L-R;y-O-M>32*ie&&(ie=(y-O-M)/32),v-L-R>32*re&&(re=(v-L-R)/32);var ne=J,oe=Z;if(ie>0&&re>0)for(var se=ee;$>se;se+=re){var F=se+re;F>$&&(oe=H+(Z-H)*($-se)/(F-se),F=$),ne=J;for(var ae=te;Q>ae;ae+=ie){var B=ae+ie;B>Q&&(ne=K+(J-K)*(Q-ae)/(B-ae),B=Q),ne-K>0&&oe-H>0&&B-ae>0&&F-se>0&&A(I,T,K,H,ne-K,oe-H,ae,se,B-ae,F-se)}}if(oe=Z,re)for(var se=ee;$>se;se+=re){var F=se+re;F>$&&(oe=H+(Z-H)*($-se)/(F-se),F=$),A(I,T,x,H,K-x,oe-H,0,se,O,F-se),A(I,T,J,H,x+b-J,oe-H,Q,se,M,F-se)}if(ne=J,ie)for(var ae=te;Q>ae;ae+=ie){var B=ae+ie;B>Q&&(ne=K+(J-K)*(Q-ae)/(B-ae),B=Q),A(I,T,K,S,ne-K,H-S,ae,0,B-ae,L),A(I,T,K,Z,ne-K,S+w-Z,ae,$,B-ae,R)}A(I,T,D[0].x,D[0].y,D[1].x-D[0].x,D[1].y-D[0].y,N[0].x,N[0].y,N[1].x-N[0].x,N[1].y-N[0].y),A(I,T,D[2].x,D[0].y,D[3].x-D[2].x,D[1].y-D[0].y,N[2].x,N[0].y,N[3].x-N[2].x,N[1].y-N[0].y),A(I,T,D[2].x,D[2].y,D[3].x-D[2].x,D[3].y-D[2].y,N[2].x,N[2].y,N[3].x-N[2].x,N[3].y-N[2].y),A(I,T,D[0].x,D[2].y,D[1].x-D[0].x,D[3].y-D[2].y,N[0].x,N[2].y,N[1].x-N[0].x,N[3].y-N[2].y)}}A(f,P,0,0,y,v,m,_,y,v)}}for(var he=0;he<this.children.length;he++)this.children[he]._renderCanvas(t);if(this._mask&&t.maskManager.popMask(t),this.maskPixel&&e&&r===qc.UIImage.IMAGE_TYPE_SIMPLE){if(f.globalCompositeOperation="destination-in",t.roundPixels?(f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution|0,this.worldTransform.ty*t.resolution|0),m=0|m,_=0|_):f.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*t.resolution,this.worldTransform.ty*t.resolution),A(f,T,x,S,b,w,m,_,y,v),f.globalCompositeOperation="source-over",t.context=o,t.roundPixels?t.context.setTransform(1,0,0,1,h.x*t.resolution|0,h.y*t.resolution|0):t.context.setTransform(1,0,0,1,h.x*t.resolution,h.y*t.resolution),!d.canvas.height||!d.canvas.width)return;t.drawCount++,t.context.drawImage(d.canvas,0,0,d.canvas.width,d.canvas.height,0,0,d.canvas.width,d.canvas.height),n.push(d)}}},imageFillVBO=function(t,e){switch(e._qc.imageType){case UIImage.IMAGE_TYPE_SLICED:generateSlicedSprite(t,e);break;case UIImage.IMAGE_TYPE_TILED:generateTiledSprite(t,e)}},imageUpdateTransform=function(){var t=this,e=t.parent;if(e&&t.visible){if(t.worldAlpha=t.alpha*e.worldAlpha,!t._isNotNeedCalcTransform||e._isSubNeedCalcTransform){t.game&&t.game._calcTransformCount++,t.rotation!==t.rotationCache&&(t.rotationCache=t.rotation,t._sr=Math.sin(t.rotation),t._cr=Math.cos(t.rotation));var i,r,n,o,s,a,h,l,c,u,p,d,f,g,m,_,y,v,T,x,S,b;h=Math.cos(t._qc._skewY||0),l=Math.sin(t._qc._skewY||0),c=-Math.sin(t._qc._skewX||0),u=Math.cos(t._qc._skewX||0),p=t.position.x,d=t.position.y,f=t._cr*t.scale.x,g=t._sr*t.scale.x,m=-t._sr*t.scale.y,_=t._cr*t.scale.y,y=0,v=0,i=f*h+g*c,r=f*l+g*u,n=m*h+_*c,o=m*l+_*u,s=y*h+v*c+p,a=y*l+v*u+d;var w=t.worldTransform,A=e.worldTransform;T=A.a,x=A.b,S=A.c,b=A.d,w.a=i*T+r*S,w.b=i*x+r*b,w.c=n*T+o*S,w.d=n*x+o*b,w.tx=s*T+a*S+A.tx,w.ty=s*x+a*b+A.ty,this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,t.transformCallback&&(w.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,w,A))}else{t._isSubNeedCalcTransform=!1;var w=t.worldTransform,A=e.worldTransform;t.transformCallback&&(w.inUpdate=!1,t.transformCallback.call(t.transformCallbackContext,w,A))}if(!t._cacheAsBitmap)for(var E=0,C=t.children.length;C>E;E++)t.children[E].updateTransform()}},UIRoot=qc.UIRoot=function(t,e){qc.Node.call(this,new Phaser.Group(t.phaser,null),null,e),this.name="UIRoot";var i=e!==undefined;if(!i){var r=this.addScript("qc.ScaleAdapter");r.referenceResolution=new qc.Point(640,960),r.manualType=qc.ScaleAdapter.EXPAND,r.fullTarget=!0}this.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),this.pivotX=0,this.pivotY=0;var n=this.getWorldScale();this.setTransformToWorld(0,0,n.x,n.y,this.getWorldRotation())};UIRoot.prototype=Object.create(qc.Node.prototype),UIRoot.prototype.constructor=UIRoot,Object.defineProperties(UIRoot.prototype,{"class":{get:function(){return"qc.UIRoot"}}}),UIRoot.prototype.postUpdate=function(){this.x=0,this.y=0};var Sprite=qc.Sprite=function(t,e,i){var r=new Phaser.Sprite(t.phaser);qc.Node.call(this,r,e,i),this.name="Sprite",this.animationType=qc.Sprite.NONE_ANIMATION,this._phaserImageSetFrame=r.setFrame,r.setFrame=setFrame,r._renderWebGL=spriteRenderWebGL,r._renderCanvas=spriteRenderCanvas};Sprite.prototype=Object.create(qc.Node.prototype),Sprite.prototype.constructor=Sprite,Sprite.NONE_ANIMATION=0,Sprite.FRAME_ANIMATION=1,Sprite.DRAGON_BONES=2,Sprite.FRAME_SAMPLES=3;var sInterpolationCo=8;Sprite.prototype.playAnimation=function(t,e,i){var r=this,n=r.animationType;if(n!==Sprite.NONE_ANIMATION&&t){if(n===Sprite.DRAGON_BONES){var o=r._armature.animation;if(o.animationNameList.indexOf(t)<0)return console.warn("Animation is not exist.",t),undefined;var s=undefined;if("number"==typeof e&&1!=e&&e>0){for(var a,h=o.animationNameList.length;h--;)if(o._animationDataList[h].name==t){a=o._animationDataList[h];break}a&&(s=a.duration/e)}var l;return l=i===!0?2097152:i===!1?1:undefined,r.paused=!1,r._armature.animation.gotoAndPlay(t,undefined,s,l),undefined}var a=this._animation[t];if(!a)return r.game.log.error("Animation {0} not exists",t),undefined;var c=a.rate?a.rate:60;if(n===Sprite.FRAME_SAMPLES&&(c*=sInterpolationCo),!r.phaser.animations._anims[t]){r.phaser.animations.add(t,a.frames,c);var o=r.phaser.animations._anims[t];o.onStart.add(function(){r._onStart&&r._onStart.dispatch(r.lastAnimationName)}),o.onComplete.add(function(){r._onFinished&&r._onFinished.dispatch(r.lastAnimationName)}),o.onLoop.add(function(){r._onLoopFinished&&r._onLoopFinished.dispatch(r.lastAnimationName)})}"boolean"!=typeof i&&(i=!!a.loop),this._slowMotion=this.game.time.timeScale,this._speed=(e?e:1)*c,r.phaser.animations.play(t,this._speed/this._slowMotion,i)}},Sprite.prototype.stop=function(){var t=this,e=t.animationType;if(e!==Sprite.NONE_ANIMATION&&t.isPlaying){if(e===Sprite.DRAGON_BONES){var i=t._armature.animation;return i.stop(),undefined}var r=t.phaser.animations.currentAnim;r&&r.stop(undefined,!0)}},Sprite.prototype.update=function(){if(this.animationType===qc.Sprite.FRAME_SAMPLES&&this.isPlaying&&this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this.animationType===qc.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var t=.001*this.game.time.deltaTime;this._armature.advanceTime(t)}else if(this.animationType===qc.Sprite.FRAME_ANIMATION||this.animationType===qc.Sprite.FRAME_SAMPLES){var e=this.game.time.timeScale;if(e===this._slowMotion)return;this._slowMotion=e;var i=this.phaser.animations.currentAnim;i&&(i.speed=this._speed/e)}},Sprite.prototype.bindDragonBonesEvent=function(){var t=this;t._armature.addEventListener("start",function(){t._onStart&&t._onStart.dispatch(t.lastAnimationName)}),t._armature.addEventListener("complete",function(){t._onFinished&&t._onFinished.dispatch(t.lastAnimationName)}),t._armature.addEventListener("loopComplete",function(){t._onLoopFinished&&t._onLoopFinished.dispatch(t.lastAnimationName)})},Sprite.prototype.getAnimationInfo=function(t){var e=this.animationType;if(e!==Sprite.NONE_ANIMATION){if(e===Sprite.DRAGON_BONES){var i=this._armature.animation;if(i.animationNameList.indexOf(t)<0)return;for(var r,n=i.animationNameList.length;n--;)if(i._animationDataList[n].name==t){r=i._animationDataList[n];break}return r}var r=this._animation[t];if(r){var o=r.frames||[],s=r.rate?parseFloat(r.rate):30;return{frames:o,frameRate:s,loop:r.loop?0:1,duration:o.length/s}}}},Object.defineProperties(Sprite.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(t){var e=this;if(e.animationType===Sprite.DRAGON_BONES&&e._boneBase&&(e.removeChild(e._boneBase),e._armature=null,e._boneBase=null),!t)return e._atlas=null,e.phaser.loadTexture(null,e.frame),e.animationType=Sprite.NONE_ANIMATION,undefined;t instanceof qc.Atlas&&(t=new qc.Texture(t,e.frame));var i=e._atlas=t.atlas;if(e.animationType=i.animation?i.animation.type:Sprite.NONE_ANIMATION,e.animationType===Sprite.DRAGON_BONES){var r=e._armature=qc.dragonBones.makeQcArmature(i.animation.data,i.json,i.img,i.key);if(!r)return console.warn("makeQcArmature failed:(img:",i.img,"atlas:",i.json,"skeleton:",i.animation.data,")"),undefined;e._armature=r;var n=r.getDisplay();e.addChild(n),e._boneBase=n,e.colorTint=e.colorTint}else e.animationType===Sprite.FRAME_ANIMATION?(e._animation=i.animation.data.animations,e.phaser.animations=new Phaser.AnimationManager(e.phaser)):e.animationType===Sprite.FRAME_SAMPLES&&(e._animation=i.animation.data.samples,e.phaser.animations=new Phaser.AnimationManager(e.phaser));i.getFrame(t.frame)||(t.frame=0),e.phaser.key=i.key,e.frame=t.frame,e.paused=!1,e.animationType===Sprite.DRAGON_BONES&&e.bindDragonBonesEvent(),e.defaultAnimation&&(!e.animationNameList||e.animationNameList.indexOf(e.defaultAnimation)<0?e.defaultAnimation=null:e.playAnimation(e.defaultAnimation)),e._dispatchLayoutArgumentChanged("size"),e._onTextureChanged&&e._onTextureChanged.dispatch()}},frame:{get:function(){return this.phaser.frameName},set:function(t){if(this.texture){var e=this.texture.atlas.frameNames||[0];("string"!=typeof t||-1!==e.indexOf(t))&&(this.phaser.loadTexture(this.texture.atlas.key,t,!1),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(t){""===t&&(t=null),this._defaultAnimation=t,this.playAnimation(t)}},paused:{get:function(){return this.isPaused()},set:function(t){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=t;break;case qc.Sprite.DRAGON_BONES:this._paused=t}}},isPlaying:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isPlaying;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return!1}}},isComplete:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return!!t&&t.isFinished;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return!1}}},lastAnimationName:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var t=this.phaser.animations.currentAnim;return t?t.name:null;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return!1}}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var t=this.texture.atlas.animation.data.animations;return t?Object.keys(t):null;case qc.Sprite.DRAGON_BONES:return this._armature?this._armature.animation.animationNameList:null;case qc.Sprite.FRAME_SAMPLES:var e=this._animation;return e?Object.keys(e):null;default:return null}}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(t){if(!(t instanceof Color))throw Error("Expected:qc.Color");this.phaser.tint=t.toNumber(),this.animationType===qc.Sprite.DRAGON_BONES&&this._armature&&this._armature._slotList.forEach(function(e){e._displayList&&e._displayList.forEach(function(e){e.colorTint=t})})}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},"class":{get:function(){return"qc.Sprite"}}}),Sprite.prototype.resetNativeSize=function(){this.width=this.nativeSize.width,this.height=this.nativeSize.height},Sprite.prototype.isPaused=function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:return this.phaser.animations.currentAnim?this.phaser.animations.paused:!1;case qc.Sprite.DRAGON_BONES:return this._paused;default:return!1}};var setFrame=function(t){var e=this._qc;e._phaserImageSetFrame.call(this,t),e.animationType!==qc.Sprite.DRAGON_BONES&&(e.setWidth(e.width),e.setHeight(e.height))},_spriteWebGLAddQuad=function(t,e,i,r,n,o,s,a,h,l,c,u,p,d,f,g,m,_,y,v,T){t.currentBatchSize<t.size||(t.flush(),t.currentBaseTexture=e.texture.baseTexture);var x=t.colors,S=t.positions,b=4*t.currentBatchSize*t.vertSize;t.renderSession.roundPixels?(S[b]=f*i+m*r+y|0,S[b+1]=_*r+g*i+v|0,S[b+5]=f*n+m*o+y|0,S[b+6]=_*o+g*n+v|0,S[b+10]=f*s+m*a+y|0,S[b+11]=_*a+g*s+v|0,S[b+15]=f*h+m*l+y|0,S[b+16]=_*l+g*h+v|0):(S[b]=f*i+m*r+y,S[b+1]=_*r+g*i+v,S[b+5]=f*n+m*o+y,S[b+6]=_*o+g*n+v,S[b+10]=f*s+m*a+y,S[b+11]=_*a+g*s+v,S[b+15]=f*h+m*l+y,S[b+16]=_*l+g*h+v),S[b+2]=c,S[b+3]=u,S[b+7]=p,S[b+8]=u,S[b+12]=p,S[b+13]=d,S[b+17]=c,S[b+18]=d,x[b+4]=x[b+9]=x[b+14]=x[b+19]=T,t.sprites[t.currentBatchSize++]=e},spriteRenderWebGL=function(t){var e=this._qc,i=e.animationType;if(i===qc.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var r,n,o,s,a=t.spriteBatch,h=this,l=this.animations.currentAnim._frameIndex,c=e.texture.atlas.animation.data,u=c.uvs,p=e.lastAnimationName,d=e._animation[p],f=d.frames,g=h.texture,m=g.baseTexture.resolution,_=h.worldTransform,y=_.a/m,v=_.b/m,T=_.c/m,x=_.d/m,S=_.tx,b=_.ty,w=h.tint,A=h.parent.worldAlpha*h.alpha,E=d.last;w=(w>>16)+(65280&w)+((255&w)<<16);var C,P,I,O,M=-1;c.convert||(c.convert={}),c.convert[p]?I=c.convert[p]:c.convert[p]=I=Array(f.length),0===(7&l)?(M=l>>3,I[M]||(O=[M])):l===E-1?(M=(l>>3)+1,I[M]||(O=[M])):(C=l>>3,P=C+1,I[C]||I[P]?I[C]?I[P]||(O=[P]):O=[C]:O=[C,P]);var L,R,D,N,q,B,k,F,U;if(O)for(var z=h.texture.baseTexture.width,G=h.texture.baseTexture.height,W=u.length>>2,j=0,X=O.length;X>j;j++){var V=O[j],Y=f[V];if(Y){s=Array(W);for(var K=0,H=Y.length/10;H>K;K++){r=10*K,n=4*Y[r],s[n]=K;var J=Y[r+1],Z=Y[r+2],Q=Y[r+3],$=Y[r+4],te=Y[r+5],ee=Y[r+6],ie=Y[r+7],re=Y[r+8],ne=(u[n+2]-u[n])*z,oe=(u[n+3]-u[n+1])*G,se=ne*-ie,ae=oe*-re,he=ne*(1-ie),le=oe*(1-re);Y[r+1]=J*se+Q*ae+te,Y[r+2]=Z*se+$*ae+ee,Y[r+3]=J*he+Q*ae+te,Y[r+4]=Z*he+$*ae+ee,Y[r+5]=J*he+Q*le+te,Y[r+6]=Z*he+$*le+ee,Y[r+7]=J*se+Q*le+te,Y[r+8]=Z*se+$*le+ee}c.convert[p][V]=!0,c.uvmap||(c.uvmap={}),c.uvmap[p]||(c.uvmap[p]={}),c.uvmap[p][V]=s}else console.log(V,O)}if(M<0)for(var ce=(l-(C<<3))/(P===E?E-(C<<3):8),Y=f[C],ue=f[P],s=c.uvmap[p][P],K=0,H=Y.length/10;H>K;K++)r=10*K,n=4*Y[r],o=10*s[n],isNaN(o)?(L=Y[r+1],R=Y[r+2],D=Y[r+3],N=Y[r+4],q=Y[r+5],B=Y[r+6],k=Y[r+7],F=Y[r+8],U=Y[r+9]):(L=Y[r+1],R=Y[r+2],D=Y[r+3],N=Y[r+4],q=Y[r+5],B=Y[r+6],k=Y[r+7],F=Y[r+8],U=Y[r+9],L+=(ue[o+1]-L)*ce,R+=(ue[o+2]-R)*ce,D+=(ue[o+3]-D)*ce,N+=(ue[o+4]-N)*ce,q+=(ue[o+5]-q)*ce,B+=(ue[o+6]-B)*ce,k+=(ue[o+7]-k)*ce,F+=(ue[o+8]-F)*ce,U+=(ue[o+9]-U)*ce),_spriteWebGLAddQuad(a,h,L,R,D,N,q,B,k,F,u[n],u[n+1],u[n+2],u[n+3],y,v,T,x,S,b,w+(U*A<<24));else for(var Y=f[M],K=0,H=Y.length/10;H>K;K++)r=10*K,n=4*Y[r],L=Y[r+1],R=Y[r+2],D=Y[r+3],N=Y[r+4],q=Y[r+5],B=Y[r+6],k=Y[r+7],F=Y[r+8],U=Y[r+9],_spriteWebGLAddQuad(a,h,L,R,D,N,q,B,k,F,u[n],u[n+1],u[n+2],u[n+3],y,v,T,x,S,b,w+(U*A<<24));return PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,t)}return i===qc.Sprite.DRAGON_BONES&&e._armature?PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,t):Phaser.Sprite.prototype._renderWebGL.call(this,t)},spriteRenderCanvas=function(t){var e=this._qc,i=e.animationType;if(i!==qc.Sprite.FRAME_SAMPLES)return i===qc.Sprite.DRAGON_BONES&&e._armature?PIXI.DisplayObjectContainer.prototype._renderCanvas.call(this,t):Phaser.Sprite.prototype._renderCanvas.call(this,t);if(this.visible!==!1&&0!==this.alpha&&this.renderable!==!1&&this.texture.crop.width>0&&this.texture.crop.height>0&&this.animations.currentAnim){var r=t.context;if(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=PIXI.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t),this.texture.valid){var n=this.texture.baseTexture.resolution/t.resolution;!t.smoothProperty||t.scaleMode===this.texture.baseTexture.scaleMode&&r[t.smoothProperty]===(t.scaleMode===PIXI.scaleModes.LINEAR)||(t.scaleMode=this.texture.baseTexture.scaleMode,r[t.smoothProperty]=t.scaleMode===PIXI.scaleModes.LINEAR);
var o,s=this.texture.baseTexture.width,a=this.texture.baseTexture.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var h=this.texture.crop,l=h.x,c=h.y,u=h.width,p=h.height;h.x=0,h.y=0,h.width=s,h.height=a,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),h.x=l,h.y=c,h.width=u,h.height=p}o=this.tintedTexture}else o=this.texture.baseTexture.source;var d,f,g,m,_,y,v,T,x,S,b,w=this,A=this.animations.currentAnim._frameIndex,E=e.texture.atlas.animation.data,C=E.uvs,P=e.lastAnimationName,I=e._animation[P].frames,O=w.texture.baseTexture.resolution,M=w.worldTransform,L=M.a/O,R=M.b/O,D=M.c/O,N=M.d/O,q=M.tx,B=M.ty,k=e._animation[P].last;if(0===(7&A))d=A>>3,y=I[d];else if(A===k-1)d=(A>>3)+1,y=I[d];else if(f=A>>3,g=f+1,y=I[f],v=I[g],T=(A-(f<<3))/(g===k?k-(f<<3):8),E.uvmap||(E.uvmap={}),E.uvmap[P]?m=E.uvmap[P]:E.uvmap[P]=m=Array(I.length),m[g])_=m[g];else{var F=C.length>>2;_=Array(F),v=I[g];for(var U=0,z=v.length/10;z>U;U++)S=4*v[10*U],_[S]=U;m[g]=_}for(var G=this.parent.worldAlpha*w.alpha,U=0,z=y.length/10;z>U;U++){x=10*U,S=4*y[x];var W=y[x+1],j=y[x+2],X=y[x+3],V=y[x+4],Y=y[x+5],K=y[x+6],H=y[x+7],J=y[x+8],Z=y[x+9];g&&(b=10*_[S],isNaN(b)||(W+=(v[b+1]-W)*T,j+=(v[b+2]-j)*T,X+=(v[b+3]-X)*T,V+=(v[b+4]-V)*T,Y+=(v[b+5]-Y)*T,K+=(v[b+6]-K)*T,H+=(v[b+7]-H)*T,J+=(v[b+8]-J)*T,Z+=(v[b+9]-Z)*T));var Q=C[S]*s,$=C[S+1]*a,te=C[S+2]*s,ee=C[S+3]*a,ie=W*L+j*D,re=W*R+j*N,ne=X*L+V*D,oe=X*R+V*N,se=(Y*L+K*D+q)*t.resolution,ae=(Y*R+K*N+B)*t.resolution,he=te-Q,le=ee-$,ce=he*-H,ue=le*-J;t.roundPixels?(r.setTransform(ie,re,ne,oe,0|se,0|ae),ce=0|ce,ue=0|ue):r.setTransform(ie,re,ne,oe,se,ae),r.globalAlpha=G*(Z/255),r.drawImage(o,Q,$,he,le,ce/n,ue/n,he/n,le/n)}}for(var pe=this.children,U=0;U<pe.length;U++)pe[U]._renderCanvas(t);this._mask&&t.maskManager.popMask(t)}};Sprite.prototype.getSampledAnimationBounds=function(){var t=this.animationType;if(t!==qc.Sprite.FRAME_SAMPLES)return new qc.Rectangle(0,0,0,0);var e=this.lastAnimationName;if(!e)return new qc.Rectangle(0,0,0,0);var i=this.texture.atlas.animation.data,r=i.bounds;r||(r=i.bounds={});var n=r[e];if(n)return n;var o,s,a,h,l,c,u,p,d,f,g,m,_,y,v,T,x,S,b,w,A,E,C,P,I,O,M,L,R,D,N=i.uvs,q=this.phaser.texture.baseTexture.width,B=this.phaser.texture.baseTexture.height,k=this._animation[e],F=i.convert?i.convert[e]||{}:{},U=1/0,z=1/0,G=-1/0,W=-1/0;for(o=0,s=k.frames.length;s>o;o++)for(a=k.frames[o],c=F[o],h=0,l=a.length/10;l>h;h++)u=10*h,p=4*a[u],c?(C=a[u+1],M=a[u+2],P=a[u+3],L=a[u+4],I=a[u+5],R=a[u+6],O=a[u+7],D=a[u+8]):(d=a[u+1],f=a[u+2],g=a[u+3],m=a[u+4],_=a[u+5],y=a[u+6],v=a[u+7],T=a[u+8],x=(N[p+2]-N[p])*q,S=(N[p+3]-N[p+1])*B,b=x*-v,w=S*-T,A=x*(1-v),E=S*(1-T),C=d*b+g*w+_,M=f*b+m*w+y,P=d*A+g*w+_,L=f*A+m*w+y,I=d*A+g*E+_,R=f*A+m*E+y,O=d*b+g*E+_,D=f*b+m*E+y),U=Math.min(U,C,P,I,O),G=Math.max(G,C,P,I,O),z=Math.min(z,M,L,R,D),W=Math.max(W,M,L,R,D);return n=r[e]=new qc.Rectangle(U,z,G-U,W-z)},Sprite.prototype.setWidth=function(t){Node.prototype.setWidth.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.width=t)},Sprite.prototype.setHeight=function(t){Node.prototype.setHeight.call(this,t),this.phaser.texture.trim||(this.phaser.texture.frame.height=t)},Sprite.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.texture=t.TEXTURE,e.frame=t.AUTO,e.defaultAnimation=t.STRING,e};var UIText=qc.UIText=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.textPhaser=new Phaser.Text(t.phaser),this.textPhaser._nqc=this,this.textPhaser.wordWrapWidth=this.width,this.phaser.addChildAt(this.textPhaser,0),this.textRealWidth=0,this.textRealHeight=0,this.fontSize=12,this._glowText=null,this.name="UIText",this._data="",this._locale="",this._colors=[],this.color=Color.black,this._gradient=!1,this.startColor=Color.red,this.endColor=Color.black,this._fontFamily=UIText.SYSTEMFONT,this.textPhaser.updateText=UIText._phaserUpdateText,this.textPhaser.determineFontProperties=UIText._phaserDetermineFontProperties,this.shadowBlur=10,this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowColor=Color.shadow,this._enableShadow=!1,this._enableGlow=!1,this.glowColor=Color.red,this.stroke=Color.black,this._strokeThickness=0,this._glowBlur=1,this._wrap=!1,this._wrapWidth=this.width,this._autoSize=!1,this._onPhaseTextSizeChange=new Phaser.Signal,this._onPhaseTextSizeChange.add(function(t,e){this.autoSize&&(this.width=t,this.height=e)},this);var r=i!==undefined;r!==!0&&(this.bold=!1,this.alignH=UIText.LEFT,this.alignV=UIText.MIDDLE,this.overflow=!0)};UIText.prototype=Object.create(qc.Node.prototype),UIText.prototype.constructor=UIText,UIText.LEFT=0,UIText.RIGHT=1,UIText.CENTER=2,UIText.TOP=0,UIText.BOTTOM=1,UIText.MIDDLE=2,UIText.SYSTEMFONT=0,UIText.WEBFONT=1,UIText.BITMAPFONT=2,UIText._SYMBOL_COLOR=0,UIText._SYMBOL_END_COLOR=1,Object.defineProperties(UIText.prototype,{colorTint:{get:function(){return new Color(this.textPhaser.tint)},set:function(t){if(t=t||new Color(16777215),!(t instanceof Color))throw Error("Expected qc.Color");this.textPhaser.tint=t.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(t){t!==this._autoSize&&(this._autoSize=t,t&&this.textPhaser&&(this.width=this.textPhaser.width,this.height=this.textPhaser.height))}},fontFamily:{get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._changeText(""),this._isTransformDirty=!0)}},alignH:{get:function(){return this._alignH},set:function(t){t!==this._alignH&&(this._alignH=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},alignV:{get:function(){return this._alignV},set:function(t){t!==this._alignV&&(this._alignV=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},font:{get:function(){var t=this.textPhaser.font.replace(/\'/g,"");return this.fontFamily!==UIText.SYSTEMFONT?this.game.assets.find(t):t},set:function(t){if(t){var e=t;if(this.fontFamily!==UIText.SYSTEMFONT){if(!(t instanceof qc.Font))return this.game.log.error("Expected qc.Font"),undefined;if(this.fontFamily!==t._fontFamily)return this.game.log.error("Invalid font asset"),undefined;e=this.fontFamily===UIText.WEBFONT?t.uuid:t.url}else if("string"!=typeof t)return this.game.log.error("Expected string"),undefined;e!==this.textPhaser.font&&(this._changeText(e),this.enableGlow&&(this._glowText.font=e),this._isTransformDirty=!0)}}},bold:{get:function(){return"normal"!==this.textPhaser.fontWeight},set:function(t){var e=t?"bold":"normal";e!==this.textPhaser.fontWeight&&(this.textPhaser.fontWeight=e,this._enableGlow&&(this._glowText.fontWeight=e),this._isTransformDirty=!0)}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(t){if("number"!=typeof t)throw Error("Expected number");t!==this.textPhaser.fontSize&&(this.textPhaser.fontSize=t,this._enableGlow&&(this._glowText.fontSize=t),this._isTransformDirty=!0)}},color:{get:function(){return new Color(this.textPhaser.fill)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=t.toString("rgb");e!==this.textPhaser.fill&&(this.textPhaser.fill=e,this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.fill=e),this._isTransformDirty=!0)}},text:{get:function(){return this._data},set:function(t){if("string"!=typeof t)throw Error("Expected string");t!==this._data&&(this._colors=[],this._data=t,this._parseTextColor(t),this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.text=this.textPhaser.text),this._isTransformDirty=!0)}},locale:{get:function(){return this._locale},set:function(t){this._locale=t,qc.locales[qc.lang]&&qc.locales[qc.lang][t]&&(this.text=qc.locales[qc.lang][t])}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(t){t!==this.textPhaser.lineSpacing&&(this.textPhaser.lineSpacing=t,this._enableGlow&&(this._glowText.lineSpacing=t),this._isTransformDirty=!0)}},wrap:{get:function(){return this._wrap},set:function(t){t!==this._wrap&&(this._wrap=t,this.textPhaser.wordWrap=t,this._enableGlow&&(this._glowText.wordWrap=t),this._isTransformDirty=!0)}},overflow:{get:function(){var t=this.getScript("qc.NodeMask");return t&&t.enable?!1:!0},set:function(t){var e=this.getScript("qc.NodeMask");e||(e=this.addScript("qc.NodeMask")),e.enable=!t}},pivotX:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},pivotY:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},width:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").get.call(this)},set:function(t){t!==this.width&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,t),this._wrapWidth=t,this._enableGlow&&(this._glowText.wordWrapWidth=t),this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos()),this._isTransformDirty=!0)}},height:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").get.call(this)},set:function(t){t!==this.height&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0)}},"class":{get:function(){return"qc.UIText"}},startColor:{get:function(){return new Color(this._startColor)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=""+t;e!==this._startColor&&(this._startColor=e,this.textPhaser.dirty=!0)}},endColor:{get:function(){return new Color(this._endColor)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=""+t;e!==this._endColor&&(this._endColor=e,this.textPhaser.dirty=!0)}},gradient:{get:function(){return this._gradient},set:function(t){t!==this._gradient&&(this._gradient=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},stroke:{get:function(){return new Color(this.textPhaser.stroke)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=""+t;e!==this.textPhaser.stroke&&(this.textPhaser.stroke=e,this._isTransformDirty=!0)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(t){t!==this._strokeThickness&&(this._strokeThickness=t,this._enableGlow&&(this._glowText.strokeThickness=this.textPhaser.strokeThickness,this._glowText.dirty=!0),this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},enableShadow:{get:function(){return this._enableShadow},set:function(t){this._enableShadow=t,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowColor:{get:function(){return new Color(this.textPhaser.shadowColor)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=""+t;e!==this.textPhaser.shadowColor&&(this.textPhaser.shadowColor=e,this._isTransformDirty=!0)}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(t){t!==this.textPhaser.shadowBlur&&(this.textPhaser.shadowBlur=t,this._isTransformDirty=!0)}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(t){this.textPhaser.shadowOffsetX=t,this._isTransformDirty=!0}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(t){this.textPhaser.shadowOffsetY=t,this._isTransformDirty=!0}},glowColor:{get:function(){return new Color(this._glowColor)},set:function(t){if(!(t instanceof Color))throw Error("Expected qc.Color");var e=""+t;e!==this._glowColor&&(this._glowColor=e,this._glowText&&(this._glowText.fill=e,this._glowText.stroke=e,this._glowText.shadowColor=e,this._glowText.dirty=!0))}},glowBlur:{get:function(){return this._glowBlur},set:function(t){t!==this._glowBlur&&(this._glowBlur=t,this.enableGlow&&(this._glowText.filterX.blur=t,this._glowText.filterY.blur=t))}},enableGlow:{get:function(){return this._enableGlow},set:function(t){if(t!==this._enableGlow){if(this._enableGlow=t,t){this._glowText=new Phaser.Text(this.game.phaser),this._glowText._nqc=this,this._copyProperty(this._glowText,this.textPhaser),this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.fill=this._glowColor,this._glowText.stroke=this._glowColor,this._glowText.shadowColor=this._glowColor,this._glowText.scale=this.textPhaser.scale,this._glowText.pivot=this.textPhaser.pivot,this._glowText.rotation=this.textPhaser.rotation,this._glowText.updateText=UIText._phaserUpdateText,this._glowText.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText.font=this.textPhaser.font,this.phaser.addChildAt(this._glowText,0);var e=new qc.Filter.BlurX(this.game),i=new qc.Filter.BlurY(this.game);e.blur=this.glowBlur,i.blur=this.glowBlur,this._glowText.filters=[e,i],this._glowText.filterX=e,this._glowText.filterY=i}else this.phaser.removeChild(this._glowText),this._glowText.destroy(),this._glowText=null,this.textPhaser.dirty=!0;this._isTransformDirty=!0}}},nativeSize:{get:function(){var t=this.rect;return t.width=this.textRealWidth,t.height=this.textRealHeight,t}}}),UIText.prototype._changeText=function(t){var e,i=PIXI.BitmapText.fonts[t];i?(e=new Phaser.BitmapText(this.game.phaser,0,0,t),this._glowText&&(this._glowText.visible=!1)):(e=new Phaser.Text(this.game.phaser),e.updateText=UIText._phaserUpdateText,e.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText&&(this._glowText.visible=!0)),e.font=t,e._nqc=this,this._copyProperty(e,this.textPhaser),e.x=this.textPhaser.x,e.y=this.textPhaser.y,this._glowText&&(this._glowText.font=e.font);var r=this.phaser.getChildIndex(this.textPhaser);this.phaser.removeAt?this.phaser.removeAt(r):this.phaser.removeChildAt(r),this.phaser.addAt?this.phaser.addAt(e,r):this.phaser.addChildAt(e,r),this.textPhaser.destroy(),this.textPhaser=e,this._isTransformDirty=!0,this._setTextColor(this.textPhaser)},UIText.prototype.setWidth=function(t){qc.Node.prototype.setWidth.call(this,t),this._wrapWidth=t,this.textPhaser&&(this.textPhaser.wordWrapWidth=t,this._adjustTextPos())},UIText.prototype.setHeight=function(t){qc.Node.prototype.setHeight.call(this,t),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos())},UIText.prototype.postUpdate=function(){var t=this,e=this.textPhaser;if(e.dirty)e.updateText();else{var i=t.getWorldScale(),r=t._preWorldScale,n=t.game.time.fixedTime;if(r)if(r.x!==i.x||r.y!==i.y)r.x=i.x,r.y=i.y,t._worldScaleChangeTime=n,0===t.scaleDirtyInterval&&e.updateText();else{var o=e._worldScale,s=t.scaleDirtyInterval||textScaleDirtyInterval;n-t._worldScaleChangeTime<=s||o&&i.x===o.x&&i.y===o.y||e.updateText()}else t._preWorldScale=new qc.Point(i.x,i.y),t._worldScaleChangeTime=n}},UIText.prototype._copyProperty=function(t,e){t.align=e.align,t.fontWeight=e.fontWeight,t.fontSize=e.fontSize,t.lineSpacing=e.lineSpacing,t.wordWrap=this._wrap,t.name=e.name,t.scale=e.scale,t.pivot=e.pivot,t.rotation=e.rotation,t.alpha=e.alpha,t.visible=e.visible,t.renderable=e.renderable,t.mask=e.mask,t.text=e.text,t.locale=e.locale,t.wordWrapWidth=this._wrapWidth,t.stroke=e.stroke,t.strokeThickness=e.strokeThickness,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.fill=e.fill,t.fontFamily=this.fontFamily},UIText.prototype._parseSymbol=function(t,e,i){var r={};if(r.result=!1,"["!==t[e])return r;for(var n=e;++n;){if("["===t[n]||n>=t.length||n-e>25)return r;if("]"===t[n])break}var o=n-e;return o>2&&"#"===t[e+1]?(r.color=t.slice(e+1,n),r.result=!0,r.type=UIText._SYMBOL_COLOR):o>6&&"r"===t[e+1]&&"g"===t[e+2]&&"b"===t[e+3]?(r.color=t.slice(e+1,n),r.result=!0,r.type=UIText._SYMBOL_COLOR):"-"===t[e+1]&&"]"===t[e+2]&&(i.length>0&&(r.result=!0),r.type=UIText._SYMBOL_END_COLOR),r.result&&(r.pos=n),r},UIText.prototype._pushColor=function(t,e){var i={};i.color=t,i.pos=e,this._colors.push(i),this._isTransformDirty=!0},UIText.prototype._setTextColor=function(t){if(t.clearColors&&t.clearColors(),t.addColor){for(var e=0;e<this._colors.length;e++){var i="defaultColor"===this._colors[e].color?"defaultColor":this._colors[e].color;t.addColor(i,this._colors[e].pos)}this._isTransformDirty=!0}},UIText.prototype._parseTextColor=function(t){t=t.replace(/(?:\r\n|\r|\n)/g,"\n");for(var e="",i=[],r=0;r<t.length;r++){var n=this._parseSymbol(t,r,i);if(n.result){if(r=n.pos,n.type===UIText._SYMBOL_COLOR)i.push(n.color),this._pushColor(n.color,e.length);else if(n.type===UIText._SYMBOL_END_COLOR){i.pop();var o=i.length>0?i[i.length-1]:"defaultColor";this._pushColor(o,e.length)}}else e+=t[r]}this.textPhaser.text=e,this._isTransformDirty=!0},UIText.prototype.getMeta=function(){var t=Node.prototype.getMeta.call(this);return t.fontFamily=Serializer.NUMBER,t.alignH=Serializer.NUMBER,t.alignV=Serializer.NUMBER,t.font=Serializer.FONT,t.bold=Serializer.BOOLEAN,t.fontSize=Serializer.NUMBER,t.color=Serializer.COLOR,t.text=Serializer.STRING,t.locale=Serializer.STRING,t.lineSpacing=Serializer.NUMBER,t.wrap=Serializer.BOOLEAN,t.enableGlow=Serializer.BOOLEAN,t.startColor=Serializer.COLOR,t.endColor=Serializer.COLOR,t.gradient=Serializer.BOOLEAN,t.stroke=Serializer.COLOR,t.strokeThickness=Serializer.NUMBER,t.glowColor=Serializer.COLOR,t.autoSize=Serializer.BOOLEAN,t.shadowColor=Serializer.COLOR,t.shadowBlur=Serializer.NUMBER,t.shadowOffsetX=Serializer.NUMBER,t.shadowOffsetY=Serializer.NUMBER,t.enableShadow=Serializer.BOOLEAN,t},UIText.prototype._adjustTextPos=function(){var t=this.textPhaser.realWidth,e=this.textPhaser.realHeight;this.textPhaser.x=-this.pivotX*this.width,this._alignH===UIText.RIGHT?this.textPhaser.x=this.textPhaser.x+this.width-t:this._alignH===UIText.CENTER&&(this.textPhaser.x=this.textPhaser.x+(this.width-t)/2),this.textPhaser.y=-this.pivotY*this.height,this._alignV===UIText.BOTTOM?this.textPhaser.y=this.textPhaser.y+this.height-e:this._alignV===UIText.MIDDLE&&(this.textPhaser.y=this.textPhaser.y+(this.height-e)/2),this._shiftCanvas&&(this.textPhaser.x-=this._shiftCanvas[0],this.textPhaser.y-=this._shiftCanvas[1]),this._enableGlow&&(this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.dirty=!0),this._isTransformDirty=!0},UIText.prototype._refreshWebFont=function(t){/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(t)||/['",]/.exec(t)||(t="'"+t+"'"),t===this.textPhaser.font&&(this.textPhaser.dirty=!0,this._glowText&&(this._glowText.dirty=!0),this._isTransformDirty=!0)},UIText._phaserUpdateText=function(){var t=!this._canvasMode;t&&(this.texture=PIXI.Text.drawSprite);var e=this._nqc,i=this.canvas,r=this.context,n=e.getWorldScale(),o=e.game.device.desktop,s=o?1920:Math.max(960,e.game.world.width),a=o?1920:Math.max(960,e.game.world.height),h=e.game.device.phaser.UCBrowser;this._worldScale=new qc.Point(n.x,n.y);var l=Math.max(.2,Math.min(10,Math.abs(n.x))),c=Math.max(.2,Math.min(10,Math.abs(n.y))),u=this.resolution=e.game.resolution;this.texture.baseTexture.resolution=u,this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,r.font=this.style.font;var p=this.text,d=e.width;if(this.style.wordWrap){p=p.replace(/(?:\r\n|\r|\n)/g,"\n");var f=this.runWordWrap(p,d)}else for(var f=p.split(/(?:\r\n|\r|\n)/),g=0;g<f.length-1;g++)f[g]+="\n";for(var m=e,_=[],y=0,v=this.determineFontProperties(r.font).fontSize,g=0;g<f.length;g++){var T=this._getWorldWidth(f[g]);_[g]=T,y=Math.max(y,T)}y=Math.ceil(y);var x=this.style.stroke?m._strokeThickness:0,S=e.enableShadow?this.style.shadowOffsetX:0,b=e.enableShadow?this.style.shadowOffsetY:0,w=this.realWidth=y;this.realWidth=w,w*u*l>s&&(l=s/(w*u));var A=v,E=A*f.length,C=this._lineSpacing;if(0>C&&Math.abs(C)>A&&(C=-A),0!==C){var P=C*(f.length-1);E+=P}var I=this.realHeight=E;I*u*c>a&&(c=a/(I*u)),m.textRealWidth=y,m.textRealHeight=E;var O=Math.min(l,c);S*=O*u,b*=O*u,this._shadowOffset=[S,b];var M=x*O*u/2;w=w*u*O+M+Math.max(Math.abs(S),M),I=I*u*O+M+Math.max(Math.abs(b),M),i.width=Math.max(Math.ceil(w),1),i.height=Math.max(Math.ceil(I),1),this._canvasDownScale=new qc.Point(1/O,1/O),r.scale(u*O,u*O);var L,R;L=R=M,0>S&&(L=Math.max(L,-S)),0>b&&(R=Math.max(R,-b)),L/=O*u,R/=O*u,e._shiftCanvas=[L,R],r.translate(L,R);var D=[];for(g=0;g<f.length;g++){var N=0;m._alignH===UIText.RIGHT?N=this.realWidth-_[g]:m._alignH===UIText.CENTER&&(N=(this.realWidth-_[g])/2),D.push(N)}var q=0;m._alignV===UIText.BOTTOM?q=this.realHeight-E:m._alignV===UIText.MIDDLE&&(q=(this.realHeight-E)/2),navigator.isCocoonJS&&r.clearRect(0,0,this.realWidth,this.realHeight),r.font=this.style.font,r.strokeStyle=this.style.stroke,r.textBaseline="middle",m.enableShadow&&(r.shadowOffsetX=S,r.shadowOffsetY=b,r.shadowColor=this.style.shadowColor,r.shadowBlur=this.style.shadowBlur),r.lineCap="round",r.lineJoin="round",r.lineWidth=x,this._charCount=0;var B;if(m._gradient){B=r.createLinearGradient(0,q,0,q+E*this.scale.y);var k=1/f.length;B.addColorStop(0,m._startColor);for(var g=1;g<f.length;g++)B.addColorStop(k*g,m._endColor),B.addColorStop(k*g,m._startColor);B.addColorStop(1,m._endColor),r.fillStyle=B}else r.fillStyle=this.style.fill;var F,U,z=r.fillStyle,G=r.strokeStyle;for(g=0;g<f.length;g++)if(F=D[g],U=q+g*A+A/2,g>0&&(U+=C*g),this.colors.length>0)this.updateLine(f[g],F,U,r,x,z,G,A,B,h);else if(this.style.stroke&&x&&(this._clearShadowStyle(r),r.strokeText(f[g],F,U),this._restoreShadowStyle(r)),this.style.fill)if(B&&h){if(r.save(),r.fillStyle="black",r.fillText(f[g],F,U),r.globalCompositeOperation="source-in",r.fillStyle=B,r.beginPath(),r.rect(F,U-A/2,_[g],A),r.clip(),r.fillRect(F,U-A/2,_[g],A),r.restore(),qc.__IS_ANDROID_UC){var W=qc._tempCanvas;W||(W=qc._tempCanvas=document.createElement("canvas"),W.width=128,W.height=128),r.drawImage(W,0,0,2,2,-5,-5,1,1)}}else r.fillText(f[g],F,U);this.updateTexture(),t&&this._uploadToRenderTexture(),this.cachedTint=null,e._adjustTextPos(),this.getWorldTransform(),this.dirty=!1},UIText._phaserDetermineFontProperties=function(t){var e=PIXI.Text.fontPropertiesCache[t];if(!e){e={},PIXI.Text.fontPropertiesCanvas||(PIXI.Text.fontPropertiesCanvas=PIXI.sharedCanvas,PIXI.Text.fontPropertiesContext=PIXI.Text.fontPropertiesCanvas.getContext("2d"));var i=PIXI.Text.fontPropertiesCanvas,r=PIXI.Text.fontPropertiesContext;r.font=t;var n=Math.ceil(r.measureText("|MÉq").width);0===n&&(n=1);var o=Math.ceil(r.measureText("M").width),s=2*o;0===s&&(s=1),o=1.4*o|0,i.width=n,i.height=s,r.fillStyle="#f00",r.fillRect(0,0,n,s),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText("|MÉq",0,o);var a,h,l=r.getImageData(0,0,n,s).data,c=l.length,u=4*n,p=0,d=!1;for(a=0;o>a;a++){for(h=0;u>h;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p+=u}for(e.ascent=o-a,p=c-u,d=!1,a=s;a>o;a--){for(h=0;u>h;h+=4)if(255!==l[p+h]){d=!0;break}if(d)break;p-=u}e.descent=a-o,e.fontSize=e.ascent+e.descent,PIXI.Text.fontPropertiesCache[t]=e}return e};var Button=qc.Button=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="Button",this.onStateChange=new qc.Signal;var r=i!==undefined;if(r!==!0){this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.interactive=!0,this.state=qc.UIState.NORMAL;var n=this.addScript("qc.TransitionBehaviour");n.target=this,this.width=120,this.height=40,this.text.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.text.left=0,this.text.right=0,this.text.top=0,this.text.bottom=0,this.text.alignH=UIText.CENTER}var o=this;this.onDown.add(function(){o.state!==qc.UIState.DISABLED&&(o.state=qc.UIState.PRESSED)}),this.onUp.add(function(){o.state===qc.UIState.PRESSED&&(o.state=qc.UIState.NORMAL)}),this._onNativeElementClick=this._processNativeClick.bind(this)};Button.prototype=Object.create(qc.UIImage.prototype),Button.prototype.constructor=Button,Object.defineProperties(Button.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},colorTint:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").get.call(this)},set:function(t){Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").set.call(this,t),this.text&&(this.text.colorTint=t)}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(t){t!==this._supportNativeEvent&&(this._supportNativeEvent=t,this._checkNativeElement())}},onNativeClick:{get:function(){return this._onNativeClick||(this._onNativeClick=new Phaser.Signal),this._onNativeClick}},"class":{get:function(){return"qc.Button"}}}),Button.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.text=t.NODE,e.state=t.NUMBER,e.supportNativeEvent=t.BOOLEAN,e},Button.prototype.update=function(t){this.isWorldVisible()&&this.supportNativeEvent?(this._checkNativeElement(),t&&this._updateNativeElement()):this._removeNativeElement()},Button.prototype.onVisibleChange=function(){this.update(!0)},Button.prototype.onDestroy=function(){this._removeNativeElement(),qc.UIImage.prototype.onDestroy.call(this)},Button.prototype._checkNativeElement=function(){this.supportNativeEvent&&this.worldVisible&&!this._nativeElement?this._createNativeElement():!this._nativeElement||this.supportNativeEvent&&this.worldVisible||this._removeNativeElement()},Button.prototype._createNativeElement=function(){var t=this;if(!t._nativeElement){var e=t._nativeElement=document.createElement("div");e.addEventListener("click",t._onNativeElementClick,!1),e.addEventListener("touchstart",t._onNativeElementClick,!1);var i=e.style;i.position="absolute",i.padding=0,i.margin=0,i.border=0,i.outline=0,i.background="none",t.game.world.frontDomRoot.appendChild(e),t._updateNativeElement(),t.phaser.worldTransformChangedCallback=t._updateNativeElement.bind(t),t.phaser.worldTransformChangedContext=t}},Button.prototype._removeNativeElement=function(){var t=this._nativeElement;t&&(this._nativeElement=null,t.removeEventListener("click",this._onNativeElementClick,!1),t.removeEventListener("touchstart",this._onNativeElementClick,!1),qc.Util.removeHTML(t))},Button.prototype._updateNativeElement=function(){var t=this,e=t._nativeElement;e&&(e._lastUpdate=t.game.time.now,qc.Util.updateTransform(t,e))},Button.prototype._processNativeClick=function(t){this.worldVisible||this._checkNativeElement(),this._onNativeClick&&this._onNativeClick.getNumListeners()>0&&this._onNativeClick.dispatch(this,t)};var Toggle=qc.Toggle=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="Toggle",this.interactive=!0,this.onStateChange=new qc.Signal,this.onValueChange=new qc.Signal,this.canValueChange=new qc.Signal;var r=i!==undefined;if(r!==!0){this.background=t.add.image(this),this.background.name="Background",this.background.interactive=!1,this.background.width=80,this.background.height=80,this.checkMark=t.add.image(this.background),this.checkMark.name="CheckMark",this.checkMark.interactive=!1,this.text=t.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.on=!1,this.state=qc.UIState.NORMAL,this.checkMark.pivotX=.5,this.checkMark.pivotY=.5,this.checkMark.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),this.checkMark.anchoredX=0,this.checkMark.anchoredY=0,this.checkMark.width=50,this.checkMark.height=50,this.text.x=this.background.width+5,this.text.height=this.background.height;var n=this.addScript("qc.TransitionBehaviour");n.target=this.background,n.transition=qc.Transition.TEXTURE_SWAP}var o=this;this.onDown.add(function(){o.state!==qc.UIState.DISABLED&&(o.state=qc.UIState.PRESSED)}),this.onUp.add(function(){o.state===qc.UIState.PRESSED&&(o.state=qc.UIState.NORMAL)}),this.onClick.add(function(){o.on=!o.on,o.checkMark.visible=o.on})};Toggle.prototype=Object.create(qc.Node.prototype),Toggle.prototype.constructor=Toggle,Object.defineProperties(Toggle.prototype,{on:{get:function(){return!!this._on},set:function(t){var e=this.on,i={};this.canValueChange.dispatch(this,t,e,i),i.ignore||(this._on=t,this.checkMark.visible=t,e!==t&&this.onValueChange.dispatch(this))}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},"class":{get:function(){return"qc.Toggle"}}}),Toggle.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.background=t.NODE,e.checkMark=t.NODE,e.text=t.NODE,e.on=_CUSTOM_FIELD("on",t.BOOLEAN),e.state=_CUSTOM_FIELD("state",t.NUMBER),e};var Sound=qc.Sound=function(t,e,i){this.soundPhaser=new Phaser.Sound(t.phaser),this.soundPhaser._qc=this,this._loop=!1,this.game=t,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),e,i),this.name="Sound",this._related(),t.phaser.sound._sounds.push(this.soundPhaser),this._playOnAwake=!1,this.destroyWhenStop=!0};Sound.prototype=Object.create(qc.Node.prototype),Sound.prototype.constructor=Sound,Object.defineProperties(Sound.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(t){this._loop=t,this.soundPhaser.loop=t,this.soundPhaser._sound&&(this.soundPhaser._sound.loop=t)}},audio:{get:function(){return this.game.assets.find(this.soundPhaser.key)},set:function(t){var e=this.soundPhaser;if(!t)return e.key=t,undefined;var i=t.key;if(e&&e.key){var r=this.loop,n=this.mute,o=this.volume;e.destroy(),e=this.soundPhaser=new Phaser.Sound(this.game.phaser,i),e._qc=this,this.game.phaser.sound._sounds.push(e),this.loop=r,this.mute=n,this.volume=o}else e.key=i,e.usingAudioTag&&(e.game.cache.getSound(i)&&e.game.cache.isSoundReady(i)?(e._sound=e.game.cache.getSoundData(i),e.totalDuration=0,e._sound.duration&&(e.totalDuration=e._sound.duration)):e.game.cache.onSoundUnlock.add(e.soundHasUnlocked,e))}},volume:{get:function(){return this.soundPhaser.volume},set:function(t){this.soundPhaser.volume=t}},playOnAwake:{get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},mute:{get:function(){return this.soundPhaser.mute},set:function(t){this.soundPhaser.mute=t}},destroyWhenStop:{get:function(){return this._destroyWhenStop||!1},set:function(t){this._destroyWhenStop=t}},"class":{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying},set:function(t){t?this.play():this.stop()}},isPaused:{get:function(){return this.soundPhaser.paused}}}),Sound.prototype._dispatchAwake=function(){var t=this;Node.prototype._dispatchAwake.call(t),!t.game.device.editor&&t.playOnAwake&&t.play()},Sound.prototype._related=function(){var t=this;t.onDecoded=t.soundPhaser.onDecoded,t.onStop=t.soundPhaser.onStop,this.onStop.add(function(){!t.game.device.editor&&t.destroyWhenStop&&t.destroy()},t),t.onLoop=t.soundPhaser.onLoop},Sound.prototype.play=function(){if(this.isPaused)return this.soundPhaser.resume(),this;this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null);var t=this.marker?this.marker.name:null;return this.soundPhaser.play(t),this},Sound.prototype.fadeIn=function(t){this.soundPhaser.fadeIn(t)},Sound.prototype.fadeOut=function(t){this.soundPhaser.fadeOut(t)},Sound.prototype.pause=function(){this.soundPhaser.pause()},Sound.prototype.resume=function(){this.soundPhaser.resume()},Sound.prototype.stop=function(){this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null),this.soundPhaser.stop()},Sound.prototype.addMarker=function(t,e,i){this.removeMarker(),this.marker={},this.marker.name="s",this.marker.start=t,this.marker.duration=e,this.marker.volume=i,this.soundPhaser.addMarker(this.marker.name,t,e,i)},Sound.prototype.removeMarker=function(){this.marker&&(this.soundPhaser.currentMarker="",this.soundPhaser.markers={},this.marker=null)},Sound.prototype.onDestroy=function(){this.game.phaser.sound.remove(this.soundPhaser),qc.Node.prototype.onDestroy.call(this)},Sound.prototype.getMeta=function(){var t=qc.Serializer,e=qc.Node.prototype.getMeta.call(this);return e.audio=t.AUDIO,e.loop=t.BOOLEAN,e.volume=t.NUMBER,e.playOnAwake=t.BOOLEAN,e.mute=t.BOOLEAN,e.destroyWhenStop=t.BOOLEAN,e
};var ScrollView=qc.ScrollView=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ScrollView",this.canHorizontal=!0,this.canVertical=!0,this.movementType=ScrollView.MOVEMENT_ELASTIC,this.elasticity=1,this.inertia=!0,this.decelerationRate=.03,this.scrollSensitivity=1,this.propagationScroll=!1,this.onValueChange=new Phaser.Signal,this._contentRect=null,this._viewRect=null,this._preContentPosition=null,this._preContentRect=null,this._preViewRect=null,this._velocity=new qc.Point(0,0),this._isDragging=!1,this.onWheel.add(this._doWheel,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollView.prototype=Object.create(qc.UIImage.prototype),ScrollView.prototype.constructor=ScrollView,Object.defineProperties(ScrollView.prototype,{"class":{get:function(){return"qc.ScrollView"}},content:{get:function(){return this._content&&this._content._destroy&&(this._content=null),this._content},set:function(t){this._content=t,this._updateBounds()}},horizontalScrollBar:{get:function(){return this._horizontalScrollBar&&this._horizontalScrollBar._destroy&&(this._horizontalScrollBar=null),this._horizontalScrollBar},set:function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this),this._horizontalScrollBar=t,this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}},verticalScrollBar:{get:function(){return this._verticalScrollBar&&this._verticalScrollBar._destroy&&(this._verticalScrollBar=null),this._verticalScrollBar},set:function(t){this._verticalScrollBar&&this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this),this._verticalScrollBar=t,this._verticalScrollBar&&this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}},horizontalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.width>this._viewRect.width?(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width):this._viewRect.x>this._contentRect.x?1:0},set:function(t){this.setNormalizedPosition(t,0)}},verticalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.height>this._viewRect.height?(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height):this._viewRect.y>this._contentRect.y?1:0},set:function(t){this.setNormalizedPosition(t,1)}}}),ScrollView.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.content=t.NODE,e.canHorizontal=t.BOOLEAN,e.canVertical=t.BOOLEAN,e.movementType=t.NUMBER,e.elasticity=t.NUMBER,e.inertia=t.BOOLEAN,e.decelerationRate=t.NUMBER,e.scrollSensitivity=t.NUMBER,e.horizontalScrollBar=t.NODE,e.verticalScrollBar=t.NODE,e.propagationScroll=t.BOOLEAN,e},ScrollView.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.content=null,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.phaser.mask=null},ScrollView.prototype.update=function(){this._updateBounds()},ScrollView.prototype.postUpdate=function(){this._updateVelocity()},ScrollView.prototype._setHorizontalNormalizedPosition=function(t){this.setNormalizedPosition(t,0)},ScrollView.prototype._setVerticalNormalizedPosition=function(t){this.setNormalizedPosition(t,1)},ScrollView.prototype._setContentPosition=function(t,e){this.content.x=t,this.content.y=e},ScrollView.prototype._calculateOffset=function(t,e){var i=new qc.Point(0,0);if(this.movementType===ScrollView.MOVEMENT_UNRESTRICTED)return i;var r=this.rect,n=this._contentRect,o=new qc.Point(n.x,n.y),s=new qc.Point(n.x+n.width,n.y+n.height);return this.canHorizontal&&(o.x+=t,s.x+=t,o.x>r.x?i.x=r.x-o.x:s.x<r.x+r.width&&(i.x=r.x+r.width-s.x)),this.canVertical&&(o.y+=e,s.y+=e,o.y>r.y?i.y=r.y-o.y:s.y<r.y+r.height&&(i.y=r.y+r.height-s.y)),i},ScrollView.prototype._calcVelocityEffect=function(t,e,i,r){if(this.movementType===ScrollView.MOVEMENT_ELASTIC&&0!==e[r]){var n=this["_lastOffset_"+r]||0;Math.abs(n)<Math.abs(e[r])?(this["_lastOffset_"+r]=e[r],this._currSmoothetTime=i):(this["_lastOffset_"+r]=e[r],this._currSmoothetTime+=i);var o=(this.elasticity>0?this.elasticity:i,this.game.math.smoothDamp(t[r],t[r]+e[r],this._velocity[r],this.elasticity,Number.MAX_VALUE,i/100));Math.abs(t[r]+e[r]-o[0])<1e-4?(t[r]=t[r]+e[r],this._velocity[r]=0):(t[r]=o[0],this._velocity[r]=o[1])}else if(this.movementType===ScrollView.MOVEMENT_CLAMPED&&0!==e[r])t[r]=t[r]+e[r];else if(this.inertia){var s=this._velocity[r]*Math.pow(Math.abs(this.decelerationRate),i/1e3);Math.abs(s)<1&&(s=0),this._velocity[r]=s,t[r]=t[r]+s*i/1e3}else this._velocity[r]=0},ScrollView.prototype._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*this.game.math.sign(t)},ScrollView.prototype._updateVelocity=function(){if(this.content){this._updateBounds();var t=this.game.time.deltaTime,e=this._calculateOffset(0,0),i=new qc.Point(this.content.x,this.content.y);if(this._isDragging||0===e.x&&0===e.y&&0===this._velocity.x&&0===this._velocity.y||(this._calcVelocityEffect(i,e,t,"x"),this._calcVelocityEffect(i,e,t,"y"),(0!==this._velocity.x||0!==this._velocity.y)&&this.movementType===ScrollView.MOVEMENT_CLAMPED&&(e=this._calculateOffset(i.x-this.content.x,i.y-this.content.y),i.x+=e.x,i.y+=e.y),this._setContentPosition(i.x,i.y)),this._isDragging&&this.inertia){var r=this.content.x-this._preContentPosition.x,n=this.content.y-this._preContentPosition.y,o=this.game.math.clamp(t/1e3,0,1);this._velocity.x=r/o,this._velocity.y=n/o}this._preViewRect&&qc.Rectangle.equals(this._viewRect,this._preViewRect)&&this._preContentRect&&qc.Rectangle.equals(this._contentRect,this._preContentRect)&&this._preContentPosition&&qc.Point.equals(this._preContentPosition,i)||(this._updateScrollBars(e.x,e.y),this.onValueChange.dispatch(new qc.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition)),this._updatePrevData())}},ScrollView.prototype.setNormalizedPosition=function(t,e){if(this._updateBounds(),this.content&&this._contentRect){var i=e?"height":"width",r=e?"y":"x",n=this._contentRect[i]-this._viewRect[i],o=this._viewRect[r]-t*n,s=this.content[r]+o-this._contentRect[r],a=this.content[r];Math.abs(a-s)>1&&(this.content[r]=s,this._velocity[r]=0,this._updateBounds())}},ScrollView.prototype._updatePrevData=function(){this._preContentPosition=this.content?new qc.Point(this.content.x,this.content.y):new qc.Point(0,0),this._preContentRect=this._contentRect,this._preViewRect=this._viewRect},ScrollView.prototype._updateScrollBars=function(t,e){if(this.horizontalScrollBar){if(this._contentRect.width>0){var i=(this._viewRect.width-Math.abs(t))/this._contentRect.width;this.horizontalScrollBar.size=Phaser.Math.clamp(i,0,1)}else this.horizontalScrollBar.size=1;this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){var i=(this._viewRect.height-Math.abs(e))/this._contentRect.height;this.verticalScrollBar.size=Phaser.Math.clamp(i,0,1)}else this.verticalScrollBar.size=1;this.verticalScrollBar.value=this.verticalNormalizedPosition}},ScrollView.prototype._updateBounds=function(){if(this._viewRect=this.rect,this._updateContentBounds(),this.content){var t=this.rect,e=t.width-this._contentRect.width,i=t.height-this._contentRect.height;e>0&&(this._contentRect.width=t.width,this._contentRect.x-=e*this.content.pivotX),i>0&&(this._contentRect.height=t.height,this._contentRect.y-=i*this.content.pivotY)}},ScrollView.prototype._updateContentBounds=function(){return this.content?(this._contentRect=qc.Bounds.getBox(this.content,qc.Bounds.USE_BOUNDS,!1,1,this),undefined):(this._contentRect=new qc.Rectangle(0,0,0,0),undefined)},ScrollView.prototype._doWheel=function(t,e){if(this.content){this._updateBounds();var i=new qc.Point(e.source.deltaX,e.source.deltaY);this.canVertical||(i.y=0),this.canHorizontal||(i.x=0);var r=i.x*this.scrollSensitivity,n=i.y*this.scrollSensitivity;this.doScroll(r,n,!1)}},ScrollView.prototype._doDragStart=function(t,e){e.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._updateBounds(),this._contentStartPosition=new qc.Point(this.content.x,this.content.y),this._pointerStartCursor=this.toLocal(new qc.Point(e.source.startX,e.source.startY)),this._isDragging=!0)},ScrollView.prototype._doDragEnd=function(t,e){e.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._isDragging=!1)},ScrollView.prototype._doDrag=function(t,e){if(e.source.eventId===qc.Mouse.BUTTON_LEFT){this._updateBounds();var i=this.toLocal(new qc.Point(e.source.x,e.source.y));if(this._pointerStartCursor){var r=this.canHorizontal?i.x-this._pointerStartCursor.x:0,n=this.canVertical?i.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+r-this.content.x,this._contentStartPosition.y+n-this.content.y,!0)}}},ScrollView.prototype.doScroll=function(t,e,i){var r=new qc.Point(this.content.x,this.content.y);r.x+=t,r.y+=e;var n=this._calculateOffset(t,e);if(r.x+=n.x,r.y+=n.y,this.movementType===ScrollView.MOVEMENT_CLAMPED&&this.propagationScroll){for(var o=this.parent;!(o instanceof ScrollView)&&o!==this.game.world;)o=o.parent;o instanceof ScrollView&&o.doScroll(-n.x,-n.y,i)}else this.movementType===ScrollView.MOVEMENT_ELASTIC&&(i?(0!==n.x&&(r.x=r.x-this._rubberDelta(n.x,this._viewRect.width)),0!==n.y&&(r.y=r.y-this._rubberDelta(n.y,this._viewRect.height))):(r.x-=n.x,r.y-=n.y,Math.abs(n.x)>this._viewRect.width&&(r.x+=n.x-this.game.math.sign(n.x)*this._viewRect.width),Math.abs(n.y)>this._viewRect.height&&(r.y+=n.y-this.game.math.sign(n.y)*this._viewRect.height)));this._setContentPosition(r.x,r.y),i||this._updateBounds()},ScrollView.MOVEMENT_UNRESTRICTED=0,ScrollView.MOVEMENT_ELASTIC=1,ScrollView.MOVEMENT_CLAMPED=2;var ScrollBar=qc.ScrollBar=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ScrollBar",this.autoHide=!1,this._setValue(0,!1),this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollBar.prototype=Object.create(qc.UIImage.prototype),ScrollBar.prototype.constructor=ScrollBar,Object.defineProperties(ScrollBar.prototype,{"class":{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},direction:{get:function(){return this._direction||ScrollBar.LEFT_TO_RIGHT},set:function(t){this._setDirection(t,!1)}},value:{get:function(){return this._value},set:function(t){this._setValue(t,!0)}},size:{get:function(){return this._size},set:function(t){var e=Phaser.Math.clamp(t,0,1);this.visible=!(this.autoHide&&this.game.math.fuzzyEqual(e,1)),this.visible&&!this.fixSlidersSize&&(this._size=e,this._size=Math.max(5/Math.max(this.height,this.width),this._size),this._updateSliders())}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(t){this._fixSlidersSize=t}},_axisPos:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===ScrollBar.RIGHT_TO_LEFT||this.direction===ScrollBar.BOTTOM_TO_TOP}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}}}),ScrollBar.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.sliders=t.NODE,e.value=t.NUMBER,e.size=t.NUMBER,e.numberOfStep=t.NUMBER,e.direction=t.NUMBER,e.fixSlidersSize=t.BOOLEAN,e.autoHide=t.BOOLEAN,e},ScrollBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ScrollBar.prototype._setDirection=function(t,e){if(this._direction!==t){{var i=this._axisPos;this._reverseValue}if(this._direction=t,e&&i!=this._axisPos){var r=this.width;this.width=this.height,this.height=r}this._updateSliders()}},ScrollBar.prototype._setValue=function(t,e){var i=this._value;this._value=Phaser.Math.clamp(t,0,1),i!==this.value&&(this._updateSliders(),e&&this.onValueChange.dispatch(this.value))},ScrollBar.prototype.postUpdate=function(){this._isMoveNotDragging&&this._doPursued()},ScrollBar.prototype._updateSliders=function(){if(this._slidingRect){var t=new qc.Point(0,0),e=new qc.Point(1,1),i=this.value*(1-this.size),r=this._axisPos;this._reverseValue?(t[r]=1-i-this.size,e[r]=1-i):(t[r]=i,e[r]=i+this.size),this.sliders.setAnchor(t,e,!1)}},ScrollBar.prototype._getSlidersRectInBar=function(){var t=this.sliders.minAnchor,e=this.sliders.maxAnchor,i=this._slidingRect,r=i.width*t.x,n=i.height*t.y,o=i.width*(e.x-t.x),s=i.height*(e.y-t.y),a=i.width/this.rect.width,h=i.height/this.rect.height;return new qc.Rectangle(this.rect.x+r*a,this.rect.y+n*h,o*a,s*h)},ScrollBar.prototype._getSlidersPointInBar=function(t){var e=this.sliders.minAnchor,i=(this.sliders.maxAnchor,this._slidingRect),r=this.sliders.rect.width/i.width,n=this.sliders.rect.height/i.height,o=i.width*e.x+t.x*r,s=i.height*e.y+t.y*n,a=i.width/this.rect.width,h=i.height/this.rect.height;return new qc.Point(this.rect.x+o*a,this.rect.y+s*h)},ScrollBar.prototype._doPursued=function(){var t=this._getSlidersRectInBar(),e=this._axisPos,i=this._axisSize;return this._pursuedPoint<t[e]||this._pursuedPoint>t[e]+t[i]?(this._pursuedPoint<t[e]^this._reverseValue?2!==this._pursuedType&&(this.value-=this.stepSize,this._pursuedType=1):1!==this._pursuedType&&(this.value+=this.stepSize,this._pursuedType=2),undefined):(this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-t[e]-t[i]/2,this._pursuedPoint=0,this._pursuedType=0,undefined)},ScrollBar.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=r[this._axisPos],this._pursuedType=0}}},ScrollBar.prototype._doUp=function(){this._isMoveNotDragging=!1},ScrollBar.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this._isMoveNotDragging=!1;var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),o=this._axisPos,s=this._axisSize;this._offset=r[o]-n[o]-n[s]/2}},ScrollBar.prototype._doDragEnd=function(){this._isMoveNotDragging=!1},ScrollBar.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._getSlidersRectInBar(),o=this._axisPos,s=this._axisSize,a=r[o]-this._offset-this.rect[o]-n[s]/2,h=this.rect[s]*(1-this.size);switch(this.direction){case ScrollBar.LEFT_TO_RIGHT:case ScrollBar.TOP_TO_BOTTOM:this._setValue(a/h,!0);break;case ScrollBar.RIGHT_TO_LEFT:case ScrollBar.BOTTOM_TO_TOP:this._setValue(1-a/h,!0)}}},ScrollBar.prototype._doWheel=function(t,e){if(this.sliders){var i=e.source["delta"+this._axisPos.toUpperCase()],r=this.value;r+=(this._reverseValue?-1:1)*Math.sign(i)*this.stepSize,this._setValue(r,!0)}},ScrollBar.LEFT_TO_RIGHT=0,ScrollBar.RIGHT_TO_LEFT=1,ScrollBar.TOP_TO_BOTTOM=2,ScrollBar.BOTTOM_TO_TOP=3;var ProgressBar=qc.ProgressBar=function(t,e,i){qc.UIImage.call(this,t,e,i),this.name="ProgressBar",this.style=ProgressBar.STYLE_HORIZONTAL,this.value=0,this.minValue=0,this.maxValue=1,this.indeterminable=!1,this.loopTime=3e3,this.numberOfStep=0,this.fixedSize=-1,this._canSlideOut=!0,this.clipSliders=!1,this.showMode=ProgressBar.SHOW_PROCESSED,this.reverse=!1};ProgressBar.prototype=Object.create(qc.UIImage.prototype),ProgressBar.prototype.constructor=ProgressBar,Object.defineProperties(ProgressBar.prototype,{"class":{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(t){this._setStyle(t)}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t,this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(t){this._indeterminable=t}},minValue:{get:function(){return isNaN(this._minValue)||null===this._minValue?0:this._minValue},set:function(t){this.setMinMax(t)}},maxValue:{get:function(){return isNaN(this._maxValue)||null===this._maxValue?1:this._maxValue},set:function(t){this.setMinMax(null,t)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var t=this.stepSize;return t>0?this.minValue+Math.round((this.value-this.minValue)/t)*t:this.value},set:function(t){var e=this.stepSize;e>0?this._setValue(this.minValue+Math.round((t-this.minValue)/e)*e,!0):this._setValue(t)}},value:{get:function(){return this._value||0},set:function(t){t!==this._value&&this._setValue(t,!0)}},loopTime:{get:function(){return this._loopTime},set:function(t){this._loopTime=t}},numberOfStep:{get:function(){return this._numberOfStep},set:function(t){this._numberOfStep=t}},stepSize:{get:function(){return this.numberOfStep>1?this.length/(this.numberOfStep-1):this.style===ProgressBar.STYLE_CIRCLE?this.length/360:this.style===ProgressBar.STYLE_HORIZONTAL?this.length/(this._slidingRect?this._slidingRect.width:this.width):this.length/(this._slidingRect?this._slidingRect.height:this.height)}},fixedSize:{get:function(){return this._fixedSize},set:function(t){this._fixedSize!==t&&(this._fixedSize=t,this._updateSliders())}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},clipSliders:{get:function(){if(!this.sliders)return!1;var t=this.sliders.getScript(qc.NodeMask);return t&&t.enable},set:function(t){this._setClipSliders(t)}},showMode:{get:function(){return this._showMode},set:function(t){this._setShowMode(t)}},reverse:{get:function(){return this._reverse},set:function(t){this._reverse=t,this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(t){this.setCircleScope(t)}},endRadian:{get:function(){return this._endRadian||2*Math.PI},set:function(t){this.setCircleScope(null,t)}},startAngle:{get:function(){return 180*this.startRadian/Math.PI},set:function(t){this.setCircleAngle(t)}},endAngle:{get:function(){return 180*this.endRadian/Math.PI},set:function(t){this.setCircleAngle(null,t)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}},_axisPos:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"width":"height"}}}),ProgressBar.prototype.getMeta=function(){var t=(qc.Serializer,qc.UIImage.prototype.getMeta.call(this));return t.style=qc.Serializer.NUMBER,t.sliders=qc.Serializer.NODE,t._minValue=qc.Serializer.NUMBER,t._maxValue=qc.Serializer.NUMBER,t.value=qc.Serializer.NUMBER,t._startRadian=qc.Serializer.NUMBER,t._endRadian=qc.Serializer.NUMBER,t.indeterminable=qc.Serializer.BOOLEAN,t.loopTime=qc.Serializer.NUMBER,t.numberOfStep=qc.Serializer.NUMBER,t.fixedSize=qc.Serializer.NUMBER,t.showMode=qc.Serializer.NUMBER,t.reverse=qc.Serializer.NUMBER,t},ProgressBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ProgressBar.prototype._resetSliders=function(){if(this.sliders){this.sliders.rotation=0,this.sliders.setAnchor(new qc.Point(0,0),new qc.Point(1,1),!1);var t=this.sliders.getScript(qc.NodeMask);t&&t.setMask(new qc.Point(0,0),new qc.Point(1,1),0,2*Math.PI)}},ProgressBar.prototype._setStyle=function(t){this._style!==t&&(this._style=t,this._resetSliders(),this._updateSliders())},ProgressBar.prototype._setClipSliders=function(t){if(this.clipSliders!==t){if(this.sliders){this._resetSliders();var e=this.sliders.getScript(qc.NodeMask);!e&&t&&(e=this.sliders.addScript("qc.NodeMask")),e&&(e.enable=t)}this._updateSliders()}},ProgressBar.prototype._setShowMode=function(t){this._showMode!==t&&(this._showMode=t,this.sliders&&this._resetSliders(),this._updateSliders())},ProgressBar.prototype.update=function(){this._indeterminable&&this._processIndeterminable()},ProgressBar.prototype.setMinMax=function(t,e){if(t=undefined===t||null===t?this.minValue:t,e=undefined===e||null===e?this.maxValue:e,t>=e)throw Error("Expected:min < max");this._minValue=t,this._maxValue=e,this._setValue(this.value,!0)},ProgressBar.prototype.setCircleScope=function(t,e){if(t=undefined===t||null===t?this.startRadian:t,e=undefined===e||null===e?this.endRadian:e,t>=e||e>t+2*Math.PI)throw Error("Expected:start < end and end <= 2*PI + start");this._startRadian=t,this._endRadian=e,this._updateSliders()},ProgressBar.prototype.setCircleAngle=function(t,e){if(t=undefined===t||null===t?this.startAngle:t,e=undefined===e||null===e?this.endAngle:e,t>=e||e>t+360)throw Error("Expected:start < end and end <= 360 + start");this._startRadian=t*Math.PI/180,this._endRadian=e*Math.PI/180,this._updateSliders()},ProgressBar.prototype._setValue=function(t,e){var i=this.stepValue;this._value=Phaser.Math.clamp(t,this.minValue,this.maxValue),i!==this.stepValue&&this._updateSliders(),e&&this.onValueChange.dispatch(this.value)},ProgressBar.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value,this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime,this._loopValue>this.maxValue+this.stepSize&&(this._loopValue=this.minValue),this.value=this._loopValue},ProgressBar.prototype._updateSliders=function(){if(this._slidingRect){var t=this.sliders.getScript(qc.NodeMask),e=(this.stepValue-this.minValue)/this.length;if(this.reverse&&(e=1-e),this.clipSliders&&t)switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:var i=new qc.Point(0,0),r=new qc.Point(1,1),n=this._axisPos;this.fixedSize<0?this.showMode===ProgressBar.SHOW_PROCESSED?r[n]=Math.min(1,e):i[n]=Math.min(1,e):this._canSlideOut?(e*=1+this.fixedSize,r[n]=Math.min(1,e),i[n]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,i[n]=Math.max(0,e),r[n]=Math.min(1,e+this.fixedSize+1e-5)),t.setMask(i,r);break;case ProgressBar.STYLE_CIRCLE:if(this.fixedSize<0){var o=-Math.PI/2+this.startRadian,s=-Math.PI/2+this.endRadian;this.showMode===ProgressBar.SHOW_PROCESSED?s=o+e*this.showRadian:o+=e*this.showRadian,t.setMask(null,null,o,s)}else{var o=this.startRadian+(e-this.fixedSize)*this.showRadian,s=this.startRadian+e*this.showRadian;if(this.showMode===ProgressBar.SHOW_REMAINED&&this.showRadian===2*Math.PI){var a=s;s=o+2*Math.PI,o=a}t.setMask(null,null,o,s)}}else switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:var i=new qc.Point(0,0),r=new qc.Point(1,1),n=this._axisPos;this.fixedSize<0?this.showMode===ProgressBar.SHOW_PROCESSED?r[n]=Math.max(1e-5,Math.min(1,e)):i[n]=Math.min(.99999,e):this._canSlideOut?(e*=1+this.fixedSize,r[n]=Math.min(1,e),i[n]=Math.max(0,e-this.fixedSize-1e-5)):(e*=1-this.fixedSize,i[n]=Math.max(0,e),r[n]=Math.min(1,e+this.fixedSize+1e-5)),this.sliders.setAnchor(i,r,!1);break;case ProgressBar.STYLE_CIRCLE:this.sliders.rotation=e*this.showRadian+this.startRadian}}},ProgressBar.STYLE_HORIZONTAL=0,ProgressBar.STYLE_VERTICAL=1,ProgressBar.STYLE_CIRCLE=2,ProgressBar.SHOW_PROCESSED=0,ProgressBar.SHOW_REMAINED=1;var Slider=qc.Slider=function(t,e,i){qc.ProgressBar.call(this,t,e,i),this.name="Slider",this.canPursue=!0,this._canSlideOut=!1,this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this);var r=i!==undefined;if(r!==!0){this.state=qc.UIState.NORMAL;var n=this.addScript("qc.TransitionBehaviour");n.target=this.sliders,n.transition=qc.Transition.TEXTURE_SWAP}};Slider.prototype=Object.create(qc.ProgressBar.prototype),Slider.prototype.constructor=Slider,Object.defineProperties(Slider.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this._onStateChange&&this._onStateChange.dispatch())}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(t){this._sliders=t;var e=this.getScript("qc.TransitionBehaviour");e&&(e.target=t?t:this),this._updateSliders()}},onStateChange:{get:function(){return this._onStateChange||(this._onStateChange=new qc.Signal),this._onStateChange}},"class":{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(t){this._canPursue=t}},interactive:{get:function(){return this._interactive},set:function(t){this._interactive=t,this._onInteractive&&this._onInteractive.dispatch(),this.state=this.interactive?qc.UIState.NORMAL:qc.UIState.DISABLED}}}),Slider.prototype.getMeta=function(){var t=(qc.Serializer,qc.ProgressBar.prototype.getMeta.call(this));return t.canPursue=qc.Serializer.BOOLEAN,t},Slider.prototype.update=function(){qc.ProgressBar.prototype.update.call(this),this._isMoveNotDragging&&this._canPursue&&this._doPursued()},Slider.prototype._setStyle=function(t){qc.ProgressBar.prototype._setStyle.call(this,t),this.fixedSize=t===Slider.STYLE_CIRCLE?0:-1},Slider.prototype._calcPointValue=function(t,e){var i=0,r=this.rect;switch(this.style){case Slider.STYLE_HORIZONTAL:case Slider.STYLE_VERTICAL:i=this.minValue+(t[this._axisPos]-r[this._axisPos])*this.length/r[this._axisSize];break;case Slider.STYLE_CIRCLE:var n=2*Math.PI,o=Math.atan2(t.x-r.centerX,r.centerY-t.y);if(0>o&&(o+=n),e)if(undefined===this._tempDragAngle||null===this._tempDragAngle)this._tempDragAngle=o,this._recordDragAngle=o;else{var s=o-this._tempDragAngle;this._tempDragAngle=o,Math.abs(s)>Math.PI&&(s=Phaser.Math.sign(s)*(n-Math.abs(s))),this._recordDragAngle+=s,o=this._recordDragAngle}i=this.minValue+(o-this.startRadian)*this.length/this.showRadian}return this.reverse&&(i=this.maxValue-i+this.minValue),i},Slider.prototype._doWheel=function(t,e){if(this.sliders){var i=Math.abs(e.source.deltaX)<Math.abs(e.source.deltaY)?e.source.deltaY:e.source.deltaX,r=this.value;r+=(this.reverse?-1:1)*Math.sign(i)*this.stepSize,this.value=r}},Slider.prototype._doDown=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._tempDragAngle=null,this._recordDragAngle=null;var i=new qc.Point(e.source.x,e.source.y);if(!this.sliders.rectContains(i)||this.fixedSize<0){var r=this.toLocal(i);this._isMoveNotDragging=!0,this._pursuedPoint=this._calcPointValue(r),this._pursuedType=0}}},Slider.prototype._doUp=function(){this._isMoveNotDragging=!1,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDragStart=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._isMoveNotDragging=!1;var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i);this._offset=this._calcPointValue(r,!0)-this.value}},Slider.prototype._doDragEnd=function(){this._isMoveNotDragging=!1,this._tempDragAngle=null,this._recordDragAngle=null,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDrag=function(t,e){if(this.sliders&&e.source.eventId==qc.Mouse.BUTTON_LEFT){var i=new qc.Point(e.source.x,e.source.y),r=this.toLocal(i),n=this._calcPointValue(r,!0)-this._offset;this._setValue(n,!0)}},Slider.prototype._doPursued=function(){for(var t=this.stepSize,e=Math.max(1,Math.ceil(this.length/10/t));e--;){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+t)return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-this.value,this._pursuedPoint=0,this._pursuedType=0,undefined;this._pursuedPoint<this.value^this.reverse?2!==this._pursuedType&&(this.value-=t,this._pursuedType=1):1!==this._pursuedType&&(this.value+=t,this._pursuedType=2)}},Slider.STYLE_HORIZONTAL=qc.ProgressBar.STYLE_HORIZONTAL,Slider.STYLE_VERTICAL=qc.ProgressBar.STYLE_VERTICAL,Slider.STYLE_CIRCLE=qc.ProgressBar.STYLE_CIRCLE,Slider.SHOW_PROCESSED=qc.ProgressBar.SHOW_PROCESSED,Slider.SHOW_REMAINED=qc.ProgressBar.SHOW_REMAINED;var InputField=qc.InputField=function(t,e,i){var r=this;qc.UIImage.call(r,t,e,i),r.name="InputField",r.onStateChange=new qc.Signal,r.onValueChange=new qc.Signal,r.interactive=!0;var n=r.div=document.createElement("div"),o=n.style;o.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),o.position="absolute",o.padding=0,o.margin=0,o.border=0,o.outline=0,o.background="none",r.game.world.frontDomRoot.appendChild(n);var s=i!==undefined;if(s!==!0){var a=r.textComponent=t.add.text(r);a.text="",a.name="Text",a.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),a.left=5,a.right=5,a.top=5,a.bottom=5,a.interactive=!1,a.color=Color.black,a.alignV=UIText.MIDDLE,a.alignH=UIText.LEFT;var h=r.placeholder=t.add.text(r);h.text="Enter text...",h.name="Placeholder",h.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),h.left=5,h.right=5,h.top=5,h.bottom=5,h.interactive=!1,h.color=Color.grey,h.alignV=UIText.MIDDLE,h.alignH=UIText.LEFT,this.state=qc.UIState.NORMAL;var l=this.addScript("qc.TransitionBehaviour");l.target=this}var c=function(t){t.preventDefault(),r.state!==qc.UIState.DISABLED&&r.startEditing()};n.addEventListener("mouseup",c,!1),n.addEventListener("touchend",c,!1),this.onDown.add(function(){r.state!==qc.UIState.DISABLED&&(r.state=qc.UIState.PRESSED)}),this.onUp.add(function(){r.state===qc.UIState.PRESSED&&(r.state=qc.UIState.NORMAL)}),r.phaser.worldTransformChangedCallback=r._updateNativeDiv.bind(r),r.phaser.worldTransformChangedContext=r,this.text="",this.width=120,this.height=30,this._checkVisibility()};InputField.SINGLE_LINE=0,InputField.MULTI_LINE=1,InputField.STANDARD=0,InputField.INT=1,InputField.NUMBER=2,InputField.TEL=3,InputField.EMAIL=4,InputField.PASSWORD=5,InputField.prototype=Object.create(qc.UIImage.prototype),InputField.prototype.constructor=InputField,InputField.prototype._characterLimit=-1,InputField.prototype._lineType=InputField.SINGLE_LINE,InputField.prototype._contentType=InputField.STANDARD,InputField.prototype._input=null,InputField.prototype._password="",InputField.prototype.textComponent=null,InputField.prototype.placeholder=null,Object.defineProperties(InputField.prototype,{"class":{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},lineType:{get:function(){return this._lineType},set:function(t){this._lineType=t}},contentType:{get:function(){return this._contentType},set:function(t){this._contentType!==t&&(this._contentType=t,this.text=this.text)}},textComponent:{get:function(){return this._textComponent&&this._textComponent._destroy&&(this._textComponent=null),this._textComponent},set:function(t){this._textComponent=t}},placeholder:{get:function(){return this._placeholder&&this._placeholder._destroy&&(this._placeholder=null),this._placeholder},set:function(t){this._placeholder=t}},placeholderText:{get:function(){var t=this.placeholder;return t?t.text:""},set:function(t){var e=this.placeholder;e&&(e.text=t)}},text:{get:function(){var t=this.textComponent;return t?this._contentType===InputField.PASSWORD?this._password:this.textComponent.text:""},set:function(t){if(this.textComponent&&(t=this.toValidateText(t),t!==this.text)){if(this._contentType===InputField.PASSWORD){this._password=t;for(var e="",i=0;i<t.length;i++)e+="·";this.textComponent.text=e}else this.textComponent.text=t;this.onValueChange.dispatch(t)}}},characterLimit:{get:function(){return this._characterLimit
},set:function(t){this.characterLimit!==t&&(this._characterLimit=t,this.text=this.text)}},overflow:{get:function(){return this.textComponent?this.textComponent.overflow:!1},set:function(t){this.textComponent&&(this.textComponent.overflow=t)}},isFocused:{get:function(){return!!this.getInput()},set:function(t){t?this.startEditing():this.stopEditing()}}}),InputField.prototype.getMeta=function(){var t=qc.Serializer,e=qc.UIImage.prototype.getMeta.call(this);return e.lineType=t.NUMBER,e.contentType=t.NUMBER,e.placeholder=t.NODE,e.textComponent=t.NODE,e.text=t.STRING,e.overflow=t.BOOLEAN,e.state=t.NUMBER,e._password=t.STRING,e.characterLimit=t.NUMBER,e},InputField.prototype.update=function(){var t=this.getInput(),e=this.textComponent,i=this.placeholder,r=e.textPhaser.renderable;t?(e&&(e.textPhaser.renderable=!1),i&&(i.textPhaser.renderable=!1),this._updateInput(t)):(e&&(e.textPhaser.renderable=!0),i&&(i.textPhaser.renderable=""===this.text)),e.textPhaser.renderable!==r&&(e.textPhaser.displayChanged(e.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this.phaser.displayChanged(e.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE))},InputField.prototype.toValidateText=function(t){switch(t=t||"",this.contentType){case InputField.INT:t=t.replace(/[^\d\-]/g,"");break;case InputField.NUMBER:t=t.replace(/[^\d\.\-]/g,"");break;case InputField.EMAIL:t=t.replace(/[^\w0-9\@\.]/g,"");break;case InputField.TEL:t=t.replace(/[^\d\(\)\+\-\s]/g,"")}return this.characterLimit>0&&t.length>this.characterLimit&&(t=t.substr(0,this.characterLimit)),t},InputField.prototype.startEditing=function(){var t=this,e=t.textComponent;if(e){var i=this._input;if(!i){if(this.lineType===InputField.MULTI_LINE)i=t._input=document.createElement("textarea"),i.onkeydown=function(e){Keyboard.ESC===e.keyCode&&t.cancelEditing()};else{switch(i=t._input=document.createElement("input"),i.onkeydown=function(e){Keyboard.ENTER===e.keyCode?t.stopEditing():Keyboard.ESC===e.keyCode&&t.cancelEditing()},t.contentType){case InputField.PASSWORD:i.type="password";break;case InputField.EMAIL:i.type="email";break;case InputField.TEL:i.type="tel";break;case InputField.INT:case InputField.NUMBER:i.type="number";break;default:i.type="text"}switch(e.alignH){case UIText.LEFT:i.style.textAlign="left";break;case UIText.RIGHT:i.style.textAlign="right";break;default:i.style.textAlign="center"}switch(e.alignV){case UIText.TOP:i.style.verticalAlign="top";break;case UIText.BOTTOM:i.style.verticalAlign="bottom";break;default:i.style.verticalAlign="middle"}}this.characterLimit>0&&i.setAttribute("maxlength",this.characterLimit),i._qc=t,i.value=t.text;var r=i.style;r.position="absolute",r.padding=0,r.margin=0,r.border=0,r.outline=0,r.background="none",i.onblur=function(){t.stopEditing()},i._handleClick=function(e){e.target!==t.div&&e.target!==i&&t.stopEditing()};var n=t.game.world.frontDomRoot;n.addEventListener("mousedown",i._handleClick,!1),n.addEventListener("touchstart",i._handleClick,!1),t.game.input._inputting++;var o=document.createElement("div");o.style.width=this.game.canvas.style.width,o.style.height=this.game.canvas.style.height,o.style.position="absolute",o.style.overflow="hidden",o.appendChild(i),n.appendChild(o),t._updateInput(i),i.focus(),t._updateNativeInput(),e.phaser.worldTransformChangedCallback=this._updateNativeInput.bind(t),e.phaser.worldTransformChangedContext=e}}},InputField.prototype._updateInput=function(t){var e=this.game.time.now;if(!t._lastUpdate||e-t._lastUpdate>=100){t._lastUpdate=e;var i=this.textComponent;i.textPhaser instanceof Phaser.Text&&(t.style.font=i.textPhaser.style.font),t.style.fontSize=i.fontSize+"px",t.style.color=""+i.color,t._lastValue!==t.value&&(t._lastValue=t.value,this.text=t.value)}},InputField.prototype.getInput=function(){return this._input&&!this.textComponent&&this.cancelEditing(),this._input},InputField.prototype.cancelEditing=function(){var t=this._input;if(t){this._input=null,this.game.input._inputting--;var e=this.game.world.frontDomRoot;e.removeEventListener("mousedown",t._handleClick,!1),e.removeEventListener("touchstart",t._handleClick,!1),qc.Util.removeHTML(t.parentNode)}},InputField.prototype.stopEditing=function(){var t=this.getInput();t&&(this.text=t.value,this.cancelEditing())},InputField.prototype.onDestroy=function(){this.cancelEditing(),qc.Util.removeHTML(this.div),qc.UIImage.prototype.onDestroy.call(this)},InputField.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._checkVisibility()},InputField.prototype.onVisibleChange=function(){this._checkVisibility()},InputField.prototype._checkVisibility=function(){var t=this.isWorldVisible();this.div.style.display=t?"block":"none",t||this.stopEditing()},InputField.prototype._updateNativeDiv=function(){var t=this,e=t.div;e._lastUpdate=t.game.time.now,qc.Util.updateTransform(t,e)},InputField.prototype._updateNativeInput=function(){var t=this,e=t.getInput();e&&qc.Util.updateTransform(t.textComponent,e)};var Tilemap=qc.Tilemap=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="Tilemap",this._copyCanvas=Phaser.Canvas.create(1,1),this._copyContext=this._copyCanvas.getContext("2d")};Tilemap.prototype=Object.create(qc.Node.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype._data=null,Tilemap.prototype._scrollX=0,Tilemap.prototype._scrollY=0,Tilemap.prototype._layers=0,Tilemap.prototype._tilesets=0,Tilemap.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.data=Serializer.TEXTASSET,t.scrollX=Serializer.NUMBER,t.scrollY=Serializer.NUMBER,t.layers=Serializer.NODES,t.tilesets=Serializer.TEXTURES,t},Tilemap.prototype.generateLayers=function(t){var e=this,i=e.data;if(i){for(var r=e.game,n=e._dataInfo,o=n.json,s=o.tilesets,a=[],h=0;h<s.length;h++)a.push({key:s[h].name,url:n.prefix+s[h].name+".bin"});r.assets.loadBatch(a,function(){for(var i=[],n=0;n<a.length;n++)i.push(new qc.Texture(a[n].asset));e.tilesets=i,e.removeChildren();for(var s=[],n=0;n<o.layers.length;n++){var h=o.layers[n];if("tilelayer"===h.type){var l=new TileLayer(r,e);l.name=h.name,l.tilemap=e,l.layerIndex=n,s.push(l)}else if("objectgroup"===h.type){var c=new ObjectLayer(r,e);c.name=h.name,c.tilemap=e,c.layerIndex=n,s.push(c)}}e.layers=s,t&&t()})}},Tilemap.prototype.getLayerByIndex=function(t){var e=this._layers;return e&&t>=0&&t<e.length?e[t]:null},Tilemap.prototype.getLayerByName=function(t){var e=this._layers;if(e)for(var i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null},Tilemap.prototype._getLayerJson=function(t,e){if(this._dataInfo){var i=this._dataInfo.json.layers;if(t>=0&&t<i.length){var r=i[t];if(r.type===e)return r}return null}},Tilemap.prototype.resetNativeSize=function(){var t=this.nativeSize;t&&(this.width=t.width,this.height=t.height)},Tilemap.prototype.getTilePosition=function(t,e){return new qc.Point(Math.floor(t/this.tileWidth),Math.floor(e/this.tileHeight))},Object.defineProperties(Tilemap.prototype,{nativeSize:{get:function(){var t=this._dataInfo;return t?new qc.Rectangle(0,0,t.map.widthInPixels,t.map.heightInPixels):null}},layers:{get:function(){return this._layers},set:function(t){this._layers=t}},tilesets:{get:function(){return this._tilesets},set:function(t){this._tilesets=t}},scrollX:{get:function(){return this._scrollX},set:function(t){this._scrollX=t}},scrollY:{get:function(){return this._scrollY},set:function(t){this._scrollY=t}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(t){var e=this,i=e.game,r=null;if(t){if(!(t instanceof TextAsset))return;try{var n=JSON.parse(t.text);if(!n.layers||!n.tilesets)throw Error("Invalid tilemap data format");i.phaser.load.tilemap(t.url,null,n,Phaser.Tilemap.TILED_JSON);for(var o=i.phaser.add.tilemap(t.url),s=0,a=0,h=0;h<o.tilesets.length;h++)s=Math.max(s,o.tilesets[h].tileWidth),a=Math.max(a,o.tilesets[h].tileHeight);o.maxTileWidth=s,o.maxTileHeight=a;var l=t.url.lastIndexOf("/");r={json:n,map:o,prefix:0>l?"":t.url.substring(0,l+1)}}catch(c){return i.log.error("Asset{0}/{1} Parse fail",t.key,t.url,c),qc.Util.popupError(c.message),undefined}}e._data=t,e._dataInfo=r}},"class":{get:function(){return"qc.Tilemap"}}});var TileLayer=qc.TileLayer=function(t,e,i){var r=this,n=new Phaser.Sprite(t.phaser);qc.Node.call(r,n,e,i),r.name="TileLayer",r._cache={},r._dirtyTiles=null,n.canvas=Phaser.Canvas.create(1,1),n.context=n.canvas.getContext("2d"),n.baseTexture=new PIXI.BaseTexture(n.canvas),n.texture=new PIXI.Texture(n.baseTexture),r.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),r.setStretch(0,0,0,0);var o=n._renderCanvas,s=n._renderWebGL;n._renderCanvas=function(){r._renderTiles(),o.apply(n,arguments)},n._renderWebGL=function(){r._renderTiles(),s.apply(n,arguments)}};TileLayer.prototype=Object.create(qc.Node.prototype),TileLayer.prototype.constructor=TileLayer,TileLayer.prototype._tilemap=null,TileLayer.prototype._layerIndex=-1,TileLayer.prototype._scrollXRatio=1,TileLayer.prototype._scrollYRatio=1,TileLayer.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.tilemap=Serializer.NODE,t.layerIndex=Serializer.INT,t.scrollXRatio=Serializer.NUMBER,t.scrollYRatio=Serializer.NUMBER,t},TileLayer.prototype.getTile=function(t,e){var i=this._cache,r=this.tilemap;if(!r)return undefined;var n=i.phaserLayer;if(!n||i.tilemap!==r||i.layerIndex!==this.layerIndex){n=null;var o=r._getLayerJson(this.layerIndex,"tilelayer");if(o){var s=r._dataInfo.map,a=s.getLayerIndex(o.name);0>a||(n=s.layers[a])}}return n&&n.data&&n.data[e]?n.data[e][t]:undefined},TileLayer.prototype.getTileIndex=function(t,e){var i=this.getTile(t,e);return i?i.index:1/0},TileLayer.prototype.setTileIndex=function(t,e,i){var r=this.getTile(t,e);r&&r.index!==i&&(r.index=i,this._dirtyTiles||(this._dirtyTiles={}),this._dirtyTiles[t+"|"+e]={x:t,y:e})},TileLayer.prototype.redrawAll=function(){this._redrawAllFlag=!0},TileLayer.prototype._renderTiles=function(){var t=this,e=t.tilemap;if(e){var i=t._cache,r=t.phaser,n=e._dataInfo.map,o=t._checkTileLayerChange(n),s=i.phaserLayer;if(s){t._redrawAllFlag&&(o=!0,t._redrawAllFlag=!1);var a=r.context,h=s.data,l=Math.round(t.width),c=Math.round(t.height),u=e.scrollX,p=e.scrollY,d=t.scrollXRatio,f=t.scrollYRatio;o=t._checkSizeChange(l,c)||o;var g=!1;if(o||i.scrollX!==u||i.scrollY!==p||i.scrollXRatio!==d||i.scrollYRatio!==f){var m=Math.round(u*d),_=Math.round(p*f),y=i.viewRect,v=new Phaser.Rectangle(-m,-_,l,c);if(!o){var T=Phaser.Rectangle.intersection(y,v);if(T.width>10&&T.height>10){var x=T.x-y.x,S=T.y-y.y,b=T.width,w=T.height;e._copyCanvas.width!==l&&(e._copyCanvas.width=l),e._copyCanvas.height!==c&&(e._copyCanvas.height=c),e._copyContext.clearRect(x,S,b,w),e._copyContext.drawImage(r.canvas,x,S,b,w,x,S,b,w)}else o=!0}a.clearRect(0,0,l,c),a.translate(m,_),o?(t._dirtyTiles=null,t._drawRect(a,n,h,-m,-_,l,c)):(a.drawImage(e._copyCanvas,x,S,b,w,T.x,T.y,b,w),v.contains(y.left,y.top)?(t._drawRect(a,n,h,v.x,v.y,T.x-v.x,v.height),t._drawRect(a,n,h,T.x,v.y,v.right-T.x,T.y-v.y)):v.contains(y.right,y.top)?(t._drawRect(a,n,h,v.x,v.y,T.right-v.x,T.y-v.y),t._drawRect(a,n,h,T.right,v.y,v.right-T.right,v.height)):v.contains(y.left,y.bottom)?(t._drawRect(a,n,h,v.x,v.y,T.x-v.x,v.height),t._drawRect(a,n,h,T.x,T.bottom,v.right-T.x,v.bottom-T.bottom)):v.contains(y.right,y.bottom)&&(t._drawRect(a,n,h,v.x,T.bottom,T.right-v.x,v.bottom-T.bottom),t._drawRect(a,n,h,T.right,v.y,v.right-T.right,v.height))),a.translate(-m,-_),g=!0,i.scrollX=u,i.scrollY=p,i.scrollXRatio=d,i.scrollYRatio=f,i.viewRect=v}var A=t._renderDirtyTiles(a,n,h);(g||A)&&(r.texture.baseTexture.dirty(),r.displayChanged(qc.DisplayChangeStatus.TEXTURE))}}},TileLayer.prototype._renderDirtyTiles=function(t,e,i){var r=this,n=!1;if(r._dirtyTiles){var o=e.maxTileWidth,s=e.maxTileHeight,a=e.tileWidth,h=e.tileHeight,l=r._cache.viewRect,c=o>a?-o:0,u=s>h?s:0,p=Math.floor((l.x+c)/a),d=Math.floor(l.y/h),f=Math.ceil((l.x+l.width)/a),g=Math.ceil((l.y+l.height+u)/h);t.translate(-l.x,-l.y);for(var m in r._dirtyTiles){var _=r._dirtyTiles[m],y=_.x,v=_.y;p>y||y>f||d>v||v>g||(r._drawRect(t,e,i,y*a,v*h+h-s,o,s,!0),n=!0)}t.translate(l.x,l.y),r._dirtyTiles=null}return n},TileLayer.prototype._checkTileLayerChange=function(t){var e=this._cache,i=this.tilemap,r=this.layerIndex;if(e.tilemap!==i||e.layerIndex!==r){e.phaserLayer=null;var n=i._getLayerJson(r,"tilelayer");if(n){var o=t.getLayerIndex(n.name);0>o||(e.phaserLayer=t.layers[o])}return e.tilemap=i,e.layerIndex=r,!0}return!1},TileLayer.prototype._checkSizeChange=function(t,e){var i=this._cache,r=this.phaser,n=r.texture;return i.width!==t||i.height!==e?(r.canvas.width=t,r.canvas.height=e,n.frame.width=t,n.frame.height=e,n.width=t,n.height=e,n.crop.width=t,n.crop.height=e,n.baseTexture.width=t,n.baseTexture.height=e,n.baseTexture.dirty(),i.width=t,i.height=e,!0):!1},TileLayer.prototype._drawRect=function(t,e,i,r,n,o,s,a){if(o&&s){a&&t.clearRect(r,n,o,s),t.save(),t.beginPath(),t.rect(r,n,o,s),t.clip();var h=e.maxTileWidth,l=e.maxTileHeight,c=e.tileWidth,u=e.tileHeight,p=Math.floor((h>c?r-h:r)/c),d=Math.floor(n/u),f=Math.ceil((r+o)/c),g=Math.ceil((l>u?n+s+l:n+s)/u);for(0>p&&(p=0),0>d&&(d=0),f>e.width&&(f=e.width),g>e.height&&(g=e.height),n=d;g>n;n++){var m=i[n];for(r=p;f>r;r++)this._drawTile(t,e,m[r],r,n)}t.restore()}},TileLayer.prototype._drawTile=function(t,e,i){var r=i.index;if(r>0){var n=e.tiles[r],o=e.tilesets[n[2]],s=o.asset;if(s===undefined){var a=this.tilemap._dataInfo.prefix+o.name+".bin",h=this.tilemap.tilesets;if(h)for(var l=0;l<h.length;l++)if(h[l].atlas.url===a){s=h[l];break}o.asset=s?s:null}s&&t.drawImage(s.atlas.img,n[0],n[1],o.tileWidth,o.tileHeight,i.worldX,i.worldY+e.tileHeight-o.tileHeight,o.tileWidth,o.tileHeight)}},Object.defineProperties(TileLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Tilemap)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},"class":{get:function(){return"qc.TileLayer"}}});var ObjectLayer=qc.ObjectLayer=function(t,e,i){qc.Node.call(this,new Phaser.Group(t.phaser,null),e,i),this.name="ObjectLayer",this.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.setStretch(0,0,0,0)};ObjectLayer.prototype=Object.create(qc.Node.prototype),ObjectLayer.prototype.constructor=ObjectLayer,ObjectLayer.prototype._tilemap=null,ObjectLayer.prototype._layerIndex=-1,ObjectLayer.prototype._scrollXRatio=1,ObjectLayer.prototype._scrollYRatio=1,ObjectLayer.prototype.getMeta=function(){var t=qc.Node.prototype.getMeta.call(this);return t.tilemap=Serializer.NODE,t.layerIndex=Serializer.INT,t.scrollXRatio=Serializer.NUMBER,t.scrollYRatio=Serializer.NUMBER,t},ObjectLayer.prototype.update=function(){this._tilemap&&this._tilemap._destroy&&(this._tilemap=null);var t=this._tilemap;t&&(this.x=t.scrollX*this.scrollXRatio,this.y=t.scrollY*this.scrollXRatio)},Object.defineProperties(ObjectLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(t){(!t||t instanceof Tilemap)&&(this._tilemap=t)}},layerIndex:{get:function(){return this._layerIndex},set:function(t){this._layerIndex=t}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(t){this._scrollXRatio=t}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(t){this._scrollYRatio=t}},"class":{get:function(){return"qc.ObjectLayer"}}});var Dom=qc.Dom=function(t,e,i){var r=this;r.game=t,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),e,i),r.name="dom";var n=r.div=document.createElement("div");n.style.position="absolute",n.setAttribute("id",r.uuid),n._qc=r,r.overflow="hidden",r.serializable=!0,r.phaser.worldTransformChangedCallback=r._updateDomTransform,r.phaser.worldTransformChangedContext=r,r.pos=Dom.POS_FRONT,r._updateDomTransform(),r.game.device.android&&(r.game.timer.add(1,function(){r._destroy||(r.rotation+=.001)}),r.game.timer.add(40,function(){r._destroy||(r.rotation-=.002)}),r.game.timer.add(300,function(){r._destroy||(r.rotation+=5e-4)}),r.game.timer.add(1e3,function(){r._destroy||(r.rotation+=5e-4)}))};Dom.prototype=Object.create(qc.Node.prototype),Dom.prototype.constructor=Dom,Dom.POS_NONE=-1,Dom.POS_BACK=0,Dom.POS_FRONT=1,Object.defineProperties(Dom.prototype,{"class":{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(t){this.pos!==t&&(this._pos=t,this.div.parentNode&&this.div.parentNode.removeChild(this.div),t===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex<0||(this.zIndex=-1)):t===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex>0||(this.zIndex=1)))}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(t){t!==this.div.style.zIndex&&(this._pos!==Dom.POS_BACK||0>t?this._pos!==Dom.POS_FRONT||t>0||(t=1):t=-1,this.div.style.zIndex=t)}},innerHTML:{get:function(){return this.div.innerHTML},set:function(t){this.div.innerHTML=t}},className:{get:function(){return this.div.className},set:function(t){this.div.className=t}},overflow:{get:function(){return this._overflow},set:function(t){t!==this._overflow&&(this._overflow=t,this.div.style.overflow=t)}},alpha:{get:function(){var t=this.div,e=t.style.opacity;return e?1*e:1},set:function(t){var e=this,i=e.div;t!==i.alpha&&(i.style.filter="alpha(opacity:"+100*t+")",i.style.opacity=t)}}}),Dom.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._updateDomTransform()},Dom.prototype.onVisibleChange=function(){this._updateDomTransform()},Dom.prototype.onRemoveFromWorld=function(){this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div)},Dom.prototype.onAddToWorld=function(){if(this.div&&!this.div.parentNode){var t=this.pos;t===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex<0||(this.zIndex=-1)):t===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex>0||(this.zIndex=1))}},Dom.prototype.onDestroy=function(){this.div._qc=null,this.div.parentNode&&this.div.parentNode.removeChild(this.div),qc.Node.prototype.onDestroy.call(this)},Dom.prototype.getMeta=function(){var t=this,e=qc.Serializer,i=qc.Node.prototype.getMeta.call(this);return i.pos=e.NUMBER,i.className=e.STRING,i.overflow=e.STRING,i.innerHTML={get:function(t){return t.serializable?[!0,t.innerHTML]:undefined},set:function(e,i){i?(t.serializable=!0,t.innerHTML=i[1]):(t.serializable=!1,t.innerHTML="")}},i.zIndex=e.INT,i},Dom.prototype._updateDomTransform=function(){qc.Util.updateTransform(this,this.div),this.div.style.display=this.isWorldVisible()?"block":"none"};var Graphics=qc.Graphics=function(t,e,i){var r=this;r.game=t,qc.Node.call(this,new Phaser.Graphics(this.game.phaser),e,i),r.name="graphics"};Graphics.prototype=Object.create(qc.Node.prototype),Graphics.prototype.constructor=Graphics,Object.defineProperties(Graphics.prototype,{"class":{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(t){this.phaser.fillAlpha=t}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(t){this.phaser.lineWidth=t}},lineColor:{get:function(){return this.phaser.lineColor},set:function(t){this.phaser.lineColor=t}},blendMode:{get:function(){return this.phaser.blendMode},set:function(t){this.phaser.blendMode=t}},boundsPadding:{get:function(){return this.phaser.boundsPadding},set:function(t){this.phaser.boundsPadding=t}}}),Graphics.prototype.getMeta=function(){var t=(qc.Serializer,qc.Node.prototype.getMeta.call(this));return t},Graphics.prototype.drawTriangle=function(t,e){return this.phaser.drawTriangle(t,e)},Graphics.prototype.drawTriangles=function(t,e,i){return this.phaser.drawTriangles(t,e,i)},Graphics.prototype.lineStyle=function(t,e,i){return this.phaser.lineStyle(t,e,i)},Graphics.prototype.moveTo=function(t,e){return this.phaser.moveTo(t,e)},Graphics.prototype.lineTo=function(t,e){return this.phaser.lineTo(t,e)},Graphics.prototype.quadraticCurveTo=function(t,e,i,r){return this.quadraticCurveTo(t,e,i,r)},Graphics.prototype.bezierCurveTo=function(t,e,i,r,n,o){return this.phaser.bezierCurveTo(t,e,i,r,n,o)},Graphics.prototype.arcTo=function(t,e,i,r,n){return this.phaser.arcTo(t,e,i,r,n)},Graphics.prototype.arc=function(t,e,i,r,n,o){return this.phaser.arc(t,e,i,r,n,o)},Graphics.prototype.beginFill=function(t,e){return this.phaser.beginFill(t,e)},Graphics.prototype.endFill=function(){return this.phaser.endFill()},Graphics.prototype.drawRect=function(t,e,i,r){return this.phaser.drawRect(t,e,i,r)},Graphics.prototype.drawRoundedRect=function(t,e,i,r,n){return this.phaser.drawRoundedRect(t,e,i,r,n)},Graphics.prototype.drawCircle=function(t,e,i){return this.phaser.drawCircle(t,e,i)},Graphics.prototype.drawEllipse=function(t,e,i,r){return this.phaser.drawEllipse(t,e,i,r)},Graphics.prototype.drawPolygon=function(t){return this.phaser.drawPolygon(t)},Graphics.prototype.clear=function(){return this.phaser.clear()},Graphics.prototype.generateTexture=function(t,e){return this.phaser.generateTexture(t,e)},Graphics.prototype.containsPoint=function(t){return this.phaser.containsPoint(t)},Graphics.prototype.drawShape=function(t){return this.phaser.drawShape(t)};var Dropdown=qc.Dropdown=function(t,e,i){var r=this;qc.UIImage.call(r,t,e,i),r.onStateChange=new qc.Signal,r.onValueChange=new qc.Signal,r.captionImage=null,r.captionText=null,r.item=null,r.options=[],r.template=null;var n=i!==undefined;if(r.name="Dropdown",r.interactive=!0,r._items=[],r._value=-1,n!==!0){r.captionText=t.add.text(r),r.captionText.name="Label",r.captionImage=t.add.image(r),r.captionImage.name="Image",r.template=t.add.scrollView(r),r.template.interactive=!0,r.template.name="Template";var o=r.template.addScript("qc.NodeMask");o.checkInField=!1,r.template.content=t.add.node(r.template),r.template.visible=!1,r.template.content.name="Content";var s=r.item=t.add.node(r.template.content);s.name="Item",s.interactive=!0;var a=s.addScript("qc.DropdownItem");a.checkBackground=t.add.image(s),a.checkBackground.name="Background",a.checkMark=t.add.image(s),a.checkMark.name="CheckMark",a.text=t.add.text(s),a.text.name="Text",a.image=t.add.image(s),a.image.name="Image",a.image.visible=!1}r.addListener(r.onDown,function(){r.state!==qc.UIState.DISABLED&&(r.state=qc.UIState.PRESSED)}),r.addListener(r.onUp,function(){r.state===qc.UIState.PRESSED&&(r.state=qc.UIState.NORMAL)}),r.addListener(r.onClick,function(){r.isFocused=!r.isFocused}),r.phaser.worldTransformChangedCallback=r._updatePosition,r.phaser.worldTransformChangedContext=r,r._updatePosition()};Dropdown.prototype=Object.create(qc.UIImage.prototype),Dropdown.prototype.constructor=Dropdown,Object.defineProperties(Dropdown.prototype,{"class":{get:function(){return"qc.Dropdown"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(t){this.state!==t&&(this._state=t,this.onStateChange.dispatch())}},value:{get:function(){return this.options.length>0?this._value:-1},set:function(t){if(this._value!==t&&t<this.options.length&&"number"==typeof this._value){var e=this._items[this._value],i=this._items[t];this._value=t,e&&e.getScript("qc.DropdownItem").redraw(),i&&i.getScript("qc.DropdownItem").redraw(),this._redraw(),this.onValueChange.dispatch(t)}}},isFocused:{get:function(){return this._list&&this._list.visible},set:function(t){t!==this.isFocused&&(t?this.show():this.hide())}}}),Dropdown.prototype._dispatchAwake=function(){var t=this;Node.prototype._dispatchAwake.call(t),t._value&&0!==t.options.length||(t._value=-1),t._redraw()},Dropdown.prototype.addOptions=function(t){var e=this,i=e.options.concat(t);0===e.options.length?(e.options=i,this.value=0):e.options=i,e.isFocused&&e.show()},Dropdown.prototype.clearOptions=function(){var t=this;t.options=[],t._value<0||(t._value=-1,t.onValueChange.dispatch(t._value)),t.isFocused&&t.hide(),t._redraw()},Dropdown.prototype.show=function(){var t=this,e=t._list;t.hide(),t._maskNode=t.game.add.node(t.game.world),t._maskNode.interactive=!0,t._maskNode.name="mask",t._maskNode.addListener(t._maskNode.onClick,function(){t.hide()}),t._items=[],t.item.visible=!1,e=t._list=t.game.add.clone(t.template,t.game.world);for(var i="",r=t.item.parent;r!==t.template;)i=""===i?r.name:r.name+"/"+i,r=r.parent;for(var n=""===i?e:e.find(i),o=0;o<t.options.length;o++){var s=t.game.add.clone(t.item,n);s.visible=!0;var a=s.getScript("qc.DropdownItem");a.dropdown=t,a.index=o,t._items.push(s)}e.visible=!0,t._updatePosition()},Dropdown.prototype.hide=function(){var t=this,e=t._list;e&&(e.destroy(),delete t._list),t._maskNode&&(t._maskNode.destroy(),delete t._maskNode),t._items=[]},Dropdown.prototype.getMeta=function(){var t=this,e=qc.Serializer,i=qc.UIImage.prototype.getMeta.call(t);return i.captionImage=e.NODE,i.captionText=e.NODE,i.template=e.NODE,i.item=e.NODE,i.maskNode=e.NODE,i.state=e.NUMBER,i._value=e.NUMBER,i.options={get:function(e,i){for(var r=[],n=0;n<t.options.length;n++){var o=t.options[n];r.push(o?"string"!=typeof o?t.game.serializer._saveTextureItem(o,i):o:undefined)}return r},set:function(e,i){i.forEach(function(e){return e&&"string"!=typeof e?(t.options.push(t.game.serializer._restoreTextureItem(e)),undefined):(t.options.push(e),undefined)})}},i},Dropdown.prototype._redraw=function(){var t=this;if(0===t.options.length||t.value<0||t.value>=t.options.length)return t.captionImage&&(t.captionImage.visible=!1),t.captionText&&(t.captionText.visible=!1),undefined;var e=t.options[t.value];"string"==typeof e?(t.captionImage&&(t.captionImage.visible=!1),t.captionText&&(t.captionText.visible=!0,t.captionText.text=e)):e&&(t.captionText&&(t.captionText.visible=!1),t.captionImage&&(t.captionImage.visible=!0,t.captionImage.texture=e))},Dropdown.prototype._updatePosition=function(){var t=this,e=t._list;if(e){t.template.visible=!0;var i=qc.Bounds.getBox(t,Bounds.USE_BOUNDS,!0,0),r=qc.Bounds.getBox(t.template,Bounds.USE_BOUNDS,!0,0),n=r.y;if(r.height<t.game.world.height/2&&r.y+r.height>t.game.world.height){var o=r.y-(i.y+i.height);n=i.y-o-r.height}var s=t.template.getWorldPosition();e.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),e.x=s.x,e.y=n-e.pivotY*e.height;var a=t.template.getWorldScale();e.scaleX=a.x,e.scaleY=a.y,e.rotation=t.template.getWorldRotation(),e.width=t.template.width,e.height=t.template.height,t._maskNode.x=t._maskNode.y=0,t._maskNode.width=t.game.world.width,t._maskNode.height=t.game.world.height,t.template.visible=!1}};var Bounds=defineBehaviour("qc.Bounds",qc.Behaviour,function(){this._sizeProvider=Bounds.USE_BOUNDS,this._autoCalcBounds=!0,this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0,this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0,this._deep=1},{_sizeProvider:qc.Serializer.NUMBER,_marginTop:qc.Serializer.NUMBER,_marginBottom:qc.Serializer.NUMBER,_marginLeft:qc.Serializer.NUMBER,_marginRight:qc.Serializer.NUMBER,_paddingTop:qc.Serializer.NUMBER,_paddingBottom:qc.Serializer.NUMBER,_paddingLeft:qc.Serializer.NUMBER,_paddingRight:qc.Serializer.NUMBER,_autoCalcBounds:qc.Serializer.BOOLEAN});Bounds.__hiddenInMenu=!0,Object.defineProperties(Bounds.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(t){this._sizeProvider!==t&&(this._sizeProvider=t,this.getBounds(!0))}},marginTop:{get:function(){return this._marginTop},set:function(t){this.setMargin(t)}},marginBottom:{get:function(){return this._marginBottom},set:function(t){this.setMargin(null,null,t)}},marginLeft:{get:function(){return this._marginLeft},set:function(t){this.setMargin(null,null,null,t)}},marginRight:{get:function(){return this._marginRight},set:function(t){this.setMargin(null,t)}},paddingTop:{get:function(){return this._paddingTop},set:function(t){this.setPadding(t)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(t){this.setPadding(null,null,t)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(t){this.setPadding(null,null,null,t)}},paddingRight:{get:function(){return this._paddingRight},set:function(t){this.setPadding(null,t)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(t){this._autoCalcBounds=t}}}),Bounds.prototype.setPadding=function(t,e,i,r){undefined!==t&&null!==t&&(this._paddingTop=t),undefined!==e&&null!==e&&(this._paddingRight=e),undefined!==i&&null!==i&&(this._paddingBottom=i),undefined!==r&&null!==r&&(this._paddingLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.setMargin=function(t,e,i,r){undefined!==t&&null!==t&&(this._marginTop=t),undefined!==e&&null!==e&&(this._marginRight=e),undefined!==i&&null!==i&&(this._marginBottom=i),undefined!==r&&null!==r&&(this._marginLeft=r),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.calcBounds=function(){this.getBounds(!0)},Bounds.prototype.getBounds=function(t){var e=this._recordBounds||new qc.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible())return e;if(this._recordBounds&&!t&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime))return this._recordBounds;this._lastWrapTime=this.gameObject.game.time.fixedTime;var i=new qc.Point(0,0),r=new qc.Point(0,0);return Bounds._calcBounds(i,r,this.sizeProvider,this.gameObject,this._deep),e.x=i.x,e.y=i.y,e.width=r.x-i.x,e.height=r.y-i.y,this._recordBounds=e,e},Bounds.prototype.getWorldCorners=function(t){var e=this.getBounds(t),i=new qc.Point(e.x,e.y),r=new qc.Point(e.x+e.width,e.y),n=new qc.Point(e.x+e.width,e.y+e.height),o=new qc.Point(e.x,e.y+e.height),s=this.gameObject.worldTransform;return[s.apply(i),s.apply(r),s.apply(n),s.apply(o)]},Bounds._calcBounds=function(t,e,i,r,n){var o=r.getScript("qc.Bounds");i=o&&o.enable?o.sizeProvider:i,i===Bounds.USE_BOUNDS?this._calcRealBounds(t,e,r,n):this._calcRectBounds(t,e,r,n)},Bounds._calcRectBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),o=i.rect,s=o.x,a=o.y,h=o.x+o.width,l=o.y+o.height;if(0!==r)for(var c=i.children,u=c.length;u--;){var p=c[u];if(p.isWorldVisible()){var d=p.getScript("qc.Bounds"),f=new qc.Point(0,0),g=new qc.Point(0,0);if(d){var m=d.getBounds();f.x=m.x,f.y=m.y,g.x=m.x+m.width,g.y=m.y+m.height}else Bounds._calcRectBounds(f,g,p,r-1);n&&n.enable&&(f.x-=n.paddingLeft,f.y-=n.paddingTop,g.x+=n.paddingRight,g.y+=n.paddingBottom),s=Math.min(s,f.x),a=Math.min(a,f.y),h=Math.max(h,g.x),l=Math.max(l,g.y)}}n&&n.enable&&(s-=n.marginLeft,a-=n.marginTop,h+=n.marginRight,l+=n.marginBottom),t.x=Math.min(t.x,s),t.y=Math.min(t.y,a),e.x=Math.max(e.x,h),e.y=Math.max(e.y,l)},Bounds._calcRealBounds=function(t,e,i,r){var n=i.getScript("qc.Bounds"),o=i.rect,s=o.x,a=o.y,h=o.x+o.width,l=o.y+o.height;if(0!==r)for(var c=i.worldTransform,u=i.children,p=u.length;p--;){var d=u[p];if(d.isWorldVisible()){var f=d.getScript("qc.Bounds"),g=new qc.Point(0,0),m=new qc.Point(0,0);if(f){var _=f.getBounds();g.x=_.x,g.y=_.y,m.x=_.x+_.width,m.y=_.y+_.height}else Bounds._calcRealBounds(g,m,d,r-1);var y=new qc.Point(g.x,g.y),v=new qc.Point(m.x,g.y),T=new qc.Point(m.x,m.y),x=new qc.Point(g.x,m.y),S=d.worldTransform;y=c.applyInverse(S.apply(y)),v=c.applyInverse(S.apply(v)),T=c.applyInverse(S.apply(T)),x=c.applyInverse(S.apply(x));var b=Math.min(y.x,v.x,T.x,x.x),w=Math.min(y.y,v.y,T.y,x.y),A=Math.max(y.x,v.x,T.x,x.x),E=Math.max(y.y,v.y,T.y,x.y);n&&n.enable&&(b-=n.paddingLeft,w-=n.paddingTop,A+=n.paddingRight,E+=n.paddingBottom),s=Math.min(s,b),a=Math.min(a,w),h=Math.max(h,A),l=Math.max(l,E)
}}n&&n.enable&&(s-=n.marginLeft,a-=n.marginTop,h+=n.marginRight,l+=n.marginBottom),t.x=Math.min(t.x,s),t.y=Math.min(t.y,a),e.x=Math.max(e.x,h),e.y=Math.max(e.y,l)},Bounds.getBounds=function(t,e,i,r){r=undefined===r||null===r?0:r;var n=t.getScript("qc.Bounds");if(n&&n.enable)return n.getBounds(i);var o=new qc.Point(0,0),s=new qc.Point(0,0);Bounds._calcBounds(o,s,e,t,r);var a=new qc.Rectangle(0,0,0,0);return a.x=o.x,a.y=o.y,a.width=s.x-o.x,a.height=s.y-o.y,a},Bounds.getCorners=function(t,e,i,r,n){var o=Bounds.getBounds(t,e,i,r),s=t.worldTransform,a=n&&n.worldTransform;if(e===Bounds.USE_RECTTRANSFORM){for(var h=Bounds.findCommonRoot(t,n||t.game.world),l=0,c=0,u=t;u&&u!==t.game.world&&u!==h;)l+=u.x,c+=u.y,u=u.parent;for(u=n;u&&u!==t.game.world&&u!==h;)l-=u.x,c-=u.y;var p=new qc.Point(o.x+l,o.y+c),d=new qc.Point(o.x+o.width+l,o.y+c),f=new qc.Point(o.x+o.width+l,o.y+o.height+c),g=new qc.Point(o.x+l,o.y+o.height+c);return[p,d,f,g]}var p=new qc.Point(o.x,o.y),d=new qc.Point(o.x+o.width,o.y),f=new qc.Point(o.x+o.width,o.y+o.height),g=new qc.Point(o.x,o.y+o.height);return a?[a.applyInverse(s.apply(p)),a.applyInverse(s.apply(d)),a.applyInverse(s.apply(f)),a.applyInverse(s.apply(g))]:[s.apply(p),s.apply(d),s.apply(f),s.apply(g)]},Bounds.getBox=function(t,e,i,r,n){for(var o=Bounds.getCorners(t,e,i,r,n),s=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),a=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),h=0;4>h;h++){var l=o[h];s.x=Math.max(s.x,l.x),s.y=Math.max(s.y,l.y),a.x=Math.min(a.x,l.x),a.y=Math.min(a.y,l.y)}return new qc.Rectangle(a.x,a.y,s.x-a.x,s.y-a.y)},Bounds.getContentRect=function(t){var e=t.rect,i=t.getScript("qc.Bounds");return i&&i.enable&&(e.x+=i.paddingLeft,e.y+=i.paddingTop,e.width-=i.paddingLeft+i.paddingRight,e.height-=i.paddingTop+i.paddingBottom),e},Bounds.getMargin=function(t){var e=t.getScript("qc.Bounds");return e&&e.enable?{top:e._marginTop,bottom:e._marginBottom,left:e._marginLeft,right:e._marginRight}:{top:0,bottom:0,left:0,right:0}},Bounds.findCommonRoot=function(t,e){if(!t||!e)return null;for(var i=t,r=e;i;){for(r=e;r;){if(i===r)return i;r=r.parent}i=i.parent}return null},Bounds.USE_BOUNDS=0,Bounds.USE_RECTTRANSFORM=1;var LayoutElement=defineBehaviour("qc.LayoutElement",qc.Bounds,function(){this.ignoreLayout=!1,this.minWidth=-1,this.minHeight=-1,this.preferredWidth=-1,this.preferredHeight=-1,this.flexibleWidth=-1,this.flexibleHeight=-1,this._deep=0},{ignoreLayout:qc.Serializer.BOOLEAN,minWidth:qc.Serializer.NUMBER,minHeight:qc.Serializer.NUMBER,preferredWidth:qc.Serializer.NUMBER,preferredHeight:qc.Serializer.NUMBER,flexibleWidth:qc.Serializer.NUMBER,flexibleHeight:qc.Serializer.NUMBER});LayoutElement.__menu="UI/Layout/LayoutElement",Object.defineProperties(LayoutElement.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(t){t!==this._ignoreLayout&&(this._ignoreLayout=t)}},minWidth:{get:function(){return this._minWidth},set:function(t){t!==this._minWidth&&(this._minWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},minHeight:{get:function(){return this._minHeight},set:function(t){t!==this._minHeight&&(this._minHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredWidth:{get:function(){return this._preferredWidth},set:function(t){t!==this._preferredWidth&&(this._preferredWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredHeight:{get:function(){return this._preferredHeight},set:function(t){t!==this._preferredHeight&&(this._preferredHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(t){t!==this._flexibleWidth&&(this._flexibleWidth=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(t){t!==this._flexibleHeight&&(this._flexibleHeight=t,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(t){this.hasMinWidth!==t&&(this.minWidth=t?0:-1)}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(t){this.hasMinHeight!==t&&(this.minHeight=t?0:-1)}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(t){this.hasPreferredWidth!==t&&(this.preferredWidth=t?this.gameObject?this.gameObject.width:0:-1)}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(t){this.hasPreferredHeight!==t&&(this.preferredHeight=t?this.gameObject?this.gameObject.height:0:-1)}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(t){this.hasFlexibleWidth!==t&&(this.flexibleWidth=t?1:-1)}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(t){this.hasFlexibleHeight!==t&&(this.flexibleHeight=t?1:-1)}}}),LayoutElement.getLayoutElement=function(t){var e=new LayoutElement,i=t.getScript("qc.LayoutElement");return i&&!i.ignoreLayout&&(e.ignoreLayout=i.ignoreLayout,e.minWidth=i.minWidth,e.minHeight=i.minHeight,e.preferredWidth=i.preferredWidth,e.preferredHeight=i.preferredHeight,e.flexibleWidth=i.flexibleWidth,e.flexibleHeight=i.flexibleHeight),e},LayoutElement.USE_RECTTRANSFORM=qc.Bounds.USE_RECTTRANSFORM,LayoutElement.USE_BOUNDS=qc.Bounds.USE_BOUNDS;var TableLayout=defineBehaviour("qc.TableLayout",qc.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]],this._constraint=TableLayout.CONSTRAINT_FLEXIBLE,this.runInEditor=!0,this.cellAlignment=TableLayout.ALIGN_TOP_LEFT,this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this),this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:qc.Serializer.NUMBER,stride:qc.Serializer.NUMBER,startCorner:qc.Serializer.NUMBER,startAxis:qc.Serializer.NUMBER,contentSizeProvider:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,_cellStyle:qc.Serializer.MAPPING,autoUpdate:qc.Serializer.BOOLEAN,contentAlignment:qc.Serializer.NUMBER,cellAlignment:qc.Serializer.NUMBER,spacingX:qc.Serializer.NUMBER,spacingY:qc.Serializer.NUMBER,ignoreX:qc.Serializer.BOOLEAN,ignoreY:qc.Serializer.BOOLEAN});TableLayout.__menu="UI/Layout/TableLayout",TableLayout._precision=1e-7,Object.defineProperties(TableLayout.prototype,{constraint:{get:function(){return isNaN(this._constraint)?TableLayout.CONSTRAINT_FLEXIBLE:this._constraint},set:function(t){this._constraint!==t&&(this._constraint=t,this.rebuildTable())}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(t){t!==this._stride&&(this._stride=t,this.rebuildTable())}},startCorner:{get:function(){return this._startCorner||TableLayout.CORNER_TOP_LEFT},set:function(t){t!==this._startCorner&&(this._startCorner=t,this.rebuildTable())}},startAxis:{get:function(){return this._startAxis||TableLayout.AXIS_HORIZONTAL},set:function(t){t!==this._startAxis&&(this._startAxis=t,this.rebuildTable())}},contentSizeProvider:{get:function(){return this._contentSizeProvider||TableLayout.USE_BOUNDS},set:function(t){t!==this._contentSizeProvider&&(this._contentSizeProvider=t,this.rebuildTable())}},style:{get:function(){return this._style||TableLayout.STYLE_WRAP_ELEMENT},set:function(t){t!==this._style&&(this._style=t,this.rebuildTable())}},autoUpdate:{get:function(){return this._autoUpdate},set:function(t){this._autoUpdate=t}},spacingX:{get:function(){return this._spacingX||0},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.rebuildTable())}},spacingY:{get:function(){return this._spacingY||0},set:function(t){this._spacingY!==t&&(this._spacingY=t,this.rebuildTable())}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,t)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(t){this.setCellStyle(null,null,null,null,null,null,null,null,t)}},contentAlignment:{get:function(){return this._contentAlignment||TableLayout.ALIGN_TOP_LEFT},set:function(t){this._contentAlignment!==t&&(this._contentAlignment=t,this.rebuildTable())}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(t){this.cellAlignment!==t&&(this.setCellStyle(null,null,t),this.rebuildTable())}},columnsCount:{get:function(){var t=this._calcColumnRow();return t.x}},rowsCount:{get:function(){var t=this._calcColumnRow();return t.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(t){this._ignoreX!==t&&(this._ignoreX=t)}},ignoreY:{get:function(){return!!this._ignoreY},set:function(t){this._ignoreY!==t&&(this._ignoreY=t)}}}),TableLayout.prototype.postUpdate=function(){this.enable&&(this.autoUpdate||this._needRebuildTable)&&(this.rebuildTable(),this._needRebuildTable=!1)},TableLayout.prototype._getChildrenCount=function(){for(var t=0,e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t++;return t},TableLayout.prototype._getChildren=function(){for(var t=[],e=this.gameObject.children,i=0;i<e.length;++i)e[i]&&e[i].isWorldVisible()&&t.push(e[i]);return t},TableLayout.prototype._mixinStyle=function(t,e){return{align:(0===(240&e.align)?240&t.align:240&e.align)|(0===(15&e.align)?15&t.align:15&e.align),timestamp:Math.max(e.timestamp,t.timestamp),paddingLeft:isNaN(e.paddingLeft)?t.paddingLeft:e.paddingLeft,paddingRight:isNaN(e.paddingRight)?t.paddingRight:e.paddingRight,paddingTop:isNaN(e.paddingTop)?t.paddingTop:e.paddingTop,paddingBottom:isNaN(e.paddingBottom)?t.paddingBottom:e.paddingBottom,cellWidth:isNaN(e.cellWidth)?t.cellWidth:e.cellWidth,cellHeight:isNaN(e.cellHeight)?t.cellHeight:e.cellHeight}},TableLayout._calcRectTransform=function(t,e){e=isNaN(e)?0:e;var i=t.rect;if(0!==e)return i;for(var r=t.children,n=r.length;n--;){var o=TableLayout._calcRectTransform(r[n],e-1);i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),i.w=Math.max(i.x+i.width,o.x+o.width)-i.x,i.h=Math.max(i.y+i.height,o.y+o.height)-i.y}return i},TableLayout.prototype.getCellRect=function(t,e){return qc.Bounds.getBox(t,this.contentSizeProvider,e,0,this.gameObject)},TableLayout.prototype.getCellStyle=function(t,e){t=null==t?0:t+1,e=null==e?0:e+1;var i=this._cellStyle[0][0],r=this._cellStyle[e]&&this._cellStyle[e][0],n=this._cellStyle[0][t];!n||r&&r.timestamp>n.timestamp?(n&&(i=this._mixinStyle(i,n)),r&&(i=this._mixinStyle(i,r))):(r&&(i=this._mixinStyle(i,r)),n&&(i=this._mixinStyle(i,n)));var o=this._cellStyle[e]&&this._cellStyle[e][t];return o&&(i=this._mixinStyle(i,o)),i.paddingTop=isNaN(i.paddingTop)?0:i.paddingTop,i.paddingLeft=isNaN(i.paddingLeft)?0:i.paddingLeft,i.paddingRight=isNaN(i.paddingRight)?0:i.paddingRight,i.paddingBottom=isNaN(i.paddingBottom)?0:i.paddingBottom,i.cellWidth=isNaN(i.cellWidth)?0:i.cellWidth,i.cellHeight=isNaN(i.cellHeight)?0:i.cellHeight,i},TableLayout.prototype.setCellStyle=function(t,e,i,r,n,o,s,a,h){t=null==t?0:t+1,e=null==e?0:e+1,this._cellStyle[e]||(this._cellStyle[e]=[]),this._cellStyle[e][t]||(this._cellStyle[e][t]=this._buildCellInfo());var l=this._cellStyle[e][t];null!=i&&(l.align=i),null!=r&&(l.paddingTop=r),null!=n&&(l.paddingRight=n),null!=o&&(l.paddingBottom=o),null!=s&&(l.paddingLeft=s),null!=a&&(l.cellWidth=a),null!=h&(l.cellHeight=h),this._cellStyle[e][t].timestamp=this.gameObject.game.time.fixedTime,this.rebuildTable()},TableLayout.prototype.clearCellStyle=function(t,e){return t=null==t?0:t+1,e=null==e?0:e+1,0===t&&0===e?(this._cellStyle[0][0]=this._buildCellInfo(),undefined):(this._cellStyle[e]&&this._cellStyle[e][t]&&(this._cellStyle[e][t]=null),undefined)},TableLayout.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:0/0,paddingRight:0/0,paddingTop:0/0,paddingBottom:0/0,cellWidth:0/0,cellHeight:0/0}},TableLayout.prototype._calcColumnRow=function(){var t=this._getChildrenCount(),e=this.stride,i=this.constraint;if(i===TableLayout.CONSTRAINT_FLEXIBLE){var r=this.getCellStyle(null,null),n=qc.Bounds.getContentRect(this.gameObject);this.startAxis===TableLayout.AXIS_HORIZONTAL?(e=Math.min(Math.max(1,Math.floor((n.width+this.spacingX)/(r.cellWidth+this.spacingX))),t),i=TableLayout.CONSTRAINT_FIX_COLUMN_COUNT):(e=Math.min(Math.max(1,Math.floor((n.height+this.spacingY)/(r.cellHeight+this.spacingY))),t),i=TableLayout.CONSTRAINT_FIX_ROW_COUNT)}var o=i===TableLayout.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(t/e):e,s=i===TableLayout.CONSTRAINT_FIX_ROW_COUNT?e:Math.ceil(t/e);return new qc.Point(o,s)},TableLayout.prototype._calcPos=function(t,e){var i=this._calcColumnRow();return e=e||new qc.Point(0,0),this.startAxis===TableLayout.AXIS_HORIZONTAL?(e.x=t%i.x,e.y=Math.floor(t/i.x)):(e.x=Math.floor(t/i.y),e.y=t%i.y),0!==(240&this.startCorner)&&(e.x=i.x-1-e.x),0!==(15&this.startCorner)&&(e.y=i.y-1-e.y),e},TableLayout.prototype._setCellPosition=function(t,e){if(!this.ignoreX||this.columnsCount>1){var i=t.node.x;i+=0!==(t.style.align&TableLayout.ALIGN_RIGHT)?e.x-t.bounds.x+(e.width-t.bounds.width):0!==(t.style.align&TableLayout.ALIGN_CENTER)?e.x-t.bounds.x+(e.width-t.bounds.width)/2:e.x-t.bounds.x,Math.abs(i-t.node.x)>TableLayout._precision&&(t.node.x=i)}if(!this.ignoreY||this.rowsCount>1){var r=t.node.y;r+=0!==(t.style.align&TableLayout.ALIGN_BOTTOM)?e.y-t.bounds.y+(e.height-t.bounds.height):0!==(t.style.align&TableLayout.ALIGN_MIDDLE)?e.y-t.bounds.y+(e.height-t.bounds.height)/2:e.y-t.bounds.y,Math.abs(r-t.node.y)>TableLayout._precision&&(t.node.y=r)}},TableLayout.prototype._setCellSize=function(t,e,i){if(Math.abs(t.bounds.width-e)>=TableLayout._precision||Math.abs(t.bounds.height-i)>=TableLayout._precision){var r=Bounds.getMargin(t.node),n=e-r.left-r.right,o=i-r.top-r.bottom,s=t.bounds.width-r.left-r.right,a=t.bounds.height-r.top-r.bottom;t.node.setAnchor(new qc.Point(0,0),new qc.Point(0,0),!1),t.node.x=0,t.node.y=0,s>0?t.node.width*=n/s:t.node.width=n,a>0?t.node.height*=o/a:t.node.height=o,t.node.setStretch(0,0,0,0),t.bounds=this.getCellRect(t.node,!0)}},TableLayout.prototype.relayout=function(){this.rebuildTable()},TableLayout.prototype.rebuildTable=function(){this.getCellStyle(null,null);this.style===TableLayout.STYLE_WRAP_ELEMENT?this._rebuildWrapTable():this._rebuildResizeTable()},TableLayout.prototype._getDefaultLayout=function(){return{min:0,preferred:0,flexible:0,extra:0}},TableLayout.prototype.getCellLayout=function(t){return qc.LayoutElement.getLayoutElement(t)},TableLayout.prototype._rebuildResizeTable=function(){for(var t=this._getChildren(),e=[],i=[],r=[],n=[],o=[],s=t.length,a=new qc.Point(0,0),h=-1;++h<s;){this._calcPos(h,a);var l=this.getCellLayout(t[h]),c=this.getCellStyle(a.x,a.y),u=this.getCellRect(t[h]);(e[a.y]||(e[a.y]=[]))[a.x]={node:t[h],layout:l,bounds:u,style:c};var p=n[a.x]||(n[a.x]=this._getDefaultLayout("x")),d=o[a.y]||(o[a.y]=this._getDefaultLayout("y"));l.preferredWidth<0&&t[h].nativeSize&&(l.preferredWidth=t[h].nativeSize.width),l.preferredHeight<0&&t[h].nativeSize&&(l.preferredHeight=t[h].nativeSize.height),!isNaN(c.cellWidth)&&c.cellWidth>0&&(l.minWidth=c.cellWidth,l.preferredWidth=c.cellWidth),!isNaN(c.cellHeight)&&c.cellHeight>0&&(l.minHeight=c.cellHeight,l.preferredHeight=c.cellHeight),l.minWidth>=0&&(p.min=Math.max(p.min,l.minWidth)),l.minHeight>=0&&(d.min=Math.max(d.min,l.minHeight)),p.preferred=Math.max(p.preferred,l.preferredWidth,p.min),d.preferred=Math.max(d.preferred,l.preferredHeight,p.min),l.flexibleWidth>=0&&(p.flexible=Math.max(p.flexible,l.flexibleWidth)),l.flexibleHeight>=0&&(d.flexible=Math.max(d.flexible,l.flexibleHeight)),p.extra=Math.max(p.extra,c.paddingLeft+c.paddingRight),d.extra=Math.max(d.extra,c.paddingTop+c.paddingBottom)}var f={min:0,preferred:0,flexible:0,extra:0,fixed:0},g={min:0,preferred:0,flexible:0,extra:0,fixed:0};n.forEach(function(t){f.min+=t.min,f.preferred+=t.preferred,f.flexible+=t.flexible,f.extra+=t.extra}),o.forEach(function(t){g.min+=t.min,g.preferred+=t.preferred,g.flexible+=t.flexible,g.extra+=t.extra});var m=qc.Bounds.getContentRect(this.gameObject),_=Math.max(0,n.length-1)*this.spacingX,y=Math.max(0,o.length-1)*this.spacingY,v=new qc.Point(0,0);if(m.width>f.min+f.extra+_)if(m.width>f.preferred+f.extra+_){for(var T=m.width-f.extra-f.preferred-_,x=0;x<n.length;++x)i[x]=n[x]?T*n[x].flexible/(f.flexible||1)+n[x].preferred+n[x].extra:0;0===f.flexible&&(0!==(this.contentAlignment&TableLayout.ALIGN_RIGHT)?v.x=T:0!==(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(v.x=T/2))}else for(var T=m.width-f.extra-f.min-_,x=0;x<n.length;++x)i[x]=n[x]?T*n[x].preferred/(f.preferred||1)+n[x].min+n[x].extra:0;else for(var x=0;x<n.length;++x)i[x]=n[x]?n[x].min+n[x].extra:0;if(m.height>g.min+g.extra+y)if(m.height>g.preferred+g.extra+y){for(var T=m.height-g.extra-g.preferred-y,x=0;x<o.length;++x)r[x]=o[x]?T*o[x].flexible/(g.flexible||1)+o[x].preferred+o[x].extra:0;0===g.flexible&&(0!==(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?v.y=T:0!==(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(v.y=T/2))}else for(var T=m.height-g.extra-g.min-y,x=0;x<o.length;++x)r[x]=o[x]?T*o[x].preferred/(g.preferred||1)+o[x].min+o[x].extra:0;else for(var x=0;x<o.length;++x)r[x]=o[x]?o[x].min+o[x].extra:0;for(var S=qc.Bounds.getContentRect(this.gameObject),b=new qc.Rectangle(0,0,0,0),w=0,A=0,E=0;E<r.length;E++){w=0;for(var C=0;C<i.length;C++){var P=e[E][C];if(P){b.x=S.x+w+P.style.paddingLeft+v.x,b.y=S.y+A+P.style.paddingTop+v.y,b.width=i[C]-P.style.paddingLeft-P.style.paddingRight,b.height=r[E]-P.style.paddingTop-P.style.paddingBottom;var I=b.width,O=b.height;P.layout.flexibleWidth<=0&&b.width>P.layout.preferredWidth&&P.layout.preferredWidth>0&&(I=P.layout.preferredWidth),P.layout.flexibleHeight<=0&&b.height>P.layout.preferredHeight&&P.layout.preferredHeight>0&&(O=P.layout.preferredHeight),this._setCellSize(P,I,O),this._setCellPosition(P,b),w+=i[C]+this.spacingX}else w+=i[C]+this.spacingX}A+=r[E]+this.spacingY}},TableLayout.prototype._rebuildWrapTable=function(){for(var t=this._getChildren(),e=[],i=[],r=[],n=t.length,o=new qc.Point(0,0);n--;){this._calcPos(n,o);var s=this.getCellStyle(o.x,o.y),a=this.getCellRect(t[n]);(e[o.y]||(e[o.y]=[]))[o.x]={node:t[n],bounds:a,style:s},i[o.x]=s.cellWidth>0?s.cellWidth:Math.max(a.width+s.paddingLeft+s.paddingRight,i[o.x]||0,s.cellWidth),r[o.y]=s.cellHeight>0?s.cellHeight:Math.max(a.height+s.paddingTop+s.paddingBottom,r[o.y]||0,s.cellHeight)}for(var h=0,l=0,c=0;c<i.length;c++)h+=i[c];for(var u=0;u<r.length;u++)l+=r[u];var p=qc.Bounds.getContentRect(this.gameObject),d=new qc.Point(0,0);0!==(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?d.y=p.height-l:0!==(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(d.y=(p.height-l)/2),0!==(this.contentAlignment&TableLayout.ALIGN_RIGHT)?d.x=p.width-h:0!==(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(d.x=(p.width-h)/2);for(var f=new qc.Rectangle(0,0,0,0),g=0,m=0,u=0;u<r.length;u++){g=0;for(var c=0;c<i.length;c++){var _=e[u][c];if(_)f.x=p.x+g+_.style.paddingLeft+d.x,f.y=p.y+m+_.style.paddingTop+d.y,f.width=i[c]-_.style.paddingLeft-_.style.paddingRight,f.height=r[u]-_.style.paddingTop-_.style.paddingBottom,this._setCellPosition(_,f),g+=i[c]+this.spacingX;else{var s=this.getCellStyle(c,u),y=i[c]===undefined?s.cellWidth:i[c];g+=y+this.spacingX}}m+=r[u]+this.spacingY}},TableLayout.prototype._doChildrenChanged=function(t){var e=t.children.length;if("add"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this);else if("remove"===t.type)for(;e--;)t.children[e]&&t.children[e].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this);this._needRebuildTable=!0},TableLayout.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=!0},TableLayout.CONSTRAINT_FLEXIBLE=0,TableLayout.CONSTRAINT_FIX_COLUMN_COUNT=1,TableLayout.CONSTRAINT_FIX_ROW_COUNT=2,TableLayout.STYLE_WRAP_ELEMENT=0,TableLayout.STYLE_RESIZE_ELEMENT=1,TableLayout.USE_RECTTRANSFORM=qc.LayoutElement.USE_RECTTRANSFORM,TableLayout.USE_BOUNDS=qc.LayoutElement.USE_BOUNDS,TableLayout.AXIS_HORIZONTAL=0,TableLayout.AXIS_VERTICAL=1,TableLayout.CORNER_TOP_LEFT=0,TableLayout.CORNER_TOP_RIGHT=16,TableLayout.CORNER_BOTTOM_RIGHT=17,TableLayout.CORNER_BOTTOM_LEFT=1,TableLayout.ALIGN_LEFT=1,TableLayout.ALIGN_CENTER=2,TableLayout.ALIGN_RIGHT=4,TableLayout.ALIGN_TOP=16,TableLayout.ALIGN_MIDDLE=32,TableLayout.ALIGN_BOTTOM=64,TableLayout.ALIGN_TOP_LEFT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_TOP_CENTER=TableLayout.ALIGN_TOP|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_TOP_RIGHT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_MIDDLE_LEFT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_MIDDLE_CENTER=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_MIDDLE_RIGHT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_BOTTOM_LEFT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_BOTTOM_CENTER=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_BOTTOM_RIGHT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_RIGHT;var Animator=defineBehaviour("qc.Animator",qc.Behaviour,function(){var t=this;t.animatorMap={},t.animatorList=[],t.animators=null,t.runInEditor=!0},{animators:qc.Serializer.ANIMATORS});Animator.__menu="Action/Animator",Object.defineProperties(Animator.prototype,{animators:{get:function(){return this._animators},set:function(t){for(var e=0;e<this.animatorList.length;e++){var i=this.animatorList[e];i&&i.destroy()}if(this.animatorMap={},this.animatorList=[],this._animators=t,t)for(var e=0;e<t.length;e++){var r=t[e];if(r){r instanceof qc.ActionManagerAsset?this.animatorList[e]=qc.ActionManager.restoreBundle(r,this.game,!this.game.serializer.isRestoring):r instanceof qc.ActionAsset&&(this.animatorList[e]=qc.Action.restoreBundle(r,this.game,!this.game.serializer.isRestoring)),this.animatorList[e].targetLocked||(this.animatorList[e].targetObject=this.gameObject);var n=this.animatorList[e].name;this.animatorMap[n]&&this.gameObject.game.log.error("Exist duplicate action's name: {0}",n),this.animatorMap[n]=this.animatorList[e]}}}}}),Animator.prototype.awake=function(){if(this.animatorList.length>=1)for(var t=0;t<this.animatorList.length;t++)this.animatorList[t]&&this.animatorList[t].awake()},Animator.prototype.update=function(){for(var t=0;t<this.animatorList.length;t++){var e=this.animatorList[t];e&&e.isRunning&&e.update()}},Animator.prototype.getAction=function(t){return this.animatorMap[t]||this.animatorList[t]},Animator.prototype.play=function(t,e,i){t=t||0;var r=this.getAction(t);r&&(e=e||this.gameObject,i="boolean"==typeof i?i:!0,r.playAction(e,i))},Animator.prototype.stop=function(t){t=t||0;var e=this.getAction(t);e&&e.stop()},Animator.prototype.destroy=function(){this.animators=null,qc.Behaviour.prototype.destroy.call(this)};var AspectRatioFitter=defineBehaviour("qc.AspectRatioFitter",qc.Behaviour,function(){var t=this;t.mode=AspectRatioFitter.NONE,t.ratio=1,t.runInEditor=!0},{mode:qc.Serializer.NUMBER,ratio:qc.Serializer.NUMBER});AspectRatioFitter.__menu="UI/AspectRatioFitter",Object.defineProperties(AspectRatioFitter.prototype,{mode:{get:function(){return this._mode||AspectRatioFitter.NONE},set:function(t){this.mode!==t&&(this._mode=t,this._reset())}},ratio:{get:function(){return this._ratio||1},set:function(t){t>0||(t=.001),this.ratio!==t&&(this._ratio=t,this._reset())}}}),AspectRatioFitter.NONE=0,AspectRatioFitter.WIDTH_CONTROLS_HEIGHT=1,AspectRatioFitter.HEIGHT_CONTROLS_WIDTH=2,AspectRatioFitter.FIT_IN_PARENT=3,AspectRatioFitter.ENVELOPE_PARENT=4,AspectRatioFitter.prototype.awake=function(){var t=this;t._reset();var e=t.gameObject;t.addListener(e.onRelayout,function(){t._reset()})},AspectRatioFitter.prototype._reset=function(){var t=this;if(t.mode!==AspectRatioFitter.NONE){var e=t.gameObject;if(t.mode===AspectRatioFitter.WIDTH_CONTROLS_HEIGHT)return e.height=e.width/t.ratio,undefined;if(t.mode===AspectRatioFitter.HEIGHT_CONTROLS_WIDTH)return e.width=e.height*t.ratio,undefined;var i=e.parent.rect;if(e.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),t.mode===AspectRatioFitter.FIT_IN_PARENT){var r=i.width,n=r/t.ratio;return n>i.height&&(n=i.height,r=n*t.ratio),e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2),undefined}if(t.mode===AspectRatioFitter.ENVELOPE_PARENT){var r=i.width,n=r/t.ratio;return n<i.height&&(n=i.height,r=n*t.ratio),e.setStretch((i.width-r)/2,(i.width-r)/2,(i.height-n)/2,(i.height-n)/2),undefined}}};var CacheAsBitmap=defineBehaviour("qc.CacheAsBitmap",qc.Behaviour,function(){this._boundsType=CacheAsBitmap.BOUNDS_SELF,this._cacheType=CacheAsBitmap.CACHE_FOR_SCREEN,this._dirty=!0,this.boundsInScreen=!1,this.runInEditor=!0,this.offX=0,this.offY=0},{boundsType:qc.Serializer.NUMBER,cacheType:qc.Serializer.NUMBER,boundsInScreen:qc.Serializer.BOOLEAN});CacheAsBitmap.__menu="UI/CacheAsBitmap",Object.defineProperties(CacheAsBitmap.prototype,{boundsType:{get:function(){return this._boundsType},set:function(t){this._boundsType!==t&&(this._boundsType=t,this.dirty=!0)}},cacheType:{get:function(){return this._cacheType},set:function(t){this._cacheType!==t&&(this._cacheType=t,this.dirty=!0)}},dirty:{get:function(){return this._dirty},set:function(t){this._dirty!==t&&(this._dirty=t)}}}),CacheAsBitmap.prototype.awake=function(){var t=this,e=t.gameObject;t.addListener(t.game.assets.webFontLoaded,t._setDirty,t),e.onRelayout.add(t._setDirty,t)},CacheAsBitmap.prototype._setDirty=function(){this.dirty=!0},CacheAsBitmap.prototype.onEnable=function(){var t=this,e=t.gameObject;e._destroy||(t._cache||(t._cache=new qc.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution),t._cacheSprite=new PIXI.Sprite(t._cache)),t.dirty=!0,t.gameObject.phaser.setDisplayProxy(t._cacheSprite,!0),t._nodeRenderCanvas||(t._nodeRenderCanvas=t.gameObject.phaser._renderCanvas,t.gameObject.phaser._renderCanvas=t.renderCanvas.bind(t)),t._nodeRenderWebGL||(t._nodeRenderWebGL=t.gameObject.phaser._renderWebGL,t.gameObject.phaser._renderWebGL=t.renderWebGL.bind(t)))},CacheAsBitmap.prototype.onDisable=function(){var t=this;t.gameObject.phaser.setDisplayProxy(null,!1),t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null)},CacheAsBitmap.prototype.onDestroy=function(){var t=this;t._nodeRenderCanvas&&(t.gameObject.phaser._renderCanvas=t._nodeRenderCanvas,t._nodeRenderCanvas=null),t._nodeRenderWebGL&&(t.gameObject.phaser._renderWebGL=t._nodeRenderWebGL,t._nodeRenderWebGL=null),t._cache&&(t._cache.destroy(!0),t._cache=null),t._cacheSprite&&(t._cacheSprite=null),t.gameObject.onRelayout.remove(t._setDirty,t)},CacheAsBitmap.prototype._updateCache=function(){var t=this,e=t._cache,i=t._cacheSprite;t._updatingCache=!0;var r=null;r=t._cacheBounds=this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN?t.getLocalBounds():t.getBounds(),t.boundsInScreen?(r.x<0&&(r.width+=r.x,r.x=0),r.y<0&&(r.height+=r.y,r.y=0),r.width=Math.round(Math.max(1,Math.min(t.game.width*t.game.resolution-r.x,r.width))),r.height=Math.round(Math.max(1,Math.min(t.game.height*t.game.resolution-r.y,r.height)))):(r.width=Math.round(r.width),r.height=Math.round(r.height)),e.resize(r.width+(1&r.width),r.height+(1&r.height),!0);var n=t.gameObject.worldTransform;if(this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var o=i.worldTransform;o.a=n.a,o.b=n.b,o.c=n.c,o.d=n.d,o.tx=n.tx,o.ty=n.ty,PIXI.DisplayObject._tempMatrix.tx=-r.x,PIXI.DisplayObject._tempMatrix.ty=-r.y,e.render(t.gameObject.phaser,PIXI.DisplayObject._tempMatrix,!0),i.anchor.x=-(r.x/r.width),i.anchor.y=-(r.y/r.height)}else t.offX=r.x-n.tx,t.offY=r.y-n.ty,i.anchor.x=0,i.anchor.y=0,CacheAsBitmap._tempMatrix.a=n.a,CacheAsBitmap._tempMatrix.b=n.b,CacheAsBitmap._tempMatrix.c=n.c,CacheAsBitmap._tempMatrix.d=n.d,CacheAsBitmap._tempMatrix.tx=Math.round(n.tx-r.x),CacheAsBitmap._tempMatrix.ty=Math.round(n.ty-r.y),e.render(t.gameObject.phaser,CacheAsBitmap._tempMatrix,!0),n=i.worldTransform,n.identity(),n.tx=r.x,n.ty=r.y;t._updatingCache=!1,t.dirty=!1,t.gameObject._isTransformDirty=!0,i.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),t.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),e.baseTexture.scaleMode=PIXI.scaleModes.NEAREST},CacheAsBitmap.prototype.postUpdate=function(){var t=this,e=t._cacheSprite;if(t.dirty)t.game.log.trace("[CacheAsBitmap]Update Cache."),t._updateCache();else if(t._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var i=e.worldTransform,r=t.gameObject.worldTransform;i.a=r.a,i.b=r.b,i.c=r.c,i.d=r.d,i.tx=r.tx,i.ty=r.ty}else{var n=t.gameObject.worldTransform,r=e.worldTransform;r.identity(),r.tx=n.tx+t.offX,r.ty=n.ty+t.offY}},CacheAsBitmap.prototype.getBounds=function(){var t=this;return t.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,0):t.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,-1):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.getLocalBounds=function(){var t=this;return t.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,0,t.gameObject):t.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(t.gameObject,qc.Bounds.USE_BOUNDS,!0,-1,t.gameObject):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.renderCanvas=function(t){var e=this,i=e.gameObject;if(i.phaser.visible!==!1&&i.renderable!==!1){if(e._updatingCache&&e._nodeRenderCanvas)return e._nodeRenderCanvas.call(e.gameObject.phaser,t),undefined;e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderCanvas(t)}},CacheAsBitmap.prototype.renderWebGL=function(t){var e=this,i=e.gameObject;if(i.phaser.visible!==!1&&i.renderable!==!1){if(e._updatingCache&&e._nodeRenderWebGL)return e._nodeRenderWebGL.call(e.gameObject.phaser,t),undefined;e._cacheSprite.worldAlpha=e._cacheSprite.alpha=e.gameObject.phaser.worldAlpha,e._cacheSprite._renderWebGL(t)}},CacheAsBitmap._tempMatrix=new PIXI.Matrix,Object.defineProperties(qc.Node.prototype,{cacheAsBitmap:{get:function(){var t=this.getScript("qc.CacheAsBitmap");return t&&t.enable},set:function(t){var e=this.getScript("qc.CacheAsBitmap");(t||e)&&(e||(e=this.addScript("qc.CacheAsBitmap")),e.enable=t)}}}),CacheAsBitmap.BOUNDS_SELF=0,CacheAsBitmap.BOUNDS_ALL=1,CacheAsBitmap.CACHE_FOR_SCREEN=0,CacheAsBitmap.CACHE_FOR_SELF=1;var DebugViewer=defineBehaviour("qc.DebugViewer",qc.Behaviour,function(){var t=this;t.count=1,t.now=t.game.time.now,t.runInEditor=!0,t.duration=1,t.detail=!1},{debugOn:qc.Serializer.BOOLEAN,duration:qc.Serializer.NUMBER,detail:qc.Serializer.BOOLEAN});DebugViewer.__menu="Debug/DebugViewer",Object.defineProperties(DebugViewer.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(t){this.game.debug.on=t}}}),DebugViewer.prototype.postUpdate=function(){var t=this.game.debug,e=this.game.time.now;if(e-this.now<1e3*this.duration)this.count++;else{var i=1e3*this.count/(e-this.now),r=(t.preUpdate/this.count).toFixed(1),n=(t.update/this.count).toFixed(1),o=(t.postUpdate/this.count).toFixed(1),s=(t.logic/this.count).toFixed(1),a=(t.render/this.count).toFixed(1),h=(t.total/this.count).toFixed(1),l=this.game.phaser.renderer.renderSession.drawCount;null==l&&(l="(N/A)");var c=this.game.phaser._calcTransformCount,u="FPS: "+i.toFixed(1)+"\nDraw Calls: "+l+"\nTotal: "+h+" ms\nLogic: "+s+" ms\nRender: "+a+" ms\nPreUpdate: "+r+" ms\nUpdate: "+n+" ms\nPostUpdate: "+o+" ms\nTransformCalc: "+c;if(this.detail){var p="Canvas";this.game.phaser.renderType===Phaser.WEBGL?p="WebGL":this.game.phaser.renderType==Phaser.HEADLESS&&(p="Headless"),u+="\n------------\nresolution="+this.game.phaser.resolution+"\ndevicePixelRatio="+window.devicePixelRatio+"\nsize="+this.game.width+"*"+this.game.height+"\nrenderType="+p+"\nantialias="+this.game.antialias}this.gameObject instanceof qc.UIText?this.gameObject.text=u:this.gameObject instanceof qc.Dom&&(u=u.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=u),this.count=1,this.now=e,t.total=0,t.logic=0,t.preUpdate=0,t.update=0,t.postUpdate=0,t.render=0
}};var DropdownItem=defineBehaviour("qc.DropdownItem",qc.Behaviour,function(){var t=this;t.dropdown=null},{checkBackground:qc.Serializer.NODE,checkMark:qc.Serializer.NODE,text:qc.Serializer.NODE,image:qc.Serializer.NODE});DropdownItem.__menu="UI/DropdownItem",Object.defineProperties(DropdownItem.prototype,{index:{get:function(){return this._index},set:function(t){this._index!==t&&(this._index=t,this.redraw())}}}),DropdownItem.prototype.onDown=function(){this.checkBackground&&(this.checkBackground.visible=!0)},DropdownItem.prototype.onUp=function(){this.checkBackground&&(this.checkBackground.visible=!1)},DropdownItem.prototype.onClick=function(){var t=this;t.index!==t.dropdown.value&&(t.dropdown.value=t.index,t.dropdown.hide())},DropdownItem.prototype.redraw=function(){var t=this,e=t.gameObject,i=t.dropdown.options[t.index];"string"==typeof i?(t.image&&(t.image.visible=!1),t.text.visible=!0,t.text.text=i):(t.text&&(t.text.visible=!1),t.image.visible=!0,t.image.texture=i),t.checkMark&&(t.checkMark.visible=t.index===t.dropdown.value),e.anchoredY=t.index*e.height,t.checkBackground&&(t.checkBackground.visible=!1)};var FilterGroup=defineBehaviour("qc.FilterGroup",qc.Behaviour,function(){this._filters=[]},{filters:Serializer.FILTERS,inherited:Serializer.BOOLEAN});FilterGroup.__menu="UI/FilterGroup",Object.defineProperties(FilterGroup.prototype,{filters:{get:function(){return this._filters},set:function(t){this._filters=t,this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(t){this.gameObject&&(this.gameObject.filterSelf=!t)}}}),FilterGroup.prototype.onDisable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onEnable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onDestroy=function(){this.gameObject&&!this.gameObject._destroy&&this.gameObject.phaser&&(this.gameObject.phaser.filters=null)},FilterGroup.prototype.refresh=function(){this.gameObject&&!this.gameObject._destroy&&(this.enable?this.enable&&(this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null):this.gameObject.phaser.filters=null)},FilterGroup.prototype.findFilter=function(t){"string"==typeof t&&(t=qc.Util.findClass(t));var e=[];for(var i in this.filters)this.filters[i]instanceof t&&e.push(this.filters[i]);return e},FilterGroup.prototype.removeFilterAt=function(t){if(t>=0&&t<this.filters.length){var e=this.filters.splice(t,1);return this.refresh(),e}},FilterGroup.prototype.removeFilter=function(t){"string"==typeof t&&(t=qc.Util.findClass(t));var e=[],i=this.filters.length;if("function"==typeof t)for(;i-->0;)this.filters[i]instanceof t&&e.push(this.filters.splice(i,1));else for(;i-->0;)this.filters[i]===t&&e.push(this.filters.splice(i,1));return this.refresh(),e},FilterGroup.prototype.addFilter=function(t,e){if("string"==typeof t&&(t=qc.Util.findClass(t),"function"!=typeof t))return null;if("function"==typeof t)t=new t(this.game);else for(var e=this.filters.length;e-->0;)if(this.filters[e]===t)return;return isNaN(e)||0>e||e>this.filters.length?this.filters.push(t):this.filters.splice(e,0,t),this.refresh(),t};var HorizontalLayout=defineBehaviour("qc.HorizontalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_ROW_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});HorizontalLayout.__menu="UI/Layout/HorizontalLayout",Object.defineProperties(HorizontalLayout.prototype,{spacing:{get:function(){return this.spacingX},set:function(t){this.spacingX=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),HorizontalLayout.prototype._getDefaultLayout=function(t){return"x"===t?{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}:{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}},HorizontalLayout.prototype.getCellLayout=function(t){var e=qc.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var NodeMask=defineBehaviour("qc.NodeMask",qc.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0),this._mask.parent&&this._mask.parent.remove(this._mask),this.gameObject.onTextureChanged&&this.addListener(this.gameObject.onTextureChanged,this._doTextureChange,this),this.gameObject.onTransformChanged&&this.addListener(this.gameObject.onTransformChanged,this._doTransformChanged,this),this.onEnable(),this.runInEditor=!0},{checkInField:qc.Serializer.BOOLEAN,minAnchor:qc.Serializer.GEOM,maxAnchor:qc.Serializer.GEOM,minRotation:qc.Serializer.NUMBER,maxRotation:qc.Serializer.NUMBER,clipType:qc.Serializer.NUMBER,mode:qc.Serializer.NUMBER});NodeMask.__menu="UI/NodeMask",Object.defineProperties(NodeMask.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(t){this._checkInField!==t&&(this._checkInField=t,t||this._resetRenderAble(this.gameObject))}},minAnchor:{get:function(){return this._minAnchor||new qc.Point(0,0)},set:function(t){this.setMask(t)}},maxAnchor:{get:function(){return this._maxAnchor||new qc.Point(1,1)},set:function(t){this.setMask(null,t)}},minRotation:{get:function(){return undefined!==this._minRotation||null===this._minRotation?this._minRotation:0},set:function(t){this.setMask(null,null,t)}},maxRotation:{get:function(){return undefined!==this._maxRotation||null===this._maxRotation?this._maxRotation:2*Math.PI},set:function(t){this.setMask(null,null,null,t)}},clipType:{get:function(){return NodeMask.CLIP_STENCIL},set:function(){}},mode:{get:function(){return this._mode||NodeMask.MODE_DEFAULT},set:function(t){this._mode!==t&&(this._mode=t,this._refresh())}},customGraphics:{get:function(){return this._customGraphics||(this._customGraphics=this.game.phaser.add.graphics(0,0),this._customGraphics.parent&&this._customGraphics.parent.remove(this._customGraphics)),this._customGraphics}},_maskFilter:{get:function(){return this.__maskFilter||(this.__maskFilter=new qc.Filter.AlphaMask(this.game),this.__maskFilter.otherTexture=new qc.Filter.FilterTexture(this.game),this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame),this.__maskFilter}},_graphicsFilter:{get:function(){return this.__graphicsFilter||(this.__graphicsFilter=new qc.Filter.AlphaMask(this.game),this.__graphicsFilter.otherTexture=new qc.Filter.GraphicsTexture(this.game)),this.__graphicsFilter}}}),NodeMask.prototype.onEnable=function(){this._refresh()},NodeMask.prototype.onDisable=function(){this._refresh()},NodeMask.prototype.onDestroy=function(){this.gameObject.phaser.mask=null,this.gameObject.phaser.softClip=null,this.gameObject.phaser.maskPixel=null,this.gameObject.phaser._graphicsFilter=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject)},NodeMask.prototype._doTextureChange=function(){this.__maskFilter&&(this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame)},NodeMask.prototype._doTransformChanged=function(){this.postUpdate()},NodeMask.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===Phaser.WEBGL&&this.clipType===NodeMask.CLIP_STENCIL},NodeMask.prototype._refresh=function(){this._isNeedUseClipReplaceStencil()?(this.gameObject.phaser.softClip=null,this.gameObject.phaser.mask=null,this.gameObject.phaser.maskPixel=null,this._graphicsFilter.otherTexture.updateTexture(),this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null):this.game.phaser.renderType!==Phaser.WEBGL||this.clipType===NodeMask.CLIP_STENCIL?(this.gameObject.phaser.mask=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this.mode===NodeMask.MODE_GRAPHICS?this.customGraphics:this._mask:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.softClip=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject),this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null):(this.gameObject.phaser.softClip=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this._softClip:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.mask=null,this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null)},NodeMask.prototype.postUpdate=function(){if(this.enable&&this.mode===NodeMask.MODE_DEFAULT&&(this._updateMask(),this._checkInField))for(var t=this.gameObject.children,e=this.gameObject.getWorldBox(),i=0;i<t.length;i++)this._checkRenderable(e,t[i])},NodeMask.prototype.setMask=function(t,e,i,r){var n=t||this.minAnchor,o=e||this.maxAnchor;if(i=undefined===i||null===i?this.minRotation:i,r=undefined===r||null===r?this.maxRotation:r,n.x<0&&(n.x=0),n.y<0&&(n.y=0),n.x>1&&(n.x=1),n.y>1&&(n.y=1),o.x<0&&(o.x=0),o.y<0&&(o.y=0),o.x>1&&(o.x=1),o.y>1&&(o.y=1),n.x>o.x||n.y>o.y)throw Error("Expected:min < max");if(i>r)throw Error("Expected:minRotation < maxRotation");(n.x!==this.minAnchor.x||n.y!==this.minAnchor.y||o.x!==this.maxAnchor.x||o.y!==this.maxAnchor.y||i!==this.minRotation||r!==this.maxRotation)&&(this._minAnchor=n,this._maxAnchor=o,this._minRotation=i,this._maxRotation=r,this._maskForceChange=!0,this.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},NodeMask.prototype._updateMask=function(){var t=this._mask,e=this.gameObject.worldTransform,i=this.gameObject.rect,r=[i.x,i.y,i.width,i.height,e.a,e.b,e.c,e.d,e.tx,e.ty];if(this._maskForceChange||!this._lastMaskRect||this._lastMaskRect[0]!==r[0]||this._lastMaskRect[1]!==r[1]||this._lastMaskRect[2]!==r[2]||this._lastMaskRect[3]!==r[3]||this._lastMaskRect[4]!==r[4]||this._lastMaskRect[5]!==r[5]||this._lastMaskRect[6]!==r[6]||this._lastMaskRect[7]!==r[7]||this._lastMaskRect[8]!==r[8]||this._lastMaskRect[9]!==r[9]){this._maskForceChange=!1,this._lastMaskRect=r;var n=this.minAnchor,o=this.maxAnchor,s=this.minRotation,a=this.maxRotation,h=i.x+n.x*i.width,l=i.y+n.y*i.height,c=i.x+o.x*i.width,u=i.y+o.y*i.height,p=this.gameObject.getWorldScale(),d=p.x*p.y<0,f=(h+c)/2,g=(l+u)/2,m=null;if(a-s<2*Math.PI){for(var _=2*Math.PI,y=Math.atan2(u-l,c-h);-y>s||s>_-y;){var v=0>s?_:-_;s+=v,a+=v}var T,x,S;s>=-y&&y>s?(T=c,x=g+(c-f)*Math.tan(s),S=0):s<Math.PI-y?(x=u,T=f+(u-g)/Math.tan(s),S=1):s<Math.PI+y?(T=h,x=g+(f-h)*Math.tan(Math.PI-s),S=2):(x=l,T=f+(g-l)/Math.tan(_-s),S=3);for(var b,w,A=0;a>_-y;)a-=_,A+=4;a>=-y&&y>a?(b=c,w=g+(c-f)*Math.tan(a),A+=0):a<Math.PI-y?(w=u,b=f+(u-g)/Math.tan(a),A+=1):a<Math.PI+y?(b=h,w=g+(f-h)*Math.tan(Math.PI-a),A+=2):(w=l,b=f+(g-l)/Math.tan(_-a),A+=3);var E=[new qc.Point(c,u),new qc.Point(h,u),new qc.Point(h,l),new qc.Point(c,l)];for(m=[new qc.Point(f,g),new qc.Point(T,x)];A>S;)m.push(E[S%4]),S++;m.push(new qc.Point(b,w))}else m=[new qc.Point(h,l),new qc.Point(c,l),new qc.Point(c,u),new qc.Point(h,u)];if(!this._isNeedUseClipReplaceStencil()){for(var C=0;C<m.length;C++)m[C]=e.apply(m[C]);d&&m.reverse()}if(this._softClip=m,this._isNeedUseClipReplaceStencil()){var P=this.gameObject.phaser.getBounds(),I=this._graphicsFilter.otherTexture;I.resize(P.width,P.height),I.offset.x=-P.x,I.offset.y=-P.y;var O=I.graphics;O.clear(),O.beginFill(16777215),O.drawPolygon(m),O.worldTransform=this.gameObject.worldTransform}else t.clear(),t.beginFill(16777215),t.drawPolygon(m);this._refresh()}},NodeMask.prototype._checkRenderable=function(t,e){var i=e.getWorldBox();e.renderable=qc.Rectangle.intersects(t,i)?!0:!1;for(var r=e.children,n=0;n<r.length;n++)this._checkRenderable(t,r[n])},NodeMask.prototype._resetRenderAble=function(t){if(t){t.renderable=!0;for(var e=t.children,i=0;i<e.length;i++)this._resetRenderAble(e[i])}},NodeMask.MODE_DEFAULT=0,NodeMask.MODE_PIXEL=1,NodeMask.MODE_GRAPHICS=2,NodeMask.CLIP_STENCIL=1;var NonexistScript=defineBehaviour("qc.NonexistScript",qc.Behaviour,function(){this.script="",this.data={}},{});NonexistScript.__hiddenInMenu=!0;var ScaleAdapter=defineBehaviour("qc.ScaleAdapter",qc.Behaviour,function(){var t=this;t.target=null,t.referenceResolution=new qc.Point(0,0),t.manualType=ScaleAdapter.NONE,t.gameObjectRecord=t.gameObject?[t.gameObject.scaleX,t.gameObject.scaleY,t.gameObject.width,t.gameObject.height]:[],t._fullTarget=!1,t.runInEditor=!0},{target:qc.Serializer.NODE,referenceResolution:qc.Serializer.GEOM,manualType:qc.Serializer.NUMBER,fullTarget:qc.Serializer.BOOLEAN,gameObjectRecord:qc.Serializer.NUMBERS});ScaleAdapter.__hiddenInMenu=!0,Object.defineProperties(ScaleAdapter.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(t){this._fullTarget!==t&&(this._fullTarget=t,!t&&this.gameObject&&(this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3]),this._forceUpdate=!0)}}}),ScaleAdapter.NONE=0,ScaleAdapter.MANUAL_HEIGHT=1,ScaleAdapter.MANUAL_WIDTH=2,ScaleAdapter.EXPAND=3,ScaleAdapter.SHRINK=4,ScaleAdapter.FILL=5,ScaleAdapter.prototype.awake=function(){if(this.game.fixedGameSize){var t=this.gameObject;t.width=this.game.world.width,t.height=this.game.world.height,t.scaleX=1,t.scaleY=1}},ScaleAdapter.prototype.onEnable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i[0]=e.scaleX,i[1]=e.scaleY,i[2]=e.width,i[3]=e.height},ScaleAdapter.prototype.onDisable=function(){var t=this,e=t.gameObject,i=t.gameObjectRecord;i.length<4||null===i[0]||isNaN(i[0])||(e.scaleX=i[0],e.scaleY=i[1],e.width=i[2],e.height=i[3])},ScaleAdapter.prototype.preUpdate=function(){var t=this;if(!t.game.fixedGameSize){var e=t.gameObject;if(e&&e.scaleX){var i=t.getTargetSize(),r=t.getReferenceResolution();if(0!==i.x&&0!==i.y&&0!==r.x&&0!==r.y){var n=1,o=1;switch(this.manualType){case qc.ScaleAdapter.MANUAL_HEIGHT:o=n=i.y/r.y;break;case qc.ScaleAdapter.MANUAL_WIDTH:o=n=i.x/r.x;break;case qc.ScaleAdapter.EXPAND:o=n=Math.min(i.x/r.x,i.y/r.y);break;case qc.ScaleAdapter.SHRINK:o=n=Math.max(i.x/r.x,i.y/r.y);break;case qc.ScaleAdapter.FILL:n=i.x/r.x,o=i.y/r.y}isNaN(n)||isNaN(o)||(this.fullTarget&&(this.gameObject.width=i.x/n,this.gameObject.height=i.y/o),(this._forceUpdate||this.gameObject.scaleX!==n||this.gameObject.scaleY!==o)&&(this._forceUpdate=!1,this.gameObject.scaleX=n,this.gameObject.scaleY=o))}}}},ScaleAdapter.prototype.onDestroy=function(){this.target=null},ScaleAdapter.prototype.getTargetSize=function(){var t=this.target||this.gameObject.game.world;return t&&t.width&&t.height?new qc.Point(t.width,t.height):new qc.Point(0,0)},ScaleAdapter.prototype.getReferenceResolution=function(){return this.referenceResolution};var ToggleGroup=qc.defineBehaviour("qc.ToggleGroup",qc.Behaviour,function(){this._toggles=[],this.runInEditor=!0,this.onValueChange=new qc.Signal},{toggles:qc.Serializer.NODES,allowSwitchOff:qc.Serializer.BOOLEAN});ToggleGroup.__menu="UI/ToggleGroup",Object.defineProperties(ToggleGroup.prototype,{toggle:{get:function(){for(var t=0;t<this._toggles.length;t++){var e=this._toggles[t];if(e&&e.on)return e}return null},set:function(t){var e=this._toggles.indexOf(t);if(-1===e)return this.game.log.error("target is not in this group"),undefined;for(var i=0;i<this._toggles.length;i++){var r=this._toggles[i];r&&(r.on=r===t)}this.onValueChange.dispatch(this,t,!0)}},toggles:{get:function(){return this._toggles},set:function(t){var e=this;e._toggles.forEach(function(t){t&&(t.onValueChange.remove(e._onValueChange,e),t.canValueChange.remove(e._canValueChange,e))}),e._toggles=t||[],e._toggles.forEach(function(t){t&&(t.onValueChange.add(e._onValueChange,e),t.canValueChange.add(e._canValueChange,e))})}},allowSwitchOff:{get:function(){var t=this._allowSwitchOff;return t===undefined?!0:t},set:function(t){t=!!t;var e=this.allowSwitchOff;e!==t&&(this._allowSwitchOff=t,t||this._assureSelection())}}}),ToggleGroup.prototype._assureSelection=function(){if(null==this.toggle){var t=this.toggles;if(t&&t.length){var e=t[0];e&&(e.on=!0)}}},ToggleGroup.prototype.add=function(t){-1===this._toggles.indexOf(t)&&(this._toggles.push(t),t.on=!1,t.onValueChange.add(this._onValueChange,this),t.canValueChange.add(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype.remove=function(t){var e=this._toggles.indexOf(t);-1!==e&&(this._toggles.splice(e,1),t.onValueChange.remove(this._onValueChange,this),t.canValueChange.remove(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype._canValueChange=function(t,e,i,r){if(!this.allowSwitchOff&&i&&!e){for(var n=!1,o=0,s=this.toggles.length;s>o;o++){var a=this.toggles[o];if(a!==t){if(a&&a.on)return}else n=!0}n&&(r.ignore=!0)}},ToggleGroup.prototype._onValueChange=function(t){t.on?this.toggle=t:this.toggle||this.onValueChange.dispatch(this,t,!1)};var TransitionBehaviour=qc.defineBehaviour("qc.TransitionBehaviour",qc.Behaviour,function(){if(this.gameObject.state===undefined)throw Error("The target node does not have the interactive function, and can not be added to this component.");this.target=this.gameObject,this._transition=qc.Transition.TEXTURE_SWAP},{target:qc.Serializer.NODE,_transition:qc.Serializer.NUMBER,_normalTexture:{get:function(t,e){return this._saveTexture(t._normalTexture,e)},set:function(t,e){this._normalTexture=this._restoreTexture(e,t)}},_pressedTexture:{get:function(t,e){return this._saveTexture(t._pressedTexture,e)},set:function(t,e){this._pressedTexture=this._restoreTexture(e,t)}},_disabledTexture:{get:function(t,e){return this._saveTexture(t._disabledTexture,e)},set:function(t,e){this._disabledTexture=this._restoreTexture(e,t)}},_normalColor:qc.Serializer.COLOR,_pressedColor:qc.Serializer.COLOR,_disabledColor:qc.Serializer.COLOR});TransitionBehaviour.__menu="UI/TransitionBehaviour",Object.defineProperties(TransitionBehaviour.prototype,{target:{get:function(){return this._target},set:function(t){this._target=t,this._reset()}},transition:{get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition=t,this.target&&this._reset())}},normalTexture:{get:function(){return this._normalTexture},set:function(t){t!==this._normalTexture&&(this._normalTexture=t,this.target&&this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.normalTexture))}},pressedTexture:{get:function(){return this._pressedTexture},set:function(t){t!==this._pressedTexture&&(this._pressedTexture=t,this.target&&this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.pressedTexture))}},disabledTexture:{get:function(){return this._disabledTexture},set:function(t){t!==this._disabledTexture&&(this._disabledTexture=t,this.target&&this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.disabledTexture))}},normalColor:{get:function(){return this._normalColor},set:function(t){if(this._normalColor!==t&&this.target){if(t=t||Color.white,!(t instanceof Color))return this.game.log.error("Expected qc.Color, got:{0}",t),undefined;this._normalColor=t,this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.normalColor)}}},pressedColor:{get:function(){return this._pressedColor},set:function(t){if(this._pressedColor!==t&&this.target){if(t=t||Color.grey,!(t instanceof Color))return this.game.log.error("Expected qc.Color, got:{0}",t),undefined;this._pressedColor=t,this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.pressedColor)}}},disabledColor:{get:function(){return this._disabledColor},set:function(t){if(this._disabledColor!==t&&this.target){if(t=t||Color.grey,!(t instanceof Color))return this.game.log.error("Expected:qc.Color, got:{0}",t),undefined;this._disabledColor=t,this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.disabledColor)}}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(t){this._pressedAnimation!==t&&(this._pressedAnimation=t)}}}),TransitionBehaviour.prototype._normalColor=Color.white,TransitionBehaviour.prototype._pressedColor=Color.grey,TransitionBehaviour.prototype._disabledColor=Color.grey,TransitionBehaviour.prototype.awake=function(){this.addListener(this.gameObject.onStateChange,this._reset,this),this._reset()},TransitionBehaviour.prototype._saveTexture=function(t,e){return this.gameObject.game.serializer._saveTextureItem(t,e)},TransitionBehaviour.prototype._restoreTexture=function(t,e){if(t&&t.length&&t[0]===qc.Serializer.STRING){var i=e.gameObject.texture;return i&&i.atlas.frameNames.indexOf(t[1])>=0?e.gameObject.texture.atlas.getTexture(t[1]):null}return this.gameObject.game.serializer._restoreTextureItem(t)},TransitionBehaviour.prototype._reset=function(){if(this.target&&this.enable)switch(this.transition){case qc.Transition.NONE:break;case qc.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case qc.UIState.NORMAL:this.normalTexture&&(this.target.texture=this.normalTexture);break;case qc.UIState.PRESSED:this.pressedTexture&&(this.target.texture=this.pressedTexture);break;case qc.UIState.DISABLED:this.disabledTexture&&(this.target.texture=this.disabledTexture)}break;case qc.Transition.COLOR_TINT:switch(this.gameObject.state){case qc.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case qc.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case qc.UIState.DISABLED:this.target.colorTint=this.disabledColor}break;case qc.Transition.ANIMATION:}};var Tween=defineBehaviour("qc.Tween",qc.Behaviour,function(){this._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),this._started=!1,this._startTime=0,this._amountPerDelta=1e3,this._factor=0,this.duration=1,this.runInEditor=!0,this.flag="",this.playOnAwake=!1,this.canRunInEditor=!1},{_curve:qc.Serializer.GEOM,sampleMethod:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,delay:qc.Serializer.NUMBER,duration:qc.Serializer.NUMBER,tweenGroup:qc.Serializer.NUMBER,flag:qc.Serializer.STRING,playOnAwake:qc.Serializer.BOOLEAN});Tween.__hiddenInMenu=!0,Object.defineProperties(Tween.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||Tween.SAMPLE_LINEAR},set:function(t){this._sampleMethod!==t&&(this._sampleMethod=t)}},style:{get:function(){return this._style||0},set:function(t){this._style!==t&&(this._style=t)}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(t){this._delay!==t&&(this._delay=t)}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(t){this._duration!==t&&(this._duration=t,this._amountPerDelta=Math.abs(t>0?1/(1e3*t):1e3)*(this._amountPerDelta<0?-1:1))}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(t){this._tweenGroup!==t&&(this._tweenGroup=t)}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(t){this._factor=Phaser.Math.clamp(t,0,1)}},direction:{get:function(){return this.amountPerDelta<0?Tween.DIR_REVERSE:Tween.DIR_FORWARD}}}),Tween.prototype.awake=function(){var t=this;t._started||(t.enable=!1,t.playOnAwake&&(t.resetToBeginning(),t.playForward()))},Tween.prototype._lineSample=function(t){return t},Tween.prototype.start=function(){this.update()},Tween.prototype.update=function(){if(this.enable&&(!this.gameObject||!this.game.device.editor||this.canRunInEditor)){var t=this.game.time.deltaTime,e=this.game.time.scaledTime;this._started||(this._started=!0,this._dispatchStart=!1,this._startTime=e+1e3*this.delay),e<this._startTime||(e===this._startTime?t=0:e-this._startTime<t&&(t=e-this._startTime),this._dispatchStart||(this._dispatchStart=!0,this._onStart&&this._onStart.dispatch(this)),this._factor+=this.amountPerDelta*t,this.style===Tween.STYLE_LOOP?this._factor>1&&(this._factor-=Math.floor(this._factor),this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this.style===Tween.STYLE_PINGPONG&&(this._factor>1?(this._factor=1-(this._factor-Math.floor(this._factor)),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this._factor<0&&(this._factor=-this._factor,this._factor-=Math.floor(this._factor),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this))),this.style===Tween.STYLE_ONCE&&(0===this.duration||this._factor>1||this._factor<0)?(this._factor=Phaser.Math.clamp(this._factor,0,1),this.sample(this._factor,!0),this._onFinished&&this._onFinished.dispatch(this),(0===this.duration||1===this._factor&&this._amountPerDelta>0||0===this._factor&&this._amountPerDelta<0)&&(this.enable=!1)):this.sample(this._factor,!1))}},Tween.prototype.onDisable=function(){this._started=!1,this.canRunInEditor=!1},Tween.prototype.sample=function(t,e){var i=Phaser.Math.clamp(t,0,1);switch(this.sampleMethod){case Tween.SAMPLE_LINEAR:i=this._lineSample(i)}this.onUpdate(this.curve.evaluate(i),e)},Tween.prototype._funcGroup=function(t){var e=this;return 0===e.tweenGroup?(t(e),undefined):(Tween._funcGroup(e.gameObject,e.tweenGroup,t),undefined)},Tween.prototype.reset=function(t){this._started||(t?this.setEndToCurrValue():this.setStartToCurrValue())},Tween.prototype.resetGroup=function(t){var e=function(e){e.reset(t)};this._funcGroup(e)},Tween.prototype.playForward=function(t){t&&this.resetToBeginning(),this.play(!1)},Tween.prototype.playGroupForward=function(t){var e=function(e){e.playForward(t)};this._funcGroup(e)},Tween.prototype.playReverse=function(t){t&&this.resetToBeginning(!0),this.play(!0)},Tween.prototype.playGroupReverse=function(t){var e=function(e){e.playReverse(t)};this._funcGroup(e)},Tween.prototype.stop=function(){this.enable=!1,this.canRunInEditor=!1},Tween.prototype.stopGroup=function(){var t=function(t){t.stop()};this._funcGroup(t)},Tween.prototype.play=function(t){this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this.enable=!0,this.canRunInEditor=!0,this.update()},Tween.prototype.playGroup=function(t){var e=function(e){e.play(t)};this._funcGroup(e)},Tween.prototype.resetToBeginning=function(t){this._started=!1,this._amountPerDelta=Math.abs(this.amountPerDelta)*(t?-1:1),this._factor=this.amountPerDelta<0?1:0,this.sample(this._factor,!1),t?this.setEndToCurrValue():this.setStartToCurrValue()},Tween.prototype.resetGroupToBeginning=function(t){var e=function(e){e.resetToBeginning(t)};this._funcGroup(e)},Tween.prototype.toggle=function(){this._amountPerDelta=this._factor>0?-this.amountPerDelta:Math.abs(this.amountPerDelta),this.enable=!0},Tween.prototype.onUpdate=function(){},Tween.prototype.setStartToCurrValue=function(){},Tween.prototype.setEndToCurrValue=function(){},Tween.prototype.setCurrToStartValue=function(){},Tween.prototype.setCurrToEndValue=function(){},Tween.begin=function(t,e,i){var r=e.getScript(t,!1);if(r&&0!=r.tweenGroup){r=null;for(var n=e.getScripts(t,!1),o=0;o<n.length;++o)if(n[o]&&0===n[o].tweenGroup){r=n[o];break}}if((r||(r=e.addScript(t)))&&r instanceof Tween)return r._started=!1,r.duration=i,r._factor=0,r._amountPerDelta=Math.abs(r.amountPerDelta),r.style=Tween.STYLE_ONCE,r._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),r.enable=!0,r},Tween._funcGroup=function(t,e,i){for(var r=t.getScripts?t.getScripts("qc.Tween"):[],n=r.length;n-->0;)r[n].tweenGroup===e&&i(r[n]);var o=t.children;if(o)for(var s=o.length;s-->0;){var a=o[s];Tween._funcGroup(a,e,i)}},Tween.resetGroup=function(t,e,i){var r=function(t){t.reset(i)};Tween._funcGroup(t,e,r)},Tween.playGroupForward=function(t,e){var i=function(t){t.playForward()};Tween._funcGroup(t,e,i)},Tween.playGroupReverse=function(t,e){var i=function(t){t.playReverse()};Tween._funcGroup(t,e,i)},Tween.stopGroup=function(t,e){var i=function(t){t.stop()};Tween._funcGroup(t,e,i)},Tween.playGroup=function(t,e,i){var r=function(t){t.play(i)};Tween._funcGroup(t,e,r)},Tween.resetGroupToBeginning=function(t,e,i){var r=function(t){t.resetToBeginning(i)};Tween._funcGroup(t,e,r)},Tween.STYLE_ONCE=0,Tween.STYLE_LOOP=1,Tween.STYLE_PINGPONG=2,Tween.DIR_FORWARD=0,Tween.DIR_REVERSE=1,Tween.SAMPLE_LINEAR=0;var TweenAlpha=defineBehaviour("qc.TweenAlpha",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenAlpha.__menu="Tween/TweenAlpha",TweenAlpha.prototype.onUpdate=function(t){var e=this,i=e.from,r=e.to;e.gameObject.alpha=Phaser.Math.clamp(i+t*(r-i),0,1)},TweenAlpha.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from},TweenAlpha.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to},TweenAlpha.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha},TweenAlpha.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha},TweenAlpha.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenAlpha",t,e);return r.from=t.alpha,r.to=i,e>0||(r.sample(1,!0),r.enable=!1),r};var TweenColor=defineBehaviour("qc.TweenColor",qc.Tween,function(){var t=this;t.from=Color.black,t.to=Color.white,t.enable=!1},{from:qc.Serializer.COLOR,to:qc.Serializer.COLOR});TweenColor.__menu="Tween/TweenColor",TweenColor.prototype.onUpdate=function(t){var e=this,i=e.from.rgb,r=e.to.rgb,n=[Phaser.Math.clamp(Math.round(i[0]+t*(r[0]-i[0])),0,255),Phaser.Math.clamp(Math.round(i[1]+t*(r[1]-i[1])),0,255),Phaser.Math.clamp(Math.round(i[2]+t*(r[2]-i[2])),0,255),Phaser.Math.clamp(e.from.alpha+t*(e.to.alpha-e.from.alpha),0,1)],o=new Color(n);e.gameObject.colorTint=o},TweenColor.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new Color(""+this.from)},TweenColor.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new Color(""+this.to)},TweenColor.prototype.setCurrToStartValue=function(){this.from=new Color(""+this.gameObject.colorTint)},TweenColor.prototype.setCurrToEndValue=function(){this.to=new Color(""+this.gameObject.colorTint)},TweenColor.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenColor",t,e);return r.from=new Color(""+t.colorTint),r.to=i,e>0||(r.sample(1,!0),r.enable=!1),r};var TweenPosition=defineBehaviour("qc.TweenPosition",qc.Tween,function(){var t=this;t.from=new qc.Point(0,0),t.to=new qc.Point(0,0),t.moveAxis=TweenPosition.BOTH,t.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT,moveAxis:qc.Serializer.NUMBER});TweenPosition.__menu="Tween/TweenPosition",TweenPosition.prototype.onUpdate=function(t){var e=this,i=e.from,r=e.to;0!==(e.moveAxis&TweenPosition.ONLY_X)&&(e.gameObject.x=i.x+t*(r.x-i.x)),0!==(e.moveAxis&TweenPosition.ONLY_Y)&&(e.gameObject.y=i.y+t*(r.y-i.y))},TweenPosition.prototype.setStartToCurrValue=function(){0!==(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.from.x),0!==(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.from.y)},TweenPosition.prototype.setEndToCurrValue=function(){0!==(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.to.x),0!==(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.to.y)
},TweenPosition.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenPosition",t,e);return r.from=new qc.Point(t.x,t.y),r.to=i.clone(),e>0||(r.sample(1,!0),r.enable=!1),r},TweenPosition.BOTH=255,TweenPosition.ONLY_X=1,TweenPosition.ONLY_Y=2;var TweenProperty=defineBehaviour("qc.TweenProperty",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.property="",t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER,property:qc.Serializer.STRING});TweenProperty.__menu="Tween/TweenProperty",Object.defineProperties(TweenProperty.prototype,{property:{get:function(){return this._property},set:function(t){if(t!==this._property){for(var e=t.split("."),i=this.gameObject,r=0;r<e.length-1;r++)if(i=i[e[r]],!i)return this.game.log.important("The property({0}) non-exist.",t),undefined;this._ob=i,this._attrib=e[e.length-1],this._property=t}}}}),TweenProperty.prototype.onUpdate=function(t){var e=this,i=e.from,r=e.to;e._ob[e._attrib]=i+t*(r-i)},TweenProperty.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from},TweenProperty.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to},TweenProperty.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]},TweenProperty.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]},TweenProperty.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenProperty",t,e);return r.from=this._ob[this._attrib],r.to=i,e>0||(r.sample(1,!0),r.enable=!1),r};var TweenRotation=defineBehaviour("qc.TweenRotation",qc.Tween,function(){var t=this;t.from=0,t.to=1,t.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenRotation.__menu="Tween/TweenRotation",TweenRotation.prototype.onUpdate=function(t){var e=this,i=e.from,r=e.to;e.gameObject.rotation=i+t*(r-i)},TweenRotation.prototype.setStartToCurrValue=function(){this.gameObject.rotation=this.from},TweenRotation.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to},TweenRotation.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation},TweenRotation.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation},TweenRotation.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenRotation",t,e);return r.from=t.rotation,r.to=i,e>0||(r.sample(1,!0),r.enable=!1),r};var TweenScale=defineBehaviour("qc.TweenScale",qc.Tween,function(){var t=this;t.from=new qc.Point(0,0),t.to=new qc.Point(1,1),t.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT});TweenScale.__menu="Tween/TweenScale",TweenScale.prototype.onUpdate=function(t){var e=this,i=e.from,r=e.to,n=new qc.Point(i.x+t*(r.x-i.x),i.y+t*(r.y-i.y));e.gameObject.scaleX=n.x,e.gameObject.scaleY=n.y},TweenScale.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x,this.gameObject.scaleY=this.from.y},TweenScale.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x,this.gameObject.scaleY=this.to.y},TweenScale.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.begin=function(t,e,i){var r=qc.Tween.begin("qc.TweenScale",t,e);return r.from=new qc.Point(t.scaleX,t.scaleY),r.to=i.clone(),e>0||(r.sample(1,!0),r.enable=!1),r};var TweenTransform=defineBehaviour("qc.TweenTransform",qc.Tween,function(){var t=this;t.enable=!1,t.localFrom=new qc.Point,t.localTo=new qc.Point},{from:qc.Serializer.NODE,to:qc.Serializer.NODE});TweenTransform.__menu="Tween/TweenTransform",Object.defineProperties(TweenTransform.prototype,{from:{get:function(){return this._from},set:function(t){if(this._from=t,t){var e=this._from.getWorldPosition();this.localFrom=this.gameObject.parent.toLocal(e)}}},to:{get:function(){return this._to},set:function(t){if(this._to=t,t){var e=this._to.getWorldPosition();this.localTo=this.gameObject.parent.toLocal(e)}}}}),TweenTransform.prototype.onUpdate=function(t){if(this._from&&this._to){var e=this;e.gameObject.x=e.localFrom.x+t*(e.localTo.x-e.localFrom.x),e.gameObject.y=e.localFrom.y+t*(e.localTo.y-e.localFrom.y)}};var VerticalLayout=defineBehaviour("qc.VerticalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});VerticalLayout.__menu="UI/Layout/VerticalLayout",Object.defineProperties(VerticalLayout.prototype,{spacing:{get:function(){return this.spacingY},set:function(t){this.spacingY=t}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(t){this._childForceExpandWidth!==t&&(this._childForceExpandWidth=t,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(t){this._childForceExpandHeight!==t&&(this._childForceExpandHeight=t,this.rebuildTable())}}}),VerticalLayout.prototype._getDefaultLayout=function(t){return"y"===t?{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}:{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}},VerticalLayout.prototype.getCellLayout=function(t){var e=qc.LayoutElement.getLayoutElement(t);return this.childForceExpandWidth&&(e.flexibleWidth=1),this.childForceExpandHeight&&(e.flexibleHeight=1),e};var Prop=qc.Prop=function(t,e,i){var r=this;r.action=t,r.path=e,r.propertyId=i,r.propMap={},r.propDefaultValue={},r.keyIndexMap={}};Prop.prototype.constructor=Prop,Prop.prototype.destroy=function(){this.action=null,this.propMap={}},Prop.prototype.getPropMap=function(){return this.propMap},Prop.prototype.saveValue=function(t,e,i){var r;switch(t){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:r=e;break;case Serializer.COLOR:r=e instanceof Color?e.toNumber(!0):null;break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:r=[e.class,e.toJson()];break;case Serializer.TEXTURE:if(e)if(e[0]instanceof qc.Atlas){var n=e[0],o=e[1];i.dependences.push({key:n.key,uuid:n.uuid}),r=[n.uuid,o]}else r=null;else r=null;break;case Serializer.AUDIO:e instanceof qc.SoundAsset?(i.dependences.push({key:e.key,uuid:e.uuid}),r=e.uuid):r=null;break;default:throw Error("unsupported asset type:"+t)}return r},Prop.prototype.restoreValue=function(t,e){var i;switch(t){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:i=e;break;case Serializer.COLOR:i=new Color(e);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:if(e){var r=qc.Util.findClass(e[0]),n=new r;n.fromJson(e[1]),i=n}else i=null;break;case Serializer.TEXTURE:if(e){var o=e[0],s=e[1],a=this.action.game.assets.findByUUID(o);a?i=a instanceof qc.Atlas?[a,s]:[null,s]:(console.error("贴图资源尚未载入，无法反序列化。",e),i=[null,s])}else i=[];break;case Serializer.AUDIO:if(e){var a=this.action.game.assets.findByUUID(e);a?i=a instanceof qc.SoundAsset?a:null:(console.error("音频资源尚未载入，无法反序列化。",e),i=null)}else i=null;break;default:throw Error("unsupported asset type:"+t)}return i},Prop.prototype.setData=function(){},Prop.prototype.fromJson=function(){return 0},Prop.prototype.toJson=function(){return[]},Prop.prototype.addKey=function(){return 0},Prop.prototype.deleteKey=function(){return 0},Prop.prototype.getDuration=function(){return{}},Prop.prototype.getValue=function(){},Prop.prototype.getValueByIndex=function(){},Prop.prototype.setValue=function(){},Prop.prototype.isKey=function(){return!1},Prop.prototype.update=function(){},Prop.prototype.reset=function(){this.keyIndexMap={}};var KeyProp=qc.KeyProp=function(t,e,i){var r=this;qc.Prop.call(r,t,e,i)};KeyProp.prototype=Object.create(qc.Prop.prototype),KeyProp.prototype.constructor=KeyProp,KeyProp.prototype.fromJson=function(t,e){this.propertyInfo=t,this.forceUpdate=t.forceUpdate;for(var i=0,r=t.properties,n=0;n<r.length;n++){var o,s=r[n].attrib;if("string"==typeof s){var a=s.split(".");a.length>1&&(o=a)}if(this.propDefaultValue[s]=r[n].default,e){var h=e[n];if(h){for(var l=h[0],c=h[1],u=[],p=0;p<c.length;p++)u.push([c[p][0],this.restoreValue(l,c[p][1])]);if(this.propMap[s]=[l,u,o],u.length>0){var d=u[u.length-1][0];d>i&&(i=d)}}else this.propMap[s]||(this.propMap[s]=[r[n].type,[],o])}else this.propMap[s]=[r[n].type,[],o]}return i},KeyProp.prototype.toJson=function(t){for(var e=[],i=this.propertyInfo.properties,r=0;r<i.length;r++){var n=i[r].attrib,o=this.propMap[n],s=o[0],a=o[1];if(s&&a){for(var h=[],l=0;l<a.length;l++)h.push([a[l][0],this.saveValue(s,a[l][1],t)]);e.push([s,h])}}return e},KeyProp.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(!r)return this.action.game.log.important("KeyProp not find attrib({0}) in addKey.",t),undefined;var n=function(t,e){return t[0]<e[0]};i!==undefined&&null!==i||this.propDefaultValue[t]==undefined||(i=this.propDefaultValue[t]);var o=qc.Util.insertSortedList(r[1],[e,i],n);return o},KeyProp.prototype.deleteKey=function(t,e){var i=this.propMap[t];return i?i[1]?i[1].splice(e,1):null:(this.action.game.log.important("KeyProp not find attrib({0}) in deleteKey.",t),undefined)},KeyProp.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("KeyProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i[1].length;r++)e.push(i[1][r][0]);return e},KeyProp.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e];0!==i[1].length&&i[1][i[1].length-1][0]>t&&(t=i[1][i[1].length-1][0])}return t},KeyProp.prototype.isKey=function(t,e){var i=this.propMap[t];if(0===i[1].length)return!1;for(var r=0;r<i[1].length;r++)if(this.action.game.math.fuzzyEqual(i[1][r][0],e))return r},KeyProp.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t];n[1][r][1]=i},KeyProp.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;for(var r=0;r<i[1].length;r++)if(i[1][r][0]>e)return r=r>0?r-1:0,i[1][r][1];return i[1][i[1].length-1][1]},KeyProp.prototype.getValueByIndex=function(t,e){var i=this.propMap[t];return 0===i[1].length?null:i[1][e]?i[1][e][1]:null},KeyProp.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var o=t,s=0;n-1>s&&(o=o[r[s]],o);s++);o&&(o[r[n-1]]=i)}}else t[e]=i},KeyProp.prototype.update=function(t,e,i,r,n){i&&(this.keyIndexMap={});for(var o in this.propMap){var s=this.keyIndexMap[o]||0,a=this.propMap[o];if(0!==a[1].length)if(s>a[1].length&&(this.keyIndexMap[o]=a[1].length,s=a[1].length),s<a[1].length&&a[1][s][0]<=e)for(var h=s;h<a[1].length&&a[1][h][0]<=e;h++)this.updateAttrib(t,o,a[1][h][1],a[2]),this.keyIndexMap[o]=h+1;else{for(var l=!1,h=s-1;h>=0;h--)if(a[1][h]){if(a[1][h][0]<=e){l=!0,(h!==s-1||r&&(n||this.forceUpdate))&&(this.updateAttrib(t,o,a[1][h][1],a[2]),this.keyIndexMap[o]=h+1);break}}else this.action.game.log.error("{0}:{1}~{2} update error: keyIndex({3}), propList({4})",this.path,this.propertyId,o,s,a[1]);l||(this.keyIndexMap[o]=0)}}};var LinearProp=qc.LinearProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};LinearProp.prototype=Object.create(qc.KeyProp.prototype),LinearProp.prototype.constructor=LinearProp,LinearProp.prototype.calcValue=function(t,e,i){return t+i*(e-t)},LinearProp.prototype.getValue=function(t,e){var i=this.propMap[t];if(0===i[1].length)return null;if(e<=i[1][0][0])return i[1][0][1];for(var r=0;r<i[1].length;r++)if(i[1][r][0]>=e){r=r>0?r-1:0;var n=(e-i[1][r][0])/(i[1][r+1][0]-i[1][r][0]);return this.calcValue(i[1][r][1],i[1][r+1][1],n)}return i[1][i[1].length-1][1]},LinearProp.prototype.updateAttrib=function(t,e,i,r){if(r){var n=r.length;if(2===n&&t[r[0]])t[r[0]][r[1]]=i;else if(n>2){for(var o=t,s=0;n-1>s&&(o=o[r[s]],o);s++);o&&(o[r[n-1]]=i)}}else t[e]=i},LinearProp.prototype.update=function(t,e,i){i&&(this.keyIndexMap={});for(var r in this.propMap){var n=this.keyIndexMap[r]||0,o=this.propMap[r];if(0!==o[1].length)if(n<o[1].length||(this.keyIndexMap[r]=o[1].length-1,n=o[1].length-1),o[1][n][0]>e){if(o[1][0][0]>e){this.keyIndexMap[r]=0;continue}for(var s=0;n>s;s++)if(o[1][s][0]<=e&&o[1][s+1][0]>e){var a=(e-o[1][s][0])/(o[1][s+1][0]-o[1][s][0]);if(o[1][s][1]&&o[1][s+1][1]){var h=this.calcValue(o[1][s][1],o[1][s+1][1],a);this.updateAttrib(t,r,h,o[2])}this.keyIndexMap[r]=s;break}}else for(var s=n;s<o[1].length;s++)if(s===o[1].length-1)s!==n&&(this.updateAttrib(t,r,o[1][s][1],o[2]),this.keyIndexMap[r]=s);else if(o[1][s][0]<=e&&o[1][s+1][0]>e){var a=(e-o[1][s][0])/(o[1][s+1][0]-o[1][s][0]);if(o[1][s][1]&&o[1][s+1][1]){var h=this.calcValue(o[1][s][1],o[1][s+1][1],a);this.updateAttrib(t,r,h,o[2])}this.keyIndexMap[r]=s;break}}};var CurveProp=qc.CurveProp=function(t,e,i){var r=this;qc.Prop.call(r,t,e,i)};CurveProp.prototype=Object.create(qc.Prop.prototype),CurveProp.prototype.constructor=CurveProp,CurveProp.prototype.fromJson=function(t,e){this.propertyInfo=t;for(var i=0,r=t.properties,n=0;n<r.length;n++){var o,s=r[n].attrib;if("string"==typeof s){var a=s.split(".");a.length>1&&(o=a)}if(this.propDefaultValue[s]=r[n].default,e){var h=e[n];if(h){var l=new qc.BezierCurve;if(this.propMap[s]={curveType:h[0],curve:l,to:0,attribArray:o},l.fromJson(h[1]),h[0]<qc.CURVE_TYPE_TWEEN_RELATIVE||(this.propMap[s].from=h[2][0],this.propMap[s].to=h[2][1]||0),l._keys.length>0){var c=l._keys[l._keys.length-1].time;c>i&&(i=c)}}}else this.propMap[s]={curveType:qc.CURVE_TYPE_ABSOLUTE,curve:new qc.BezierCurve,to:0,attribArray:o}}return i},CurveProp.prototype.toJson=function(){for(var t=[],e=this.propertyInfo.properties,i=0;i<e.length;i++){var r=e[i].attrib,n=this.propMap[r],o=[n.curveType,n.curve.toJson()];n.curveType<qc.CURVE_TYPE_TWEEN_RELATIVE||o.push([n.from,n.to]),t.push(o)}return t},CurveProp.prototype.setData=function(t,e){var i=this.propMap[t];return i?("number"==typeof e.curveType&&(i.curveType=e.curveType),"number"==typeof e.from&&(i.from=e.from),"number"==typeof e.to&&(i.to=e.to),undefined):(this.action.game.log.important("CurveProp not find attrib({0}) in setData.",t),undefined)},CurveProp.prototype.getMaxValue=function(t){var e=this.propMap[t];if(!e)return this.action.game.log.important("CurveProp not find attrib({0}) in getMaxValue.",t),undefined;for(var i=!1,r=0;r<e.curve._keys.length;r++)i===!1?i=e.curve._keys[r].value:i<e.curve._keys[r].value&&(i=e.curve._keys[r].value);return e.curveType===qc.CURVE_TYPE_ABSOLUTE?i:e.curveType===qc.CURVE_TYPE_RELATIVE?e.from+i:e.curveType===qc.CURVE_TYPE_TWEEN_ABSOLUTE?e.from+i*(e.to-e.from):e.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE?e.from+i*e.to:undefined},CurveProp.prototype.getFromValue=function(t,e,i){var r=this.propMap[e];if(!r)return this.action.game.log.important("CurveProp not find attrib({0}) in getFromValue.",e),undefined;if("number"==typeof r.from)return r.from;if(t){var n;if(r.attribArray){var o=r.attribArray.length;if(2===o)n=t[r.attribArray[0]]?t[r.attribArray[0]][r.attribArray[1]]:null;else if(o>2){for(var s=t,a=0;o-1>a&&(s=s[r.attribArray[a]],s);a++);s&&(n=s[r.attribArray[o-1]])}}else n=t[e];var h=this.getValue(e,i,!0)||0,l=r.to,c=h;return r.curveType===qc.CURVE_TYPE_RELATIVE?c=n-h:r.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE&&(c=n-(l?l*h:0)),r.from=c,c}},CurveProp.prototype.addKey=function(t,e,i){var r=this.propMap[t];if(!r)return this.action.game.log.important("CurveProp not find attrib({0}) in addKey.",t),undefined;i!==undefined&&null!==i||this.propDefaultValue[t]==undefined||(i=this.propDefaultValue[t]),i=i||0;var n=r.curve.addKey(e,i);return r.curve.makeKeyframeLinear(n-1),r.curve.makeKeyframeLinear(n),r.curve.makeKeyframeLinear(n+1),n},CurveProp.prototype.deleteKey=function(t,e){var i=this.propMap[t];return i?(i.curve.removeKey(e),undefined):(this.action.game.log.important("CurveProp not find attrib({0}) in deleteKey.",t),undefined)},CurveProp.prototype.getKeyTimeList=function(t){var e=[],i=this.propMap[t];if(!i)return this.action.game.log.important("CurveProp not find attrib({0}) in getKeyTimeList.",t),[];for(var r=0;r<i.curve._keys.length;r++)e.push(i.curve._keys[r].time);return e},CurveProp.prototype.getDuration=function(){var t=0;for(var e in this.propMap){var i=this.propMap[e],r=i.curve;if(r._keys.length>=1){var n=r._keys[r._keys.length-1].time;n>t&&(t=n)}}return t},CurveProp.prototype.getValue=function(t,e,i){var r=this.propMap[t],n=r.from,o=r.to,s=r.curveType,a=r.curve,h=a.evaluate(e);return i?h:s===qc.CURVE_TYPE_ABSOLUTE?h:s===qc.CURVE_TYPE_RELATIVE?n+h:s===qc.CURVE_TYPE_TWEEN_ABSOLUTE?n+h*(o-n):n+h*o},CurveProp.prototype.getValueByIndex=function(t,e){var i=this.propMap[t],r=i.curve;return r._keys[e]?r._keys[e].value:null},CurveProp.prototype.setValue=function(t,e,i){var r=this.isKey(t,e);if("number"!=typeof r)return this.addKey(t,e,i),e>this.action.duration&&(this.action.duration=e),!0;var n=this.propMap[t],o=n.curve;o._keys[r].value=i,n.curve.makeKeyframeLinear(r-1),n.curve.makeKeyframeLinear(r),n.curve.makeKeyframeLinear(r+1)},CurveProp.prototype.isKey=function(t,e){var i=this.propMap[t],r=i.curve;if(0===r._keys.length)return!1;for(var n=0;n<r._keys.length;n++)if(this.action.game.math.fuzzyEqual(r._keys[n].time,e))return n},CurveProp.prototype.update=function(t,e,i,r){i&&(this.keyIndexMap={});for(var n in this.propMap)if(r||!this.keyIndexMap[n]){var o,s=this.propMap[n],a=s.curve,h=s.curveType;if(i&&(h===qc.CURVE_TYPE_RELATIVE||h===qc.CURVE_TYPE_TWEEN_RELATIVE)){if(s.attribArray){var l=s.attribArray.length;if(2===l)o=t[s.attribArray[0]]?t[s.attribArray[0]][s.attribArray[1]]:null;else if(l>2){for(var c=t,u=0;l-1>u&&(c=c[s.attribArray[u]],c);u++);c&&(o=c[s.attribArray[l-1]])}}else o=t[n];s.from=o}if(a._keys.length>0&&a._keys[0].time<=e){var p=this.getFromValue(t,n,e),d=s.to,f=a.evaluate(e);if(r||a._keys[a._keys.length-1].time>e||(this.keyIndexMap[n]=1),o=h===qc.CURVE_TYPE_ABSOLUTE?f:h===qc.CURVE_TYPE_RELATIVE?p+f:h===qc.CURVE_TYPE_TWEEN_ABSOLUTE?p+f*(d-p):p+f*d,s.attribArray){var l=s.attribArray.length;if(2===l&&t[s.attribArray[0]])t[s.attribArray[0]][s.attribArray[1]]=o;else if(l>2){for(var c=t,u=0;l-1>u&&(c=c[s.attribArray[u]],c);u++);c&&(c[s.attribArray[l-1]]=o)}}else t[n]=o}}};var ActionState=qc.ActionState=function(t){var e=this;e.game=t,e.name="",e.targetObject=null,e.targetLocked=!1,e.eventList=[],e.samples=60,e.duration=0,e.speed=1,e.startTime=0,e.elapsedFrame=0,e.loop=!1,e.playEventInEditor=!0,e.isRunning=!1,e.onFinished=new qc.Signal,e.onLoopFinished=new qc.Signal,e.unpackDone=!1};ActionState.prototype.constructor=ActionState,ActionState.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject))},ActionState.prototype.destroy=function(){var t=this;t.targetObject=null,t.isRunning=!1,t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},ActionState.prototype.getDuration=function(){return this.duration},ActionState.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0},ActionState.prototype.playAction=function(t,e){return this.isRunning=!0,!this.targetLocked&&t&&(this.targetObject=t),e&&this.reset(),this.update(null,!0)},ActionState.prototype.stop=function(){this.isRunning=!1},ActionState.prototype.addEvent=function(t,e,i){var r=function(t,e){return t[0]<e[0]},n=qc.Util.insertSortedList(this.eventList,[t,e,i],r,!0);return n},ActionState.prototype.deleteEvent=function(t){return this.eventList?this.eventList.splice(t,1):null},ActionState.prototype.setEvent=function(t,e,i){var r=this.eventList[t];r&&(r[e]=i)},ActionState.prototype.getEventInfo=function(t){var e=this.eventList[t];if(e)return{func:e[1],para:e[2]}},ActionState.prototype.triggerEvent=function(t){var e=this.eventList[0][0],i=this.eventList[this.eventList.length-1][0];if(this.elapsedFrame>=e&&i>=t)for(var r=0;r<this.eventList.length;r++)if(this.eventList[r][0]>t){if(this.eventList[r][0]>this.elapsedFrame)break;if(this.eventList[r][1])for(var n=0;n<this.targetObject.scripts.length;n++){var o=this.targetObject.scripts[n];if(o[this.eventList[r][1]]){var s=this.eventList[r][2];Array.isArray(s)||(s="string"==typeof s?[s]:[]),o[this.eventList[r][1]].apply(o,s)}}}},ActionState.prototype.update=function(){},ActionState.buildEmptyBundle=function(){return{}},ActionState.buildBundle=function(t){var e={dependences:[]};return t.targetObject&&(e.targetObject=t.targetObject.uuid),e.targetLocked=t.targetLocked,e.loop=t.loop,e.samples=t.samples,e.speed=t.speed,e.playEventInEditor=t.playEventInEditor,t.name&&(e.name=t.name),e.eventList=JSON.stringify(t.eventList),e},ActionState.restoreBundle=function(t,e,i){var r=e.json,n=t.game;if(t.uuid=e.uuid,t.key=e.key,t.name=r.name?r.name:e.key.match(/\/([^\/]+?).bin/)[1],r.__json&&(t.__json=r.__json),r.eventList)try{t.eventList=JSON.parse(r.eventList)}catch(o){n.log.error(o)}return t.targetLocked=r.targetLocked,t.loop=r.loop,t.samples=r.samples||60,t.speed=r.speed||1,t.playEventInEditor="boolean"==typeof r.playEventInEditor?r.playEventInEditor:!0,t.targetObject=i?n.nodePool.find(r.targetObject):n.nodePool.find(r.targetObject)||r.targetObject,i&&t.awake(),t};var Action=qc.Action=function(t){var e=this;e.propertyList={},e.actionList=[],qc.ActionState.call(e,t),e.class="qc.Action"};Action.prototype=Object.create(qc.ActionState.prototype),Action.prototype.constructor=Action,Object.defineProperties(Action.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){this.unpackDone&&t===this._targetObject&&this._targetObject||(this._targetObject=t,this.unpackDone&&(this.actionList=[],t&&this.refreshActionList()))}}}),Action.prototype.awake=function(){return this.unpackDone=!0,"string"==typeof this.targetObject?this.targetObject=this.game.nodePool.find(this.targetObject):"object"==typeof this.targetObject&&0===this.actionList.length&&this.refreshActionList(),!this.targetObject&&this.targetLocked?(this.game.log.trace("Action({0}) can not find targetObject.",this.name),undefined):undefined},Action.prototype.destroy=function(){var t=this;t.targetObject=null,t.isRunning=!1;for(var e in t.propertyList)t.propertyList[e].destroy();t.propertyList={},t.actionList=[],t.eventList=[],t.onFinished.removeAll(),t.onLoopFinished.removeAll()},Action.prototype.refreshActionList=function(){if(!this.targetObject)return this.game.log.trace("Action({0}) can not find targetObject.",this.name),undefined;this.actionList=[];for(var t in this.propertyList){var e=t.match(/(.*):(.*)/),i=e[1],r=(e[2],this.targetObject.find(i));r?this.actionList.push({target:r,propOb:this.propertyList[t]}):this.game.log.error("In action({0}), target({1}) not find child({2})",this.key,this.targetObject?this.targetObject.name:null,i)}},Action.prototype.addProperty=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];if(o)return this.game.log.important("Action has duplicate key : {0} in addProperty",n),undefined;var s=qc.ActionProperties[e];if(!s)return this.game.log.important("Can't find propertyId : {0} in addProperty",e),undefined;var a=qc.Util.findClass(s.class);o=new a(this,t,e);var h=o.fromJson(s,i);this.duration<h&&(this.duration=h),this.propertyList[n]=o,r&&this.refreshActionList()},Action.prototype.removeProperty=function(t,e){var i=t+":"+e,r=this.propertyList[i];return r?(r.destroy(),delete this.propertyList[i],this.refreshActionList(),this.duration=this.getDuration(!0,!0),undefined):(this.game.log.important("Action not find key : {0} in removeProperty",i),undefined)},Action.prototype.getPropertyInfo=function(t,e){var i=t+":"+e,r=this.propertyList[i];return r?r.getPropMap():(this.game.log.important("Action not find key : {0} in getPropertyInfo",i),undefined)},Action.prototype.setData=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];return o?(o.setData(i,r),undefined):(this.game.log.important("Action has't property : {0} in setData",n),undefined)},Action.prototype.addKey=function(t,e,i,r,n){var o=t+":"+e,s=this.propertyList[o];if(!s)return this.game.log.important("Action has't property : {0} in addKey",o),undefined;s.addKey(i,r,n);r>this.duration&&(this.duration=r)},Action.prototype.deleteKey=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];if(!o)return this.game.log.important("Action has't property : {0} in deleteKey",n),undefined;var s=o.getKeyTimeList(i),a=s[r];o.deleteKey(i,r),this.duration==a&&(this.duration=this.getDuration(!0,!0))},Action.prototype.getDuration=function(t,e){if(t){var i=0;for(var r in this.propertyList){var n=this.propertyList[r],o=n.getDuration();o>i&&(i=o)}this.duration=i}return this.loop&&!e?qc.MAX_DURATION:this.duration},Action.prototype.getValue=function(t,e,i,r,n){var o=t+":"+e,s=this.propertyList[o];return s?s.getValue(i,r,n):(this.game.log.important("Action has't property : {0} in getValue",o),undefined)},Action.prototype.getValueByIndex=function(t,e,i,r){var n=t+":"+e,o=this.propertyList[n];return o?o.getValueByIndex(i,r):(this.game.log.important("Action has't property : {0} in getValueByIndex",n),undefined)},Action.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0;for(var t=0;t<this.actionList.length;t++){var e=this.actionList[t];e.propOb.reset()}},Action.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var o=this.elapsedFrame-this.duration;o>=this.duration;)o-=this.duration;t=o/(this.samples*this.speed)*1e3,this.reset(),this.startTime=n-t}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var s=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed;for(var a=0;a<this.actionList.length;a++){var h=this.actionList[a];h.propOb.update(h.target,this.elapsedFrame,e,i,r)}(!i||this.playEventInEditor)&&this.eventList.length>0&&this.triggerEvent(s)}},Action.buildEmptyBundle=function(){return{propertyList:{}}},Action.buildBundle=function(t){var e=qc.ActionState.buildBundle(t),i={};for(var r in t.propertyList){var n=r.match(/(.*):(.*)/),o=n[1],s=n[2];i[o]=i[o]||{},i[o][s]=t.propertyList[r].toJson(e)}return e.propertyList=i,e},Action.restoreBundle=function(t,e,i){var r=t.json,n=new qc.Action(e);for(var o in r.propertyList)for(var s in r.propertyList[o])n.addProperty(o,s,r.propertyList[o][s]);return n=qc.ActionState.restoreBundle(n,t,i)},qc.MAX_DURATION=4294967295,qc.CURVE_TYPE_RELATIVE=1,qc.CURVE_TYPE_ABSOLUTE=2,qc.CURVE_TYPE_TWEEN_RELATIVE=3,qc.CURVE_TYPE_TWEEN_ABSOLUTE=4,qc.PROP_POSITION=1,qc.PROP_ROTATION=2,qc.PROP_ALPHA=3,qc.PROP_SCALE=4,qc.PROP_COLOR_TINT=5,qc.PROP_VISIBLE=6,qc.PROP_SIZE=7,qc.PROP_SKEW=8,qc.PROP_TEXTURE=9,qc.PROP_ANIMATION=10,qc.PROP_COLOR=11,qc.PROP_TEXT=12,qc.PROP_PIVOT=13,qc.PROP_ANCHORED_POSITION=14,qc.PROP_TOGGLE_ON=15,qc.PROP_SCROLLBAR_VALUE=16,qc.PROP_SCROLLVIEW_POSITION=17,qc.PROP_PROGRESSBAR_VALUE=18,qc.PROP_SLIDER_VALUE=19,qc.PROP_SOUND=20,qc.PROP_DOM_INNERHTML=21,qc.PROP_TILEMAP_POSITION=22,qc.ActionProperties={},qc.ActionProperties[qc.PROP_POSITION]={name:"Position","class":"qc.CurveProp",curve:!0,properties:[{attrib:"x",type:Serializer.NUMBER},{attrib:"y",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ANCHORED_POSITION]={name:"AnchoredPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"anchoredX",type:Serializer.NUMBER},{attrib:"anchoredY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ROTATION]={name:"Rotation","class":"qc.CurveProp",curve:!0,properties:[{attrib:"rotation",type:"angle"}]},qc.ActionProperties[qc.PROP_ALPHA]={name:"Alpha","class":"qc.CurveProp",curve:!0,properties:[{attrib:"alpha",type:Serializer.NUMBER,min:0,max:1,precision:2}]},qc.ActionProperties[qc.PROP_SCALE]={name:"Scale","class":"qc.CurveProp",curve:!0,properties:[{attrib:"scaleX",type:Serializer.NUMBER},{attrib:"scaleY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_COLOR_TINT]={name:"ColorTint","class":"qc.ColorLinearProp",properties:[{attrib:"colorTint",type:Serializer.COLOR,"default":qc.Color.white}]},qc.ActionProperties[qc.PROP_VISIBLE]={name:"Visible","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"visible",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_SIZE]={name:"Size","class":"qc.CurveProp",curve:!0,properties:[{attrib:"width",type:Serializer.NUMBER},{attrib:"height",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PIVOT]={name:"Pivot","class":"qc.CurveProp",curve:!0,properties:[{attrib:"pivotX",type:Serializer.NUMBER},{attrib:"pivotY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SKEW]={name:"Skew","class":"qc.CurveProp",curve:!0,properties:[{attrib:"skewX",type:"angle"},{attrib:"skewY",type:"angle"}]},qc.ActionProperties[qc.PROP_TEXTURE]={name:"Texture","class":"qc.TextureKeyProp",forceUpdate:!0,properties:[{attrib:"texture",type:Serializer.TEXTURE}]},qc.ActionProperties[qc.PROP_ANIMATION]={name:"Animation","class":"qc.AnimationKeyProp",properties:[{attrib:"defaultAnimation",type:Serializer.STRING}]},qc.ActionProperties[qc.PROP_COLOR]={name:"Color","class":"qc.ColorLinearProp",properties:[{attrib:"color",type:Serializer.COLOR,"default":qc.Color.white}]},qc.ActionProperties[qc.PROP_TEXT]={name:"Text","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"text",type:Serializer.STRING,"default":""}]},qc.ActionProperties[qc.PROP_TOGGLE_ON]={name:"ToggleOn","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"on",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_SCROLLBAR_VALUE]={name:"ScrollBarValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SCROLLVIEW_POSITION]={name:"ScrollViewPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"horizontalNormalizedPosition",type:Serializer.NUMBER},{attrib:"verticalNormalizedPosition",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PROGRESSBAR_VALUE]={name:"ProgressBarValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SLIDER_VALUE]={name:"SliderValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SOUND]={name:"Sound","class":"qc.KeyProp",properties:[{attrib:"audio",type:Serializer.AUDIO},{attrib:"isPlaying",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_DOM_INNERHTML]={name:"DomInnerHTML","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"innerHTML",type:Serializer.STRING,"default":""}]},qc.ActionProperties[qc.PROP_TILEMAP_POSITION]={name:"TilemapPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"scrollX",type:Serializer.NUMBER},{attrib:"scrollY",type:Serializer.NUMBER}]},qc.FinishTrigger=1,qc.EventTrigger=2,qc.propertyList={"qc.Node":[qc.PROP_POSITION,qc.PROP_ANCHORED_POSITION,qc.PROP_ROTATION,qc.PROP_ALPHA,qc.PROP_SCALE,qc.PROP_COLOR_TINT,qc.PROP_VISIBLE,qc.PROP_SIZE,qc.PROP_PIVOT],"qc.UIImage":[qc.PROP_SKEW,qc.PROP_TEXTURE],"qc.Sprite":[qc.PROP_TEXTURE,qc.PROP_ANIMATION],"qc.UIText":[qc.PROP_COLOR,qc.PROP_TEXT],"qc.Button":[qc.PROP_TEXTURE],"qc.Toggle":[qc.PROP_TOGGLE_ON],"qc.ScrollBar":[qc.PROP_TEXTURE,qc.PROP_SCROLLBAR_VALUE],"qc.ScrollView":[qc.PROP_TEXTURE,qc.PROP_SCROLLVIEW_POSITION],"qc.ProgressBar":[qc.PROP_TEXTURE,qc.PROP_PROGRESSBAR_VALUE],"qc.Slider":[qc.PROP_TEXTURE,qc.PROP_SLIDER_VALUE],"qc.InputField":[qc.PROP_TEXTURE,qc.PROP_TEXT],"qc.Sound":[qc.PROP_SOUND],"qc.Dom":[qc.PROP_DOM_INNERHTML],"qc.Graphics":[],"qc.UIRoot":[],"qc.Tilemap":[qc.PROP_TILEMAP_POSITION]},qc.extend=qc.extend||{},qc.extend.addProperty=function(t,e,i){qc.ActionProperties[e]=i===qc.Serializer.NUMBER?{name:e,"class":"qc.CurveProp",curve:!0,isCustomProperty:!0,properties:[{attrib:e,type:qc.Serializer.NUMBER}]}:i===qc.Serializer.TEXTURE?{name:e,"class":"qc.TextureKeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:qc.Serializer.TEXTURE}]}:i===qc.Serializer.COLOR?{name:e,"class":"qc.ColorLinearProp",isCustomProperty:!0,properties:[{attrib:e,type:Serializer.COLOR,"default":qc.Color.white}]}:{name:e,"class":"qc.KeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:e,type:i}]},qc.propertyList[t]=qc.propertyList[t]||[],qc.propertyList[t].push(e)
};var ActionManager=qc.ActionManager=function(t){var e=this;e.actionList=[],qc.ActionState.call(e,t),e.class="qc.ActionManager",e._endLinePos=-1,e.runningActions={}};ActionManager.prototype=Object.create(qc.ActionState.prototype),ActionManager.prototype.constructor=ActionManager,ActionManager.prototype.awake=function(){if(this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject)),!this.targetObject&&this.targetLocked)return this.game.log.trace("Action({0}) can not find targetObject.",this.name),undefined;for(var t=0;t<this.actionList.length;t++)this.actionList[t]&&this.actionList[t][1]&&this.actionList[t][1].awake()},ActionManager.prototype.destroy=function(){var t=this;t.isRunning=!1,t._targetObject=null;for(var e=0;e<this.actionList.length;e++)this.actionList[e]&&this.actionList[e][1]&&this.actionList[e][1].destroy();t.actionList=[]},Object.defineProperties(ActionManager.prototype,{targetObject:{get:function(){return this._targetObject},set:function(t){if(!this.unpackDone||t!==this._targetObject||!this._targetObject){this._targetObject=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&!i.targetLocked&&(i.targetObject=t)}}}},isRunning:{get:function(){return this._isRunning},set:function(t){this._isRunning=t;for(var e=0;e<this.actionList.length;e++)if(this.actionList[e]){var i=this.actionList[e][1];i&&(i.isRunning=t)}}},endLinePos:{get:function(){return this._endLinePos},set:function(t){this._endLinePos=t,t>-1?this.duration=t:this.getDuration(!0)}}}),ActionManager.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0,this.runningActions={};for(var t=0;t<this.actionList.length;t++)if(this.actionList[t]){var e=this.actionList[t][1];e&&e.reset()}},ActionManager.prototype.update=function(t,e,i,r){if((this.isRunning||i)&&this.targetObject){var n=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var o=this.elapsedFrame-this.duration;o>=this.duration;)o-=this.duration;t=o/(this.samples*this.speed)*1e3,this.reset();var s=function(t,e,i){t.startTime=e;var r=i*t.samples*t.speed/1e3;if(t.duration<r&&(t.elapsedFrame=r),t instanceof qc.ActionManager)for(var n=0;n<t.actionList.length;n++){var o=t.actionList[n];if(o){var a=o[1];s(a,e,i)}}};s(this,n-t,t)}t="number"==typeof t?t:this.game.time.deltaTime,this.startTime||(this.startTime=n),n===this.startTime&&(t=0);var a=e?-1:this.elapsedFrame;this.elapsedFrame+=t/1e3*this.samples*this.speed,this.eventList.length<=0||i&&!this.playEventInEditor||this.triggerEvent(a),t*=this.speed;for(var h=0;h<this.actionList.length;h++){var l=this.actionList[h];if(l){var n=l[0],c=l[1];if(this.elapsedFrame>=n){var u=!1;this.runningActions[h]||(u=!0),c.update(t,u,i,r),this.runningActions[h]=!0}}}}},ActionManager.prototype.addAction=function(t){var e=this,i=e.actionList.push(t),r=t[0],n=t[1];if(n.parent=e,e.endLinePos>-1)return i;var o=n.getDuration();if(o===qc.MAX_DURATION)e.duration=o;else{var s=e.samples,a=n.samples;o=o*s/a,e.duration<r+o&&(e.duration=r+o)}return i},ActionManager.prototype.deleteAction=function(t){var e=this;if(e.actionList[t]){var i=e.actionList[t][1],r=0;if(i){var n=i.getDuration();if(n===qc.MAX_DURATION)r=qc.MAX_DURATION;else{var o=e.samples,s=i.samples;n=n*o/s,r=e.actionList[t][0]+n}i.destroy(),i.parent=undefined}delete e.actionList[t],this.duration===r&&this.getDuration(!0)}},ActionManager.prototype.updateActionTime=function(t,e){var i=this,r=i.actionList[t];r&&(r[0]=e,i.getDuration(!0))},ActionManager.prototype.getDuration=function(t,e){if(t&&this.endLinePos<=-1){for(var i=0,r=0;r<this.actionList.length;r++){var n=this.actionList[r];if(n){var o=n[1].getDuration(),s=n[0];if(o===qc.MAX_DURATION)i=qc.MAX_DURATION;else{var a=this.samples,h=n[1].samples;o=o*a/h/n[1].speed,s+o>i&&(i=s+o)}}}this.duration=i}return this.loop&&!e?qc.MAX_DURATION:this.endLinePos>-1?this.endLinePos:this.duration},ActionManager.buildEmptyBundle=function(){return{actionList:[]}},ActionManager.buildBundle=function(t){var e=qc.ActionState.buildBundle(t);e.endLinePos=t.endLinePos;for(var i=[],r=0;r<t.actionList.length;r++){var n=t.actionList[r];if(n){var o=n[1],s=n[0],a=o.uuid,h=o.loop,l=o.targetObject?o.targetObject.uuid:undefined;e.dependences.push({key:o.key,uuid:a}),i.push([s,a,h,l,o.targetLocked,o.speed])}}return e.actionList=i,e},ActionManager.restoreBundle=function(t,e,i,r){var n=t.json,o=new qc.ActionManager(e);if(r||(r={}),r[t.uuid])return e.log.error("Failed to add this action({0}) because of recursive reference.",t.key),!1;r[t.uuid]=!0,o.endLinePos=n.endLinePos?n.endLinePos:-1;for(var s=0;s<n.actionList.length;s++){var a=n.actionList[s]||[],h=a[0],l=a[1],c=a[2],u=a[3],p=a[4],d=a[5]||1,f=e.assets.findByUUID(l);if(f){var g;if(f instanceof qc.ActionAsset)g=qc.Action.restoreBundle(f,e,!e.serializer.isRestoring);else if(f instanceof qc.ActionManagerAsset&&(g=qc.ActionManager.restoreBundle(f,e,!e.serializer.isRestoring,r),!g))return delete r[t.uuid],!1;g.loop=c,g.speed=d,g.targetObject=e.serializer.isRestoring?e.nodePool.find(u)||u:e.nodePool.find(u),g.targetLocked=p,o.addAction([h,g])}}return delete r[t.uuid],o=qc.ActionState.restoreBundle(o,t,i)};var AnimationKeyProp=qc.AnimationKeyProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};AnimationKeyProp.prototype=Object.create(qc.KeyProp.prototype),AnimationKeyProp.prototype.constructor=AnimationKeyProp,AnimationKeyProp.prototype.updateAttrib=function(t,e,i){for(var r=this.action,n=r.speed;r.parent;)n*=r.parent.speed,r=r.parent;t.playAnimation(i,n)};var ColorLinearProp=qc.ColorLinearProp=function(t,e,i){var r=this;qc.LinearProp.call(r,t,e,i)};ColorLinearProp.prototype=Object.create(qc.LinearProp.prototype),ColorLinearProp.prototype.constructor=ColorLinearProp,ColorLinearProp.prototype.calcValue=function(t,e,i){if(!t||!e)return qc.Color.white;var r=t.rgb,n=e.rgb,o=[Phaser.Math.clamp(Math.round(r[0]+i*(n[0]-r[0])),0,255),Phaser.Math.clamp(Math.round(r[1]+i*(n[1]-r[1])),0,255),Phaser.Math.clamp(Math.round(r[2]+i*(n[2]-r[2])),0,255),Phaser.Math.clamp(t.alpha+i*(e.alpha-t.alpha),0,1)],s=new Color(o);return s};var TextureKeyProp=qc.TextureKeyProp=function(t,e,i){var r=this;qc.KeyProp.call(r,t,e,i)};TextureKeyProp.prototype=Object.create(qc.KeyProp.prototype),TextureKeyProp.prototype.constructor=TextureKeyProp,TextureKeyProp.prototype.updateAttrib=function(t,e,i,r){if(!i){var n=this.action.game.assets.find("__builtin_resource__"),o=n?n.frameNames[0]:0;i=[n,o]}var n=i[0],o=i[1],s=n?new qc.Texture(n,o):null;if(r){var a=r.length;if(2===a&&t[r[0]])t[r[0]][r[1]]=s;else if(a>2){for(var h=t,l=0;a-1>l&&(h=h[r[l]],h);l++);h&&(h[r[a-1]]=s)}}else t[e]=s};var Time=qc.Time=function(t){this.phaser=t.phaser.time,this.phaser._qc=this,this.onFrameRateChanged=new qc.Signal};Time.prototype.constructor=Time,Object.defineProperties(Time.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return 1e3*this.phaser.totalElapsedSeconds()}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(t){t>0||(t=1e-6),this.phaser.slowMotion=t}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(t){this.phaser.desiredFps=t,this.onFrameRateChanged.dispatch(t)}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}}),Time.prototype.applyFrameRate=function(t){var e=this.game.device.desktop?t.desktop:t.mobile;this.frameRate=e};var LinkList=qc.LinkList=function(t){for(this.length=t,this.head=null,this.tail=null;t--;)this.push({})};LinkList.prototype={},LinkList.prototype.constructor=LinkList,LinkList.prototype.push=function(t){t.pre=null,t.next=null,this.head?(this.tail.next=t,t.pre=this.tail,this.tail=this.tail.next):(this.head=t,this.tail=this.head),this.length++},LinkList.prototype.insertBefore=function(t,e){if(!t)return this.push(e),undefined;var i=t.pre;t.pre=e,e.next=t,e.pre=i,i&&(i.next=e),e.pre||(this.head=e)},LinkList.prototype.remove=function(t){var e=t.pre,i=t.next;e&&(e.next=i),i&&(i.pre=e),t===this.head&&(this.head=i),t===this.tail&&(this.tail=e),t.pre=null,t.next=null,this.length--};var Timer=qc.Timer=function(t){var e=this;e.game=t,e.paused=!1,e.events=new qc.LinkList(0),e.loopEvents=new qc.LinkList(0),this._nextTimerBegin=0,this._nextLoopTimerBegin=0};Timer.prototype.constructor=Timer,Timer.prototype.create=function(t,e,i,r,n){t=Math.round(t);var o=new Phaser.TimerEvent(this,t,t,0,e,i,r,n);return this._pushEvent(e?this.loopEvents:this.events,o),o},Timer.prototype.add=function(t,e,i){var t=t>0?t:1;return t+=this._nextTimerBegin,this.create(t,!1,e,i,Array.prototype.splice.call(arguments,3))},Timer.prototype.loop=function(t,e,i){var t=t>0?t:1;return t+=this._nextLoopTimerBegin,this.create(t,!0,e,i,Array.prototype.splice.call(arguments,3))},Timer.prototype.remove=function(t){t.__delete=!0},Timer.prototype.update=function(t){if(!this.paused){this._now=this._now?this._now:t;var e=(t-this._now)/this.game.time.timeScale;this._now=t;for(var i=this.events.head,r=e,n=0;i&&(i.delta-=r,i.delta<=0);){if(n++,n>2e3)throw Error("timer loop forever!");this._nextTimerBegin=r=-i.delta,this.events.remove(i),i.__delete||i.callback.apply(i.callbackContext,i.args),i=this.events.head}this._nextTimerBegin=0;var o=[];for(i=this.loopEvents.head,r=e;i&&(i.delta-=r,i.delta<=0);)this._nextLoopTimerBegin=r=-i.delta,this.loopEvents.remove(i),i.__delete||(o.push(i),i.callback.apply(i.callbackContext,i.args)),i=this.loopEvents.head;this._nextLoopTimerBegin=0;for(var s=0;s<o.length;s++)this._pushEvent(this.loopEvents,o[s])}},Timer.prototype._pushEvent=function(t,e){var i=t.head;if(!i)return e.delta=e.delay,t.push(e),undefined;for(var r=e.delay;i;){if(r<i.delta)return i.delta-=r,e.delta=r,t.insertBefore(i,e),e;r-=i.delta,i=i.next}return e.delta=r,t.push(e),e},qc.TimerEvent=Phaser.TimerEvent;var Filter=qc.Filter=function(t){Phaser.Filter.call(this,t),this._textureCount=1,this.extraAttribute=[],this.customInspectors={}};Filter.prototype=Object.create(Phaser.Filter.prototype),Filter.prototype.constructor=Filter,Object.defineProperties(Filter.prototype,{textureCount:{get:function(){return this._textureCount}}}),Filter.prototype.registerCustomInspector=function(t,e){this.customInspectors[t]=e},Filter.filters={},Filter.F1="1f",Filter.F1V="1fv",Filter.I1="1i",Filter.F2="2f",Filter.F2V="2fv",Filter.I2="2i",Filter.I2V="2iv",Filter.F3="3f",Filter.F3V="3fv",Filter.I3="3i",Filter.I3V="3iv",Filter.F4="4f",Filter.F4V="4fv",Filter.I4="4i",Filter.I4V="4iv",Filter.MAT2="mat2",Filter.MAT3="mat3",Filter.MAT4="mat4",Filter.SAMPLER2D="sampler2D",Filter.MAX_SAMPLE_COUNT=8,Filter.mixinUniform=function(t,e){if(e)for(var i in e){var r=e[i],n=r===Filter.SAMPLER2D;if(!n||t.textureCount<Filter.MAX_SAMPLE_COUNT){var o=function(){var e=i;return n?(t._textureCount++,function(){return t[e]&&t[e].filterTexture}):function(){return t[e]}};if(t.uniforms[i]=new UniformHelp(r,o()),n){var s="a"+i.substring(0,1).toUpperCase()+i.substring(1)+"Coord";t.extraAttribute.push({name:s,texture:i})}}}},Filter.uniformToJson=function(t,e,i){switch(t){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return[t,e];case Filter.I2:case Filter.F2:return[t,[e.x,e.y]];case Filter.I3:case Filter.F3:return[t,[e.x,e.y,e.z]];case Filter.I4:case Filter.F4:return[t,[e.x,e.y,e.z,e.w]];case Filter.SAMPLER2D:if(!(e instanceof FilterTexture))return[t,[]];var r=e.texture;return r?(i.dependences.push({key:r.key,uuid:r.uuid}),[t,[r.key,r.url,r.uuid,e.frame]]):[t,[]]}return[t,[]]},Filter.uniformFromJson=function(t,e,i,r,n){if(n)switch(r){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return e[i]=n,undefined;case Filter.I2:case Filter.F2:return e[i]?(e[i].x=n[0],e[i].y=n[1]):e[i]={x:n[0],y:n[1]},undefined;case Filter.I3:case Filter.F3:return e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2]):e[i]={x:n[0],y:n[1],z:n[2]},undefined;case Filter.I4:case Filter.F4:return e[i]?(e[i].x=n[0],e[i].y=n[1],e[i].z=n[2],e[i].w=n[3]):e[i]={x:n[0],y:n[1],z:n[2],w:n[3]},undefined;case Filter.SAMPLER2D:if(!n)return;var o=new FilterTexture(t);if(n.length>0){var s=t.assets.find(n[0],n[1]);if(s||(s=t.assets.findByUUID(n[2])),!s)return t.log.error("Texture({0}) not loaded, deserialize fail.",n[1]),undefined;if(!(s instanceof qc.Atlas))return;o.texture=s,o.frame=n[3]}return e[i]=o,undefined}},Serializer.prototype._saveFilter=function(t,e,i,r,n){n&&(e[r]=this._saveFilterItem(n,i))},Serializer.prototype._restoreFilter=function(t,e,i,r){t[i]=this._restoreFilterItem(r)},Serializer.prototype._saveFilterItem=function(t,e){var i=t.getExtraUniforms(),r={};for(var n in i){var o=i[n];r[n]=Filter.uniformToJson(o,t[n],e)}return[Serializer.FILTER,t.class,r]},Serializer.prototype._restoreFilterItem=function(t){var e=qc.Util.findClass(t[1]);if(!e)return console.warn("着色器脚本：{0}未找到，无法反序列化。",t[1]),undefined;var i=t[2],r=new e(this.game),n=r.getExtraUniforms();for(var o in n){var s=n[o];i[o]&&s===i[o][0]&&Filter.uniformFromJson(this.game,r,o,s,i[o][1])}return r};var defineFilter=qc.defineFilter=function(t,e,i,r){for(var n=t.split("."),o=window,s=0;s<n.length-1;s++)o[n[s]]||(o[n[s]]={}),o=o[n[s]];var a=n[n.length-1];return e=e||qc.Filter,"function"==typeof r&&(r=r.call(this)),r=r||{},o[a]=function(r){e.call(this,r),this.class=t,this.super=e.prototype;var n=this.getExtraUniforms();Filter.mixinUniform(this,n),"function"==typeof i&&i.call(this,r)},o[a].prototype=Object.create(e.prototype),o[a].prototype.constructor=o[a],o[a].prototype.getExtraUniforms=function(){var t=e.prototype.getExtraUniforms?e.prototype.getExtraUniforms.call(this):{};return mixin(t,r)},o[a].prototype.clazz=t,Filter.filters[t]=o[a],o[a]},FilterTexture=qc.Filter.FilterTexture=function(t){this._image=new qc.UIImage(t,null,!1),this._image.parent.removeChild(this._image)};FilterTexture.prototype={},FilterTexture.prototype.constructor=FilterTexture,Object.defineProperties(FilterTexture.prototype,{texture:{get:function(){return this._image.texture},set:function(t){this._image.texture=t}},frame:{get:function(){return this._image.frame},set:function(t){this._image.frame=t}},filterTexture:{get:function(){return this._image.phaser.texture}}});var UniformHelp=qc.Filter.UniformHelp=function(t,e){this._type=t,this._value=e,this._valueIsFunc="function"==typeof this._value};UniformHelp.prototype={},UniformHelp.prototype.constructor=UniformHelp,Object.defineProperties(UniformHelp.prototype,{type:{get:function(){return this._type}},value:{get:function(){return this._valueIsFunc?this._value():this._value}}});var BlendTexture=defineFilter("qc.Filter.AlphaMask",qc.Filter,function(){this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D}),BlendTexture=defineFilter("qc.Filter.BlendTexture",qc.Filter,function(){this.mixing=.5,this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D,mixing:qc.Filter.F1}),BlurX=defineFilter("qc.Filter.BlurX",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurX.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var BlurY=defineFilter("qc.Filter.BlurY",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurY.prototype,"blur",{get:function(){return this._blur},set:function(t){this.dirty=!0,this._blur=t,this.padding=Math.max(0,t)}});var Glow=defineFilter("qc.Filter.Glow",qc.Filter,function(t){this.distance=40,this.outerStrength=1.5,this.innerStrength=1,this.glowColor=[1,0,0],this.pixelWidth=1/t.phaser.renderer.width,this.pixelHeight=1/t.phaser.renderer.height,this._updateFragmentSrc(),this.registerCustomInspector("glowColor",qc.Color)},{distance:qc.Filter.F1,outerStrength:qc.Filter.F1,innerStrength:qc.Filter.F1,glowColor:qc.Filter.F3V});Object.defineProperty(Glow.prototype,"distance",{get:function(){return this._distance},set:function(t){this._distance=t,this._updateFragmentSrc(),this.shaders=[]}}),Glow.prototype._updateFragmentSrc=function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D texture;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec3 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2("+this.pixelWidth+", "+this.pixelHeight+");","void main(void) {","    const float PI = 3.14159265358979323846264;","    vec4 ownColor = texture2D(texture, vTextureCoord);","    vec4 curColor;","    float totalAlpha = 0.;","    float maxTotalAlpha = 0.;","    float offset = 0.;","    for (float curDistance = 0.; curDistance <= "+this.distance.toFixed(7)+"; curDistance++) {","       offset = curDistance - distance / 2.;","       curColor = texture2D(texture, vec2(vTextureCoord.x + offset * px.x, vTextureCoord.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x, vTextureCoord.y + offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.25) * offset * px.x, vTextureCoord.y + sin(PI * 0.25) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.75) * offset * px.x, vTextureCoord.y + sin(PI * 0.75) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","    }","    maxTotalAlpha = max(maxTotalAlpha, 0.0001);","    ownColor.a = max(ownColor.a, 0.0001);","    ownColor.rgb = ownColor.rgb / ownColor.a;","    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","    float resultAlpha = (ownColor.a + outerGlowAlpha);","    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);","}"]};var GraphicsTexture=qc.Filter.GraphicsTexture=function(t,e,i,r,n){var o=this;o.game=t,o._texture=new qc.RenderTexture(e||100,i||100,r||o.game.phaser.render,null,n||o.game.resolution),o.offset=new qc.Point(0,0),o._graphics=o.game.phaser.add.graphics(0,0),o._graphics.parent&&o._graphics.parent.remove(o._graphics)};GraphicsTexture.prototype={},GraphicsTexture.prototype.constructor=GraphicsTexture,Object.defineProperties(GraphicsTexture.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}}),GraphicsTexture.prototype.updateTexture=function(){var t=this,e=t._texture,i=t._graphics;i.dirty&&e.directRenderWebGL(i,t.offset,!0)},GraphicsTexture.prototype.resize=function(t,e){t=t>1?t:1,e=e>1?e:1,this._texture.resize(t,e,!0)};var Gray=defineFilter("qc.Filter.Gray",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{}),Highlight=defineFilter("qc.Filter.Highlight",qc.Filter,function(){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"],this.light=.5,this.lightColor=[1,1,1],this.registerCustomInspector("lightColor",qc.Color)},{light:qc.Filter.F1,lightColor:qc.Filter.F3V}),KeepSource=defineFilter("qc.Filter.KeepSource",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}}).call(this,this,Object);
